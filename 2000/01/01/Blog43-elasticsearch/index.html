<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.10.1","exturl":false,"sidebar":{"position":"left","width":500,"display":"always","padding":1,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="elasticsearch">
<meta property="og:type" content="article">
<meta property="og:title" content="Blog43-elasticsearch">
<meta property="og:url" content="http://example.com/2000/01/01/Blog43-elasticsearch/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="elasticsearch">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="1999-12-31T16:00:43.000Z">
<meta property="article:modified_time" content="2023-09-09T07:46:36.164Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2000/01/01/Blog43-elasticsearch/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://example.com/2000/01/01/Blog43-elasticsearch/","path":"2000/01/01/Blog43-elasticsearch/","title":"Blog43-elasticsearch"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Blog43-elasticsearch | Hexo</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Hexo</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Blog43-elasticsearch"><span class="nav-text">Blog43-elasticsearch</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%AE%E5%8A%A9"><span class="nav-text">帮助</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%86%85%E5%AE%B9%E7%AE%A1%E7%90%86"><span class="nav-text">内容管理</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter01-ElasticSearch-%E5%9F%BA%E7%A1%80"><span class="nav-text">Chapter01 ElasticSearch 基础</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-ES-%E4%BB%8B%E7%BB%8D"><span class="nav-text">1.1 ES 介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E5%85%A8%E6%96%87%E6%A3%80%E7%B4%A2"><span class="nav-text">知识点：全文检索</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AElasticStack-%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：ElasticStack 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AES-%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：ES 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AES-%E7%9B%AE%E5%BD%95%E4%BD%93%E7%B3%BB"><span class="nav-text">知识点：ES 目录体系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AES-%E8%BF%90%E8%A1%8C%E6%97%A5%E5%BF%97"><span class="nav-text">知识点：ES 运行日志</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-ES-%E5%AE%89%E8%A3%85"><span class="nav-text">1.2 ES 安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AES-tar-gz-%E5%AE%89%E8%A3%85"><span class="nav-text">知识点：ES tar.gz 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AES-rpm-%E5%AE%89%E8%A3%85"><span class="nav-text">知识点：ES rpm 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AES-docker-%E5%AE%89%E8%A3%85"><span class="nav-text">知识点：ES docker 安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-ES-%E9%85%8D%E7%BD%AE"><span class="nav-text">1.3 ES 配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AES-%E9%85%8D%E7%BD%AE"><span class="nav-text">知识点：ES 配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AES-%E4%B8%AD%E7%9A%84%E6%A6%82%E5%BF%B5"><span class="nav-text">知识点：ES 中的概念</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter02-ElasticSearch-%E8%A6%81%E7%B4%A0"><span class="nav-text">Chapter02 ElasticSearch 要素</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-Restful-API"><span class="nav-text">2.1 Restful API</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ARestful-API-%E7%AE%80%E4%BB%8B"><span class="nav-text">知识点：Restful API 简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AES-%E9%9B%86%E7%BE%A4%E8%AE%BF%E9%97%AE"><span class="nav-text">知识点：ES 集群访问</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A-cat-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：_cat 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A-search-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：_search 指令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E7%B4%A2%E5%BC%95"><span class="nav-text">2.2 索引</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E7%B4%A2%E5%BC%95%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：索引介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E5%80%92%E6%8E%92%E7%B4%A2%E5%BC%95"><span class="nav-text">知识点：倒排索引</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E7%B4%A2%E5%BC%95-Restful-API"><span class="nav-text">知识点：索引 Restful API</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-%E6%98%A0%E5%B0%84"><span class="nav-text">2.3 映射</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E6%98%A0%E5%B0%84%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：映射介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E6%98%A0%E5%B0%84-Restful-API"><span class="nav-text">知识点：映射 Restful API</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-%E6%96%87%E6%A1%A3"><span class="nav-text">2.4 文档</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E6%96%87%E6%A1%A3"><span class="nav-text">知识点：文档</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E6%9F%A5%E8%AF%A2%E6%96%87%E6%A1%A3-Restful-API"><span class="nav-text">知识点：查询文档 Restful API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E6%B7%BB%E5%8A%A0%E6%96%87%E6%A1%A3-Restful-API"><span class="nav-text">知识点：添加文档 Restful API</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E5%88%A0%E9%99%A4%E6%96%87%E6%A1%A3-Restful-API"><span class="nav-text">知识点：删除文档 Restful API</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter03-QueryDSL"><span class="nav-text">Chapter03 QueryDSL</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-QueryDSL-%E5%9F%BA%E7%A1%80"><span class="nav-text">3.1 QueryDSL 基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AQueryDSL-%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：QueryDSL 介绍</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter05-Kibana"><span class="nav-text">Chapter05 Kibana</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-Kibana-%E5%9F%BA%E7%A1%80"><span class="nav-text">5.1 Kibana 基础</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AKibana-%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：Kibana 介绍</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-2-Kibana-%E5%AE%89%E8%A3%85"><span class="nav-text">5.2 Kibana 安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AKibana-rpm-%E5%AE%89%E8%A3%85"><span class="nav-text">知识点：Kibana rpm 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AKibana-tar-gz-%E5%AE%89%E8%A3%85"><span class="nav-text">知识点：Kibana tar.gz 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AKibana-docker-%E5%AE%89%E8%A3%85"><span class="nav-text">知识点：Kibana docker 安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-Kibana-%E9%85%8D%E7%BD%AE"><span class="nav-text">5.3 Kibana 配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AKibana-%E9%85%8D%E7%BD%AE"><span class="nav-text">知识点：Kibana 配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-4-Kibana-%E7%95%8C%E9%9D%A2"><span class="nav-text">5.4 Kibana 界面</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AKibana-%E7%95%8C%E9%9D%A2"><span class="nav-text">知识点：Kibana 界面</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter06-Logstash"><span class="nav-text">Chapter06 Logstash</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-Logstash-%E4%BB%8B%E7%BB%8D"><span class="nav-text">6.1 Logstash 介绍</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter07-Filebeat"><span class="nav-text">Chapter07 Filebeat</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-Filebeat-%E4%BB%8B%E7%BB%8D"><span class="nav-text">7.1 Filebeat 介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AFilebeat-%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：Filebeat 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AFilebeat-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：Filebeat 指令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-Filebeat-%E5%AE%89%E8%A3%85"><span class="nav-text">7.2 Filebeat 安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AFilebeat-rpm-%E5%AE%89%E8%A3%85"><span class="nav-text">知识点：Filebeat rpm 安装</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-3-Filebeat-%E9%85%8D%E7%BD%AE"><span class="nav-text">7.3 Filebeat 配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AFilebeat-%E9%85%8D%E7%BD%AE"><span class="nav-text">知识点：Filebeat 配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Afilebeat-input-%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：filebeat input 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Afilebeat-output-%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：filebeat output 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Aoutput-console-%E9%85%8D%E7%BD%AE"><span class="nav-text">知识点：output.console 配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Aoutput-elasticsearch-%E9%85%8D%E7%BD%AE"><span class="nav-text">知识点：output.elasticsearch 配置</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter11-ES-%E9%9B%86%E7%BE%A4"><span class="nav-text">Chapter11 ES 集群</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#11-1-ES-%E9%9B%86%E7%BE%A4%E4%BB%8B%E7%BB%8D"><span class="nav-text">11.1 ES 集群介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AES-%E9%9B%86%E7%BE%A4%E5%9F%BA%E7%A1%80"><span class="nav-text">知识点：ES 集群基础</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E8%8A%82%E7%82%B9%E8%A7%92%E8%89%B2"><span class="nav-text">知识点：节点角色</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Amaster-%E9%80%89%E4%B8%BE"><span class="nav-text">知识点：master 选举</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E6%95%B0%E6%8D%AE%E5%9D%87%E8%A1%A1"><span class="nav-text">知识点：数据均衡</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E5%88%86%E5%B8%83%E5%BC%8F%E6%9F%A5%E8%AF%A2"><span class="nav-text">知识点：分布式查询</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E8%8A%82%E7%82%B9%E8%BD%AC%E5%8F%91"><span class="nav-text">知识点：节点转发</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E6%95%85%E9%9A%9C%E8%BD%AC%E7%A7%BB"><span class="nav-text">知识点：故障转移</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2000/01/01/Blog43-elasticsearch/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Blog43-elasticsearch | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Blog43-elasticsearch
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2000-01-01 00:00:43" itemprop="dateCreated datePublished" datetime="2000-01-01T00:00:43+08:00">2000-01-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2023-09-09 15:46:36" itemprop="dateModified" datetime="2023-09-09T15:46:36+08:00">2023-09-09</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <h1 id="Blog43-elasticsearch"><a href="#Blog43-elasticsearch" class="headerlink" title="Blog43-elasticsearch"></a>Blog43-elasticsearch</h1><hr>
<p><a href="#Chapter01-ElasticSearch-%E5%9F%BA%E7%A1%80"><strong>Chapter01 ElasticSearch 基础</strong></a></p>
<ul>
<li><a href="#1-1-ES-%E4%BB%8B%E7%BB%8D">1.1 ES 介绍</a></li>
<li><a href="#1-2-ES-%E5%AE%89%E8%A3%85">1.2 ES 安装</a></li>
<li><a href="#1-3-ES-%E9%85%8D%E7%BD%AE">1.3 ES 配置</a></li>
</ul>
<p><a href="#Chapter02-ElasticSearch-%E8%A6%81%E7%B4%A0"><strong>Chapter02 ElasticSearch 要素</strong></a></p>
<ul>
<li><a href="#2-1-Restful-API">2.1 Restful API</a></li>
<li><a href="#2-2-%E7%B4%A2%E5%BC%95">2.2 索引</a></li>
<li><a href="#2-3-%E6%98%A0%E5%B0%84">2.3 映射</a></li>
<li><a href="#2-4-%E6%96%87%E6%A1%A3">2.4 文档</a></li>
</ul>
<p><a href="#Chapter03-QueryDSL"><strong>Chapter03 QueryDSL</strong></a></p>
<ul>
<li><a href="#3-1-QueryDSL-%E5%9F%BA%E7%A1%80">3.1 QueryDSL 基础</a></li>
</ul>
<p><a href="#Chapter05-Kibana"><strong>Chapter05 Kibana</strong></a></p>
<ul>
<li><a href="#5-1-Kibana-%E4%BB%8B%E7%BB%8D">5.1 Kibana 介绍</a></li>
<li><a href="#5-2-Kibana-%E5%AE%89%E8%A3%85">5.2 Kibana 安装</a></li>
<li><a href="#5-3-Kibana-%E9%85%8D%E7%BD%AE">5.3 Kibana 配置</a></li>
</ul>
<p><a href="#Chapter06-Logstash"><strong>Chapter06 Logstash</strong></a></p>
<ul>
<li><a href="#6-1-Logstash-%E4%BB%8B%E7%BB%8D">6.1 Logstash 介绍</a></li>
</ul>
<p><a href="#Chapter07-Kibabna-%E5%9F%BA%E7%A1%80"><strong>Chapter07 Filebeat 基础</strong></a></p>
<ul>
<li><a href="#7-1-Filebeat-%E4%BB%8B%E7%BB%8D">7.1 Filebeat 介绍</a></li>
<li><a href="#7-2-Filebeat-%E5%AE%89%E8%A3%85">7.2 Filebeat 安装</a></li>
</ul>
<p><a href="#Chapter11-ES-%E9%9B%86%E7%BE%A4"><strong>Chapter11 ES 集群</strong></a></p>
<ul>
<li><a href="#11-1-ES-%E9%9B%86%E7%BE%A4%E4%BB%8B%E7%BB%8D">11.1 ES 集群介绍</a></li>
</ul>
<hr>
<h2 id="帮助"><a href="#帮助" class="headerlink" title="帮助"></a>帮助</h2><ol>
<li><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/elasticsearch/reference/7.17/elasticsearch-intro.html">Elasticsearch Guide 7.17</a></li>
<li><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/logstash/7.17/introduction.html">Logstash Reference 7.17</a></li>
<li><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/kibana/7.17/introduction.html">Kibana Guid 7.17</a></li>
<li><a target="_blank" rel="noopener" href="https://www.elastic.co/guide/en/beats/filebeat/7.17/filebeat-overview.html">Filebeat Reference 7.17</a></li>
</ol>
<hr>
<h2 id="内容管理"><a href="#内容管理" class="headerlink" title="内容管理"></a>内容管理</h2><ol>
<li><strong>未整理</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* ElasticSearch</span><br><span class="line">  - 索引生命周期管理 Indes Lifetime Management</span><br><span class="line"></span><br><span class="line">* filebeat</span><br><span class="line">  - agent 是什么意思？</span><br><span class="line"></span><br><span class="line">* 其他</span><br><span class="line">  - yaml 中，Name.attr 的配置，是否可以写成 Name: &#123; attr: VALUE &#125; 的方式？</span><br></pre></td></tr></table></figure></li>
<li><strong>不整理</strong></li>
</ol>
<hr>
<h1 id="Chapter01-ElasticSearch-基础"><a href="#Chapter01-ElasticSearch-基础" class="headerlink" title="Chapter01 ElasticSearch 基础"></a>Chapter01 ElasticSearch 基础</h1><hr>
<h2 id="1-1-ES-介绍"><a href="#1-1-ES-介绍" class="headerlink" title="1.1 ES 介绍"></a>1.1 ES 介绍</h2><hr>
<h3 id="知识点：全文检索"><a href="#知识点：全文检索" class="headerlink" title="知识点：全文检索"></a>知识点：全文检索</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">* 全文检索(Full-Text Retrieval)</span><br><span class="line">  - 全文检索包含两个部分，建立索引、进行查询</span><br><span class="line"></span><br><span class="line">* 建立索引过程</span><br><span class="line">  - 以词(word)为基础建立索引</span><br><span class="line">  - 程序会扫描文章全文，并将文章切分为词</span><br><span class="line">  - 对每一个词，都会建立索引</span><br><span class="line">  - 索引中包含的的信息，包括这个词在文章中出现的次数和位置</span><br><span class="line"></span><br><span class="line">* 查询过程</span><br><span class="line">  - 通过索引进行检索</span><br><span class="line">  - 当用户进行查询时，根据用户提供的关键字，根据建立的索引进行查询，类似于通过字典的检索字表查字的过程</span><br><span class="line">  - 在返回结果时，根据相关度进行排序，相关度取决于词在文章中出现的次数</span><br><span class="line"></span><br><span class="line">* 全文检索的特性</span><br><span class="line">  - 只处理文本、不处理语义</span><br><span class="line">  - 搜索时英文不区分大小写</span><br><span class="line">  - 结果列表有相关度排序</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：ElasticStack-介绍"><a href="#知识点：ElasticStack-介绍" class="headerlink" title="知识点：ElasticStack 介绍"></a>知识点：ElasticStack 介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 收集各个应用程序的日志</span><br><span class="line">  - 进行聚合</span><br><span class="line">  - 进行检索</span><br><span class="line">  - 结果展示(Kinbana|Grafana|Superset)</span><br><span class="line"></span><br><span class="line">* 组件</span><br><span class="line">  - ElasticSearch，ES</span><br><span class="line">  - Kibana</span><br><span class="line">  - Logstash</span><br><span class="line">    - 进行日志的收集、清洗、计算转换、聚合</span><br><span class="line">    - 功能全面，但程序本身的体量较大</span><br><span class="line">  - Beats</span><br><span class="line">    - 组件集合，进行日志的收集，可以将数据发送给 Logstash、ElasticSearch</span><br><span class="line">    - 主要目的是缓解 Logstash 的压力，使 Logstash 专心进行数据处理</span><br><span class="line">  - FileBeat</span><br><span class="line">    - Beats 中最常用的日志收集组件</span><br><span class="line"></span><br><span class="line">* 常见应用架构</span><br><span class="line">  - ELK 架构：日志 =&gt; 采集+处理(Logstash) =&gt; 存储(ElasitcSearch) =&gt; 展示</span><br><span class="line">  - EFK 架构：日志 =&gt; 采集(Filebeat) =&gt; 存储(ElasitcSearch) =&gt; 展示</span><br><span class="line">  - ELFK 架构：日志 =&gt; 采集(Filebeat) =&gt; 处理(Logstash) =&gt; 存储(ElasitcSearch) =&gt; 展示</span><br><span class="line">  - ELFK + Kafka 架构：日志 =&gt; 采集(Filebeat) =&gt; 缓冲(Kafka) =&gt; 处理(Logstash) =&gt; 存储(ElasitcSearch) =&gt; 展示</span><br></pre></td></tr></table></figure></li>
<li><strong>版本</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 所有的组件应当是相同的版本</span><br><span class="line">  - 包括 version、release、update 全部都要相同</span><br><span class="line">  - 例如，ES 是 7.17.3，则 Kibana、Logstash、Filebeat 也都应当是 7.17.3</span><br><span class="line"></span><br><span class="line">* java 版本</span><br><span class="line">  - ES 7 开始，要求版本 jdk11.0+</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：ES-介绍"><a href="#知识点：ES-介绍" class="headerlink" title="知识点：ES 介绍"></a>知识点：ES 介绍</h3><ol>
<li><strong>基本介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - ElasticSearch，简称 ES</span><br><span class="line">  - 开源、高性能、实时、分布式的全文检索搜索引擎，是当前最流行的企业级搜索引擎</span><br><span class="line">  - 是 ElasticStack 的核心</span><br><span class="line">  - 基于 Apache Lucene 构建</span><br><span class="line">  - 由 Shay Banon 开发，一开始叫 Compass</span><br><span class="line">  - 采用 java 编写</span><br><span class="line">  - 提供 RestFul API</span><br><span class="line">  - 2010-02 第一个版本</span><br><span class="line">  - Elastic 公司对其提供商业支持，但 ES 将永远开源</span><br><span class="line"></span><br><span class="line">* 优点</span><br><span class="line">  - 近乎实时的存储数据、检索数据</span><br><span class="line">  - 分布式+可扩展性</span><br><span class="line">  - PB 级别处理能力</span><br><span class="line"></span><br><span class="line">* Lucene 介绍</span><br><span class="line">  - Lucene，本身就可以被认为迄今为止性能最好的一款开源搜索引擎工具包</span><br><span class="line">  - 优点</span><br><span class="line">    - 最先进、性能最好、功能最全的搜索引擎库</span><br><span class="line">  - 缺点</span><br><span class="line">    - 只支持 java 项目</span><br><span class="line">    - 只支持单节点，不支持集群</span><br><span class="line">    - API 相对复杂，需要深厚的搜索理论，开发难度大</span><br></pre></td></tr></table></figure></li>
<li><strong>ES 与 solr 对比</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">* 性能</span><br><span class="line">  - 对对离线数据，solr 性能优于 ElasticSearch</span><br><span class="line">  - 对于实时查询，ElasticSearch 性能优于 solr</span><br><span class="line"></span><br><span class="line">* 底层</span><br><span class="line">  - solr 底层也是使用 Lucene</span><br><span class="line"></span><br><span class="line">* 分布式管理</span><br><span class="line">  - ElasticSearch 自身自带分布式管理功能</span><br><span class="line">  - solr 需要借助于 zookeeper 来进行分布式管理</span><br><span class="line"></span><br><span class="line">* 索引方式</span><br><span class="line">  - ElasticSearch 仅支持 json 格式索引</span><br><span class="line">  - solr 支持的格式更多</span><br></pre></td></tr></table></figure></li>
<li><strong>技术特性</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* 监听端口</span><br><span class="line">  - 9200，对集群外部提供 http 的访问接口</span><br><span class="line">  - 9300，集群各个节点间的通信</span><br><span class="line"></span><br><span class="line">* java</span><br><span class="line">  - 内置 openjdk</span><br><span class="line"></span><br><span class="line">* 安全特性</span><br><span class="line">  - 版本 7 及以前没有默认开启</span><br><span class="line">  - 版本 8 开始默认开启</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：ES-目录体系"><a href="#知识点：ES-目录体系" class="headerlink" title="知识点：ES 目录体系"></a>知识点：ES 目录体系</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 不同安装方式的区别</span><br><span class="line">  - tar 安装，则所有内容都在 ES_HOME 下</span><br><span class="line">  - rpm 安装，则与配置有关的内容会放在 /etc/elasticsearch 下，其他内容放在 /var/lib/elasticsearch 下</span><br></pre></td></tr></table></figure></li>
<li><strong>列表</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">* ES_HOME/bin</span><br><span class="line">  - 存放 ES 的一些启动/关闭脚本</span><br><span class="line">  - 主要内容</span><br><span class="line">    - ES_HOME/bin/elasticsearch</span><br><span class="line"></span><br><span class="line">* ES_HOME/config</span><br><span class="line">  - 存放 ES 的配置文件</span><br><span class="line">  - 主要内容</span><br><span class="line">    - ES_HOME/config/jvm.option</span><br><span class="line">    - ES_HOME/config/elasticsearch.yml</span><br><span class="line"></span><br><span class="line">* ES_HOME/jdk</span><br><span class="line">  - 存放 ES 的内置 java</span><br><span class="line"></span><br><span class="line">* ES_HOME/lib</span><br><span class="line">  - 存放 ES 一些依赖的 jar 包</span><br><span class="line"></span><br><span class="line">* ES_HOME/logs</span><br><span class="line">  - 存放 ES 的运行日志</span><br><span class="line"></span><br><span class="line">* ES_HOME/modules</span><br><span class="line">  - 存放 ES 的依赖模块</span><br><span class="line"></span><br><span class="line">* ES_HOME/modules</span><br><span class="line">  - 存放 ES 的插件</span><br><span class="line"></span><br><span class="line">* ES_HOME/date</span><br><span class="line">  - 存放索引数据</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：ES-运行日志"><a href="#知识点：ES-运行日志" class="headerlink" title="知识点：ES 运行日志"></a>知识点：ES 运行日志</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* 日志目录</span><br><span class="line">  /var/log/elasticsearch</span><br><span class="line"></span><br><span class="line">* 日志文件</span><br><span class="line">  ClusterName.log               ES 服务日志</span><br><span class="line">  ClusterName_server.json</span><br><span class="line">  ClusterName_audit.json        审计日志</span><br><span class="line">  ClusterName_index_indexing_slowing.log</span><br><span class="line">  ClusterName_index_indexing_slowing.json   索引查询</span><br><span class="line">  ClusterName_index_search_slowing.log</span><br><span class="line">  ClusterName_index_search_slowing.json     慢日志查询</span><br></pre></td></tr></table></figure></li>
<li><strong>ClusterName.log</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 记录 ES 启动时的一些日志，如执行的动作</span><br><span class="line"></span><br><span class="line">* 日志格式</span><br><span class="line">  [DateTime][Level][PackageName] [NodeName] Message</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="1-2-ES-安装"><a href="#1-2-ES-安装" class="headerlink" title="1.2 ES 安装"></a>1.2 ES 安装</h2><hr>
<h3 id="知识点：ES-tar-gz-安装"><a href="#知识点：ES-tar-gz-安装" class="headerlink" title="知识点：ES tar.gz 安装"></a>知识点：ES tar.gz 安装</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - tar 安装，解压即安装，无需进行编译</span><br><span class="line"></span><br><span class="line">* 限制</span><br><span class="line">  - tar 安装，只能使用普通用户来安装，不能使用 root 用户</span><br></pre></td></tr></table></figure></li>
<li><strong>修改主机名 vim &#x2F;etc&#x2F;hostname</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">ctyunbase</span><br></pre></td></tr></table></figure></li>
<li><strong>调整防火墙和 Selinux</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop firewalld</span><br><span class="line">systemctl disable firewalld</span><br><span class="line"></span><br><span class="line">vim /etc/selinux/config</span><br></pre></td></tr></table></figure></li>
<li><strong>创建 es 用户</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">useradd es</span><br><span class="line">passwd es</span><br></pre></td></tr></table></figure></li>
<li><strong>创建目录</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">mkdir -p /data/elasticsearch/&#123;data,logs&#125;</span><br><span class="line">chown -R es:es /data/elasticsearch</span><br></pre></td></tr></table></figure></li>
<li><strong>修改资源限制 vim &#x2F;etc&#x2F;security&#x2F;limits.conf</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># ElasticSearch</span><br><span class="line">es            soft    nofile  65536</span><br><span class="line">es            hard    nofile  65536</span><br></pre></td></tr></table></figure></li>
<li><strong>修改内核参数 vim &#x2F;etc&#x2F;sysctl.conf</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># ElasticSearch</span><br><span class="line">vm.max_map_count = 262144</span><br><span class="line"></span><br><span class="line"># 修改完成后，执行 sysctl -p 使其生效</span><br></pre></td></tr></table></figure></li>
<li><strong>解压安装包</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">tar zxvf elasticsearch-7.16.2-linux-x86_64.tar.gz -C /usr/local</span><br><span class="line"></span><br><span class="line">cd /usr/local</span><br><span class="line">ln -s elasticsearch-7.16.2 elasticsearch</span><br><span class="line">chown -R es:es elasticsearch-7.16.2</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>修改配置 vim &#x2F;usr&#x2F;local&#x2F;elasticsearch&#x2F;config&#x2F;elasticsearch.yml</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">cluster.name: my-application</span><br><span class="line">node.name: node-1</span><br><span class="line">node.attr.rack: r1</span><br><span class="line">path.data: /data/elasticsearch/data</span><br><span class="line">path.logs: /data/elasticsearch/logs</span><br><span class="line">network.host: 0.0.0.0</span><br><span class="line">http.port: 9200</span><br><span class="line">transport.tcp.port: 9300</span><br><span class="line">discovery.seed_hosts: [&quot;ctyunbase&quot;]</span><br><span class="line">cluster.initial_master_nodes: [&quot;node-1&quot;]</span><br><span class="line">gateway.recover_after_nodes: 1</span><br><span class="line">http.cors.enabled: true</span><br><span class="line">http.cors.allow-origin: &quot;*&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>启动 ES</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">cd /usr/local/elasticsearch</span><br><span class="line">./bin/elasticsearch -d</span><br><span class="line"># &quot;-d&quot; 表示后台启动</span><br></pre></td></tr></table></figure></li>
<li><strong>停止 ES</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ps -ef | grep elasticsearch</span><br><span class="line">kill -9 PID</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：ES-rpm-安装"><a href="#知识点：ES-rpm-安装" class="headerlink" title="知识点：ES rpm 安装"></a>知识点：ES rpm 安装</h3><ol>
<li><strong>环境准备</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">* sshd 优化，提升 ssh 的连接效率</span><br><span class="line">  - UseNns No</span><br><span class="line">  - GSSAPI Authentication No</span><br><span class="line"></span><br><span class="line">* 关闭防火墙</span><br><span class="line"></span><br><span class="line">* 关闭 selinux</span><br><span class="line"></span><br><span class="line">* 安装 rsync</span><br><span class="line"></span><br><span class="line">* 配置时间同步</span><br><span class="line"></span><br><span class="line">* master 创建集群同步脚本</span><br></pre></td></tr></table></figure></li>
<li><strong>rpm 安装</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 从官网下载 rpm 安装包</span><br><span class="line"></span><br><span class="line">* rpm 安装</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>修改配置</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* node.name 修改为每个 node 的节点名称</span><br><span class="line"></span><br><span class="line">* discovery.seed_hosts 添加所有的节点所在的主机</span><br></pre></td></tr></table></figure></li>
<li><strong>启动 ElasticSearch</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* systemctl start elasticsearch.service</span><br><span class="line"></span><br><span class="line">* systemctl enable elasticsearch.service</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：ES-docker-安装"><a href="#知识点：ES-docker-安装" class="headerlink" title="知识点：ES docker 安装"></a>知识点：ES docker 安装</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">docker pull elasticsearch:7.14.0</span><br><span class="line"></span><br><span class="line">docker run -d -p 9200:9200 -p 9300:9300  -e &quot;discovery.type=single-node&quot;  elasticsearch:7.14.0</span><br><span class="line"></span><br><span class="line">http://10.15.0.5:9200/</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="1-3-ES-配置"><a href="#1-3-ES-配置" class="headerlink" title="1.3 ES 配置"></a>1.3 ES 配置</h2><hr>
<h3 id="知识点：ES-配置"><a href="#知识点：ES-配置" class="headerlink" title="知识点：ES 配置"></a>知识点：ES 配置</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 配置文件 ES_HOME/config/elasticsearch.yml</span><br><span class="line">  - ES 的核心配置文件</span><br><span class="line">  - ES 的所有配置都是修改此文件</span><br></pre></td></tr></table></figure></li>
<li><strong>ES 集群配置</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">* Cluster 部分</span><br><span class="line">  cluster.name    配置集群名称</span><br><span class="line"></span><br><span class="line">* Node 部分</span><br><span class="line">  node.name       配置节点的名称 NodeName，每个 node 的 node.name 必须集群唯一，默认采用 host 的 hostname</span><br><span class="line">  node.attr.rack  配置机架感知</span><br><span class="line"></span><br><span class="line">* Paths 部分</span><br><span class="line">  path.data       配置数据目录，默认为 /var/lib/elasticsearch/</span><br><span class="line">  path.logs       配置日志目录，默认为 /var/log/elasticsearch/</span><br><span class="line"></span><br><span class="line">* Network 部分</span><br><span class="line">  network.host          配置允许访问集群的地址，默认只监听 127.0.0.1</span><br><span class="line">  network.publish_host</span><br><span class="line">  http.port             配置集群的访问端口，默认 9200</span><br><span class="line">  transport.tcp.port    配置节点的通信端口，默认 9300</span><br><span class="line"></span><br><span class="line">* Discovery 集群自动发现</span><br><span class="line">  discovery.seed_hosts            配置集群中的节点列表，可以是 IP、HostName、IP:port 等</span><br><span class="line">  cluster.initial_master_node     配置集群中初始化 master 选举的节点 NodeName</span><br><span class="line"></span><br><span class="line">  gateway.recover_after_nodes     集群最少几个节点可用</span><br><span class="line"></span><br><span class="line">  http.cors.enabled true</span><br><span class="line">  http.cors.allow-origin: &quot;*&quot;     开启每个节点跨域访问</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：ES-中的概念"><a href="#知识点：ES-中的概念" class="headerlink" title="知识点：ES 中的概念"></a>知识点：ES 中的概念</h3><ol start="4">
<li><strong>其他</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">* 索引模式</span><br><span class="line"></span><br><span class="line">* 索引模板 template</span><br><span class="line">  - 创建索引时需要匹配的规则</span><br><span class="line"></span><br><span class="line">* 索引模板的匹配模式 template.pattern</span><br><span class="line"></span><br><span class="line">* 分片</span><br><span class="line"></span><br><span class="line">* 主分片</span><br><span class="line"></span><br><span class="line">* 副本分片</span><br><span class="line"></span><br><span class="line">* 文档计数</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="Chapter02-ElasticSearch-要素"><a href="#Chapter02-ElasticSearch-要素" class="headerlink" title="Chapter02 ElasticSearch 要素"></a>Chapter02 ElasticSearch 要素</h1><hr>
<h2 id="2-1-Restful-API"><a href="#2-1-Restful-API" class="headerlink" title="2.1 Restful API"></a>2.1 Restful API</h2><hr>
<h3 id="知识点：Restful-API-简介"><a href="#知识点：Restful-API-简介" class="headerlink" title="知识点：Restful API 简介"></a>知识点：Restful API 简介</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - ES 支持使用 http 请求来对 ES 进行操作</span><br><span class="line">    - METHOD 指定操作类型</span><br><span class="line">    - URL 指定操作的目标对象</span><br><span class="line">    - Content 指定具体的操作内容</span><br><span class="line">  - 返回信息为 json 格式</span><br><span class="line"></span><br><span class="line">* METHOD</span><br><span class="line">  - http 请求方法</span><br><span class="line">  - GET         相当于 SELECT</span><br><span class="line">  - PUT         相当于 CREATE</span><br><span class="line">  - POST        相当于 INSERT</span><br><span class="line">  - DELETE      相当于 DELETE + DROP</span><br><span class="line"></span><br><span class="line">* URL</span><br><span class="line">  - http://IP:PORT/URI</span><br><span class="line">  - https://IP:PORT/URI</span><br><span class="line"></span><br><span class="line">* ?v</span><br><span class="line">  - 对于 GET 方法，URL 以 &quot;?v&quot; 结尾，表示显示对象的详细信息</span><br><span class="line">  - 在显示返回结果时，同时显示每一个字段的列标题</span><br><span class="line"></span><br><span class="line">* Content</span><br><span class="line">  - 请求内容</span><br></pre></td></tr></table></figure></li>
<li><strong>json 格式</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  Method URI Content</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>curl 格式</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  curl -X Method http://IP:PORT/URI -H Header -d data</span><br><span class="line"></span><br><span class="line">* -H Header</span><br><span class="line">  - 指定 http request header</span><br><span class="line"></span><br><span class="line">* -d data</span><br><span class="line">  - 指定 http request Content</span><br><span class="line"></span><br><span class="line">* 范例</span><br><span class="line">  curl -X POST http://IP:9200/my-test-001/_doc/r01 -H &#x27;Content-Type: application/json&#x27; -d &#x27;&#123; &quot;title&quot;:&quot;iphone14&quot;, &quot;price&quot;:8999.99, &quot;created_at&quot;:&quot;2021-09-15&quot;, &quot;description&quot;:&quot;iPhone 13 屏幕采用6.8英寸OLED屏幕。&quot; &#125;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：ES-集群访问"><a href="#知识点：ES-集群访问" class="headerlink" title="知识点：ES 集群访问"></a>知识点：ES 集群访问</h3><ol>
<li><strong>查看节点信息</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  curl -X GET [http://]HostIP:9200</span><br><span class="line"></span><br><span class="line">* 返回信息</span><br><span class="line">  - name 节点名称</span><br><span class="line"></span><br><span class="line">* cluster_name  集群名称</span><br><span class="line"></span><br><span class="line">* cluster_uuid  集群 uuid</span><br><span class="line"></span><br><span class="line">* version 众多与版本相关的信息</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：-cat-指令"><a href="#知识点：-cat-指令" class="headerlink" title="知识点：_cat 指令"></a>知识点：_cat 指令</h3><ol>
<li><strong>介绍</strong></li>
<li><strong>基础</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* 查看 ES 支持的所有 _cat 指令</span><br><span class="line">  curl -X GET [http://]HostIP:9200/_cat</span><br></pre></td></tr></table></figure></li>
<li><strong>查看集群信息</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 查看集群健康状态</span><br><span class="line">  curl -X GET [http://]HostIP:9200/_cat/health</span><br><span class="line"></span><br><span class="line">* 查看集群 master</span><br><span class="line">  curl -X GET [http://]HostIP:9200/_cat/master</span><br><span class="line"></span><br><span class="line">* 查看集群节点</span><br><span class="line">  curl -X GET [http://]HostIP:9200/_cat/nodes</span><br></pre></td></tr></table></figure></li>
<li><strong>查看索引信息</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 查看所有索引</span><br><span class="line">  curl -X GET [http://]HostIP:9200/_cat/indices</span><br><span class="line"></span><br><span class="line">* 查看所有索引的详细信息</span><br><span class="line">  curl -X GET [http://]HostIP:9200/_cat/indices?v</span><br><span class="line"></span><br><span class="line">* 查看集群分片</span><br><span class="line">  curl -X GET [http://]HostIP:9200/_cat/shards</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：-search-指令"><a href="#知识点：-search-指令" class="headerlink" title="知识点：_search 指令"></a>知识点：_search 指令</h3><ol>
<li><strong>介绍</strong></li>
<li><strong>json 格式</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* 查看索引的所有数据</span><br><span class="line">  GET /IndexName/_search</span><br></pre></td></tr></table></figure></li>
<li><strong>curl 格式</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 查看索引的所有数据</span><br><span class="line">  curl -X GET http://IP:9200/IndexName/_search</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="2-2-索引"><a href="#2-2-索引" class="headerlink" title="2.2 索引"></a>2.2 索引</h2><hr>
<h3 id="知识点：索引介绍"><a href="#知识点：索引介绍" class="headerlink" title="知识点：索引介绍"></a>知识点：索引介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 索引 index，是 ES 中的存储单元，用来作为拥有相似特征的文档的集合</span><br><span class="line">  - 与 rdbms 类比，文档相当于表名(table name)</span><br><span class="line">  - 索引只支持创建、查询、删除操作，不支持修改操作</span><br><span class="line"></span><br><span class="line">* 索引名 index name</span><br><span class="line">  - 索引使用索引名(index name)来标识</span><br><span class="line">  - 索引名必须全部是小写字母的</span><br><span class="line">  - 通过索引名，来对索引中的文档进行搜索、更新、删除</span><br><span class="line"></span><br><span class="line">* 隐藏索引</span><br><span class="line">  - 索引名以 &quot;.&quot; 开头的索引</span><br><span class="line">  - 通常是由 ES/Kibana 等组件自动创建，并作为内部使用的</span><br></pre></td></tr></table></figure></li>
<li><strong>索引的属性</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">* 通过 /_cat/indics?v 来查看所有索引的属性</span><br><span class="line"></span><br><span class="line">* 索引的健康状态 health</span><br><span class="line">  - green   健康</span><br><span class="line">  - yellwo  索引可用但存在风险</span><br><span class="line">  - red     索引不可用</span><br><span class="line"></span><br><span class="line">* 索引的打开状态 status</span><br><span class="line">  - open    打开</span><br><span class="line"></span><br><span class="line">* uuid</span><br><span class="line">  - 索引的唯一标识 uuid</span><br><span class="line"></span><br><span class="line">* primary</span><br><span class="line">  - 索引的主分片的数量</span><br><span class="line"></span><br><span class="line">* replica</span><br><span class="line">  - 索引的副本分片的数量</span><br></pre></td></tr></table></figure></li>
<li><strong>主索引和副本索引</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 默认 ES 在创建索引时，会同时创建一个主索引 primary index 和一个副本索引 replica</span><br></pre></td></tr></table></figure></li>
<li><strong>分片</strong></li>
</ol>
<hr>
<h3 id="知识点：倒排索引"><a href="#知识点：倒排索引" class="headerlink" title="知识点：倒排索引"></a>知识点：倒排索引</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 倒排索引 Inverted Index，也叫反向索引</span><br><span class="line">  - ES 底层在检索，使用的就是倒排索引</span><br><span class="line"></span><br><span class="line">* 对比</span><br><span class="line">  - 正向索引</span><br><span class="line">    - 通过 key 找 value，如 rdbms 中的索引(主键索引也称为聚簇索引)</span><br><span class="line">    - 通过 id，找到 id 所映射的记录</span><br><span class="line">  - 倒排索引：通过 value 找 key</span><br><span class="line">    - 以文档的字段的 Value，作为索引的 key</span><br><span class="line">    - 以文档的 ID，作为索引的 value</span><br></pre></td></tr></table></figure></li>
<li><strong>倒排索引的实现</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - ES 的底层的储存分为两个区，元数据区和索引区</span><br><span class="line"></span><br><span class="line">* 元数据区</span><br><span class="line">  - 存放文档的原始内容，一个文档就作为元数据区的一条记录</span><br><span class="line">  - 在检索时，先在索引区搜索，根据索引区的搜索结果，返回元数据区的记录</span><br><span class="line"></span><br><span class="line">* 索引区</span><br><span class="line">  - 存放对文档创建的索引</span><br><span class="line">  - 对于不分词的类型，直接以字段的 Value 作为索引 key</span><br><span class="line">  - 对于分词的类型，先对 Value 进行分词，再以 Word 作为索引的 key</span><br><span class="line"></span><br><span class="line">* 索引格式</span><br><span class="line">  Value: [id1, id2. ...]</span><br><span class="line"></span><br><span class="line">* 其他</span><br><span class="line">  - 索引中，实际还会记录 Value 在文档中出现的次数和文档的总长度，用来进行文档的相关度的计算</span><br><span class="line">  - ES 实际是分别为每个字段都建立了一个倒排索引，查询时是先通过字段，获得对应的索引，再从索引中检索文档 ID</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：索引-Restful-API"><a href="#知识点：索引-Restful-API" class="headerlink" title="知识点：索引 Restful API"></a>知识点：索引 Restful API</h3><ol>
<li><strong>查询索引</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 列出 ES 中具有的索引</span><br><span class="line">  GET /_cat/indices</span><br><span class="line"></span><br><span class="line">* 列出 ES 中具有的索引，同时显示每一个字段的列标题</span><br><span class="line">  GET /_cat/indices?v</span><br></pre></td></tr></table></figure></li>
<li><strong>创建索引</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  PUT /IndexName</span><br><span class="line"></span><br><span class="line">* 创建一个名为 &quot;products&quot; 的索引</span><br><span class="line">  PUT /products</span><br></pre></td></tr></table></figure></li>
<li><strong>创建索引并配置分片</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">PUT /products</span><br><span class="line">&#123;</span><br><span class="line">  &quot;settings&quot;: &#123;</span><br><span class="line">    &quot;number_of_shards&quot;: 1,        # 指定主分片的数量</span><br><span class="line">    &quot;number_of_replicas&quot;: 0       # 指定副本分片的数量</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># curl 格式</span><br><span class="line">curl -X PUT http://IP:PORT/IndexName \</span><br><span class="line">-H &#x27;Content-Type: application/json&#x27; \</span><br><span class="line">-d &#x27;&#123; &quot;settings&quot;:</span><br><span class="line">        &#123; &quot;number_of_shards&quot;: 3,</span><br><span class="line">          &quot;number_of_replicas&quot;: 1</span><br><span class="line">        &#125;,</span><br><span class="line">      &quot;mappings&quot;:</span><br><span class="line">        &#123; &quot;properties&quot;:</span><br><span class="line">            &#123; &quot;title&quot;: &#123; &quot;type&quot;: &quot;keyword&quot; &#125;,</span><br><span class="line">              &quot;price&quot;: &#123; &quot;type&quot;: &quot;double&quot; &#125;,</span><br><span class="line">              &quot;created_at&quot;: &#123; &quot;type&quot;: &quot;date&quot; &#125;,</span><br><span class="line">              &quot;description&quot;: &#123; &quot;type&quot;: &quot;text&quot; &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;&#x27;</span><br></pre></td></tr></table></figure></li>
<li><strong>删除索引</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 删除 &quot;products&quot; 索引</span><br><span class="line">  DELETE /products</span><br><span class="line"></span><br><span class="line">* 使用通配符删除索引</span><br><span class="line">  DELETE /products-2023*</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="2-3-映射"><a href="#2-3-映射" class="headerlink" title="2.3 映射"></a>2.3 映射</h2><hr>
<h3 id="知识点：映射介绍"><a href="#知识点：映射介绍" class="headerlink" title="知识点：映射介绍"></a>知识点：映射介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 映射 Mapping，是一组规则，用来限定索引中储存的文档的结构，主要包括字段名、字段类型等</span><br><span class="line">  - 与 rdbms 类比，映射相当于表定义(table definition)</span><br><span class="line"></span><br><span class="line">* 映射与索引</span><br><span class="line">  - 映射与索引一一绑定，映射无法脱离索引</span><br><span class="line">  - 映射无法单独创建、修改、删除，对映射的操作全部与索引绑定</span><br><span class="line"></span><br><span class="line">* 特性</span><br><span class="line">  - 在默认配置下，ES 可以根据插入的数据自动地创建 mapping，也可以手动创建 mapping</span><br></pre></td></tr></table></figure></li>
<li><strong>常见数据类型</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">* 字符串类型</span><br><span class="line">  - keyword   不分词</span><br><span class="line">  - text      分词，默认的分词器，对于中文，是每一个汉字被切分为一个 Word</span><br><span class="line"></span><br><span class="line">* 整数类型</span><br><span class="line">  - integer</span><br><span class="line">  - long</span><br><span class="line"></span><br><span class="line">* 小数类型</span><br><span class="line">  - float</span><br><span class="line">  - double</span><br><span class="line"></span><br><span class="line">* 布尔类型</span><br><span class="line">  - boolean</span><br><span class="line"></span><br><span class="line">* 日期类型</span><br><span class="line">  - date</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：映射-Restful-API"><a href="#知识点：映射-Restful-API" class="headerlink" title="知识点：映射 Restful API"></a>知识点：映射 Restful API</h3><ol>
<li><strong>创建索引时同时创建映射</strong><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">PUT /products</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;settings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;number_of_shards&quot;</span>: <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;number_of_replicas&quot;</span>: <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;mappings&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;properties&quot;</span>: &#123;                       # properties 关键字，表示字段的类型的配置</span><br><span class="line">      <span class="attr">&quot;title&quot;</span>:&#123; <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;keyword&quot;</span> &#125;,      # type 关键字，用来指定字段的类型</span><br><span class="line">      <span class="attr">&quot;price&quot;</span>:&#123; <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;double&quot;</span> &#125;,</span><br><span class="line">      <span class="attr">&quot;created_at&quot;</span>:&#123; <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;date&quot;</span> &#125;,</span><br><span class="line">      <span class="attr">&quot;description&quot;</span>:&#123; <span class="attr">&quot;type&quot;</span>: <span class="string">&quot;text&quot;</span> &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>查看索引的映射</strong><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /products/_mapping</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="2-4-文档"><a href="#2-4-文档" class="headerlink" title="2.4 文档"></a>2.4 文档</h2><hr>
<h3 id="知识点：文档"><a href="#知识点：文档" class="headerlink" title="知识点：文档"></a>知识点：文档</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 文档 Document，是索引中存储的一条条数据，是 ES 中可被索引的最小单元</span><br><span class="line">  - 文档使用 json 格式，一个文档就是一个 json</span><br><span class="line">  - 与 rdbms 类比，文档相当于行(row)</span><br><span class="line"></span><br><span class="line">* 文档 id</span><br><span class="line">  - id 采用 &quot;_ID&quot; 的格式</span><br><span class="line">  - 自动创建的 id 为哈希值</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：查询文档-Restful-API"><a href="#知识点：查询文档-Restful-API" class="headerlink" title="知识点：查询文档 Restful API"></a>知识点：查询文档 Restful API</h3><ol>
<li><strong>基于 id 查询文档</strong><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GET /products/_doc/<span class="number">1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 返回值</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;products&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> : <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> : <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> : <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;found&quot;</span> : <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;_source&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;title&quot;</span> : <span class="string">&quot;iphone13&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;price&quot;</span> : <span class="number">8999.99</span>,</span><br><span class="line">    <span class="attr">&quot;created_at&quot;</span> : <span class="string">&quot;2021-09-15&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;description&quot;</span> : <span class="string">&quot;iPhone 13屏幕采用6.1英寸OLED屏幕&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：添加文档-Restful-API"><a href="#知识点：添加文档-Restful-API" class="headerlink" title="知识点：添加文档 Restful API"></a>知识点：添加文档 Restful API</h3><ol>
<li><strong>指定 id 添加文档</strong><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># json 格式</span><br><span class="line">POST /products/_doc/r001</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;title&quot;</span>:<span class="string">&quot;iphone13&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;price&quot;</span>:<span class="number">8999.99</span>,</span><br><span class="line">  <span class="attr">&quot;created_at&quot;</span>:<span class="string">&quot;2021-09-15&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>:<span class="string">&quot;iPhone 13 屏幕采用6.1英寸OLED屏幕。&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># curl 格式</span><br><span class="line">curl -X POST http://IP:9200/products/_doc/r001 \</span><br><span class="line">-H &#x27;Content-Type: application/json&#x27; \</span><br><span class="line">-d &#x27;&#123; &quot;title&quot;:&quot;iphone13&quot;,</span><br><span class="line">      &quot;price&quot;:8999.99,</span><br><span class="line">      &quot;created_at&quot;:&quot;2021-09-15&quot;,</span><br><span class="line">      &quot;description&quot;:&quot;iPhone 13 屏幕采用6.1英寸OLED屏幕。&quot;</span><br><span class="line">    &#125;&#x27;</span><br></pre></td></tr></table></figure></li>
<li><strong>自动生成文档 id</strong><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"># json 格式</span><br><span class="line">POST /products/_doc/</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;title&quot;</span>:<span class="string">&quot;iphone14&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;price&quot;</span>:<span class="number">8999.99</span>,</span><br><span class="line">  <span class="attr">&quot;created_at&quot;</span>:<span class="string">&quot;2021-09-15&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;description&quot;</span>:<span class="string">&quot;iPhone 13 屏幕采用6.8英寸OLED屏幕。&quot;</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>返回值</strong><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;products&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;sjfYnXwBVVbJgt24PlVU&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> : <span class="number">1</span>,</span><br><span class="line">  <span class="attr">&quot;result&quot;</span> : <span class="string">&quot;created&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;total&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> : <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> : <span class="number">3</span>,</span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：删除文档-Restful-API"><a href="#知识点：删除文档-Restful-API" class="headerlink" title="知识点：删除文档 Restful API"></a>知识点：删除文档 Restful API</h3><ol>
<li><p><strong>基于 id 删除文档</strong></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">DELETE /products/_doc/<span class="number">1</span></span><br></pre></td></tr></table></figure>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"># 返回值</span><br><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;_index&quot;</span> : <span class="string">&quot;products&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_type&quot;</span> : <span class="string">&quot;_doc&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_id&quot;</span> : <span class="string">&quot;1&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_version&quot;</span> : <span class="number">2</span>,</span><br><span class="line">  <span class="attr">&quot;result&quot;</span> : <span class="string">&quot;deleted&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;_shards&quot;</span> : &#123;</span><br><span class="line">    <span class="attr">&quot;total&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;successful&quot;</span> : <span class="number">1</span>,</span><br><span class="line">    <span class="attr">&quot;failed&quot;</span> : <span class="number">0</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;_seq_no&quot;</span> : <span class="number">2</span>,</span><br><span class="line">  <span class="attr">&quot;_primary_term&quot;</span> : <span class="number">1</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>


</li>
<li><p><strong>以重建的方式更新文档</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 先删除原始文档，再将更新文档以新的内容插入，因此需要传递全部的字段来进行更新</span><br></pre></td></tr></table></figure>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">PUT /products/_doc/sjfYnXwBVVbJgt24PlVU</span><br><span class="line">&#123;</span><br><span class="line">  &quot;title&quot;:&quot;iphon15&quot;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>在原始文档的基础上更新文档</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 在原始文档的基础上进行更新，只传入需要更新的字段即可</span><br></pre></td></tr></table></figure>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">POST /products/_doc/sjfYnXwBVVbJgt24PlVU/_update</span><br><span class="line">&#123;</span><br><span class="line">  &quot;doc&quot; : &#123;</span><br><span class="line">    &quot;title&quot; : &quot;iphon15&quot;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><p><strong>批量操作</strong></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 不同于关系型数据库，ES 的批量操作之间相互独立，互不影响</span><br><span class="line">    - 不会因为一个失败而全部失败，而是继续执行后续操作</span><br><span class="line">    - 每一个操作都具有独立的返回值，按照执行的状态返回</span><br><span class="line">  - 使用 POST 请求，调用 &quot;_doc/_bulk&quot; 接口</span><br><span class="line"></span><br><span class="line">* ES 批量操作，要求不可以对字段数据进行格式化，必须全部放在一行之中</span><br></pre></td></tr></table></figure>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 批量添加两条文档</span><br><span class="line">POST /products/_doc/_bulk</span><br><span class="line">  &#123;&quot;index&quot;:&#123;&quot;_id&quot;:&quot;1&quot;&#125;&#125;</span><br><span class="line">    &#123;&quot;title&quot;:&quot;iphone14&quot;,&quot;price&quot;:8999.99,&quot;created_at&quot;:&quot;2021-09-15&quot;,&quot;description&quot;:&quot;iPhone 13屏幕采用6.8英寸OLED屏幕&quot;&#125;</span><br><span class="line">  &#123;&quot;index&quot;:&#123;&quot;_id&quot;:&quot;2&quot;&#125;&#125;</span><br><span class="line">    &#123;&quot;title&quot;:&quot;iphone15&quot;,&quot;price&quot;:8999.99,&quot;created_at&quot;:&quot;2021-09-15&quot;,&quot;description&quot;:&quot;iPhone 15屏幕采用10.8英寸OLED屏幕&quot;&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight http"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">#更新文档同时删除文档</span><br><span class="line">POST /products/_doc/_bulk</span><br><span class="line">  &#123;&quot;update&quot;:&#123;&quot;_id&quot;:&quot;1&quot;&#125;&#125;</span><br><span class="line">    &#123;&quot;doc&quot;:&#123;&quot;title&quot;:&quot;iphone17&quot;&#125;&#125;</span><br><span class="line">  &#123;&quot;delete&quot;:&#123;&quot;_id&quot;:2&#125;&#125;</span><br><span class="line">  &#123;&quot;index&quot;:&#123;&#125;&#125;</span><br><span class="line">    &#123;&quot;title&quot;:&quot;iphone19&quot;,&quot;price&quot;:8999.99,&quot;created_at&quot;:&quot;2021-09-15&quot;,&quot;description&quot;:&quot;iPhone 19屏幕采用61.8英寸OLED屏幕&quot;&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="Chapter03-QueryDSL"><a href="#Chapter03-QueryDSL" class="headerlink" title="Chapter03 QueryDSL"></a>Chapter03 QueryDSL</h1><hr>
<h2 id="3-1-QueryDSL-基础"><a href="#3-1-QueryDSL-基础" class="headerlink" title="3.1 QueryDSL 基础"></a>3.1 QueryDSL 基础</h2><hr>
<h3 id="知识点：QueryDSL-介绍"><a href="#知识点：QueryDSL-介绍" class="headerlink" title="知识点：QueryDSL 介绍"></a>知识点：QueryDSL 介绍</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* ES 中提供了一种强大的检索数据方式，这种检索方式称之为 Query DSL(Domain Specified Language)</span><br><span class="line">* Query DSL 是利用 Rest API 传递 JSON 格式的请求体 Request Body 数据与 ES 进行交互</span><br><span class="line">* 这种方式的丰富查询语法让ES检索变得更强大，更简洁</span><br></pre></td></tr></table></figure>


<hr>
<h1 id="Chapter05-Kibana"><a href="#Chapter05-Kibana" class="headerlink" title="Chapter05 Kibana"></a>Chapter05 Kibana</h1><hr>
<h2 id="5-1-Kibana-基础"><a href="#5-1-Kibana-基础" class="headerlink" title="5.1 Kibana 基础"></a>5.1 Kibana 基础</h2><hr>
<h3 id="知识点：Kibana-介绍"><a href="#知识点：Kibana-介绍" class="headerlink" title="知识点：Kibana 介绍"></a>知识点：Kibana 介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - Elastic 提供的，针对 Elasticsearch 的 Web 图形化界面工具</span><br><span class="line">  - 可以使用 Kibana，来查询、操作、修改 ES 中的数据</span><br><span class="line"></span><br><span class="line">* 优点</span><br><span class="line">  - Kibana 直接内置了对 ES 常用的 Restful API 的操作</span><br><span class="line">    - 相比其他工具如 postman，省略了手动编写 Restful 这一层</span><br><span class="line">    - 手动输入 ES Restful API 时，具有语法提示</span><br><span class="line">  - Kibana 内置了对查询结果进行数据分析的功能，并能以图表、表格、地图、树的形式进行呈现</span><br></pre></td></tr></table></figure></li>
<li><strong>技术特点</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* 端口号</span><br><span class="line">  5601</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="5-2-Kibana-安装"><a href="#5-2-Kibana-安装" class="headerlink" title="5.2 Kibana 安装"></a>5.2 Kibana 安装</h2><hr>
<h3 id="知识点：Kibana-rpm-安装"><a href="#知识点：Kibana-rpm-安装" class="headerlink" title="知识点：Kibana rpm 安装"></a>知识点：Kibana rpm 安装</h3><ol>
<li><strong>安装</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 下载 rpm 安装包</span><br><span class="line"></span><br><span class="line">* rpm 安装</span><br></pre></td></tr></table></figure></li>
<li><strong>修改配置</strong></li>
<li><strong>启动服务</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* systemctl start kibana</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：Kibana-tar-gz-安装"><a href="#知识点：Kibana-tar-gz-安装" class="headerlink" title="知识点：Kibana tar.gz 安装"></a>知识点：Kibana tar.gz 安装</h3><ol>
<li><strong>安装</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* 下载 tar.gz 安装包</span><br><span class="line"></span><br><span class="line">* 解压 tar.gz</span><br><span class="line">  - bin</span><br><span class="line">  - config</span><br><span class="line">  - data</span><br><span class="line">  - node          # 一些 node.js 依赖</span><br><span class="line">  - node_modules  # 一些 node.js 模块</span><br><span class="line">  - src           # Kibana 源码</span><br><span class="line">  - x-pac         # Kibana 一些扩展工具</span><br></pre></td></tr></table></figure></li>
<li><strong>修改配置</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* vim config/kibana.yml</span><br></pre></td></tr></table></figure></li>
<li><strong>启动 Kibana</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* ./bin/kibana</span><br></pre></td></tr></table></figure></li>
<li><strong>访问</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* http://10.15.0.5:5601/</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：Kibana-docker-安装"><a href="#知识点：Kibana-docker-安装" class="headerlink" title="知识点：Kibana docker 安装"></a>知识点：Kibana docker 安装</h3><ol>
<li><strong>下载镜像</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">* docker pull kibana:7.14.0</span><br></pre></td></tr></table></figure></li>
<li><strong>准备配置文件</strong></li>
<li><strong>以数据卷映射的方式运行 Kibana</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* docker run \</span><br><span class="line">  -d \</span><br><span class="line">  -v /root/kibana.yml:/usr/share/kibana/config/kibana.yml \</span><br><span class="line">  --name kibana \</span><br><span class="line">  -p 5601:5601 \</span><br><span class="line">  kibana:7.14.0</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="5-3-Kibana-配置"><a href="#5-3-Kibana-配置" class="headerlink" title="5.3 Kibana 配置"></a>5.3 Kibana 配置</h2><hr>
<h3 id="知识点：Kibana-配置"><a href="#知识点：Kibana-配置" class="headerlink" title="知识点：Kibana 配置"></a>知识点：Kibana 配置</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 配置文件</span><br><span class="line">  Kibana_Home/config/kibana.yml</span><br><span class="line">  /etc/kibana/kibana.yml</span><br></pre></td></tr></table></figure></li>
<li><strong>配置项</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">* server 部分</span><br><span class="line">  server.name   kibana 服务的名称</span><br><span class="line">  server.port   kibana 监听的端口号，默认 5601</span><br><span class="line">  server.host   kibana 监听的地址</span><br><span class="line"></span><br><span class="line">* elasticsearch 部分</span><br><span class="line">  elasticsearch.hosts      kibana 绑定的 ES 的 url 的列表，使用 9200 端口，对于 ES 集群需要加上所有的节点</span><br><span class="line">  elasticsearch.username   kibana 访问 ES 集群时，安全认证使用的用户</span><br><span class="line">  elasticsearch.password   kibana 访问 ES 集群时，安全认证使用的密码</span><br><span class="line"></span><br><span class="line">* kibana 部分</span><br><span class="line">  kibana.index    kibana 在 ES 上存储的索引的名字</span><br><span class="line"></span><br><span class="line">* pid 部分</span><br><span class="line">  pid.file        kibana 的 pid 文件</span><br><span class="line"></span><br><span class="line">* i18n 部分</span><br><span class="line">  i18n.locale     指定语言</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="5-4-Kibana-界面"><a href="#5-4-Kibana-界面" class="headerlink" title="5.4 Kibana 界面"></a>5.4 Kibana 界面</h2><hr>
<h3 id="知识点：Kibana-界面"><a href="#知识点：Kibana-界面" class="headerlink" title="知识点：Kibana 界面"></a>知识点：Kibana 界面</h3><ol>
<li><strong>Dev Tools</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  -</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="Chapter06-Logstash"><a href="#Chapter06-Logstash" class="headerlink" title="Chapter06 Logstash"></a>Chapter06 Logstash</h1><hr>
<h2 id="6-1-Logstash-介绍"><a href="#6-1-Logstash-介绍" class="headerlink" title="6.1 Logstash 介绍"></a>6.1 Logstash 介绍</h2><hr>
<h1 id="Chapter07-Filebeat"><a href="#Chapter07-Filebeat" class="headerlink" title="Chapter07 Filebeat"></a>Chapter07 Filebeat</h1><hr>
<h2 id="7-1-Filebeat-介绍"><a href="#7-1-Filebeat-介绍" class="headerlink" title="7.1 Filebeat 介绍"></a>7.1 Filebeat 介绍</h2><hr>
<h3 id="知识点：Filebeat-介绍"><a href="#知识点：Filebeat-介绍" class="headerlink" title="知识点：Filebeat 介绍"></a>知识点：Filebeat 介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - filebeat，用来采集源数据的新增内容，并发送给目标</span><br><span class="line">  - filebeat 会对源文件进行监听</span><br><span class="line">  - filebeat 以行为单位进行发送，在监听时以 newline 为 trigger</span><br></pre></td></tr></table></figure></li>
<li><strong>实例状态文件</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 保存 filebeat 的实例状态</span><br><span class="line">  - 作用是，当 filebeat 重启后，依然可以在上一个实例生命周期结束时的状态的基础上，继续运行</span><br><span class="line">  - 全部位于 /var/lib/filebeat/ 目录下</span><br><span class="line"></span><br><span class="line">* /var/lib/filebeat/filebeat.lick</span><br><span class="line">  - 锁文件</span><br><span class="line">  - filebeat 启动时，默认会重建并覆盖 /var/lib/filebeat/* 的内容</span><br><span class="line">  - 锁文件用于保证当 filebeat 启动时，不进行重新创建，而是在 /var/lib/filebeat/* 原有的基础上进行运行</span><br><span class="line">  - 同样的，若锁文件存在但 /var/lib/filebeat/* 中的某个内容缺失，则就会报错</span><br><span class="line"></span><br><span class="line">* /var/lib/filebeat/registry/filebeat/log.json</span><br><span class="line">  - 记录 filebeat 的日志</span><br><span class="line">  - 重要字段</span><br><span class="line">    - source，记录源文件的路径</span><br><span class="line">    - offset，记录本次读取行为的结束点的偏移量，当 filebest 重启时，会在此基础上进行继续工作</span><br><span class="line"></span><br><span class="line">* /var/lib/filebeat/registry/filebeat/meta.json</span><br><span class="line">  - 记录版本信息</span><br></pre></td></tr></table></figure></li>
<li><strong>输出内容</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - filebeat 的输出内容是一个 json</span><br><span class="line">  - 其中除了源文件的数据外，还会额外增加一些描述字段</span><br><span class="line"></span><br><span class="line">* 重要字段</span><br><span class="line">  - @timestamp</span><br><span class="line">  - message         源文件的新增数据的内容</span><br><span class="line">  - input           input 相关的信息</span><br><span class="line">  - input.type      input 的类型</span><br><span class="line">  - log.offset      本次输出的行的开始位置在源文件中的偏移量</span><br><span class="line">  - log.file.path   数据源文件</span><br><span class="line">  - host.name       数据源所在的主机</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：Filebeat-指令"><a href="#知识点：Filebeat-指令" class="headerlink" title="知识点：Filebeat 指令"></a>知识点：Filebeat 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  filebate [Flag]</span><br><span class="line">  filebate [Command]</span><br></pre></td></tr></table></figure></li>
<li><strong>Command</strong></li>
<li><strong>Flag</strong></li>
</ol>
<hr>
<h2 id="7-2-Filebeat-安装"><a href="#7-2-Filebeat-安装" class="headerlink" title="7.2 Filebeat 安装"></a>7.2 Filebeat 安装</h2><hr>
<h3 id="知识点：Filebeat-rpm-安装"><a href="#知识点：Filebeat-rpm-安装" class="headerlink" title="知识点：Filebeat rpm 安装"></a>知识点：Filebeat rpm 安装</h3><ol>
<li><strong>安装</strong></li>
<li><strong>修改配置</strong></li>
<li><strong>启动服务</strong></li>
</ol>
<hr>
<h2 id="7-3-Filebeat-配置"><a href="#7-3-Filebeat-配置" class="headerlink" title="7.3 Filebeat 配置"></a>7.3 Filebeat 配置</h2><hr>
<h3 id="知识点：Filebeat-配置"><a href="#知识点：Filebeat-配置" class="headerlink" title="知识点：Filebeat 配置"></a>知识点：Filebeat 配置</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - filebeat 的主配置文件，使用 yaml 格式</span><br><span class="line">  - 在其中定义了 filebeat 的所有的细节</span><br><span class="line"></span><br><span class="line">* 配置文件位置</span><br><span class="line">  /etc/filebeat/filebeat.yml</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：filebeat-input-介绍"><a href="#知识点：filebeat-input-介绍" class="headerlink" title="知识点：filebeat input 介绍"></a>知识点：filebeat input 介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - List 型</span><br><span class="line">  - 配置 filebeat 采集的日志数据的源文件</span><br><span class="line">  - input 有多种类型，如 log、stdin、filestream 等</span><br><span class="line"></span><br><span class="line">* 关键字</span><br><span class="line">  filebeat.inputs</span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">filebeat.inputs:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">type:</span> <span class="string">filestream</span></span><br><span class="line">  <span class="attr">id:</span> <span class="string">my-filestream-id</span></span><br><span class="line">  <span class="attr">paths:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/var/log/messages</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/var/log/*.log</span></span><br><span class="line"><span class="attr">filebeat.inputs:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">type:</span> <span class="string">log</span></span><br><span class="line">  <span class="attr">paths:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;/var/log/apache2/*&quot;</span></span><br><span class="line">  <span class="attr">fields:</span>                           <span class="comment"># 为 filebeat 的输出内容增加一个字段</span></span><br><span class="line">    <span class="attr">apache:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">fields_under_root:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：filebeat-output-介绍"><a href="#知识点：filebeat-output-介绍" class="headerlink" title="知识点：filebeat output 介绍"></a>知识点：filebeat output 介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - Dist 型</span><br><span class="line">  - 指定 filebeat 发送数据的目标，如 ES、Logstash、kafka 等</span><br><span class="line">  - output 有多种类型，每种类型都有自己独立的关键字，如 output.elasticsearch、output.console 等</span><br><span class="line">  - 在一个 filebeat 配置文件中，可以同时配置多个 output，每一种类型的 output 只能配置一个</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例一</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">output.console:</span></span><br><span class="line">  <span class="attr">pretty:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：output-console-配置"><a href="#知识点：output-console-配置" class="headerlink" title="知识点：output.console 配置"></a>知识点：output.console 配置</h3><hr>
<h3 id="知识点：output-elasticsearch-配置"><a href="#知识点：output-elasticsearch-配置" class="headerlink" title="知识点：output.elasticsearch 配置"></a>知识点：output.elasticsearch 配置</h3><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">output.elasticsearch:</span></span><br><span class="line">  <span class="attr">hosts:</span>  <span class="comment"># List，填入 ES 集群的所有节点</span></span><br><span class="line">  <span class="attr">index:</span>  <span class="comment"># String，填入 ES 集群上的目标索引</span></span><br><span class="line">          <span class="comment">#   * 如果 ES 开启了索引生命周期管理，则此处的 index 的配置会失效</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h1 id="Chapter11-ES-集群"><a href="#Chapter11-ES-集群" class="headerlink" title="Chapter11 ES 集群"></a>Chapter11 ES 集群</h1><hr>
<h2 id="11-1-ES-集群介绍"><a href="#11-1-ES-集群介绍" class="headerlink" title="11.1 ES 集群介绍"></a>11.1 ES 集群介绍</h2><hr>
<h3 id="知识点：ES-集群基础"><a href="#知识点：ES-集群基础" class="headerlink" title="知识点：ES 集群基础"></a>知识点：ES 集群基础</h3><ol>
<li><strong>基础概念</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">* 集群</span><br><span class="line">  - cluster，由一个或多个节点组织在一起，共同持有整个 ES 的数据，一起提供索引和搜索功能</span><br><span class="line"></span><br><span class="line">* 集群 id</span><br><span class="line">  - cluster id，是一个集群的唯一名称标识</span><br><span class="line">  - 默认为 elasticsearch</span><br><span class="line">  - 一个节点只能通过指定某个集群 id，来加入这个集群</span><br><span class="line"></span><br><span class="line">* 节点</span><br><span class="line">  - node，集群中的一个逻辑服务器</span><br><span class="line">  - 节点会存储数据、参与集群的索引和搜索</span><br><span class="line"></span><br><span class="line">* 节点 id</span><br><span class="line">  - node id，是一个节点的唯一名称标识</span><br><span class="line"></span><br><span class="line">* 分片</span><br><span class="line">  - shard，将一个索引划分成多份，每一份就叫做分片，默认 3 份</span><br><span class="line">  - 每一个分片本身都是一个功能完善并且独立的索引，并且可以被放置在集群的任何节点上</span><br><span class="line">  - 分片的数量可以在创建索引时指定</span><br><span class="line"></span><br><span class="line">* 主分片和副本分片</span><br><span class="line">  - 每一个分片，都会被创建一个主分片 primary shard 和至少一个副本分片 replica shard，用于实现高可用</span><br><span class="line">  - 主分片有且只有一个，副本分片可以有多个</span><br><span class="line">  - 副本分片通常不可以与主分片放在同一个物理服务器上</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：节点角色"><a href="#知识点：节点角色" class="headerlink" title="知识点：节点角色"></a>知识点：节点角色</h3><ol>
<li><strong>节点角色分类</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">* master</span><br><span class="line">  - 主节点</span><br><span class="line">  - 职责</span><br><span class="line">    - 记录和管理集群状态</span><br><span class="line">    - 决定分片在哪一个节点上</span><br><span class="line">    - 处理创建/删除索引库的请求</span><br><span class="line"></span><br><span class="line">* master eligible</span><br><span class="line">  - 备选主节点</span><br><span class="line">  - 配置项，node.master</span><br><span class="line"></span><br><span class="line">* data node</span><br><span class="line">  - 数据节点</span><br><span class="line">  - 配置项，node.data</span><br><span class="line">  - 职责，储存数据、搜索、聚合、CRUD</span><br><span class="line"></span><br><span class="line">* ingest node</span><br><span class="line">  - 预处理节点 node.ingest</span><br><span class="line">  - 职责，在储存数据前进行预处理 pre-processing，如删除字段、修改字段内容等</span><br><span class="line"></span><br><span class="line">* coordinating only node</span><br><span class="line">  - 协调节点</span><br><span class="line">  - 职责</span><br><span class="line">    - 将请求路由到真正的数据节点</span><br><span class="line">    - 合并其他节点的处理结果，返回给用户</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：master-选举"><a href="#知识点：master-选举" class="headerlink" title="知识点：master 选举"></a>知识点：master 选举</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 脑裂</span><br><span class="line">  - 指同时选举出多个 master 的情况</span><br><span class="line">  - 可能原因</span><br><span class="line">    1. 网络波动</span><br><span class="line">  - 防范办法</span><br><span class="line">    1. 选票数量需要大于 (eligible + 1)/2，才能当选 master，因此 es 中，eligible 节点的数量最好是奇数。在 7.0 以后，此配置为默认</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：数据均衡"><a href="#知识点：数据均衡" class="headerlink" title="知识点：数据均衡"></a>知识点：数据均衡</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">* explain 指令，在查询数据时，同时返回数据所在的分片编号</span><br><span class="line"></span><br><span class="line">* 数据分配哈希算法</span><br><span class="line">  shard = hash(_routing) % number_of_shards</span><br><span class="line"></span><br><span class="line">* _routing</span><br><span class="line">  - 默认是文档的 id</span><br><span class="line"></span><br><span class="line">* 算法与分片数量有关，因此索引库一旦创建，分片数量不可更改</span><br><span class="line"></span><br><span class="line">* 新增文档的流程</span><br><span class="line">  - coordinating 计算出文档对应的 hash</span><br><span class="line">  - coordinating 将请求路由到主分片所在的 data node</span><br><span class="line">  - data node 在主分片中新增文档</span><br><span class="line">  - data node 将动作同步给副本分片所在的 node</span><br><span class="line">  - 副本分片新增数据</span><br><span class="line">  - data node 将结果返回给 coordinating</span><br><span class="line">  - coordinating 通知用户结果</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：分布式查询"><a href="#知识点：分布式查询" class="headerlink" title="知识点：分布式查询"></a>知识点：分布式查询</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - ES 的查询分为两个节点，分散阶段，收集阶段</span><br><span class="line">  - 分散阶段 scatter，coordinating 会将请求发送给每一个分片</span><br><span class="line">  - 收集阶段 gather，coordinating 收集所有的 data node 的查询结果，处理为最终结果集，返回给用户</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：节点转发"><a href="#知识点：节点转发" class="headerlink" title="知识点：节点转发"></a>知识点：节点转发</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 每个节点都知道其它节点的信息</span><br><span class="line">  - 可以对任意一个结点发起请求，接收请求的结点会转发给其它结点查询数据</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：故障转移"><a href="#知识点：故障转移" class="headerlink" title="知识点：故障转移"></a>知识点：故障转移</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - master 会监控集群中所有的节点</span><br><span class="line">  - 当发现有节点宕机，则 master 会将故障节点的数据迁移到其他节点，此即为故障转移 failover</span><br></pre></td></tr></table></figure></li>
</ol>

    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2000/01/01/Blog42-redis/" rel="prev" title="Blog42-redis">
                  <i class="fa fa-chevron-left"></i> Blog42-redis
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2000/01/01/Blog44-jenkins/" rel="next" title="Blog44-jenkins">
                  Blog44-jenkins <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2000 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"per_page":true,"tags":"none","cdn":"//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
