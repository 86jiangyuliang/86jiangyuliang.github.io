<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.10.1","exturl":false,"sidebar":{"position":"left","width":500,"display":"always","padding":1,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="docker">
<meta property="og:type" content="article">
<meta property="og:title" content="Blog31-docker">
<meta property="og:url" content="http://example.com/2000/01/01/Blog31-docker/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="docker">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="1999-12-31T16:00:31.000Z">
<meta property="article:modified_time" content="2024-03-24T08:58:35.170Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2000/01/01/Blog31-docker/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://example.com/2000/01/01/Blog31-docker/","path":"2000/01/01/Blog31-docker/","title":"Blog31-docker"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Blog31-docker | Hexo</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Hexo</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Blog31-docker"><span class="nav-text">Blog31-docker</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%AE%E5%8A%A9"><span class="nav-text">帮助</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9C%AA%E6%95%B4%E7%90%86"><span class="nav-text">未整理</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8D%E6%95%B4%E7%90%86"><span class="nav-text">不整理</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter01-Docker-%E4%BB%8B%E7%BB%8D"><span class="nav-text">Chapter01 Docker 介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF"><span class="nav-text">1.1 容器技术</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：容器技术介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E5%AE%B9%E5%99%A8%E4%B8%8E%E4%BC%A0%E7%BB%9F%E8%99%9A%E6%8B%9F%E6%9C%BA%E5%AF%B9%E6%AF%94"><span class="nav-text">知识点：容器与传统虚拟机对比</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF%E5%B8%A6%E6%9D%A5%E7%9A%84%E5%8F%98%E5%8C%96"><span class="nav-text">知识点：容器技术带来的变化</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-Docker-%E4%BB%8B%E7%BB%8D"><span class="nav-text">1.2 Docker 介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-%E7%AE%80%E4%BB%8B"><span class="nav-text">知识点：docker 简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-%E5%AE%89%E8%A3%85"><span class="nav-text">知识点：docker 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-%E9%95%9C%E5%83%8F%E5%8A%A0%E9%80%9F"><span class="nav-text">知识点：docker 镜像加速</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-%E5%8D%B8%E8%BD%BD"><span class="nav-text">知识点：docker 卸载</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-Docker-%E5%91%BD%E4%BB%A4"><span class="nav-text">1.3 Docker 命令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-%E6%9C%8D%E5%8A%A1"><span class="nav-text">知识点：docker 服务</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-info-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker info 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-help-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker help 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-inspect-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker inspect 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-system-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker system 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-events-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker events 指令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-Docker-%E5%BA%95%E5%B1%82"><span class="nav-text">1.4 Docker 底层</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-%E7%9A%84%E8%BF%9B%E7%A8%8B%E7%BB%93%E6%9E%84"><span class="nav-text">知识点：docker 的进程结构</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AE%88%E6%8A%A4%E8%BF%9B%E7%A8%8B"><span class="nav-text">知识点：容器的守护进程</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E5%AE%B9%E5%99%A8%E4%B8%8E-namespace"><span class="nav-text">知识点：容器与 namespace</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E5%AE%B9%E5%99%A8%E4%B8%8E-cgroup"><span class="nav-text">知识点：容器与 cgroup</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter02-Docker-%E5%AE%B9%E5%99%A8"><span class="nav-text">Chapter02 Docker 容器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-Docker-%E5%AE%B9%E5%99%A8"><span class="nav-text">2.1 Docker 容器</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-%E5%AE%B9%E5%99%A8%E6%93%8D%E4%BD%9C%E8%8C%83%E4%BE%8B"><span class="nav-text">知识点：docker 容器操作范例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-run-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker run 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-ps-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker ps 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-exec-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker exec 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-rm-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker rm 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-cp-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker cp 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-start-x2F-stop-x2F-restart-x2F-kill-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker start&#x2F;stop&#x2F;restart&#x2F;kill 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-logs-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker logs 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-top-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker top 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-attach-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker attach 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-export-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker export 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-%E5%85%B6%E4%BB%96%E5%AE%B9%E5%99%A8%E7%9B%B8%E5%85%B3%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker 其他容器相关指令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-Docker-%E7%BD%91%E7%BB%9C"><span class="nav-text">2.2 Docker 网络</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-%E7%BD%91%E7%BB%9C"><span class="nav-text">知识点：docker 网络</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-%E6%8C%87%E4%BB%A4%E7%BD%91%E7%BB%9C%E7%9B%B8%E5%85%B3%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：docker 指令网络相关选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-network-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker network 指令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-Docker-%E6%95%B0%E6%8D%AE%E5%8D%B7"><span class="nav-text">2.3 Docker 数据卷</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E5%AE%B9%E5%99%A8%E6%95%B0%E6%8D%AE%E5%8D%B7-VOLUME"><span class="nav-text">知识点：容器数据卷 VOLUME</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter03-Docker-%E9%95%9C%E5%83%8F"><span class="nav-text">Chapter03 Docker 镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-Docker-%E9%95%9C%E5%83%8F"><span class="nav-text">3.1 Docker 镜像</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E9%95%9C%E5%83%8F%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：镜像介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E8%81%94%E5%90%88%E6%96%87%E4%BB%B6%E7%B3%BB%E7%BB%9F"><span class="nav-text">知识点：联合文件系统</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-images-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker images 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-search-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker search 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-pull-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker pull 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-tag-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker tag 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-rmi-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker rmi 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-save-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker save 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-import-x2F-load-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker import&#x2F;load 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-commit-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker commit 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-%E5%85%B6%E4%BB%96%E9%95%9C%E5%83%8F%E7%9B%B8%E5%85%B3%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker 其他镜像相关指令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-DockerFile"><span class="nav-text">3.2 DockerFile</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ADockerfile-%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：Dockerfile 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-build-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker build 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ADockerfile-%E5%9F%BA%E7%A1%80%E8%AF%AD%E6%B3%95"><span class="nav-text">知识点：Dockerfile 基础语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AFROM-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">知识点：FROM 关键字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AMAINTAINER-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">知识点：MAINTAINER 关键字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ALABEL-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">知识点：LABEL 关键字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ARUN-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">知识点：RUN 关键字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AADD%E3%80%81COPY-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">知识点：ADD、COPY 关键字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AEXPOSE-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">知识点：EXPOSE 关键字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AWORKDIR-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">知识点：WORKDIR 关键字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AUSER-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">知识点：USER 关键字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AENV-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">知识点：ENV 关键字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ACMD-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">知识点：CMD 关键字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AENTRYPOINT-%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">知识点：ENTRYPOINT 关键字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ADockerfile-%E5%85%B6%E4%BB%96%E5%85%B3%E9%94%AE%E5%AD%97"><span class="nav-text">知识点：Dockerfile 其他关键字</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ADockerfile-%E8%8C%83%E4%BE%8B"><span class="nav-text">知识点：Dockerfile 范例</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter04-Docker-%E4%BB%93%E5%BA%93"><span class="nav-text">Chapter04 Docker 仓库</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-Docker-Registry"><span class="nav-text">4.1 Docker Registry</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-registry-%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：docker registry 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-login-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker login 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-logout-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker logout 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-push-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker push 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-registry-%E8%8C%83%E4%BE%8B"><span class="nav-text">知识点：docker registry 范例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E4%BA%91%E4%BB%93%E5%BA%93%E8%8C%83%E4%BE%8B"><span class="nav-text">知识点：云仓库范例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-Harbor"><span class="nav-text">4.2 Harbor</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter05-Docker-Compose"><span class="nav-text">Chapter05 Docker Compose</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-Docker-Compose"><span class="nav-text">5.1 Docker Compose</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-compose-%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：docker compose 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-compose-%E7%9A%84%E5%AE%89%E8%A3%85%E3%80%81%E5%8D%B8%E8%BD%BD%E3%80%81%E9%AA%8C%E8%AF%81"><span class="nav-text">知识点：docker compose 的安装、卸载、验证</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-compose-%E7%9B%B8%E5%85%B3%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker compose 相关指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Acompose-file-%E7%AE%80%E5%8D%95%E8%AF%AD%E6%B3%95"><span class="nav-text">知识点：compose file 简单语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-compose-%E8%8C%83%E4%BE%8B"><span class="nav-text">知识点：docker compose 范例</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">18</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2000/01/01/Blog31-docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Blog31-docker | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Blog31-docker
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2000-01-01 00:00:31" itemprop="dateCreated datePublished" datetime="2000-01-01T00:00:31+08:00">2000-01-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2024-03-24 16:58:35" itemprop="dateModified" datetime="2024-03-24T16:58:35+08:00">2024-03-24</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <hr>
<h1 id="Blog31-docker"><a href="#Blog31-docker" class="headerlink" title="Blog31-docker"></a>Blog31-docker</h1><p><a href="#Chapter01-Docker-%E4%BB%8B%E7%BB%8D"><strong>Chapter01 Docker 介绍</strong></a></p>
<ul>
<li><a href="#1-1-%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF">1.1 容器技术</a></li>
<li><a href="#1-2-Docker-%E4%BB%8B%E7%BB%8D">1.2 Docker 介绍</a></li>
<li><a href="#1-3-Docker-%E5%91%BD%E4%BB%A4">1.3 Docker 命令</a></li>
<li><a href="#1-4-Docker-%E5%BA%95%E5%B1%82">1.4 Docker 底层</a></li>
</ul>
<p><a href="#Chapter02-Docker-%E5%AE%B9%E5%99%A8"><strong>Chapter02 Docker 容器</strong></a></p>
<ul>
<li><a href="#2-1-Docker-%E5%AE%B9%E5%99%A8">2.1 Docker 容器</a></li>
<li><a href="#2-2-Docker-%E7%BD%91%E7%BB%9C">2.2 Docker 网络</a></li>
<li><a href="#2-3-Docker-%E6%95%B0%E6%8D%AE%E5%8D%B7">2.3 Docker 数据卷</a></li>
</ul>
<p><a href="#Chapter03-Docker-%E9%95%9C%E5%83%8F"><strong>Chapter03 Docker 镜像</strong></a></p>
<ul>
<li><a href="#3-1-Docker-%E9%95%9C%E5%83%8F">3.1 Docker 镜像</a></li>
<li><a href="#3-2-Docker-File">3.2 DockerFile</a></li>
</ul>
<p><a href="#Chapter04-Docker-%E4%BB%93%E5%BA%93"><strong>Chapter04 Docker 仓库</strong></a></p>
<ul>
<li><a href="#4-1-Docker-Registry">4.1 Docker Registry</a></li>
<li><a href="#4-2-Harbor">4.2 Harbor</a></li>
</ul>
<p><a href="#Chapter04-Docker-Compose"><strong>Chapter05 Docker Compose</strong></a></p>
<ul>
<li><a href="#5-1-Docker-Compose">5.1 Docker Compose</a></li>
</ul>
<hr>
<h2 id="帮助"><a href="#帮助" class="headerlink" title="帮助"></a>帮助</h2><ol>
<li><strong>官网</strong></li>
</ol>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.docker.com/">https://www.docker.com/</a></li>
</ul>
<ol start="2">
<li><strong>Guide</strong></li>
</ol>
<ul>
<li>Get Started <a target="_blank" rel="noopener" href="https://docs.docker.com/get-started/">https://docs.docker.com/get-started/</a></li>
<li>Get Docker <a target="_blank" rel="noopener" href="https://docs.docker.com/get-docker/">https://docs.docker.com/get-docker/</a></li>
</ul>
<ol start="3">
<li><strong>Manual</strong></li>
</ol>
<ul>
<li>Manual <a target="_blank" rel="noopener" href="https://docs.docker.com/manuals/">https://docs.docker.com/manuals/</a></li>
<li>Engine <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/">https://docs.docker.com/engine/</a></li>
<li>Compose <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/">https://docs.docker.com/compose/</a></li>
<li>Hub <a target="_blank" rel="noopener" href="https://docs.docker.com/docker-hub/">https://docs.docker.com/docker-hub/</a></li>
</ul>
<ol start="4">
<li><strong>Reference</strong></li>
</ol>
<ul>
<li>Reference <a target="_blank" rel="noopener" href="https://docs.docker.com/reference/">https://docs.docker.com/reference/</a></li>
<li>docker CLI <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/cli/">https://docs.docker.com/engine/reference/commandline/cli/</a></li>
<li>dockerd CLI <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/dockerd/">https://docs.docker.com/engine/reference/commandline/dockerd/</a></li>
<li>DockerFile <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a></li>
<li>ComposeFile <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/">https://docs.docker.com/compose/compose-file/</a></li>
</ul>
<hr>
<h2 id="未整理"><a href="#未整理" class="headerlink" title="未整理"></a>未整理</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* harbor</span><br><span class="line"></span><br><span class="line">* /etc/docker/daemon.json</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h2 id="不整理"><a href="#不整理" class="headerlink" title="不整理"></a>不整理</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* docker 底层技术与实现</span><br><span class="line">  - namespace 技术</span><br><span class="line">  - cgroup 技术</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="Chapter01-Docker-介绍"><a href="#Chapter01-Docker-介绍" class="headerlink" title="Chapter01 Docker 介绍"></a>Chapter01 Docker 介绍</h1><hr>
<h2 id="1-1-容器技术"><a href="#1-1-容器技术" class="headerlink" title="1.1 容器技术"></a>1.1 容器技术</h2><hr>
<h3 id="知识点：容器技术介绍"><a href="#知识点：容器技术介绍" class="headerlink" title="知识点：容器技术介绍"></a>知识点：容器技术介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">* 容器技术</span><br><span class="line">  - 容器技术，就是通过使用 namespace、cgroup 等技术，为进程创造一个隔离的运行环境，将进程的资源与系统的其他部分隔离开，模拟了一个完整的操作系统</span><br><span class="line"></span><br><span class="line">* 容器没有自己的内核</span><br><span class="line">  - 容器使用宿主机的内核</span><br><span class="line">  - 一台宿主机上的所有容器共用一个内核</span><br><span class="line">  - 容器不直接访问硬件，而是通过宿主机的内核来访访问硬件</span><br><span class="line"></span><br><span class="line">* 容器位于 paas 层</span><br><span class="line">  - iaas 负责物理服务器、网络、存储、硬件、操作系统</span><br><span class="line">  - iaas 技术如 openstack、ecs、vmware、KVM Kernel-based Virtual Machine</span><br><span class="line"></span><br><span class="line">* 容器的特点</span><br><span class="line">  - 自包含</span><br><span class="line">  - 轻量级</span><br><span class="line">  - 可移植</span><br><span class="line">  - 相互隔离</span><br><span class="line"></span><br><span class="line">* 容器的优势</span><br><span class="line">  - 程序带环境</span><br><span class="line">  - 轻量级</span><br><span class="line">  - 快速启动</span><br><span class="line">  - 程序运行时与数据分离</span><br><span class="line">  - 快速移植、扩容、缩容</span><br><span class="line"></span><br><span class="line">* OCI 组织</span><br><span class="line">  - open contianer</span><br><span class="line">  - 由 linux 基金会、微软、红帽、docker、google、ibm 等组建，旨在确定开放的标准的容器规范</span><br><span class="line">  - 目前已有两个规范，runtime spec 和 image format spec</span><br><span class="line">  - 只要兼容这两个规范，就可以保证容器的可移植性和可操作性</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：容器与传统虚拟机对比"><a href="#知识点：容器与传统虚拟机对比" class="headerlink" title="知识点：容器与传统虚拟机对比"></a>知识点：容器与传统虚拟机对比</h3><ol>
<li><strong>传统虚拟机技术</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 实现</span><br><span class="line">  - 在硬件层实现的虚拟化，需要虚拟出一套硬件</span><br><span class="line">  - 虚拟机具有自己单独的内核，可以通过自己的内核直接访问硬件</span><br><span class="line">  - 需要 Hypervisor 层的支持，要求宿主机的 CPU 支持虚拟化</span><br><span class="line"></span><br><span class="line">* 传统虚拟机的缺点</span><br><span class="line">  - 资源占用多，空运行的虚拟机也会占用一部分资源</span><br><span class="line">  - 启动慢，需要运行完整的 OS 启动流程，冗余步骤多</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>容器相对于传统虚拟机的优点</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">* 资源占用更少</span><br><span class="line"></span><br><span class="line">* 适配性更强</span><br><span class="line">  - 基于 OS，只要有操作系统即可</span><br><span class="line">  - 不要求宿主机的 CPU 对虚拟化的支持</span><br><span class="line"></span><br><span class="line">* 启动速度更快</span><br><span class="line">  - 容器比虚拟机具有更少的抽象层，不需要加载各种硬件的驱动</span><br><span class="line">  - 容器不需要启动一个内核，省略了诸如系统引导、地址返回、服务启动等过程</span><br><span class="line"></span><br><span class="line">* 更利于快速发布和部署</span><br><span class="line">  - 容器的启动速度为秒级</span><br><span class="line">  - 只要有镜像文件就能启动容器，不需要人工进行配置</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：容器技术带来的变化"><a href="#知识点：容器技术带来的变化" class="headerlink" title="知识点：容器技术带来的变化"></a>知识点：容器技术带来的变化</h3><ol>
<li><strong>更快的应用交付和部署</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 传统开发的模式</span><br><span class="line">  - 提交软件时，需要一并提交配置说明文档</span><br><span class="line">  - 由运维进行应用的部署，部署应用时，需要先参照配置文档，准备环境、设定配置</span><br><span class="line">  - 常出现因为环境、配置的原因导致应用异常</span><br><span class="line"></span><br><span class="line">* 容器化后</span><br><span class="line">  - 提交的不再是软件安装包，而是镜像文件</span><br><span class="line">  - 镜像文件中，已经对相应的配置进行了设定、准备好了相应的环境和依赖</span><br><span class="line">  - 测试环节、部署环节全部使用镜像文件</span><br><span class="line">  - 节省了部署、配置、测试、验证的时间</span><br><span class="line">  - 软件的开发环境、测试环境、生产环境高度统一</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>更快的升级和扩容</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 由于微服务架构和容器，应用开发变得像搭积木</span><br><span class="line"></span><br><span class="line">* 应用的扩容从天级变秒级</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>更简单的监控和运维</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 软件的生产环境、开发环境、测试环境高度一致</span><br><span class="line">  - 避免了环境和配置导致的新问题</span><br><span class="line">  - 软件异常时，可以直接通过测试环境的相同的容器快速定位故障和进行修复</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>更高效的硬件资源利用</strong></li>
<li><strong>引入了一个新的概念，devops</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 开发需要开始扮演一部分运维的角色</span><br><span class="line">  - 之前为全栈工程师，但不行，前端、后端 java、更后端的大数据数仓数湖等，想让一个人全部精通太难了</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="1-2-Docker-介绍"><a href="#1-2-Docker-介绍" class="headerlink" title="1.2 Docker 介绍"></a>1.2 Docker 介绍</h2><hr>
<h3 id="知识点：docker-简介"><a href="#知识点：docker-简介" class="headerlink" title="知识点：docker 简介"></a>知识点：docker 简介</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line">* Docker 介绍</span><br><span class="line">  - 开源</span><br><span class="line">  - 基于 go 语言开发</span><br><span class="line">  - 基于 linux 内核来实现容器技术</span><br><span class="line"></span><br><span class="line">* Docker 历史</span><br><span class="line">  - 在 2013 开源</span><br><span class="line">  - 从 2015 开始流行</span><br><span class="line">  - 早期叫 dotcloud</span><br><span class="line">  - 总部位于旧金山，公司不怎么赚钱</span><br><span class="line">  - docker 早期的实现方式，对 LXC 进行高级的封装，提供了标准的配置方法，并将做好的配置做成镜像</span><br><span class="line">  - docker 新的实现方式，使用自己研发的开源的 runc 技术</span><br><span class="line">  - docker 从 1.13 开始，版本命名方式改为 年.月.日 方式</span><br><span class="line">  - docker 从 17.03 开始，分为 CE 版和 EE 版</span><br><span class="line"></span><br><span class="line">* Docker 理念，Build, Ship and Run Any APP Anywhere</span><br><span class="line">  - 构建 Build</span><br><span class="line">  - 运输 Ship</span><br><span class="line">  - 运行 Run</span><br><span class="line"></span><br><span class="line">* Docker 的组成</span><br><span class="line">  - 主机</span><br><span class="line">  - 服务端</span><br><span class="line">  - 客户端</span><br><span class="line">  - 容器 Container</span><br><span class="line">  - 镜像 Image</span><br><span class="line">  - 仓库 Registry</span><br><span class="line"></span><br><span class="line">* docker 的 C/S 结构</span><br><span class="line">  - S，dockerd</span><br><span class="line">    - dockerd 是 docker 的守护进程</span><br><span class="line">    - dockerd 负责启动和管理各个容器进程</span><br><span class="line">  - C，docker-cli、web-api 等</span><br><span class="line">    - docker-cli 通过 local socket 连接访问 docker daemon</span><br><span class="line"></span><br><span class="line">* docker 使用的底层技术</span><br><span class="line">  - namespace</span><br><span class="line">  - cgroup</span><br><span class="line">  - chroot</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-安装"><a href="#知识点：docker-安装" class="headerlink" title="知识点：docker 安装"></a>知识点：docker 安装</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 安装需求</span><br><span class="line">  - 必须部署在 Linux 内核之上，windows 系统则需要先安装虚拟 Linux 环境</span><br><span class="line">  - 内核版本要求 3.8 以上，64bit</span><br><span class="line">  - yum 安装需要 centos-extras</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>yum 安装 docker-ce</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 官方源安装</span></span><br><span class="line">yum -y install yum-utils</span><br><span class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line">yum -y install docker-ce</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 阿里源安装</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装指导 https://developer.aliyun.com/mirror/docker-ce?spm=a2c6h.13651102.0.0.57e31b11AJtYxU</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step 1，安装必要的一些系统工具</span></span><br><span class="line">sudo yum install yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"><span class="meta">#</span><span class="bash"> Step 2，添加阿里云 docker-ce repo</span></span><br><span class="line">sudo yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">sudo sed -i &#x27;s+download.docker.com+mirrors.aliyun.com/docker-ce+&#x27; /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"><span class="meta">#</span><span class="bash"> Step 3，更新并安装 docker-ce</span></span><br><span class="line">sudo yum makecache fast</span><br><span class="line">sudo yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line"><span class="meta">#</span><span class="bash"> Step 4，启动 docker 服务</span></span><br><span class="line">sudo systemctl start docker</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 其他</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装指定版本的 docker-ce</span></span><br><span class="line">yum enable docker-ce-test</span><br><span class="line">yum list docker-ce.x86_64 --showduplicates | sort -r</span><br><span class="line">yum -y install docker-ce-[VERSION]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>apt 安装 docker-ce</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 阿里源安装</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step 1，安装必要的一些系统工具</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install apt-transport-https ca-certificates curl software-properties-common</span><br><span class="line"><span class="meta">#</span><span class="bash"> step 2，安装 GPG 证书</span></span><br><span class="line">curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | sudo apt-key add -</span><br><span class="line"><span class="meta">#</span><span class="bash"> Step 3，添加阿里云 docker-ce repo</span></span><br><span class="line">sudo add-apt-repository &quot;deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&quot;</span><br><span class="line"><span class="meta">#</span><span class="bash"> Step 4，更新并安装 docker-ce</span></span><br><span class="line">sudo apt-get update</span><br><span class="line">sudo apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-镜像加速"><a href="#知识点：docker-镜像加速" class="headerlink" title="知识点：docker 镜像加速"></a>知识点：docker 镜像加速</h3><ol>
<li><strong>阿里云源</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 阿里云会给每一个账号分配一个唯一的 docker 镜像加速地址</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 阿里云 --&gt; 控制台 --&gt; 容器镜像服务 --&gt; 镜像加速器</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> https://&lt;你的ID&gt;.mirror.aliyuncs.com</span></span><br><span class="line"></span><br><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line"></span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;XXXX&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>其他源</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 科大：https://docker.mirrors.ustc.edu.cn</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 网易：https://hub-mirror.c.163.com</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 七牛：https://reg-mirror.qiniu.com</span></span><br><span class="line"></span><br><span class="line">vim /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [</span><br><span class="line">    &quot;https://docker.mirrors.ustc.edu.cn&quot;,</span><br><span class="line">    &quot;https://hub-mirror.c.163.com&quot;,</span><br><span class="line">    &quot;https://reg-mirror.qiniu.com&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-卸载"><a href="#知识点：docker-卸载" class="headerlink" title="知识点：docker 卸载"></a>知识点：docker 卸载</h3><ol>
<li><strong>yum 卸载 docker</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop docker</span><br><span class="line">yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line">rm -rf /var/lib/docker /var/lib/containerd</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="1-3-Docker-命令"><a href="#1-3-Docker-命令" class="headerlink" title="1.3 Docker 命令"></a>1.3 Docker 命令</h2><hr>
<h3 id="知识点：docker-服务"><a href="#知识点：docker-服务" class="headerlink" title="知识点：docker 服务"></a>知识点：docker 服务</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 启动、停止 docker</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  systemctl start docker</span><br><span class="line">  systemctl stop docker</span><br><span class="line">  systemctl enable docker</span><br><span class="line">  systemctl disable docker</span><br><span class="line">  systemctl restart docker</span><br><span class="line">  systemctl status docker</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-info-指令"><a href="#知识点：docker-info-指令" class="headerlink" title="知识点：docker info 指令"></a>知识点：docker info 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 查看 docker 软件信息</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker info</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>输出信息</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* Client</span><br><span class="line">  - docker 客户端相关信息</span><br><span class="line"></span><br><span class="line">* Server</span><br><span class="line">  - docker 服务端相关信息</span><br><span class="line"></span><br><span class="line">* Registry Mirrors</span><br><span class="line">  - 当前设置的 hub 加速地址</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-help-指令"><a href="#知识点：docker-help-指令" class="headerlink" title="知识点：docker help 指令"></a>知识点：docker help 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 查看 docker 帮助</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker help</span><br><span class="line">  docker help CMD</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-inspect-指令"><a href="#知识点：docker-inspect-指令" class="headerlink" title="知识点：docker inspect 指令"></a>知识点：docker inspect 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 查看 docker 中任意一个对象的详细信息</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker [-f STRING] inspect OBJECT</span><br><span class="line"></span><br><span class="line">* OBJECT</span><br><span class="line">  - 指定需要查看的对象</span><br><span class="line">  - 对于容器，可以是 ContainerID、ContainerName</span><br><span class="line">  - 对于镜像，可以是 ImageId、ImageName</span><br><span class="line"></span><br><span class="line">* -f STRING</span><br><span class="line">  - 对结果进行过滤</span><br><span class="line">  - 采取 json 格式</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看容器的 ID</span></span><br><span class="line">docker inspect -f &#x27;&#123;&#123;.Id&#125;&#125;&#x27; mysql01</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器的端口绑定情况</span></span><br><span class="line">docker inspect -f &#x27;&#123;&#123;.NetworkSettings.Ports&#125;&#125;&#x27; mysql01</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-system-指令"><a href="#知识点：docker-system-指令" class="headerlink" title="知识点：docker system 指令"></a>知识点：docker system 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 查看 docker 的全局信息，如系统信息、资源使用等</span><br><span class="line"></span><br><span class="line">* docker system info</span><br><span class="line">  - 查看 docker 软件基本信息、宿主机信息</span><br><span class="line"></span><br><span class="line">* docker system df</span><br><span class="line">  - 查看 docker 的磁盘占用情况</span><br><span class="line"></span><br><span class="line">* docker system df -v</span><br><span class="line">  - 查看更详细的磁盘信息，包括每一个镜像的磁盘占用、每一个容器的磁盘占用，等</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-events-指令"><a href="#知识点：docker-events-指令" class="headerlink" title="知识点：docker events 指令"></a>知识点：docker events 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 查看 dockerd 的事件</span><br><span class="line">  - 事件里记录了 dockerd 的各种变更，相当于 dockerd 的系统日志</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker events OPTIONS</span><br><span class="line"></span><br><span class="line">* OPTIONS</span><br><span class="line">  -f, --filter FILTER</span><br><span class="line">  --since STRING</span><br><span class="line">  --until STRING</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker events --since 20240101</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="1-4-Docker-底层"><a href="#1-4-Docker-底层" class="headerlink" title="1.4 Docker 底层"></a>1.4 Docker 底层</h2><hr>
<h3 id="知识点：docker-的进程结构"><a href="#知识点：docker-的进程结构" class="headerlink" title="知识点：docker 的进程结构"></a>知识点：docker 的进程结构</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">* dockerd</span><br><span class="line">  - docker 的服务端</span><br><span class="line">  - 接收客户端指令</span><br><span class="line">  - 通过 sock 文件调用 containerd</span><br><span class="line">  - 因为是基于 sock 文件与客户端进行通信，因此只能接受本地的指令，不能跨主机，没有校验机制</span><br><span class="line"></span><br><span class="line">* docker-proxy</span><br><span class="line">  - 由 dockerd 启动</span><br><span class="line">  - 为每个容器确定网络访问规则</span><br><span class="line"></span><br><span class="line">* containerd</span><br><span class="line">  - 一个标准的容器运行时</span><br><span class="line">  - 由 dockerd 启动 containerd 并调用</span><br><span class="line">  - 管理宿主机上的容器的完整生命周期</span><br><span class="line">  - 在整个容器的生命周期中，containerd 通过 epoll 监控容器的文件、事件</span><br><span class="line">  - containerd 的运行时要求非常低，大多数与 Linux 容器功能集的交互都是由 runc 处理</span><br><span class="line"></span><br><span class="line">* containerd-shim</span><br><span class="line">* containerd-shim-runc-v2</span><br><span class="line">  - 沙箱进程</span><br><span class="line">  - 每个容器一个</span><br><span class="line">  - 手动执行 container-shim 命令，也能创建容器</span><br><span class="line"></span><br><span class="line">* runc</span><br><span class="line">  - docker 开发的根据 OCI 规范用来生成和运行容器的 cli 工具</span><br><span class="line">  - 容器环境的准备进程</span><br><span class="line"></span><br><span class="line">* docker-cli</span><br><span class="line">  - docker 的客户端</span><br><span class="line">  - 发送 docker 控制指令</span><br><span class="line">  - 因为是基于 sock 与服务端进行通信，因此只能管理本机的 dockerd</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>调用关系</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">* dockerd 启动，同时自动启动 containerd</span><br><span class="line"></span><br><span class="line">* docker-cli 发送指令到 dockerd</span><br><span class="line"></span><br><span class="line">* dockerd 发送信息到 containerd</span><br><span class="line"></span><br><span class="line">* containerd 启动一个 containerd-shim-runc-v2 进程</span><br><span class="line"></span><br><span class="line">* containerd-shim-runc-v2 执行各种 runc 指令，来创建容器的环境</span><br><span class="line">  - runc 调用 unshare system call 设置 namespace</span><br><span class="line">  - runc 调用 clone system call 创建容器的守护进程</span><br><span class="line">  - runc 退出，守护进程移交给 containerd-shim-runc-v2</span><br><span class="line"></span><br><span class="line">* 容器启动完成</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：容器的守护进程"><a href="#知识点：容器的守护进程" class="headerlink" title="知识点：容器的守护进程"></a>知识点：容器的守护进程</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 容器中需要有一个长期运行的进程，作为容器的守护进程</span><br><span class="line">  - 一个容器的本质，就是其守护进程</span><br><span class="line">  - 守护进程的 pid 为 1</span><br><span class="line">  - 守护进程作为容器中的 init 进程，容器中的其他进程，都是守护进程的子进程</span><br><span class="line">  - 如果守护进程结束，则容器也就退出了</span><br><span class="line"></span><br><span class="line">* 守护进程的程序为在镜像中指定</span><br><span class="line">  - CMD</span><br><span class="line">  - ENTRYPOINT</span><br><span class="line"></span><br><span class="line">* 守护进程需要占据一个前台</span><br><span class="line">  - 空容器会自动停止</span><br><span class="line">  - nginx 容器，nginx 程序需要占用前台，故需要设置 daemon off</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：容器与-namespace"><a href="#知识点：容器与-namespace" class="headerlink" title="知识点：容器与 namespace"></a>知识点：容器与 namespace</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">* namespace 介绍</span><br><span class="line">  - namespace 是 linux 内核提供的，用于隔离进程资源的一项技术</span><br><span class="line">  - namespace 是从内核 2.4.19 开始逐渐支持的，所以 docker 对系统版本有要求</span><br><span class="line"></span><br><span class="line">* namespace 的特点</span><br><span class="line">  - namespace 层位于内核与进程之间</span><br><span class="line">  - 同一个 namespace 之中，值不可以重复</span><br><span class="line">  - 不同的 namespace 之间相互独立</span><br><span class="line">  - 一个 namespace 中的项，对另一个 namespace 中的项是不可见的</span><br><span class="line"></span><br><span class="line">* namespace 的意义</span><br><span class="line">  - 在进程和内核之间，提供了一层资源隔离的功能</span><br><span class="line">  - 主要的用处，也就是用在容器中</span><br><span class="line">  - namespace 是容器最核心的技术</span><br><span class="line">  - 某种意义上 namespace 和容器的概念等价</span><br><span class="line"></span><br><span class="line">* docker 对 namespace 的使用</span><br><span class="line">  - 每当创建一个新的容器时，docker 会对五种 namespace 分别创建一个新的，容器的守护进程就被分配为这些新的项</span><br><span class="line">  - 当删除容器时，容器所对应的 namespace 也会被删除</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>五种 namespace</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">* PID</span><br><span class="line">  - 提供进程隔离</span><br><span class="line"></span><br><span class="line">* NET</span><br><span class="line">  - 管理网络接口</span><br><span class="line"></span><br><span class="line">* IPC</span><br><span class="line">  - 管理 IPC 资源的访问</span><br><span class="line"></span><br><span class="line">* MNT</span><br><span class="line">  - 管理文件系统挂载点</span><br><span class="line"></span><br><span class="line">* UTS</span><br><span class="line">  - 隔离内核和版本标识符，提供 hostname 和 NIC domain name 的隔离</span><br><span class="line"></span><br><span class="line">* User</span><br><span class="line">  - 提供用户名的隔离，从内核 3.8 开始支持</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>相关 linux 命令</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* man 7 namespaces</span><br><span class="line">  - 查看 namespace 的帮助</span><br><span class="line"></span><br><span class="line">* lsns</span><br><span class="line">  - 查看当前系统上有哪些 namespace</span><br><span class="line"></span><br><span class="line">* ls -l /proc/PID/ns</span><br><span class="line">  - 查看某个进程所有的 namespace</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：容器与-cgroup"><a href="#知识点：容器与-cgroup" class="headerlink" title="知识点：容器与 cgroup"></a>知识点：容器与 cgroup</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - control group</span><br><span class="line">  - 用来对进程进行资源限制</span><br><span class="line">  - 包括 CPU、MEM、磁盘 IO、网络带宽等</span><br><span class="line">  - 默认情况下，容器相当于可以使用宿主机的全部资源</span><br><span class="line"></span><br><span class="line">* 查看内核是否开启了 cgroup 功能</span><br><span class="line">  - cat /boot/config-3.10.0-1160.el7.x86_64 | grep CGROUP       &lt;== 查看内核是否开启了 cgroup 功能</span><br><span class="line">  - cat /boot/config-3.10.0-1160.el7.x86_64 | grep CONFIG_MEM   &lt;== 查看内核是否针对 MEM 开启了 cgroup 功能</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>cgroup 的具体实现</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 cgroup</span></span><br><span class="line">ll /sys/fs/cgroup</span><br><span class="line"></span><br><span class="line">blkio         # 块设备 IO 限制</span><br><span class="line">cpu           # 可以调控 task 对 cpu 的使用</span><br><span class="line">cpuacct       # 生成 task 对 cpu 资源使用情况的报告</span><br><span class="line">cpuset        # 针对多处理器的物理机，对 task 单独分配某个 cpu 和内存</span><br><span class="line">device        # 限制 task 对设备的访问，设备是指键盘、鼠标</span><br><span class="line">freezer       # 控制 task 的挂起和恢复，如不允许某个 task 使用 cpu 称之为挂起</span><br><span class="line">memory        # 控制 task 对内存使用量的限定，生成对内存资源使用的报告</span><br><span class="line">perf_event    # 对 task 可以进行统一的性能测试、检测、跟踪</span><br><span class="line">net_cls       # 在 docker 中没有直接被使用，标记网络数据包，从而允许 Linux 流量控制程序识别从具体 cgroup 中生成的数据包</span><br><span class="line">ns            # 命名空间</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>docker 对容器的资源限制功能</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">docker run OPTIONS</span><br><span class="line">docker update OPTIONS CONTAINER</span><br><span class="line"></span><br><span class="line">OPTIONS</span><br><span class="line">     --blkio-weight uint16        Block IO (relative weight), between 10 and 1000, or 0 to disable (default 0)</span><br><span class="line">     --cpu-period int             Limit CPU CFS (Completely Fair Scheduler) period</span><br><span class="line">     --cpu-quota int              Limit CPU CFS (Completely Fair Scheduler) quota</span><br><span class="line">     --cpu-rt-period int          Limit the CPU real-time period in microseconds</span><br><span class="line">     --cpu-rt-runtime int         Limit the CPU real-time runtime in microseconds</span><br><span class="line"> -c, --cpu-shares int             CPU shares (relative weight)</span><br><span class="line">     --cpus decimal               Number of CPUs</span><br><span class="line">     --cpuset-cpus string         CPUs in which to allow execution (0-3, 0,1)</span><br><span class="line">     --cpuset-mems string         MEMs in which to allow execution (0-3, 0,1)</span><br><span class="line">     --kernel-memory bytes        Kernel memory limit</span><br><span class="line"> -m, --memory bytes               Memory limit</span><br><span class="line">     --memory-reservation bytes   Memory soft limit</span><br><span class="line">     --memory-swap bytes          Swap limit equal to memory plus swap: &#x27;-1&#x27; to enable unlimited swap</span><br><span class="line">     --pids-limit int             Tune container pids limit (set -1 for unlimited)</span><br><span class="line">     --restart string             Restart policy to apply when a container exits</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="Chapter02-Docker-容器"><a href="#Chapter02-Docker-容器" class="headerlink" title="Chapter02 Docker 容器"></a>Chapter02 Docker 容器</h1><hr>
<h2 id="2-1-Docker-容器"><a href="#2-1-Docker-容器" class="headerlink" title="2.1 Docker 容器"></a>2.1 Docker 容器</h2><hr>
<h3 id="知识点：docker-容器操作范例"><a href="#知识点：docker-容器操作范例" class="headerlink" title="知识点：docker 容器操作范例"></a>知识点：docker 容器操作范例</h3><ol>
<li><strong>范例一，启动 tomcat 容器</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动 tomcat 容器</span></span><br><span class="line">docker run -it -d --name=tomcat01 -p 8080:8080 tomcat</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果使用 docker.hub 上最新版本的 tomcat 镜像，则会出现访问 404 的情况</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 原因，新版本 tmocat 对 webapps 目录中的内容做了修改，无法直接访问</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 处理方式一，修改容器的 webapps 目录</span></span><br><span class="line">docker exec -it -d tomcat01 /bin/bash</span><br><span class="line">rm -r /usr/local/tomcat/webapps</span><br><span class="line">cp -r /usr/local/tomcat/webapps.dist /usr/local/tomcat/webapps</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 处理方式二，使用旧版本 tomcat 镜像</span></span><br><span class="line">docker run -it -d --name=tomcat01 -p 8080:8080 billygoo/tomcat8_jdk8</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例二，启动 mysql 容器</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 准备数据目录</span></span><br><span class="line">mkdir -p /data/mysql01/data</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 准备日志目录</span></span><br><span class="line">mkdir -p /data/mysql01/log</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 准备配置文件</span></span><br><span class="line">vim /data/mysql01/my.cnf</span><br><span class="line">[client]</span><br><span class="line">default_character_set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">collation_server=utf8_general_ci</span><br><span class="line">character_set_server=utf8</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动容器</span></span><br><span class="line">docker run -d --name=mysql01 \</span><br><span class="line">  -p 3306:3306 \</span><br><span class="line">  -e MYSQL_ROOT_PASSWORD=12345678 \</span><br><span class="line">  --privileged=true \</span><br><span class="line">  -v /data/mysql01/my.cnf:/etc/my.cnf \</span><br><span class="line">  -v /data/mysql01/data:/var/lib/mysql \</span><br><span class="line">  -v /data/mysql01/log:/var/log/mysql \</span><br><span class="line">  mysql:5.7</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 登录到数据库中</span></span><br><span class="line">docker exec -it mysql01 mysql -uroot -p12345678</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例三，启动 redis 容器</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 准备 redis 配置文件</span></span><br><span class="line">mkdir -p /data/redis01/conf</span><br><span class="line">vim /data/redis01/conf/redis.conf</span><br><span class="line">database N</span><br><span class="line">requirepass 12345678</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">daemonize no      # 设置禁止后台启动，因为会和 docker -d 参数冲突，导致容器一直启动失败</span><br><span class="line">append only</span><br><span class="line">protected yes</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动 redis 容器</span></span><br><span class="line">docker run -d --name redis01 \</span><br><span class="line">  -p 6379:6379 \</span><br><span class="line">  --privileged=ture \</span><br><span class="line">  -v /data/redis01/conf:/etc/redis \</span><br><span class="line">  -v /data/redis01/data:/data \</span><br><span class="line">  redis:6.0.8 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入 redis 容器</span></span><br><span class="line">docker exec -it redis01 redis-cli -a 12345678</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-run-指令"><a href="#知识点：docker-run-指令" class="headerlink" title="知识点：docker run 指令"></a>知识点：docker run 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 创建一个新容器并运行</span><br><span class="line">  - 如果镜像在本机不存在，则 docker 会自动到官网上搜索下载相关的镜像</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker run OPTIONS IMAGE [CMD]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>选项</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">* --name Name</span><br><span class="line">  - 设置容器名</span><br><span class="line"></span><br><span class="line">* -i</span><br><span class="line">  - 以交互式运行容器</span><br><span class="line"></span><br><span class="line">* -t</span><br><span class="line">  - 为容器分配一个伪终端 tty</span><br><span class="line"></span><br><span class="line">* -d</span><br><span class="line">  - 容器后台运行</span><br><span class="line"></span><br><span class="line">* -e key=value</span><br><span class="line">  - 为容器传递环境变量</span><br><span class="line"></span><br><span class="line">* -P</span><br><span class="line">  - 随机端口映射</span><br><span class="line"></span><br><span class="line">* -p HostPort:ContainerPort</span><br><span class="line">* -p Ip:HostPort:ContainerPort</span><br><span class="line">* -p HostPort:ContainerPort:tcp</span><br><span class="line">  - 指定端口映射</span><br><span class="line"></span><br><span class="line">* -p ip::ContainerPort</span><br><span class="line">  - 随机分配宿主机端口</span><br><span class="line"></span><br><span class="line">* 其他 OPTIONS</span><br><span class="line">  --rm</span><br><span class="line">  --restart=always</span><br><span class="line">  --entrypoint command</span><br><span class="line">  -h hostname</span><br><span class="line">  --dns IP</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 运行一个 ubnutu 容器</span></span><br><span class="line">docker run -it -d --name u01 ubuntu</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-ps-指令"><a href="#知识点：docker-ps-指令" class="headerlink" title="知识点：docker ps 指令"></a>知识点：docker ps 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 接受</span><br><span class="line">  - 显示容器列表</span><br><span class="line">  -</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker ps OPTIONS</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>选项</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">* -a</span><br><span class="line">  - 列出所有容器</span><br><span class="line">  - 默认只列出 running 的容器</span><br><span class="line"></span><br><span class="line">* -q</span><br><span class="line">  - 只打印容器 ID</span><br><span class="line"></span><br><span class="line">* -f</span><br><span class="line">  - 过滤</span><br><span class="line">  - -f status=running</span><br><span class="line">  - -f status=exited -f name=n*</span><br><span class="line"></span><br><span class="line">* --size</span><br><span class="line">  - 显示容器占用的磁盘空间</span><br><span class="line"></span><br><span class="line">* 其他 OPTIONS</span><br><span class="line">  -s        &lt;== 打印容器的数据占用</span><br><span class="line">  -l        &lt;== 显示最近创建的容器</span><br><span class="line">  -n N      &lt;== 显示最近创建的 N 个容器</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-exec-指令"><a href="#知识点：docker-exec-指令" class="headerlink" title="知识点：docker exec 指令"></a>知识点：docker exec 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* 接受</span><br><span class="line">  - 切换到容器环境中执行一个指令</span><br><span class="line">  - 常用来进入容器环境</span><br><span class="line">  - 通过一个新启动的进程进入容器，exit 不会导致容器退出</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker exec OPTIONS CONTAINER CMD</span><br><span class="line"></span><br><span class="line">* CMD</span><br><span class="line">  - 指定进入容器环境所执行的指令</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>选项</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* -i, --interactive</span><br><span class="line">  - 交互模式</span><br><span class="line"></span><br><span class="line">* -t, --tty</span><br><span class="line">  - 分配一个伪终端</span><br><span class="line"></span><br><span class="line">* -e, --env LIST</span><br><span class="line">  - 同时设置环境变量</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入到 u01 容器中</span></span><br><span class="line">docker exec -it u01 /bin/bash</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-rm-指令"><a href="#知识点：docker-rm-指令" class="headerlink" title="知识点：docker rm 指令"></a>知识点：docker rm 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 接受</span><br><span class="line">  - 删除容器</span><br><span class="line">  - 默认只能删除 stopped 容器，不能删除 running 容器</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker rm OPTION COMTAINER</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>选项</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* -f, --force</span><br><span class="line">  - 强制删除容器，连同 running 容器一起删除</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-cp-指令"><a href="#知识点：docker-cp-指令" class="headerlink" title="知识点：docker cp 指令"></a>知识点：docker cp 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 在容器和宿主机之间复制文件/目录</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker cp SRC DEST</span><br><span class="line"></span><br><span class="line">* SRC/DEST</span><br><span class="line">  - 容器中的地址的格式为 CONTAINER:PATH</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将宿主机上的 /etc/hosts 复制到 u01 容器的 /home 下</span></span><br><span class="line">docker cp /etc/hosts u01:/home</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-start-x2F-stop-x2F-restart-x2F-kill-指令"><a href="#知识点：docker-start-x2F-stop-x2F-restart-x2F-kill-指令" class="headerlink" title="知识点：docker start&#x2F;stop&#x2F;restart&#x2F;kill 指令"></a>知识点：docker start&#x2F;stop&#x2F;restart&#x2F;kill 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 对容器进行相应的操作</span><br><span class="line">  - 由于生产环境主要使用 K8s，这些命令用的不多</span><br><span class="line"></span><br><span class="line">* docker start CONTAINER</span><br><span class="line">  - 启动容器</span><br><span class="line"></span><br><span class="line">* docker stop CONTAINER</span><br><span class="line">  - 停止容器</span><br><span class="line"></span><br><span class="line">* docker restart CONTAINER</span><br><span class="line">  - 重启容器</span><br><span class="line"></span><br><span class="line">* docker kill CONTAINER</span><br><span class="line">  - 强制停止容器</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-logs-指令"><a href="#知识点：docker-logs-指令" class="headerlink" title="知识点：docker logs 指令"></a>知识点：docker logs 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 查看容器日志</span><br><span class="line">  - 容器的 log，包括 docker 的程序输出，和容器内进程打印到 STDOUT 上的内容</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker logs CONTAINER</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-top-指令"><a href="#知识点：docker-top-指令" class="headerlink" title="知识点：docker top 指令"></a>知识点：docker top 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 查看 running 的容器中的进程的信息</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker top CONTAINER</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-attach-指令"><a href="#知识点：docker-attach-指令" class="headerlink" title="知识点：docker attach 指令"></a>知识点：docker attach 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 连接到容器中</span><br><span class="line">  - 不会启动新的进程，而是直接切换到容器的进程上，因此 exit 会导致容器停止</span><br><span class="line">  - Ctrl+p+q 对出容器，容器不会停止运行</span><br><span class="line">  - 在容器中的所有操作，在容器的所有终端上同步显示</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker attach CONTAINER</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-export-指令"><a href="#知识点：docker-export-指令" class="headerlink" title="知识点：docker export 指令"></a>知识点：docker export 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 将容器导出为一个 tar 文件，可以之后用来导入镜像</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker export -o FILE CONTAINER</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-其他容器相关指令"><a href="#知识点：docker-其他容器相关指令" class="headerlink" title="知识点：docker 其他容器相关指令"></a>知识点：docker 其他容器相关指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">* docker create</span><br><span class="line">  - 创建一个容器，但状态为 stopped</span><br><span class="line"></span><br><span class="line">* docker pause</span><br><span class="line">  - 暂停容器</span><br><span class="line"></span><br><span class="line">* docker unpause</span><br><span class="line">  - 重启容器</span><br><span class="line"></span><br><span class="line">* docker wait</span><br><span class="line">  - 显示容器的退出状态码</span><br><span class="line"></span><br><span class="line">* docker port</span><br><span class="line">  - 查看或设置容器的端口映射，但不能 remap</span><br><span class="line"></span><br><span class="line">* docker diff</span><br><span class="line">  - 查看容器修改过的内容</span><br><span class="line"></span><br><span class="line">* docker rename</span><br><span class="line">  - 容器重命名</span><br><span class="line"></span><br><span class="line">* docker stats</span><br><span class="line">  - 查看所有容器的资源使用情况</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="2-2-Docker-网络"><a href="#2-2-Docker-网络" class="headerlink" title="2.2 Docker 网络"></a>2.2 Docker 网络</h2><hr>
<h3 id="知识点：docker-网络"><a href="#知识点：docker-网络" class="headerlink" title="知识点：docker 网络"></a>知识点：docker 网络</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">* 直接使用并不多，但是必须要懂</span><br><span class="line"></span><br><span class="line">* 本质上是通过 iptables 设置各种规则来实现</span><br><span class="line">  - 需要 kernel 支持 net.ipv4.ip_forward 功能</span><br><span class="line"></span><br><span class="line">* docker 自带的网络仅支持单机上的容器网络，多主机运行时需要使用其他的第三方开源网络</span><br><span class="line"></span><br><span class="line">* 在 K8S 阶段有更好的解决方案</span><br><span class="line">  - k8s 早期使用 iptables，但 iptables 性能较差，后期改用 ipvs</span><br><span class="line">  - 生产环境，iptables 可能有上万条规则，每一个报文，都要经过这上万条规则的匹配后，才能发送</span><br><span class="line"></span><br><span class="line">* docker 支持三种网络驱动模式</span><br><span class="line">  - bridge 虚拟网桥模式</span><br><span class="line">  - host 主机模式</span><br><span class="line">  - none</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>bridge 虚拟网桥模式</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - docker 会通过 iptables 创建一个虚拟网桥，相当于交换机</span><br><span class="line">  - 一个虚拟网桥即为一个 24 网段，网桥的 IP 为此网络的默认网关</span><br><span class="line">  - 网桥会对容器进行 NAT IP 转换，每个容器具有一个 IP</span><br><span class="line">  - 网桥在内核层连通了宿主机的网卡，使容器可以通过网桥来与其他设备通信</span><br><span class="line">  - 每个容器内部都有一个网卡，都叫 eth0</span><br><span class="line">  - 网桥的接口称为 veth，与容器中的 eth 相对应和连接，这样一对接口称为 veth pair</span><br><span class="line">  - 宿主机 ifconfig 可以看到 veth</span><br><span class="line">  - 宿主机 ip addr show 可以看到 veth 和在虚拟网桥上的接口位置，格式 vethxxxx@ifxx</span><br><span class="line"></span><br><span class="line">* hostname</span><br><span class="line">  - 容器具有独立的 hosts 文件，与宿主机的 hosts 文件不同</span><br><span class="line">  - 默认采用容器 ID 的前 12 位作为容器的 hostname</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>host 主机模式</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 容器直接使用宿主机 IP，不再使用 NAT 转换</span><br><span class="line">  - 容器将不会虚拟出自己的网卡</span><br><span class="line">  - 容器可以使用宿主机的 hosts 文件</span><br><span class="line">  - 容器将不会获得一个独立的 network namesapce，而是和宿主机共用一个 network namespace</span><br><span class="line"></span><br><span class="line">* host 模式下，设置端口映射将无意义，容器将自动使用宿主机端口，若重复则自动递增</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>none 模式</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 容器初始不具有网络功能，只有 lo</span><br><span class="line">  - 在 none 模式下，容器没有网卡、路由、IP 等信息，只有一个 lo</span><br><span class="line">  - 需要后期手动为容器添加网卡、配置 IP 等</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-指令网络相关选项"><a href="#知识点：docker-指令网络相关选项" class="headerlink" title="知识点：docker 指令网络相关选项"></a>知识点：docker 指令网络相关选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">* --network bridge</span><br><span class="line">  - 指定容器使用默认的 docker0 虚拟网桥</span><br><span class="line">  - docker 默认的网络方式</span><br><span class="line"></span><br><span class="line">* --netwrok host</span><br><span class="line">  - 指定容器采用主机模式网络，直接使用宿主机的 IP、端口</span><br><span class="line"></span><br><span class="line">* --network none</span><br><span class="line">  - 指定容器采用 none 模式网络</span><br><span class="line">  - 容器有独立的 netwok namespace，但没有做任何配置，需要手动配置</span><br><span class="line">  - 基本用不到</span><br><span class="line">  - 不懂</span><br><span class="line"></span><br><span class="line">* --network container:NAME</span><br><span class="line">  - 指定容器直接使用一个已存在的容器的网卡，使用其 IP、端口</span><br><span class="line">  - 不会创建网卡</span><br><span class="line">  - 如果源容器停止，则网络失效</span><br><span class="line"></span><br><span class="line">* --network NETWORK</span><br><span class="line">  * 使用用户创建的网络</span><br><span class="line">  * 自定义网络会对其内的所有容器自动维护 ContainerName 和 IP 的对应关系，使同一网络内的容器，可以直接通过 ContainerName 而不是 IP 来相互访问，而默认网络 docker0 则不行</span><br><span class="line">  * 优点：可以不再通过写死 IP 来访问容器，容器的 ip 是很容易变化的，写死 IP 的方式很容易出问题</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-network-指令"><a href="#知识点：docker-network-指令" class="headerlink" title="知识点：docker network 指令"></a>知识点：docker network 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - docker 网络相关的一系列指令</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker network ls                 &lt;== 查看所有的 docker 网络</span><br><span class="line">  docker network create NETWORK     &lt;== 创建一个网络</span><br><span class="line">  docker network rm NETWORK         &lt;== 删除一个网络</span><br><span class="line">  docker [network] inspect NETWORK  &lt;== 查看一个网络的详细信息</span><br><span class="line">  docker [network] inspect -f &#x27;&#123;&#123;.Driver&#125;&#125;&#x27; NETWORK   &lt;== 查看一个网络的驱动模式</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="2-3-Docker-数据卷"><a href="#2-3-Docker-数据卷" class="headerlink" title="2.3 Docker 数据卷"></a>2.3 Docker 数据卷</h2><hr>
<h3 id="知识点：容器数据卷-VOLUME"><a href="#知识点：容器数据卷-VOLUME" class="headerlink" title="知识点：容器数据卷 VOLUME"></a>知识点：容器数据卷 VOLUME</h3><ol>
<li><strong>容器数据卷介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 目的</span><br><span class="line">  - 容器数据的持久化</span><br><span class="line">  - 删除容器不会删除其挂载的数据卷</span><br><span class="line">  - 重建容器并以相同的形式重新挂载数据卷，则其中的内容会自动恢复，如 mysql 中的库、表等</span><br><span class="line"></span><br><span class="line">* 特点</span><br><span class="line">  - 数据卷不属于联合文件系统，将容器提交为镜像时，数据卷不会被包含在镜像中</span><br><span class="line">  - 数据卷可以在多个容器之间共享</span><br><span class="line">  - 数据卷中的更改对容器和宿主机实时生效</span><br><span class="line">  - 数据卷的生命周期持续到没有容器使用它为止</span><br><span class="line">  - 数据卷会自动建立相关的目录，包括宿主机和容器上</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>相关选项</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">* -v</span><br><span class="line">  -v HostDir:ContainDir       &lt;== 指定数据卷映射</span><br><span class="line">  -v HostDir:ContainDir:ro    &lt;== 指定数据卷映射，并且指定容器对宿主机目录只读，默认策略为 rw</span><br><span class="line"></span><br><span class="line">* --privileged=ture</span><br><span class="line">  - 扩大容器的权限，解决目录没有权限的问题</span><br><span class="line">  - 不使用此参数，容器内的 root 用户只是宿主机的一个普通用户</span><br><span class="line">  - 使用此参数后，容器内的 root 用户在宿主机上才具有真正的 root 权限</span><br><span class="line"></span><br><span class="line">* --volume-from CONTAINER</span><br><span class="line">  - 指定容器的数据卷从另一个容器处继承</span><br><span class="line">  - 可以实现多个容器以及宿主机之间的数据互通，因为多个容器可以挂在同一个宿主机的目录上</span><br><span class="line">  - 本质上只是一个省略写法，主容器若被删除，不影响从容器的数据卷情况</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>相关命令</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 查看容器的数据卷情况</span><br><span class="line">  docker inspect -f &#x27;&#123;&#123;.Mounts&#125;&#125;&#x27; CONTAINER</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="Chapter03-Docker-镜像"><a href="#Chapter03-Docker-镜像" class="headerlink" title="Chapter03 Docker 镜像"></a>Chapter03 Docker 镜像</h1><hr>
<h2 id="3-1-Docker-镜像"><a href="#3-1-Docker-镜像" class="headerlink" title="3.1 Docker 镜像"></a>3.1 Docker 镜像</h2><hr>
<h3 id="知识点：镜像介绍"><a href="#知识点：镜像介绍" class="headerlink" title="知识点：镜像介绍"></a>知识点：镜像介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* 镜像 Image</span><br><span class="line">  - 启动容器的模板</span><br><span class="line">  - 提供启动容器的文件系统</span><br><span class="line">    - 已经打包好的容器</span><br><span class="line">    - 含有程序运行所需的各种配置和依赖</span><br><span class="line"></span><br><span class="line">* 镜像文件仅包含 rootfs，即系统正常运行所必须的用户空间的文件系统，不包含 bootfs</span><br><span class="line">  - 正常 linux 的文件系统包含两部分，bootfs 和 rootfs</span><br><span class="line">  - bootfs 包含 BootLoader 和 kernel</span><br><span class="line">  - rootfs 包含 linux 典型文件系统中的各种标准目录和文件</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>镜像分层</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">* 镜像分层介绍</span><br><span class="line">  - 容器是可写层</span><br><span class="line">  - 镜像是只读层</span><br><span class="line">  - 构建镜像时，每一次操作都提交作为一层，每一层都有自己的 SHA ID</span><br><span class="line">  - 镜像的最底层是引导文件系统 bootfs</span><br><span class="line">  - bootfs 之上是 rootfs</span><br><span class="line"></span><br><span class="line">* 写时复制 copy on write</span><br><span class="line">  - 对只读层的文件修改时，将文件复制一份到可写层，在可写层中进行修改</span><br><span class="line">  - 复制的位置，/var/lib/docker/XXXX/merge</span><br><span class="line"></span><br><span class="line">* 分层的优点</span><br><span class="line">  - 共享资源，便于复用</span><br><span class="line">    - 多个镜像之间的底部层可以共享</span><br><span class="line">    - Dockerfile 构建镜像时，只对发生变化的行及之后的内容进行重新构建</span><br><span class="line">  - 提高镜像的利用率、缩短最终业务镜像的构建时间</span><br><span class="line">    - 基础镜像，安装常用软件，如 vim、gcc</span><br><span class="line">    - 基础环境镜像，安装业务软件，如 jdk、nginx、tomcat</span><br><span class="line">    - 业务镜像，存放具体业务代码程序</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>镜像命名</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  DomainName:port/Registry/repository:tag</span><br><span class="line"></span><br><span class="line">* DomainName:port</span><br><span class="line">  - 域名，用来标识仓库服务器</span><br><span class="line">  - 可以是 IP 地址</span><br><span class="line">  - 省略 DomainName:port，则表示 docker.hub</span><br><span class="line">  - 省略 port，则默认 80</span><br><span class="line"></span><br><span class="line">* Registry</span><br><span class="line">  - 仓库名，通常以项目名称来命名</span><br><span class="line">  - 阿里云镜像仓库中取名为 namespace</span><br><span class="line"></span><br><span class="line">* repository</span><br><span class="line">  - 镜像名</span><br><span class="line"></span><br><span class="line">* tag</span><br><span class="line">  - 镜像的版本</span><br><span class="line">  - 省略则表示 latest</span><br><span class="line">  - 官方镜像通常采用软件版本号为 tag，如 mysql:5.7、nginx:1.16.1</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>虚悬镜像</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">* 虚悬镜像  dangling image</span><br><span class="line">  - 仓库名、标签名都是 none 的镜像</span><br><span class="line">  - 没有什么用，建议删除</span><br><span class="line">  - 通常由于构建异常而产生</span><br><span class="line">    - docker build 时未指定 -t，就会产生虚悬镜像</span><br><span class="line">    - docker build 过程中出错导致退出，也过程镜像会成为虚悬镜像，并且此时相应的容器也并没有被删除</span><br><span class="line">    - 创建镜像时，如果 tag 与旧的某个镜像重复，则旧的镜像就成为虚悬镜像</span><br><span class="line"></span><br><span class="line">* 查看当前主机是否有虚悬镜像</span><br><span class="line">  docker image -f dangling=true</span><br><span class="line"></span><br><span class="line">* 删除虚悬镜像</span><br><span class="line">  docker image prune</span><br><span class="line">  -f    &lt;== 直接删除，不用进行确认</span><br><span class="line">  -a    &lt;== 删除虚悬镜像和 unused 镜像，危险</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：联合文件系统"><a href="#知识点：联合文件系统" class="headerlink" title="知识点：联合文件系统"></a>知识点：联合文件系统</h3><ol>
<li><strong>联合文件系统 union file system</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 2004 年由纽约州立大学石溪分校开发</span><br><span class="line"></span><br><span class="line">* 联合文件系统是镜像分层的技术基础</span><br><span class="line"></span><br><span class="line">* 功能</span><br><span class="line">  - 将多个目录挂载到一起，形成一个虚拟文件系统</span><br><span class="line">  - 联合文件系统将所有的子层叠加起来，最终对外展示为一个整体</span><br><span class="line">  - 高层的内容会影响低层内容的可见性</span><br><span class="line">  - 可以对每一层文件系统设置权限，readonly、readwrite、writeable</span><br></pre></td></tr></table></figure></li>
<li><strong>存储引擎 Storage Driver</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* overlay2</span><br><span class="line">  - docker 目前默认的存储引擎是 overlay2</span><br><span class="line">  - 联合文件系统的一种，是目前所有 linux 都推荐的存储引擎</span><br><span class="line">  - overlay2 是 overlay 的升级版，overlay 是 aufs 的升级版</span><br><span class="line">  - ubuntu 14.04 如果不能使用 overlay2 则可以采用 aufs</span><br><span class="line"></span><br><span class="line">* devicemapper</span><br><span class="line">  - 早期采用的存储引擎，目前已废弃</span><br><span class="line">  - xfs 如果 ftype=0，则不支持 d_type 功能，也就不支持 overlay2</span><br><span class="line">  - centos 7.2 默认为 ftype=0，则安装 docker 后存储引擎为 devicemapper</span><br><span class="line">  - 采用 loop 文件方式存储数据，默认最大为 100G，超出则 docker 挂死</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-images-指令"><a href="#知识点：docker-images-指令" class="headerlink" title="知识点：docker images 指令"></a>知识点：docker images 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 列出本地主机上的镜像</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker images OPTIONS</span><br><span class="line"></span><br><span class="line">* OPTIONS</span><br><span class="line">  -a      &lt;== 列出本地所有镜像，含历史层</span><br><span class="line">  -q      &lt;== 只打印镜像 ID</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-search-指令"><a href="#知识点：docker-search-指令" class="headerlink" title="知识点：docker search 指令"></a>知识点：docker search 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 从 docker.hub 上搜索镜像</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker search OPTION IMAGE</span><br><span class="line"></span><br><span class="line">* OPTION</span><br><span class="line">  --limit N     &lt;== 只列出前 N 个结果，默认 25</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-pull-指令"><a href="#知识点：docker-pull-指令" class="headerlink" title="知识点：docker pull 指令"></a>知识点：docker pull 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 从 docker.hub 上拉取镜像到本地</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker pull IMAGE:TAG</span><br><span class="line"></span><br><span class="line">* IMAGE</span><br><span class="line">  - 可以是镜像名</span><br><span class="line">  - 可以是镜像的 SHA-ID</span><br><span class="line"></span><br><span class="line">* TAG</span><br><span class="line">  - 省略 TAG 则表示 latest</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-tag-指令"><a href="#知识点：docker-tag-指令" class="headerlink" title="知识点：docker tag 指令"></a>知识点：docker tag 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 为镜像创建一个新的标签</span><br><span class="line">  - 一个镜像可以同时具有多个标签</span><br><span class="line">    - 删除镜像本质上是删除标签</span><br><span class="line">    - 镜像有多个标签时，只删除镜像只会删除相对应的标签，不会删除镜像</span><br><span class="line">    - 镜像只剩一个标签时，删除镜像会实际删除镜像的文件</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker tag SOURCT_IMAGE TARGET_IMAGE</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-rmi-指令"><a href="#知识点：docker-rmi-指令" class="headerlink" title="知识点：docker rmi 指令"></a>知识点：docker rmi 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 删除镜像</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">docker rmi OPTION IMAGE</span><br><span class="line"></span><br><span class="line">* OPTION</span><br><span class="line">  -f      &lt;== 强制删除镜像</span><br><span class="line">  -v      &lt;== 同时删除容器的数据卷</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-save-指令"><a href="#知识点：docker-save-指令" class="headerlink" title="知识点：docker save 指令"></a>知识点：docker save 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 将镜像保存为一个外部文件</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker save IMAGE -o FILE</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-import-x2F-load-指令"><a href="#知识点：docker-import-x2F-load-指令" class="headerlink" title="知识点：docker import&#x2F;load 指令"></a>知识点：docker import&#x2F;load 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 将外部文件导入为一个镜像</span><br><span class="line">  - 外部文件来源可以是 save 指令，或者 export 指令</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker import/load FILE REPOSITYRO:TAG</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-commit-指令"><a href="#知识点：docker-commit-指令" class="headerlink" title="知识点：docker commit 指令"></a>知识点：docker commit 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 将容器提交为一个镜像</span><br><span class="line">  - 默认在提交过程中会 pause 容器</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker commit OPTIONS COMTAINER REPOSITORY:TAG</span><br><span class="line"></span><br><span class="line">* OPTIONS</span><br><span class="line">  -a, --author string       &lt;== 添加作者信息，如 -a &quot;John Hannibal Smith &lt;hannibal@a-team.com&gt;&quot;</span><br><span class="line">  -m, --message string      &lt;== 添加备注信息</span><br><span class="line">  -c &quot;CMD&quot;                  &lt;== 为镜像追加 Dockerfile 的指令，如为镜像添加默认指令</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-其他镜像相关指令"><a href="#知识点：docker-其他镜像相关指令" class="headerlink" title="知识点：docker 其他镜像相关指令"></a>知识点：docker 其他镜像相关指令</h3><ol>
<li><strong>其他命令</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker history    # 查看镜像的构建历史</span><br><span class="line">docker load</span><br><span class="line">docker image CMD  # docker 镜像的综合指令</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="3-2-DockerFile"><a href="#3-2-DockerFile" class="headerlink" title="3.2 DockerFile"></a>3.2 DockerFile</h2><hr>
<h3 id="知识点：Dockerfile-介绍"><a href="#知识点：Dockerfile-介绍" class="headerlink" title="知识点：Dockerfile 介绍"></a>知识点：Dockerfile 介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">* Dockerfile</span><br><span class="line">  - 用来构建镜像的文本文件脚本</span><br><span class="line">  - 文件的 filename 也必须是 &#x27;Dockerfile&#x27;</span><br><span class="line">  - 通过 dir 来区分项目</span><br><span class="line"></span><br><span class="line">* Dockerfile 中的每一条指令都会创建一个新的镜像层并提交</span><br><span class="line"></span><br><span class="line">* 官方镜像的 Dockerfile</span><br><span class="line">  - https://github.com/docker-library</span><br><span class="line"></span><br><span class="line">* 执行流程</span><br><span class="line">  - 根据基础镜像运行一个容器</span><br><span class="line">  - 根据指令，对容器进行修改</span><br><span class="line">  - 将修改后的内容提交为一个新的镜像</span><br><span class="line">  - 根据新的镜像再次创建一个容器</span><br><span class="line">  - 读取下一条指令</span><br><span class="line"></span><br><span class="line">* Dockerfile 内容的编排</span><br><span class="line">  - 不容易变动的部分放在 Dockerfile 的前部，如基础镜像、基础依赖软件、基础环境设置等</span><br><span class="line">  - 经常变动的部分放在 Dockerfile 的后部，如程序功能代码、相关变量等</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-build-指令"><a href="#知识点：docker-build-指令" class="headerlink" title="知识点：docker build 指令"></a>知识点：docker build 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 通过 Dockerfile 创建镜像</span><br><span class="line"></span><br><span class="line">* 使用方式</span><br><span class="line">  - 通常并不在命令行上执行 docker build，而是将命令放在 Dockerfile 同级的 sh 脚本中</span><br><span class="line">  - 目的是保存构建镜像时使用的命令，尤其是镜像的 tag，镜像太多时，人脑无法记住众多的镜像名</span><br><span class="line">  - sh 脚本习惯命名为 build-command.sh</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker build OPTIONS DIR</span><br><span class="line"></span><br><span class="line">* DIR</span><br><span class="line">  - 构建镜像的基础目录</span><br><span class="line">  - DIR 中应当有一个名为 Dockerfile 的文件</span><br><span class="line">  - DIR 中推荐存放需要 copy 到镜像中的数据，如代码程序、软件安装包等</span><br><span class="line">  - Dockerfile 中 ADD 和 COPY 指令指定宿主机的文件时，如果采用相对路径，则相对路径从 DIR 开始</span><br><span class="line"></span><br><span class="line">* OPTIONS</span><br><span class="line">  -t IMAGE:TAG</span><br><span class="line">    - 必须</span><br><span class="line">    - 为镜像指定标签</span><br><span class="line">    - 可以同时指定多个 -t 选项，为镜像添加多个标签</span><br><span class="line">    - 省略 TAG，则表示 TAG 为 latest</span><br><span class="line">  --no-cache</span><br><span class="line">    - 构建镜像时不使用缓存</span><br><span class="line">    - 镜像的每一层都是完全重新构建，而不是利用已有的分层数据</span><br><span class="line"></span><br><span class="line">* 其他 OPTIONS</span><br><span class="line">  -f</span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ~/projects/project01 目录下放有 Dockerfile 文件</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 绝对路径方式</span></span><br><span class="line">docker build -t IMAGE:TAG ~/projects/project01</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 相对路径方式</span></span><br><span class="line">cd ~/projects/project01</span><br><span class="line">docker build -t IMAGE:TAG</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：Dockerfile-基础语法"><a href="#知识点：Dockerfile-基础语法" class="headerlink" title="知识点：Dockerfile 基础语法"></a>知识点：Dockerfile 基础语法</h3><ol>
<li><strong>基础</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 关键字推荐大写</span><br><span class="line"></span><br><span class="line">* &#x27;#&#x27; 表示注释</span><br><span class="line"></span><br><span class="line">* &#x27;\&#x27; 可以续行</span><br></pre></td></tr></table></figure></li>
<li><strong>命令格式</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">* Dockerfile 指令通常都有两种格式</span><br><span class="line">  - shell 格式</span><br><span class="line">  - exec 格式，推荐使用</span><br><span class="line"></span><br><span class="line">* shell 格式</span><br><span class="line">  CMD Command Args</span><br><span class="line"></span><br><span class="line">* exec 单行格式</span><br><span class="line">  CMD [&quot;Command&quot;, &quot;Arg1&quot;, ...]</span><br><span class="line"></span><br><span class="line">* exec 多行格式</span><br><span class="line">  CMD</span><br><span class="line">    - &quot;Command&quot;</span><br><span class="line">    - &quot;Arg1&quot;</span><br><span class="line">    - &quot;Arg2&quot; ...</span><br><span class="line"></span><br><span class="line">* exec 格式说明</span><br><span class="line">  - 必须使用双引号，不能使用单引号</span><br><span class="line">  - 列表中第一个元素必须代表要运行的程序</span><br><span class="line">  - 复杂命令可以通过 &quot;/bin/sh&quot; &quot;-c&quot;、&quot;/bin/bash&quot; &quot;-c&quot; 方式</span><br><span class="line">  - 列表中其他的元素代表命令的参数</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：FROM-关键字"><a href="#知识点：FROM-关键字" class="headerlink" title="知识点：FROM 关键字"></a>知识点：FROM 关键字</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 用于指定基础镜像</span><br><span class="line">  - Dockerfile 的第一条指令必须是 FROM</span><br><span class="line"></span><br><span class="line">* 范例</span><br><span class="line">  FROM ubuntu:latest</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：MAINTAINER-关键字"><a href="#知识点：MAINTAINER-关键字" class="headerlink" title="知识点：MAINTAINER 关键字"></a>知识点：MAINTAINER 关键字</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 指定镜像的作者</span><br><span class="line">  - 指令已不推荐，改用 LABEL</span><br><span class="line"></span><br><span class="line">* 范例</span><br><span class="line">  MAINTAINER jay&lt;XXX@126.com&gt;</span><br><span class="line">  MAINTAINER &quot;jay XXX@126.com&quot;</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：LABEL-关键字"><a href="#知识点：LABEL-关键字" class="headerlink" title="知识点：LABEL 关键字"></a>知识点：LABEL 关键字</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 为镜像添加各种元数据信息，如维护者、版本等</span><br><span class="line">  - LABEL 指令添加的信息可以被 inspect 命令查看到</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  LABEL key=value key=value</span><br><span class="line"></span><br><span class="line">* 范例</span><br><span class="line">  LABEL version=&quot;1.0&quot;</span><br><span class="line">  LABEL maintainer=&quot;xxx XXX@126.com&quot;</span><br><span class="line">  LABEL description=&quot;This text xxxx.&quot;</span><br><span class="line">  LABEL org.opencontainers.image.authors=&quot;SvenDowideit@home.org.au&quot;</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：RUN-关键字"><a href="#知识点：RUN-关键字" class="headerlink" title="知识点：RUN 关键字"></a>知识点：RUN 关键字</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 运行相应的指令，可以是 shell 指令</span><br><span class="line">  - 所有的命令都应保证是非交互的</span><br><span class="line"></span><br><span class="line">* shell 格式</span><br><span class="line">  RUN COMMAND ARGS [...]</span><br><span class="line"></span><br><span class="line">* exec 格式</span><br><span class="line">  RUN [&quot;COMMAND&quot;, &quot;ARG1&quot;, ...]</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：ADD、COPY-关键字"><a href="#知识点：ADD、COPY-关键字" class="headerlink" title="知识点：ADD、COPY 关键字"></a>知识点：ADD、COPY 关键字</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 将宿主机上的文件复制到镜像中</span><br><span class="line">  - ADD，可以自动处理 url，可以自动解压 tar 包</span><br><span class="line">  - COPY，无法处理 url，无法解压 tar 包</span><br><span class="line"></span><br><span class="line">* 注意</span><br><span class="line">  - ADD 无法自动解压 zip 文件</span><br><span class="line">  - ADD 解压 tar 包要注意 tar 包文件的覆盖问题，尤其是 tar 包内文件是以 &#x27;/&#x27; 开头的情况</span><br></pre></td></tr></table></figure></li>
<li><strong>格式</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">* shell 格式</span><br><span class="line">  COPY [--chown=USER:GROUP] SRC ... DEST</span><br><span class="line">  ADD [--chown=USER:GROUP] SRC ... DEST</span><br><span class="line"></span><br><span class="line">* exec 格式</span><br><span class="line">  ADD [--chown=USER:GROUP] [&quot;SRC&quot;,... &quot;DEST&quot;]</span><br><span class="line">  COPY [--chown=USER:GROUP] [&quot;SRC&quot;,... &quot;DEST&quot;]</span><br><span class="line"></span><br><span class="line">* SRC</span><br><span class="line">  - 可以包含多个</span><br><span class="line">  - 可以包含支持 go filepath 的 wildcard</span><br><span class="line"></span><br><span class="line">* DEST</span><br><span class="line">  - 只能包含一个</span><br><span class="line">  - 目录可以自动创建</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：EXPOSE-关键字"><a href="#知识点：EXPOSE-关键字" class="headerlink" title="知识点：EXPOSE 关键字"></a>知识点：EXPOSE 关键字</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 指定对外暴露的端口</span><br><span class="line">  - 本质上只是声明</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  EXPOSE port [...]</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：WORKDIR-关键字"><a href="#知识点：WORKDIR-关键字" class="headerlink" title="知识点：WORKDIR 关键字"></a>知识点：WORKDIR 关键字</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 指定进入容器后的落脚工作目录</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  WORKDIR dir</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：USER-关键字"><a href="#知识点：USER-关键字" class="headerlink" title="知识点：USER 关键字"></a>知识点：USER 关键字</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 指定镜像的启动用户，如不指定则为 root</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  USER user</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：ENV-关键字"><a href="#知识点：ENV-关键字" class="headerlink" title="知识点：ENV 关键字"></a>知识点：ENV 关键字</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 在构建镜像时设置环境变量</span><br><span class="line">  - 在 Dockerfile 中上文设置的环境变量，可以在下文中的命令调用，使用 $</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  ENV Variable Value</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：CMD-关键字"><a href="#知识点：CMD-关键字" class="headerlink" title="知识点：CMD 关键字"></a>知识点：CMD 关键字</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 指定容器启动后执行的指令</span><br><span class="line">  - 如果有多个 CMD 设置，则只有最后一个 CMD 设置有效，其他的 CMD 设置会被覆盖</span><br><span class="line"></span><br><span class="line">* 若以 docker run 命令启动容器并指定了执行命令，则 CMD 会被覆盖</span><br><span class="line"></span><br><span class="line">* 若 Dockerfile 中设置了 ENTRYPOINT，则 CMD 中的设置会被传递给 ENTRYPOINT 作为参数，此时 CMD 必须是 exec 格式</span><br></pre></td></tr></table></figure></li>
<li><strong>格式</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* shell 格式</span><br><span class="line">  CMD Command Args</span><br><span class="line"></span><br><span class="line">* 说明</span><br><span class="line">  - 实际是以 /bin/sh -c 方式执行 Command</span><br></pre></td></tr></table></figure>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* exec 格式</span><br><span class="line">  CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;]</span><br><span class="line"></span><br><span class="line">* 说明</span><br><span class="line">  - executable 必须是一个可执行程序，若是 bush-buildin 则无用</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：ENTRYPOINT-关键字"><a href="#知识点：ENTRYPOINT-关键字" class="headerlink" title="知识点：ENTRYPOINT 关键字"></a>知识点：ENTRYPOINT 关键字</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 指定容器启动后执行的指令</span><br><span class="line">  - 如果有多个 ENTRYPOINT 设置，则只有最后一个 ENTRYPOINT 设置会生效</span><br><span class="line"></span><br><span class="line">* 优先级比 CMD 关键字、docker run command 都高</span><br><span class="line">  - shell 格式的 ENTRYPOINT 会覆盖 CMD 和 docker run command 的内容</span><br><span class="line">  - exec 格式 ENTRYPOINT 且 CMD 为 exec 格式，则 CMD 中的内容被视为参数传递给 ENTRYPOINT 指定的程序</span><br><span class="line">  - exec 格式 ENTRYPOINT 且 docker run command 存在，则 CMD 的内容无效，docker run command 的内容传递给 ENTRYPOINT 当做参数</span><br><span class="line">  - 因此，常用 CMD 来向 ENTRYPOINT 传递默认参数</span><br><span class="line"></span><br><span class="line">* 一种用法</span><br><span class="line">  - ENTRYPOINT 中写定参，CMD 中写变参</span><br></pre></td></tr></table></figure></li>
<li><strong>格式</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* shell 格式</span><br><span class="line">  ENTRYPOINT command param1 param2</span><br><span class="line"></span><br><span class="line">* exec 格式</span><br><span class="line">  ENTRYPOINT [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：Dockerfile-其他关键字"><a href="#知识点：Dockerfile-其他关键字" class="headerlink" title="知识点：Dockerfile 其他关键字"></a>知识点：Dockerfile 其他关键字</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* ONBUILD</span><br><span class="line"></span><br><span class="line">* STOPSIGNAL</span><br><span class="line">  - 指定容器退出时的信号值</span><br><span class="line">  - 信号可以被 K8s 使用</span><br><span class="line"></span><br><span class="line">* VOLUME</span><br><span class="line">  - 为镜像添加挂载点</span><br><span class="line">  - 仅相当于 mkdir</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：Dockerfile-范例"><a href="#知识点：Dockerfile-范例" class="headerlink" title="知识点：Dockerfile 范例"></a>知识点：Dockerfile 范例</h3><ol>
<li><strong>范例一，构建具有 vim 的镜像</strong><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install vim</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> tail -f /etc/passwd &gt; /dev.null</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例二，构建具有 jdk1.8 的镜像</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 准备工作</span><br><span class="line">  - 提前准备好 jdk-1.8.tar.gz 文件</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装基础软件包</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install glibc.i686</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># java 安装到 /uar/local/java</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir /usr/<span class="built_in">local</span>/java</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> jdk-8u311.xxxx.tar.gz /uar/<span class="built_in">local</span>/java</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置环境变量</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME /usr/local/java/jdk1.<span class="number">8.0</span>xxxx</span><br><span class="line"><span class="keyword">ENV</span> JRE_HOME $JAVA_HOME/jre</span><br><span class="line"><span class="keyword">ENV</span> CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH</span><br><span class="line"><span class="keyword">ENV</span> PATH $JAVA_HOME/bin:$PATH</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> tail -f /etc/passwd &gt; /dev.null</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例三，构建编译安装 nginx 的镜像</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 准备工作</span><br><span class="line">  - 提前准备好 nginx 源码文件 nginx-1.18.0.tar.gz</span><br><span class="line">  - 提前准备好 nginx 配置文件 nginx.conf</span><br><span class="line">  - 提前准备好 web 网页代码 code.tar.gz</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> contos:centos7</span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装一些依赖软件</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install -y vim iotop bc gcc gcc-c++ glibc glibc-devel tree telnet lsof wget tcpdump bash-completion traceroute</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install -y pcre pcre-devel openssl openssl-devel</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install -y zip unzip zlib-devel net-tools lrzsz ntpdate libevent libevent-devel systemd-devel</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝源码文件</span></span><br><span class="line"><span class="comment"># 保存在 /usr/local/src/nginx</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> nginx-1.18.0.tar.gz /usr/<span class="built_in">local</span>/src/nginx</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译安装</span></span><br><span class="line"><span class="comment"># 安装到 /usr/local/nginx</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">cd</span> /usr/<span class="built_in">local</span>/src/nginx-1.18.0/ &amp;&amp; \</span></span><br><span class="line"><span class="bash">  ./configure \</span></span><br><span class="line"><span class="bash">    --prefix=/usr/<span class="built_in">local</span>/nginx &amp;&amp; \</span></span><br><span class="line"><span class="bash">  make &amp;&amp; \</span></span><br><span class="line"><span class="bash">  make install</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建用户</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> useradd nginx -s /sbin/nologin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建链接</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> ln -sv /usr/<span class="built_in">local</span>/nginx/sbin/nginx /usr/sbin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝配置文件</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> nginx.conf /usr/<span class="built_in">local</span>/nginx/conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝 web 代码</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> code.tar.gz /usr/<span class="built_in">local</span>/nginx/html/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改 nginx 相关文件的用户和组</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chown nginx.nginx /usr/<span class="built_in">local</span>/nginx/nginx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span> <span class="number">443</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;/usr/local/nginx/sbin/nginx&quot;</span>,<span class="string">&quot;-g&quot;</span>,<span class="string">&quot;daemon off;&quot;</span>]</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="Chapter04-Docker-仓库"><a href="#Chapter04-Docker-仓库" class="headerlink" title="Chapter04 Docker 仓库"></a>Chapter04 Docker 仓库</h1><hr>
<h2 id="4-1-Docker-Registry"><a href="#4-1-Docker-Registry" class="headerlink" title="4.1 Docker Registry"></a>4.1 Docker Registry</h2><hr>
<h3 id="知识点：docker-registry-介绍"><a href="#知识点：docker-registry-介绍" class="headerlink" title="知识点：docker registry 介绍"></a>知识点：docker registry 介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 由 docker 提供的单机镜像仓库</span><br><span class="line">  - docker.hub、阿里云 docker 镜像站等，都是采用 registry 来建立</span><br><span class="line"></span><br><span class="line">* 发展历史</span><br><span class="line">  - 第一代 registry 使用 python 开发，由于存在各种问题，已被废弃</span><br><span class="line">  - registry 2.0 使用 go 开发，项目名称为 distribution，</span><br><span class="line">  - registry 2.0 与第一代 registry 不兼容</span><br><span class="line">  - 2021 年移交给 CNCF 维护，源码 git/distribution/distribution</span><br><span class="line">  - docker 1.6 开始支持 registry 2.0，docker 1.5 之前的版本无法访问 registry 2.0</span><br><span class="line">  - registry 2.4 开始支持回收站机制，即可以删除镜像</span><br><span class="line">  - registry 2.7 开始从原始镜像中移除了 htpasswd 程序，需要额外指定</span><br><span class="line"></span><br><span class="line">* 应用场景</span><br><span class="line">  - 适合小规模的镜像管理</span><br><span class="line">  - registry 没有 web 管理界面，不适用于大型场景，更多采用 harbor</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-login-指令"><a href="#知识点：docker-login-指令" class="headerlink" title="知识点：docker login 指令"></a>知识点：docker login 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 登录到某个仓库</span><br><span class="line">  - 对于有验证的仓库，只有登录后才能 push 和 pull</span><br><span class="line">  - 可以同时多个仓库</span><br><span class="line">  - push 或 pull 时，如果 IMAGE 没有指定 registry，则都是访问 docker.hub</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker login OPTIONS SERVER</span><br><span class="line"></span><br><span class="line">* SERVER</span><br><span class="line">  - 指定要登录的仓库，格式为 ip:port，省略则登录 ~/.docker/config.json 记录的仓库</span><br><span class="line">  - port 默认为 80</span><br><span class="line"></span><br><span class="line">* OPTIONS</span><br><span class="line">  -u, --username string</span><br><span class="line">  -p, --password string</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-logout-指令"><a href="#知识点：docker-logout-指令" class="headerlink" title="知识点：docker logout 指令"></a>知识点：docker logout 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 退出仓库</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker logout SERVER</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-push-指令"><a href="#知识点：docker-push-指令" class="headerlink" title="知识点：docker push 指令"></a>知识点：docker push 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 将镜像推送到仓库上</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker push IMAGE:TAG</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-registry-范例"><a href="#知识点：docker-registry-范例" class="headerlink" title="知识点：docker registry 范例"></a>知识点：docker registry 范例</h3><ol>
<li><strong>范例一，启动无需验证的 docker registry</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> registry 默认暴露 5000 端口</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 默认情况下，仓库数据存放在容器的 /var/lib/registry 目录下</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 假设本机 IP 为 192.168.31.101</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动 registry 容器</span></span><br><span class="line">docker run \</span><br><span class="line">  -d \</span><br><span class="line">  -p 5000:5000 \</span><br><span class="line">  registry ;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加不安全仓库</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 因为 docker 默认不支持 http 方式推送镜像，只有先配置不安全仓库之后才能操作</span></span><br><span class="line">vim /etc/docker/daemon.json</span><br><span class="line"><span class="meta">  #</span><span class="bash"> 添加一个与 registry-mirrors 同级的元素</span></span><br><span class="line">  &quot;insecure-registries&quot;: [&quot;192.168.31.133:5000&quot;]</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启 docker</span></span><br><span class="line">systemctl daemon-reload &amp;&amp; systemctl restart docker</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 修改镜像 tag</span></span><br><span class="line">docker tag IMAGE 192.168.31.101:5000/IMAGE:TAG</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 推送镜像到仓库</span></span><br><span class="line">docker push 192.168.31.101:5000/IMAGE:TAG</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从仓库 pull 镜像</span></span><br><span class="line">docker pull 192.168.31.101:5000/IMAGE:TAG</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取仓库的镜像列表</span></span><br><span class="line">curl -XGET http://192.168.31.101:5000/v2/_catalog</span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回信息的格式为 &#123;<span class="string">&quot;repositories&quot;</span>:[<span class="string">&quot;XXXX&quot;</span>]&#125;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 返回信息会包含 IMAGE 名，但不会包含 tag</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例二，启动需要验证的 docker registry</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> registry 的验证，是通过检验 htpasswd 生成的用户-密码对认证文件来实现</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> registry 最新版镜像并不包括 htpasswd 程序，想要生成认证文件，需要想办法搞到 htpasswd 程序</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 假设本机 IP 为 192.168.31.101</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装 htpasswd 程序</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum -y install httpd-tools</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> apt-get -y install apache2-utils</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在宿主机创建认证文件</span></span><br><span class="line">mkdir auth</span><br><span class="line">htpasswd -Bbn USERNAME PASSWORD &gt;&gt; auth/htpasswd</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建 registry 容器</span></span><br><span class="line">docker run \</span><br><span class="line">  -d \</span><br><span class="line">  -p 5000:5000 \</span><br><span class="line">  -v auth:/auth \           # 通过存储卷将认证文件传递到容器中</span><br><span class="line">  --name registry \</span><br><span class="line">  --restart=always \</span><br><span class="line">  -e &quot;REGISTRY_AUTH=htpasswd&quot; \</span><br><span class="line">  -e &quot;REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm&quot; \</span><br><span class="line">  -e REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd \</span><br><span class="line">  registry ;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加不安全仓库</span></span><br><span class="line">vim /etc/docker/daemon.json</span><br><span class="line">  &quot;insecure-registries&quot;: [&quot;192.168.31.133:5000&quot;]</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启 docker</span></span><br><span class="line">systemctl daemon-reload &amp;&amp; systemctl restart docker</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 登录到 registry</span></span><br><span class="line">docker login -u USERNAME -p PASSWD 192.168.31.101:5000</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：云仓库范例"><a href="#知识点：云仓库范例" class="headerlink" title="知识点：云仓库范例"></a>知识点：云仓库范例</h3><ol>
<li><strong>范例一，镜像发布到阿里云个人仓库</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 开通阿里云个人镜像服务，务必保留好密码</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 容器镜像服务--&gt;个人实例</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建 registry，对应 IMAGE 命名中的仓库服务器</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建 namespace，对应 IMAGE 命名中的 registry，标识仓库名</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建 repository</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 登录到阿里云个人镜像仓库</span></span><br><span class="line">docker login -u=aliyunXXXX registry.cn-XXXX.aliyuncs.com</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 推送镜像</span></span><br><span class="line">docker tag IMAGE REGISTRY/namespace/repository:TAG</span><br><span class="line">docker push REGISTRY/namespace/repository:TAG</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> web 访问 repository 页面，可以查看镜像的各个版本</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="4-2-Harbor"><a href="#4-2-Harbor" class="headerlink" title="4.2 Harbor"></a>4.2 Harbor</h2><hr>
<h1 id="Chapter05-Docker-Compose"><a href="#Chapter05-Docker-Compose" class="headerlink" title="Chapter05 Docker Compose"></a>Chapter05 Docker Compose</h1><hr>
<h2 id="5-1-Docker-Compose"><a href="#5-1-Docker-Compose" class="headerlink" title="5.1 Docker Compose"></a>5.1 Docker Compose</h2><hr>
<h3 id="知识点：docker-compose-介绍"><a href="#知识点：docker-compose-介绍" class="headerlink" title="知识点：docker compose 介绍"></a>知识点：docker compose 介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - docker 提供的简易单机容器编排工具</span><br></pre></td></tr></table></figure></li>
<li><strong>compose file</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - docker compose 的配置文件，yaml 格式</span><br><span class="line">  - 用来定义一组容器之间的调用关系，尤其是不同容器之间启动的先后顺序</span><br><span class="line">  - 文件名必须是 docker-compose.yml</span><br><span class="line">  - 执行 docker compose 命令时，必须与 compose file 位于相同目录</span><br><span class="line">  - compose file format 有版本的区别，需要相应的 docker engine 的支持，官方推荐使用 v3 以上的格式</span><br></pre></td></tr></table></figure></li>
<li><strong>docker compose 要素</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 工程 project</span><br><span class="line">  - 一组相关联的容器组成完整业务单元，相当于 K8S 中的 pod</span><br><span class="line">  - 一个 docker-compose.yml 定义一个工程</span><br><span class="line"></span><br><span class="line">* 服务 service</span><br><span class="line">  - 一个服务对应一个容器</span><br><span class="line">  - 在 compose 中，通过 service 来定位容器，而不是容器名或容器 ID</span><br><span class="line">  - 在 compose 中，容器可以通过 service_name 来与其他容器进行通信</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-compose-的安装、卸载、验证"><a href="#知识点：docker-compose-的安装、卸载、验证" class="headerlink" title="知识点：docker compose 的安装、卸载、验证"></a>知识点：docker compose 的安装、卸载、验证</h3><ol>
<li><strong>安装</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> repo 方式安装</span></span><br><span class="line">yum -y install docker-compose-plugin</span><br><span class="line">apt-get -y install docker-compose-plugin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> manual 方式安装</span></span><br><span class="line">DOCKER_CONFIG=$&#123;DOCKER_CONFIG:-$HOME/.docker&#125;</span><br><span class="line">mkdir -p $DOCKER_CONFIG/cli-plugins</span><br><span class="line">curl -SL https://github.com/docker/compose/releases/download/v2.6.1/docker-compose-linux-x86_64 -o $DOCKER_CONFIG/cli-plugins/docker-compose</span><br><span class="line">chmod +x $DOCKER_CONFIG/cli-plugins/docker-compose</span><br><span class="line">chmod +x /usr/local/lib/docker/cli-plugins/docker-compose</span><br></pre></td></tr></table></figure></li>
<li><strong>卸载</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> repo 方式卸载</span></span><br><span class="line">yum remove docker-compose-plugin</span><br><span class="line">apt-get remove docker-compose-plugin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> manual 方式卸载</span></span><br><span class="line">rm $DOCKER_CONFIG/cli-plugins/docker-compose</span><br></pre></td></tr></table></figure></li>
<li><strong>验证</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">docker compose version</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 docker compose 程序文件</span></span><br><span class="line">docker info --format &#x27;&#123;&#123;range .ClientInfo.Plugins&#125;&#125;&#123;&#123;if eq .Name &quot;compose&quot;&#125;&#125;&#123;&#123;.Path&#125;&#125;&#123;&#123;end&#125;&#125;&#123;&#123;end&#125;&#125;&#x27;</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-compose-相关指令"><a href="#知识点：docker-compose-相关指令" class="headerlink" title="知识点：docker compose 相关指令"></a>知识点：docker compose 相关指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">* docker compose [CMD] -h</span><br><span class="line">  - 查看帮助</span><br><span class="line">  - docker-compose 不支持 help 指令</span><br><span class="line"></span><br><span class="line">* docker compose up</span><br><span class="line">* docker compose up -d</span><br><span class="line">  - 部署上线创建容器</span><br><span class="line">  - &quot;-d&quot; 表示启动并后台运行</span><br><span class="line"></span><br><span class="line">* docker compose down</span><br><span class="line">  - 下线并删除容器</span><br><span class="line"></span><br><span class="line">* docker compose exec [-it] SERVICE [cmd]</span><br><span class="line">  - 进入相应的服务所对应的容器中</span><br><span class="line"></span><br><span class="line">* docker compose ps [-a]</span><br><span class="line">  - 显示所有容器</span><br><span class="line"></span><br><span class="line">* docker compose top</span><br><span class="line">  - 显示所有容器</span><br><span class="line"></span><br><span class="line">* docker compose logs SERVICE</span><br><span class="line">  - 查看相应的服务所对应的容器的日志</span><br><span class="line"></span><br><span class="line">* docker compose config</span><br><span class="line">* docker compose config -q</span><br><span class="line">  - 对 compose file 进行语法检查</span><br><span class="line">  - &quot;-q&quot; 表示有问题时才输出</span><br><span class="line"></span><br><span class="line">* docker compose start/stop/restart SERVICE</span><br><span class="line">  - 启动/停止/重启容器</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：compose-file-简单语法"><a href="#知识点：compose-file-简单语法" class="headerlink" title="知识点：compose file 简单语法"></a>知识点：compose file 简单语法</h3><ol>
<li><strong>介绍</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span>          <span class="comment"># 指定 compose file 的格式</span></span><br><span class="line"><span class="attr">services:</span>             <span class="comment"># 设置所有的服务</span></span><br><span class="line">  <span class="attr">SERVICE_NAME:</span>         <span class="comment"># 指定服务名</span></span><br><span class="line">    <span class="attr">container_name:</span>       <span class="comment"># 指定容器名</span></span><br><span class="line">    <span class="attr">image:</span>                <span class="comment"># 指定使用的镜像</span></span><br><span class="line">    <span class="attr">ports:</span>                <span class="comment"># 指定端口映射</span></span><br><span class="line">    <span class="attr">volumes:</span>              <span class="comment"># 指定容器卷映射</span></span><br><span class="line">    <span class="attr">networks:</span>             <span class="comment"># 指定容器使用的网络</span></span><br><span class="line">    <span class="attr">environment:</span>          <span class="comment"># 指定环境变量</span></span><br><span class="line">    <span class="attr">command:</span>              <span class="comment"># 指定容器默认指令</span></span><br><span class="line">    <span class="attr">depands_on:</span>           <span class="comment"># 指定服务依赖，只能在此服务对应的容器启动后再启动</span></span><br><span class="line"><span class="attr">networks:</span>             <span class="comment"># 设置网络，相应的网络会新建</span></span><br><span class="line">  <span class="attr">NETWORK_NAME:</span>         <span class="comment"># 指定网络名</span></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-compose-范例"><a href="#知识点：docker-compose-范例" class="headerlink" title="知识点：docker compose 范例"></a>知识点：docker compose 范例</h3><p>1.<strong>范例一，启动 mysql+redis 工程</strong></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># project 中包含 3 个服务，1 个 mysql，2 个 redis</span></span><br><span class="line"><span class="comment"># 要求先启动 redis，再启动 mysql</span></span><br><span class="line"></span><br><span class="line"><span class="attr">version:</span> <span class="string">&quot;3&quot;</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">mysql01:</span>                    <span class="comment"># mysql 容器配置</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">m01</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/data/ContainerData/m01/log:/var/log/mysql</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/data/ContainerData/m01/data:/var/lib/mysql</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/data/ContainerData/m01/conf:/etc/mysql/conf</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">network01</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">network02</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">network03</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWD:</span> <span class="string">&#x27;12345678&#x27;</span></span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">&#x27;DB01&#x27;</span></span><br><span class="line">      <span class="attr">MYSQL_USER:</span> <span class="string">&#x27;xyz&#x27;</span></span><br><span class="line">      <span class="attr">MYSQL_PASSWD:</span> <span class="string">&#x27;123456&#x27;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">redis01</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">redis02</span></span><br><span class="line">  <span class="attr">redis01:</span>                    <span class="comment"># redis01 容器配置</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r01</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;6381:6379&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">network02</span></span><br><span class="line">  <span class="attr">redis02:</span>                    <span class="comment"># redis02 容器配置</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r02</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;6382:6379&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">network03</span></span><br><span class="line"><span class="attr">networks:</span>                     <span class="comment"># 网络配置</span></span><br><span class="line">  <span class="attr">network01:</span></span><br><span class="line">  <span class="attr">network02:</span></span><br><span class="line">  <span class="attr">network03:</span></span><br></pre></td></tr></table></figure>
    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2000/01/01/Blog21-hadoop/" rel="prev" title="Blog21-hadoop">
                  <i class="fa fa-chevron-left"></i> Blog21-hadoop
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2000/01/01/Blog32-k8s/" rel="next" title="Blog32-k8s">
                  Blog32-k8s <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2000 – 
  <span itemprop="copyrightYear">2024</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"per_page":true,"tags":"none","cdn":"//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
