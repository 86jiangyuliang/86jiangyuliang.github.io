<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222"><meta name="generator" content="Hexo 5.4.2">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon-32x32-next.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@6.0.0/css/all.min.css" integrity="sha256-jTIdiMuX/e3DGJUGwl3pKSxuc6YOuqtJYkM0bGQESA4=" crossorigin="anonymous">
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/animate.css@3.1.1/animate.min.css" integrity="sha256-PR7ttpcvz8qrF57fur/yAx1qXMFJeJFiA6pSzWi0OIE=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"example.com","root":"/","images":"/images","scheme":"Muse","darkmode":false,"version":"8.10.1","exturl":false,"sidebar":{"position":"left","width":500,"display":"always","padding":1,"offset":12},"copycode":false,"bookmark":{"enable":false,"color":"#222","save":"auto"},"mediumzoom":false,"lazyload":false,"pangu":false,"comments":{"style":"tabs","active":null,"storage":true,"lazyload":false,"nav":null},"stickytabs":false,"motion":{"enable":true,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"Searching...","empty":"We didn't find any results for the search: ${query}","hits_time":"${hits} results found in ${time} ms","hits":"${hits} results found"}}</script><script src="/js/config.js"></script>

    <meta name="description" content="docker">
<meta property="og:type" content="article">
<meta property="og:title" content="Blog31-docker">
<meta property="og:url" content="http://example.com/2000/01/01/Blog31-docker/index.html">
<meta property="og:site_name" content="Hexo">
<meta property="og:description" content="docker">
<meta property="og:locale" content="en_US">
<meta property="article:published_time" content="1999-12-31T16:00:31.000Z">
<meta property="article:modified_time" content="2025-06-25T07:59:44.000Z">
<meta property="article:author" content="John Doe">
<meta name="twitter:card" content="summary">


<link rel="canonical" href="http://example.com/2000/01/01/Blog31-docker/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"en","comments":true,"permalink":"http://example.com/2000/01/01/Blog31-docker/","path":"2000/01/01/Blog31-docker/","title":"Blog31-docker"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>Blog31-docker | Hexo</title>
  





  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage" class="use-motion">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="Toggle navigation bar" role="button">
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <p class="site-title">Hexo</p>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
    </div>
  </div>
</div>







</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          Table of Contents
        </li>
        <li class="sidebar-nav-overview">
          Overview
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#Blog31-docker"><span class="nav-text">Blog31-docker</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#%E5%B8%AE%E5%8A%A9"><span class="nav-text">帮助</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E4%B8%8D%E6%95%B4%E7%90%86"><span class="nav-text">不整理</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter01-Docker-%E4%BB%8B%E7%BB%8D"><span class="nav-text">Chapter01 Docker 介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#1-1-Docker-%E4%BB%8B%E7%BB%8D"><span class="nav-text">1.1 Docker 介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E5%AE%B9%E5%99%A8%E6%8A%80%E6%9C%AF"><span class="nav-text">知识点：容器技术</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-%E7%AE%80%E4%BB%8B"><span class="nav-text">知识点：docker 简介</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-%E7%9A%84%E8%BF%9B%E7%A8%8B%E4%BD%93%E7%B3%BB"><span class="nav-text">知识点：docker 的进程体系</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Anamespace"><span class="nav-text">知识点：namespace</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Acgroup"><span class="nav-text">知识点：cgroup</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-2-Docker-%E5%AE%89%E8%A3%85"><span class="nav-text">1.2 Docker 安装</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-%E5%AE%89%E8%A3%85%E9%9C%80%E6%B1%82"><span class="nav-text">知识点：docker 安装需求</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-yum-%E5%AE%89%E8%A3%85"><span class="nav-text">知识点：docker yum 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-apt-%E5%AE%89%E8%A3%85"><span class="nav-text">知识点：docker apt 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-%E4%BA%8C%E8%BF%9B%E5%88%B6%E5%AE%89%E8%A3%85"><span class="nav-text">知识点：docker 二进制安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-%E5%8D%B8%E8%BD%BD"><span class="nav-text">知识点：docker 卸载</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-3-Docker-%E6%9C%8D%E5%8A%A1%E7%AB%AF"><span class="nav-text">1.3 Docker 服务端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adockerd-%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：dockerd 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adockerd-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">知识点：dockerd 配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adata-root-%E9%85%8D%E7%BD%AE"><span class="nav-text">知识点：data-root 配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Aregistry-mirrors-%E9%85%8D%E7%BD%AE"><span class="nav-text">知识点：registry-mirrors 配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Ainsecure-registry-%E9%85%8D%E7%BD%AE"><span class="nav-text">知识点：insecure-registry 配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Ahttp-proxy%E3%80%81https-proxy%E3%80%81no-proxy-%E9%85%8D%E7%BD%AE"><span class="nav-text">知识点：http-proxy、https-proxy、no-proxy 配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Ametrics-addr-%E9%85%8D%E7%BD%AE"><span class="nav-text">知识点：metrics-addr 配置</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Ahosts-%E9%85%8D%E7%BD%AE"><span class="nav-text">知识点：hosts 配置</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-4-Docker-%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-text">1.4 Docker 客户端</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-%E5%AE%A2%E6%88%B7%E7%AB%AF"><span class="nav-text">知识点：docker 客户端</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93filter-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–filter 选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93format-%E9%80%89%E9%A1%B9%E5%92%8C-GoTemplate"><span class="nav-text">知识点：–format 选项和 GoTemplate</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93since%E3%80%81%E2%80%93until-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–since、–until 选项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#1-5-Docker-%E7%B3%BB%E7%BB%9F%E7%BA%A7%E6%8C%87%E4%BB%A4"><span class="nav-text">1.5 Docker 系统级指令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-help"><span class="nav-text">知识点：docker help</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-version"><span class="nav-text">知识点：docker version</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-info"><span class="nav-text">知识点：docker info</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-inspect"><span class="nav-text">知识点：docker inspect</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-events"><span class="nav-text">知识点：docker events</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-system-df"><span class="nav-text">知识点：docker system df</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-system-prune"><span class="nav-text">知识点：docker system prune</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter02-Docker-%E5%AE%B9%E5%99%A8"><span class="nav-text">Chapter02 Docker 容器</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#2-1-Docker-%E5%AE%B9%E5%99%A8%E4%BB%8B%E7%BB%8D"><span class="nav-text">2.1 Docker 容器介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E5%AE%B9%E5%99%A8%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：容器介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E5%B8%B8%E8%A7%81%E5%AE%B9%E5%99%A8%E8%8C%83%E4%BE%8B"><span class="nav-text">知识点：常见容器范例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-2-%E5%AE%B9%E5%99%A8%E5%88%9B%E5%BB%BA%E6%8C%87%E4%BB%A4"><span class="nav-text">2.2 容器创建指令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-run-x2F-create"><span class="nav-text">知识点：docker run&#x2F;create</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-update"><span class="nav-text">知识点：docker update</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93restart-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–restart 选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93pull-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–pull 选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93init-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–init 选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93env%E3%80%81%E2%80%93env-file-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–env、–env-file 选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93label%E3%80%81%E2%80%93label-file-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–label、–label-file 选项</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-3-%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E6%8C%87%E4%BB%A4"><span class="nav-text">2.3 容器管理指令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-ps"><span class="nav-text">知识点：docker ps</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-exec"><span class="nav-text">知识点：docker exec</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-rm"><span class="nav-text">知识点：docker rm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-cp"><span class="nav-text">知识点：docker cp</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-start-x2F-stop-x2F-restart-x2F-kill"><span class="nav-text">知识点：docker start&#x2F;stop&#x2F;restart&#x2F;kill</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-pause-x2F-unpause"><span class="nav-text">知识点：docker pause&#x2F;unpause</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-rename"><span class="nav-text">知识点：docker rename</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-logs"><span class="nav-text">知识点：docker logs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-top"><span class="nav-text">知识点：docker top</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-stats"><span class="nav-text">知识点：docker stats</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-port"><span class="nav-text">知识点：docker port</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-attach"><span class="nav-text">知识点：docker attach</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-wait"><span class="nav-text">知识点：docker wait</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-diff"><span class="nav-text">知识点：docker diff</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-container-prune"><span class="nav-text">知识点：docker container prune</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#2-4-%E5%AE%B9%E5%99%A8%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6"><span class="nav-text">2.4 容器资源限制</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E5%AE%B9%E5%99%A8%E7%9A%84%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：容器的资源限制介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93memory-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–memory 选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93kernel-memory-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–kernel-memory 选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93cpus-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–cpus 选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93cpu-period%E3%80%81%E2%80%93cpu-quota-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–cpu-period、–cpu-quota 选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93cpu-shares-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–cpu-shares 选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93gpus-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–gpus 选项</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter03-DockerImage"><span class="nav-text">Chapter03 DockerImage</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#3-1-DockerImage-%E4%BB%8B%E7%BB%8D"><span class="nav-text">3.1 DockerImage 介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E9%95%9C%E5%83%8F"><span class="nav-text">知识点：镜像</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E9%95%9C%E5%83%8F%E5%88%86%E5%B1%82"><span class="nav-text">知识点：镜像分层</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#3-2-DockerImage-%E6%8C%87%E4%BB%A4"><span class="nav-text">3.2 DockerImage 指令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-images"><span class="nav-text">知识点：docker images</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-search"><span class="nav-text">知识点：docker search</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-tag"><span class="nav-text">知识点：docker tag</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-history"><span class="nav-text">知识点：docker history</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-pull"><span class="nav-text">知识点：docker pull</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-push"><span class="nav-text">知识点：docker push</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-rmi"><span class="nav-text">知识点：docker rmi</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-image-prune"><span class="nav-text">知识点：docker image prune</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-save"><span class="nav-text">知识点：docker save</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-load"><span class="nav-text">知识点：docker load</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-commit"><span class="nav-text">知识点：docker commit</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-export"><span class="nav-text">知识点：docker export</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-import"><span class="nav-text">知识点：docker import</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter04-DockerBuild"><span class="nav-text">Chapter04 DockerBuild</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#4-1-DockerBuild-%E4%BB%8B%E7%BB%8D"><span class="nav-text">4.1 DockerBuild 介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ADockerBuild-%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：DockerBuild 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E6%9E%84%E5%BB%BA%E4%B8%8A%E4%B8%8B%E6%96%87"><span class="nav-text">知识点：构建上下文</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E6%9E%84%E5%BB%BA%E5%8F%98%E9%87%8F%E5%92%8C%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-text">知识点：构建变量和环境变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Abuild-secret"><span class="nav-text">知识点：build secret</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-build"><span class="nav-text">知识点：docker build</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-buildx"><span class="nav-text">知识点：docker buildx</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#4-2-DockerFile"><span class="nav-text">4.2 DockerFile</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ADockerfile-%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：Dockerfile 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ADockerfile-%E8%AF%AD%E6%B3%95"><span class="nav-text">知识点：Dockerfile 语法</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ADockerfile-%E7%9A%84-shell-%E6%A0%BC%E5%BC%8F%E5%92%8C-exec-%E6%A0%BC%E5%BC%8F"><span class="nav-text">知识点：Dockerfile 的 shell 格式和 exec 格式</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ADockerfile-%E8%8C%83%E4%BE%8B"><span class="nav-text">知识点：Dockerfile 范例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AFROM-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：FROM 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ALABEL-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：LABEL 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AMAINTAINER-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：MAINTAINER 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AARG-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：ARG 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AENV-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：ENV 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ARUN-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：RUN 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ACMD-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：CMD 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AENTRYPOINT-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：ENTRYPOINT 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AADD-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：ADD 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ACOPY-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：COPY 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AEXPOSE-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：EXPOSE 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ASHELL-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：SHELL 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AWORKDIR-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：WORKDIR 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9AUSER-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：USER 指令</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter05-DockerRegistry"><span class="nav-text">Chapter05 DockerRegistry</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#5-1-DockerRegistry-%E4%BB%8B%E7%BB%8D"><span class="nav-text">5.1 DockerRegistry 介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ADocker-%E4%BB%93%E5%BA%93"><span class="nav-text">知识点：Docker 仓库</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ADocker-Hub"><span class="nav-text">知识点：Docker Hub</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-login"><span class="nav-text">知识点：docker login</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-logout"><span class="nav-text">知识点：docker logout</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ADocker-Registry-%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：Docker Registry 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ADocker-Registry-%E9%85%8D%E7%BD%AE%E6%96%87%E4%BB%B6"><span class="nav-text">知识点：Docker Registry 配置文件</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E5%90%AF%E5%8A%A8%E6%97%A0%E9%9C%80%E9%AA%8C%E8%AF%81%E7%9A%84-docker-registry-%E8%8C%83%E4%BE%8B"><span class="nav-text">知识点：启动无需验证的 docker registry 范例</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E5%90%AF%E5%8A%A8%E9%9C%80%E8%A6%81%E9%AA%8C%E8%AF%81%E7%9A%84-docker-registry"><span class="nav-text">知识点：启动需要验证的 docker registry</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E4%BA%91%E4%BB%93%E5%BA%93%E8%8C%83%E4%BE%8B"><span class="nav-text">知识点：云仓库范例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#5-3-Harbor"><span class="nav-text">5.3 Harbor</span></a></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter06-DockerVolume-%E5%8D%B7"><span class="nav-text">Chapter06 DockerVolume 卷</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#6-1-DockerVolume-%E4%BB%8B%E7%BB%8D"><span class="nav-text">6.1 DockerVolume 介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E5%AD%98%E5%82%A8%E5%8D%B7%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：存储卷介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E5%8D%B7-volume"><span class="nav-text">知识点：卷 volume</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E7%BB%91%E5%AE%9A%E6%8C%82%E8%BD%BD-bind-mount"><span class="nav-text">知识点：绑定挂载 bind mount</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Atmpfs"><span class="nav-text">知识点：tmpfs</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-2-DockerVolume-%E6%8C%87%E4%BB%A4"><span class="nav-text">6.2 DockerVolume 指令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-volume-ls"><span class="nav-text">知识点：docker volume ls</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-volume-create"><span class="nav-text">知识点：docker volume create</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-volume-rm"><span class="nav-text">知识点：docker volume rm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-volume-prune"><span class="nav-text">知识点：docker volume prune</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#6-3-%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AD%98%E5%82%A8%E5%8D%B7%E9%85%8D%E7%BD%AE"><span class="nav-text">6.3 容器的存储卷配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93volume-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–volume 选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93mount-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–mount 选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93volumes-from-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–volumes-from 选项</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter07-DockerNetwork"><span class="nav-text">Chapter07 DockerNetwork</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#7-1-DockerNetwork-%E4%BB%8B%E7%BB%8D"><span class="nav-text">7.1 DockerNetwork 介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-%E7%BD%91%E7%BB%9C%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：docker 网络介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Abridge-%E7%BD%91%E7%BB%9C%E9%A9%B1%E5%8A%A8"><span class="nav-text">知识点：bridge 网络驱动</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-%E5%92%8C-iptables"><span class="nav-text">知识点：docker 和 iptables</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-2-DockerNetwork-%E6%8C%87%E4%BB%A4"><span class="nav-text">7.2 DockerNetwork 指令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-network-ls"><span class="nav-text">知识点：docker network ls</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-network-create"><span class="nav-text">知识点：docker network create</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-network-inspect"><span class="nav-text">知识点：docker network inspect</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-network-connect-x2F-disconnect"><span class="nav-text">知识点：docker network connect&#x2F;disconnect</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-network-rm"><span class="nav-text">知识点：docker network rm</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-network-prune"><span class="nav-text">知识点：docker network prune</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#7-3-%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE"><span class="nav-text">7.3 容器的网络配置</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93network-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–network 选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93publish-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–publish 选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93ip-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–ip 选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93hostname-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–hostname 选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93dns-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–dns 选项</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9A%E2%80%93add-host-%E9%80%89%E9%A1%B9"><span class="nav-text">知识点：–add-host 选项</span></a></li></ol></li></ol></li><li class="nav-item nav-level-1"><a class="nav-link" href="#Chapter08-DockerCompose"><span class="nav-text">Chapter08 DockerCompose</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#8-1-DockerCompose-%E4%BB%8B%E7%BB%8D"><span class="nav-text">8.1 DockerCompose 介绍</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-compose-%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：docker compose 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-compose-%E5%AE%89%E8%A3%85"><span class="nav-text">知识点：docker compose 安装</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-compose-%E7%8E%AF%E5%A2%83%E5%8F%98%E9%87%8F"><span class="nav-text">知识点：docker compose 环境变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-compose-%E5%AE%98%E6%96%B9%E7%A4%BA%E4%BE%8B"><span class="nav-text">知识点：docker compose 官方示例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-2-DockerCompose-%E6%8C%87%E4%BB%A4"><span class="nav-text">8.2 DockerCompose 指令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-compose-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker compose 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-compose-ls-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker compose ls 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-compose-up-x2F-down-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker compose up&#x2F;down 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-compose-config-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker compose config 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-compose-ps-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker compose ps 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-compose-top-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker compose top 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-compose-logs-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker compose logs 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-compose-exec-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker compose exec 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-compose-images-x2F-push-x2F-pull-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker compose images&#x2F;push&#x2F;pull 指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Adocker-compose-version-%E6%8C%87%E4%BB%A4"><span class="nav-text">知识点：docker compose version 指令</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-3-Compose-File"><span class="nav-text">8.3 Compose File</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ACompose-file-%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：Compose file 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ACompose-file-fragments"><span class="nav-text">知识点：Compose file fragments</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ACompose-file-extensions"><span class="nav-text">知识点：Compose file extensions</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9ACompose-file-%E8%8C%83%E4%BE%8B"><span class="nav-text">知识点：Compose file 范例</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-4-Service-%E8%AF%AD%E6%B3%95"><span class="nav-text">8.4 Service 语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Acompose-service-%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：compose service 介绍</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Aservice-SERVICE-NAME-configs"><span class="nav-text">知识点：service.SERVICE_NAME.configs</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Aservice-SERVICE-NAME-cap-X"><span class="nav-text">知识点：service.SERVICE_NAME.cap_X</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Aservice-SERVICE-NAME-cgroup-X"><span class="nav-text">知识点：service.SERVICE_NAME.cgroup_X</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Aservice-SERVICE-NAME-cpu-X"><span class="nav-text">知识点：service.SERVICE_NAME.cpu_X</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Aservice-SERVICE-NAME-dns-X"><span class="nav-text">知识点：service.SERVICE_NAME.dns_X</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Aservice-SERVICE-NAME-entrypoint"><span class="nav-text">知识点：service.SERVICE_NAME.entrypoint</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Aservice-SERVICE-NAME-env-file"><span class="nav-text">知识点：service.SERVICE_NAME.env_file</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Aservice-SERVICE-NAME-environment"><span class="nav-text">知识点：service.SERVICE_NAME.environment</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Aservice-SERVICE-NAME-expose"><span class="nav-text">知识点：service.SERVICE_NAME.expose</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Aservice-SERVICE-NAME-extra-hosts"><span class="nav-text">知识点：service.SERVICE_NAME.extra_hosts</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Aservice-SERVICE-NAME-labels"><span class="nav-text">知识点：service.SERVICE_NAME.labels</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Aservice-%E5%85%B6%E4%BB%96%E8%AF%AD%E6%B3%95"><span class="nav-text">知识点：service 其他语法</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-5-Volume-%E8%AF%AD%E6%B3%95"><span class="nav-text">8.5 Volume 语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Acompose-volume-%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：compose volume 介绍</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-6-Network-%E8%AF%AD%E6%B3%95"><span class="nav-text">8.6 Network 语法</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#%E7%9F%A5%E8%AF%86%E7%82%B9%EF%BC%9Acompose-network-%E4%BB%8B%E7%BB%8D"><span class="nav-text">知识点：compose network 介绍</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-7-Build-%E8%AF%AD%E6%B3%95"><span class="nav-text">8.7 Build 语法</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#8-8-%E5%85%B6%E4%BB%96%E8%AF%AD%E6%B3%95"><span class="nav-text">8.8 其他语法</span></a></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
  <p class="site-author-name" itemprop="name">John Doe</p>
  <div class="site-description" itemprop="description"></div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">19</span>
          <span class="site-state-item-name">posts</span>
        </a>
      </div>
  </nav>
</div>



        </div>
      </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="back-to-top" role="button" aria-label="Back to top">
    <i class="fa fa-arrow-up"></i>
    <span>0%</span>
  </div>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="en">
    <link itemprop="mainEntityOfPage" href="http://example.com/2000/01/01/Blog31-docker/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.gif">
      <meta itemprop="name" content="John Doe">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Hexo">
      <meta itemprop="description" content="">
    </span>
    
    <span hidden itemprop="post" itemscope itemtype="http://schema.org/CreativeWork">
      <meta itemprop="name" content="Blog31-docker | Hexo">
      <meta itemprop="description" content="">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          Blog31-docker
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">Posted on</span>

      <time title="Created: 2000-01-01 00:00:31" itemprop="dateCreated datePublished" datetime="2000-01-01T00:00:31+08:00">2000-01-01</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar-check"></i>
      </span>
      <span class="post-meta-item-text">Edited on</span>
      <time title="Modified: 2025-06-25 15:59:44" itemprop="dateModified" datetime="2025-06-25T15:59:44+08:00">2025-06-25</time>
    </span>

  
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <hr>
<h1 id="Blog31-docker"><a href="#Blog31-docker" class="headerlink" title="Blog31-docker"></a>Blog31-docker</h1><p><a href="#Chapter01-Docker-%E4%BB%8B%E7%BB%8D"><strong>Chapter01 Docker 介绍</strong></a></p>
<ul>
<li><a href="#1-1-Docker-%E4%BB%8B%E7%BB%8D">1.1 Docker 介绍</a></li>
<li><a href="#1-2-Docker-%E5%AE%89%E8%A3%85">1.2 Docker 安装</a></li>
<li><a href="#1-3-Docker-%E6%9C%8D%E5%8A%A1%E7%AB%AF">1.3 Docker 服务端</a></li>
<li><a href="#1-4-Docker-%E5%AE%A2%E6%88%B7%E7%AB%AF">1.4 Docker 客户端</a></li>
<li><a href="#1-5-Docker-%E7%B3%BB%E7%BB%9F%E7%BA%A7%E6%8C%87%E4%BB%A4">1.5 Docker 系统级指令</a></li>
</ul>
<p><a href="#Chapter02-Docker-%E5%AE%B9%E5%99%A8"><strong>Chapter02 Docker 容器</strong></a></p>
<ul>
<li><a href="#2-1-Docker-%E5%AE%B9%E5%99%A8%E4%BB%8B%E7%BB%8D">2.1 Docker 容器介绍</a></li>
<li><a href="#2-2-%E5%AE%B9%E5%99%A8%E5%88%9B%E5%BB%BA%E6%8C%87%E4%BB%A4">2.2 容器创建指令</a></li>
<li><a href="#2-3-%E5%AE%B9%E5%99%A8%E7%AE%A1%E7%90%86%E6%8C%87%E4%BB%A4">2.3 容器管理指令</a></li>
<li><a href="#2-4-%E5%AE%B9%E5%99%A8%E8%B5%84%E6%BA%90%E9%99%90%E5%88%B6">2.4 容器资源限制</a></li>
</ul>
<p><a href="#Chapter03-DockerImage"><strong>Chapter03 DockerImage</strong></a></p>
<ul>
<li><a href="#3-1-DockerImage-%E4%BB%8B%E7%BB%8D">3.1 DockerImage 介绍</a></li>
<li><a href="#3-2-DockerImage-%E6%8C%87%E4%BB%A4">3.2 DockerImage 指令</a></li>
</ul>
<p><a href="#Chapter04-DockerBuild"><strong>Chapter04 DockerBuild</strong></a></p>
<ul>
<li><a href="#4-1-DockerBuild-%E4%BB%8B%E7%BB%8D">4.1 DockerBuild 介绍</a></li>
<li><a href="#4-2-DockerFile">4.2 DockerFile</a></li>
</ul>
<p><a href="#Chapter05-DockerRegistry"><strong>Chapter05 DockerRegistry</strong></a></p>
<ul>
<li><a href="#5-1-DockerRegistry-%E4%BB%8B%E7%BB%8D">5.1 DockerRegistry 介绍</a></li>
</ul>
<p><a href="#Chapter06-DockerVolume"><strong>Chapter06 DockerVolume</strong></a></p>
<ul>
<li><a href="#6-1-DockerVolume-%E4%BB%8B%E7%BB%8D">6.1 DockerVolume 介绍</a></li>
<li><a href="#6-2-DockerVolume-%E6%8C%87%E4%BB%A4">6.2 DockerVolume 指令</a></li>
<li><a href="#6-3-%E5%AE%B9%E5%99%A8%E7%9A%84%E5%AD%98%E5%82%A8%E5%8D%B7%E9%85%8D%E7%BD%AE">6.3 容器的存储卷配置</a></li>
</ul>
<p><a href="#Chapter07-DockerNetwork"><strong>Chapter07 DockerNetwork</strong></a></p>
<ul>
<li><a href="#7-1-DockerNetwork-%E4%BB%8B%E7%BB%8D">7.1 DockerNetwork 介绍</a></li>
<li><a href="#7-2-DockerNetwork-%E6%8C%87%E4%BB%A4">7.2 DockerNetwork 指令</a></li>
<li><a href="#7-3-%E5%AE%B9%E5%99%A8%E7%9A%84%E7%BD%91%E7%BB%9C%E9%85%8D%E7%BD%AE">7.3 容器的网络配置</a></li>
</ul>
<p><a href="#Chapter08-DockerCompose"><strong>Chapter08 DockerCompose</strong></a></p>
<ul>
<li><a href="#8-1-DockerCompose-%E4%BB%8B%E7%BB%8D">8.1 DockerCompose 介绍</a></li>
<li><a href="#8-2-DockerCompose-%E6%8C%87%E4%BB%A4">8.2 DockerCompose 指令</a></li>
<li><a href="#8-3-ComposeFile">8.3 ComposeFile</a></li>
<li><a href="#8-4-Service-%E8%AF%AD%E6%B3%95">8.4 Service 语法</a></li>
<li><a href="#8-5-Volume-%E8%AF%AD%E6%B3%95">8.5 Volume 语法</a></li>
<li><a href="#8-6-Network-%E8%AF%AD%E6%B3%95">8.6 Network 语法</a></li>
<li><a href="#8-7-Build-%E8%AF%AD%E6%B3%95">8.7 Build 语法</a></li>
<li><a href="#8-7-%E5%85%B6%E4%BB%96%E8%AF%AD%E6%B3%95">8.8 其他语法</a></li>
</ul>
<p><a href="#Chapter09-Harbor"><strong>Chapter09 Harbor</strong></a></p>
<hr>
<h2 id="帮助"><a href="#帮助" class="headerlink" title="帮助"></a>帮助</h2><ol>
<li><strong>官网</strong></li>
</ol>
<ul>
<li><a target="_blank" rel="noopener" href="https://www.docker.com/">https://www.docker.com/</a></li>
</ul>
<ol start="2">
<li><strong>Guide</strong></li>
</ol>
<ul>
<li>Get Started <a target="_blank" rel="noopener" href="https://docs.docker.com/get-started/">https://docs.docker.com/get-started/</a></li>
<li>Get Docker <a target="_blank" rel="noopener" href="https://docs.docker.com/get-docker/">https://docs.docker.com/get-docker/</a></li>
</ul>
<ol start="3">
<li><strong>Manual</strong></li>
</ol>
<ul>
<li>DockerManual <a target="_blank" rel="noopener" href="https://docs.docker.com/manuals/">https://docs.docker.com/manuals/</a></li>
<li>DockerEngine <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/">https://docs.docker.com/engine/</a></li>
<li>DockerCompose <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/">https://docs.docker.com/compose/</a></li>
<li>Hub <a target="_blank" rel="noopener" href="https://docs.docker.com/docker-hub/">https://docs.docker.com/docker-hub/</a></li>
</ul>
<ol start="4">
<li><strong>Reference</strong></li>
</ol>
<ul>
<li>Reference <a target="_blank" rel="noopener" href="https://docs.docker.com/reference/">https://docs.docker.com/reference/</a></li>
<li>docker CLI <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/cli/">https://docs.docker.com/engine/reference/commandline/cli/</a></li>
<li>dockerd CLI <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/commandline/dockerd/">https://docs.docker.com/engine/reference/commandline/dockerd/</a></li>
<li>DockerFile <a target="_blank" rel="noopener" href="https://docs.docker.com/engine/reference/builder/">https://docs.docker.com/engine/reference/builder/</a></li>
<li>ComposeFile <a target="_blank" rel="noopener" href="https://docs.docker.com/compose/compose-file/">https://docs.docker.com/compose/compose-file/</a></li>
</ul>
<hr>
<h2 id="不整理"><a href="#不整理" class="headerlink" title="不整理"></a>不整理</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><span class="line">* docker 底层技术</span><br><span class="line">  - namespace 技术</span><br><span class="line">  - cgroup 技术</span><br><span class="line"></span><br><span class="line">* DockerManual.DockerEngine.Storage</span><br><span class="line">  - volume driver</span><br><span class="line"></span><br><span class="line">* DockerManual.DockerEngine.Networking</span><br><span class="line">  - IPvlan</span><br><span class="line">  - macvlan</span><br><span class="line">  - none</span><br><span class="line"></span><br><span class="line">* DockerManual.DockerBuild</span><br><span class="line">  - BuildKit</span><br><span class="line">  - Builder</span><br><span class="line">  - Named build context</span><br><span class="line">  - Multi-stage Builds</span><br><span class="line">  - Build checks</span><br><span class="line">  - Build tool configuration variables</span><br><span class="line">  - Cache</span><br><span class="line">  - Exporters</span><br><span class="line">  - BuildKit</span><br><span class="line"></span><br><span class="line">* DockerReference.DockerfileReference</span><br><span class="line">  - VOLUME</span><br><span class="line">  - ONBUILD</span><br><span class="line">  - STOPSIGNAL</span><br><span class="line">  - HEALTHCHECK</span><br><span class="line">  - Here-Documents</span><br><span class="line"></span><br><span class="line">* DockerReference.CLIReference.docker</span><br><span class="line">  - docker builder</span><br><span class="line">  - docker buildx</span><br><span class="line"></span><br><span class="line">* DockerAPI</span><br><span class="line"></span><br><span class="line">* DockerReference.CLIReference.docker_compose</span><br><span class="line">  - docker compose create</span><br><span class="line">  - docker compose run</span><br><span class="line">  - docker compose start</span><br><span class="line">  - docker compose stop</span><br><span class="line">  - docker compose restart</span><br><span class="line">  - docker compose kill</span><br><span class="line">  - docker compose pause</span><br><span class="line">  - docker compose unpause</span><br><span class="line">  - docker compose port</span><br><span class="line">  - docker compose rm</span><br><span class="line">  - docker compose events</span><br><span class="line"></span><br><span class="line">* DockerReference.ComposeFileReference</span><br><span class="line"></span><br><span class="line">* DockerReference.ComposeFileReference.Services_top-level_elements</span><br><span class="line">  - scales</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h1 id="Chapter01-Docker-介绍"><a href="#Chapter01-Docker-介绍" class="headerlink" title="Chapter01 Docker 介绍"></a>Chapter01 Docker 介绍</h1><hr>
<h2 id="1-1-Docker-介绍"><a href="#1-1-Docker-介绍" class="headerlink" title="1.1 Docker 介绍"></a>1.1 Docker 介绍</h2><hr>
<h3 id="知识点：容器技术"><a href="#知识点：容器技术" class="headerlink" title="知识点：容器技术"></a>知识点：容器技术</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 容器技术，就是通过使用 namespace、cgroup 等技术，为进程创造一个隔离的运行环境，将进程的资源与系统的其他部分隔离开</span><br><span class="line">  - 容器几乎模拟了一个完整的操作系统</span><br><span class="line">  - 容器中可以包含除了内核以外其他所有的运行应用所需要的东西，因此不需要依赖服务器安装基础环境</span><br><span class="line"></span><br><span class="line">* 容器没有自己的内核</span><br><span class="line">  - 容器使用宿主机的内核</span><br><span class="line">  - 一台宿主机上的所有容器共用一个内核</span><br><span class="line">  - 容器不直接访问硬件，而是通过宿主机的内核来访访问硬件</span><br><span class="line"></span><br><span class="line">* 容器位于 paas 层</span><br><span class="line">  - iaas 负责物理服务器、网络、存储、硬件、操作系统</span><br><span class="line">  - iaas 技术如 openstack、ecs、vmware、KVM Kernel-based Virtual Machine</span><br><span class="line"></span><br><span class="line">* 容器的特点</span><br><span class="line">  - 自包含</span><br><span class="line">  - 轻量级</span><br><span class="line">  - 可移植</span><br><span class="line">  - 相互隔离</span><br><span class="line"></span><br><span class="line">* 容器的优势</span><br><span class="line">  - 程序带环境</span><br><span class="line">  - 轻量级</span><br><span class="line">  - 快速启动</span><br><span class="line">  - 程序运行时与数据分离</span><br><span class="line">  - 快速移植、扩容、缩容</span><br><span class="line"></span><br><span class="line">* OCI 组织</span><br><span class="line">  - open contianer</span><br><span class="line">  - 由 linux 基金会、微软、红帽、docker、google、ibm 等组建，旨在确定开放的标准的容器规范</span><br><span class="line">  - 目前已有两个规范，runtime spec 和 image format spec</span><br><span class="line">  - 只要兼容这两个规范，就可以保证容器的可移植性和可操作性</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>容器与传统虚拟机对比</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">* 传统虚拟机技术</span><br><span class="line">  - 在硬件层实现的虚拟化，需要虚拟出一套硬件</span><br><span class="line">  - 虚拟机具有自己单独的内核，可以通过自己的内核直接访问硬件</span><br><span class="line">  - 需要 Hypervisor 层的支持，要求宿主机的 CPU 支持虚拟化</span><br><span class="line">  - 缺点</span><br><span class="line">    - 资源占用多，空运行的虚拟机也会占用一部分资源</span><br><span class="line">    - 启动慢，需要运行完整的 OS 启动流程，冗余步骤多</span><br><span class="line"></span><br><span class="line">* 容器相对于传统虚拟机的优点</span><br><span class="line">  - 资源占用更少</span><br><span class="line">  - 适配性更强</span><br><span class="line">    - 基于 OS，只要有操作系统即可</span><br><span class="line">    - 不要求宿主机的 CPU 对虚拟化的支持</span><br><span class="line">  - 启动速度更快</span><br><span class="line">    - 容器比虚拟机具有更少的抽象层，不需要加载各种硬件的驱动</span><br><span class="line">    - 容器不需要启动一个内核，省略了诸如系统引导、地址返回、服务启动等过程</span><br><span class="line">  - 更利于快速发布和部署</span><br><span class="line">    - 容器的启动速度为秒级</span><br><span class="line">    - 只要有镜像文件就能启动容器，不需要人工进行配置</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>容器技术带来的变化</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">* 更快的应用交付和部署</span><br><span class="line">  - 传统开发的模式</span><br><span class="line">    - 提交软件时，需要一并提交配置说明文档</span><br><span class="line">    - 由运维进行应用的部署，部署应用时，需要先参照配置文档，准备环境、设定配置</span><br><span class="line">    - 常出现因为环境、配置的原因导致应用异常</span><br><span class="line">  - 容器化的交付和部署</span><br><span class="line">    - 提交的不再是软件安装包，而是镜像文件</span><br><span class="line">    - 镜像文件中，已经对相应的配置进行了设定、准备好了相应的环境和依赖</span><br><span class="line">    - 测试环节、部署环节全部使用镜像文件</span><br><span class="line">    - 节省了部署、配置、测试、验证的时间</span><br><span class="line">    - 软件的开发环境、测试环境、生产环境高度统一</span><br><span class="line"></span><br><span class="line">* 更快的升级和扩容</span><br><span class="line">  - 由于微服务架构和容器，应用开发变得像搭积木</span><br><span class="line">  - 应用的扩容从天级变秒级</span><br><span class="line"></span><br><span class="line">* 更简单的监控和运维</span><br><span class="line">  - 软件的生产环境、开发环境、测试环境高度一致</span><br><span class="line">  - 避免了环境和配置导致的新问题</span><br><span class="line">  - 软件异常时，可以直接通过测试环境的相同的容器快速定位故障和进行修复</span><br><span class="line"></span><br><span class="line">* 更高效的硬件资源利用</span><br><span class="line"></span><br><span class="line">* devops</span><br><span class="line">  - 开发需要开始扮演一部分运维的角色</span><br><span class="line">  - 之前为全栈工程师，但不行，前端、后端 java、更后端的大数据数仓数湖等，想让一个人全部精通太难了</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-简介"><a href="#知识点：docker-简介" class="headerlink" title="知识点：docker 简介"></a>知识点：docker 简介</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line">* Docker 介绍</span><br><span class="line">  - 基于 go 语言开发，开源</span><br><span class="line">  - 基于 linux 内核的 namespace 技术来实现容器</span><br><span class="line">  - 理念：Build、Ship、Run Any APP Anywhere</span><br><span class="line"></span><br><span class="line">* Docker 历史</span><br><span class="line">  - 在 2013 开源</span><br><span class="line">  - 从 2015 开始流行</span><br><span class="line">  - 早期叫 dotcloud</span><br><span class="line">  - 总部位于旧金山，公司不怎么赚钱</span><br><span class="line">  - docker 早期的实现方式，对 LXC 进行高级的封装，提供了标准的配置方法，并将做好的配置做成镜像</span><br><span class="line">  - docker 新的实现方式，使用自己研发的开源的 runc 技术</span><br><span class="line">  - docker 从 1.13 开始，版本命名方式改为 年.月.日 方式</span><br><span class="line">  - docker 从 17.03 开始，分为 CE 版和 EE 版</span><br><span class="line"></span><br><span class="line">* Docker 的组成</span><br><span class="line">  - dockerd 守护进程</span><br><span class="line">  - docker 客户端</span><br><span class="line">  - API</span><br><span class="line"></span><br><span class="line">* Docker 的组件</span><br><span class="line">  - 容器 Container</span><br><span class="line">  - 镜像 Image</span><br><span class="line">  - 仓库 Registry</span><br><span class="line">  - 网络 Network</span><br><span class="line">  - 存储 Storage</span><br><span class="line"></span><br><span class="line">* Docker 使用的底层技术</span><br><span class="line">  - namespace</span><br><span class="line">  - cgroup</span><br><span class="line">  - chroot</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-的进程体系"><a href="#知识点：docker-的进程体系" class="headerlink" title="知识点：docker 的进程体系"></a>知识点：docker 的进程体系</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">* dockerd</span><br><span class="line">  - docker 的服务端</span><br><span class="line">  - 接收客户端指令</span><br><span class="line">  - 通过 sock 文件调用 containerd</span><br><span class="line"></span><br><span class="line">* docker-proxy</span><br><span class="line">  - 由 dockerd 启动</span><br><span class="line">  - 为每个容器确定网络访问规则</span><br><span class="line"></span><br><span class="line">* containerd</span><br><span class="line">  - 一个标准的容器运行时</span><br><span class="line">  - 由 dockerd 启动 containerd 并调用</span><br><span class="line">  - 管理宿主机上的容器的完整生命周期</span><br><span class="line">  - 在整个容器的生命周期中，containerd 通过 epoll 监控容器的文件、事件</span><br><span class="line">  - containerd 的运行时要求非常低，大多数与 Linux 容器功能集的交互都是由 runc 处理</span><br><span class="line"></span><br><span class="line">* containerd-shim</span><br><span class="line">* containerd-shim-runc-v2</span><br><span class="line">  - 沙箱进程</span><br><span class="line">  - 每个容器一个</span><br><span class="line">  - 手动执行 container-shim 命令，也能创建容器</span><br><span class="line"></span><br><span class="line">* runc</span><br><span class="line">  - docker 开发的根据 OCI 规范用来生成和运行容器的 cli 工具</span><br><span class="line">  - 容器环境的准备进程</span><br><span class="line"></span><br><span class="line">* docker-cli</span><br><span class="line">  - docker 的客户端</span><br><span class="line">  - 发送 docker 控制指令</span><br><span class="line">  - 因为是基于 sock 与服务端进行通信，因此只能管理本机的 dockerd</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>调用关系</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">* dockerd 启动，同时自动启动 containerd</span><br><span class="line"></span><br><span class="line">* docker-cli 发送指令到 dockerd</span><br><span class="line"></span><br><span class="line">* dockerd 发送信息到 containerd</span><br><span class="line"></span><br><span class="line">* containerd 启动一个 containerd-shim-runc-v2 进程</span><br><span class="line"></span><br><span class="line">* containerd-shim-runc-v2 执行各种 runc 指令，来创建容器的环境</span><br><span class="line">  - runc 调用 unshare system call 设置 namespace</span><br><span class="line">  - runc 调用 clone system call 创建容器的守护进程</span><br><span class="line">  - runc 退出，守护进程移交给 containerd-shim-runc-v2</span><br><span class="line"></span><br><span class="line">* 容器启动完成</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：namespace"><a href="#知识点：namespace" class="headerlink" title="知识点：namespace"></a>知识点：namespace</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">* namespace 介绍</span><br><span class="line">  - namespace 是 linux 内核提供的，用于隔离进程资源的一项技术</span><br><span class="line">  - namespace 是从内核 2.4.19 开始逐渐支持的，所以 docker 对系统版本有要求</span><br><span class="line"></span><br><span class="line">* namespace 的特点</span><br><span class="line">  - namespace 层位于内核与进程之间</span><br><span class="line">  - 同一个 namespace 之中，值不可以重复</span><br><span class="line">  - 不同的 namespace 之间相互独立</span><br><span class="line">  - 一个 namespace 中的项，对另一个 namespace 中的项是不可见的</span><br><span class="line"></span><br><span class="line">* namespace 的意义</span><br><span class="line">  - 在进程和内核之间，提供了一层资源隔离的功能</span><br><span class="line">  - 主要的用处，也就是用在容器中</span><br><span class="line">  - namespace 是容器最核心的技术</span><br><span class="line">  - 某种意义上 namespace 和容器的概念等价</span><br><span class="line"></span><br><span class="line">* docker 对 namespace 的使用</span><br><span class="line">  - 每当创建一个新的容器时，docker 会对五种 namespace 分别创建一个新的，容器的守护进程就被分配为这些新的项</span><br><span class="line">  - 当删除容器时，容器所对应的 namespace 也会被删除</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>五种 namespace</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">* PID</span><br><span class="line">  - 提供进程隔离</span><br><span class="line"></span><br><span class="line">* NET</span><br><span class="line">  - 管理网络接口</span><br><span class="line"></span><br><span class="line">* IPC</span><br><span class="line">  - 管理 IPC 资源的访问</span><br><span class="line"></span><br><span class="line">* MNT</span><br><span class="line">  - 管理文件系统挂载点</span><br><span class="line"></span><br><span class="line">* UTS</span><br><span class="line">  - 隔离内核和版本标识符，提供 hostname 和 NIC domain name 的隔离</span><br><span class="line"></span><br><span class="line">* User</span><br><span class="line">  - 提供用户名的隔离，从内核 3.8 开始支持</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>相关 linux 命令</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* man 7 namespaces</span><br><span class="line">  - 查看 namespace 的帮助</span><br><span class="line"></span><br><span class="line">* lsns</span><br><span class="line">  - 查看当前系统上有哪些 namespace</span><br><span class="line"></span><br><span class="line">* ls -l /proc/PID/ns</span><br><span class="line">  - 查看某个进程所有的 namespace</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：cgroup"><a href="#知识点：cgroup" class="headerlink" title="知识点：cgroup"></a>知识点：cgroup</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - control group</span><br><span class="line">  - 用来对进程进行资源限制</span><br><span class="line">  - 包括 CPU、MEM、磁盘 IO、网络带宽等</span><br><span class="line">  - 默认情况下，容器相当于可以使用宿主机的全部资源</span><br><span class="line"></span><br><span class="line">* 查看内核是否开启了 cgroup 功能</span><br><span class="line">  - cat /boot/config-3.10.0-1160.el7.x86_64 | grep CGROUP       &lt;== 查看内核是否开启了 cgroup 功能</span><br><span class="line">  - cat /boot/config-3.10.0-1160.el7.x86_64 | grep CONFIG_MEM   &lt;== 查看内核是否针对 MEM 开启了 cgroup 功能</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>cgroup 的具体实现</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 cgroup</span></span><br><span class="line">ll /sys/fs/cgroup</span><br><span class="line"></span><br><span class="line">blkio         # 块设备 IO 限制</span><br><span class="line">cpu           # 可以调控 task 对 cpu 的使用</span><br><span class="line">cpuacct       # 生成 task 对 cpu 资源使用情况的报告</span><br><span class="line">cpuset        # 针对多处理器的物理机，对 task 单独分配某个 cpu 和内存</span><br><span class="line">device        # 限制 task 对设备的访问，设备是指键盘、鼠标</span><br><span class="line">freezer       # 控制 task 的挂起和恢复，如不允许某个 task 使用 cpu 称之为挂起</span><br><span class="line">memory        # 控制 task 对内存使用量的限定，生成对内存资源使用的报告</span><br><span class="line">perf_event    # 对 task 可以进行统一的性能测试、检测、跟踪</span><br><span class="line">net_cls       # 在 docker 中没有直接被使用，标记网络数据包，从而允许 Linux 流量控制程序识别从具体 cgroup 中生成的数据包</span><br><span class="line">ns            # 命名空间</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="1-2-Docker-安装"><a href="#1-2-Docker-安装" class="headerlink" title="1.2 Docker 安装"></a>1.2 Docker 安装</h2><hr>
<h3 id="知识点：docker-安装需求"><a href="#知识点：docker-安装需求" class="headerlink" title="知识点：docker 安装需求"></a>知识点：docker 安装需求</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 安装需求</span><br><span class="line">  - 必须部署在 Linux 内核之上，windows 系统则需要先安装虚拟 Linux 环境</span><br><span class="line">  - 内核版本要求 3.8 以上，64bit</span><br><span class="line">  - yum 安装需要 centos-extras</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-yum-安装"><a href="#知识点：docker-yum-安装" class="headerlink" title="知识点：docker yum 安装"></a>知识点：docker yum 安装</h3><ol>
<li><strong>官方源安装</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">yum install yum-utils</span><br><span class="line">yum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 docker 版本</span></span><br><span class="line">yum list docker-ce --showduplicate | sort -r</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装 docker</span></span><br><span class="line">yum install docker-ce</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>阿里源安装</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装指导 https://developer.aliyun.com/mirror/docker-ce?spm=a2c6h.13651102.0.0.57e31b11AJtYxU</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step 1，安装必要的一些系统工具</span></span><br><span class="line">yum install yum-utils device-mapper-persistent-data lvm2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Step 2，添加阿里云 docker-ce repo</span></span><br><span class="line">yum-config-manager --add-repo https://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br><span class="line">sed -i &#x27;s+download.docker.com+mirrors.aliyun.com/docker-ce+&#x27; /etc/yum.repos.d/docker-ce.repo</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Step 3，更新并安装 docker-ce</span></span><br><span class="line">yum makecache fast</span><br><span class="line">yum install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Step 4，启动 docker 服务</span></span><br><span class="line">systemctl start docker</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装指定版本的 docker-ce</span></span><br><span class="line">yum enable docker-ce-test</span><br><span class="line">yum list docker-ce.x86_64 --showduplicates | sort -r</span><br><span class="line">yum install docker-ce-[VERSION]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-apt-安装"><a href="#知识点：docker-apt-安装" class="headerlink" title="知识点：docker apt 安装"></a>知识点：docker apt 安装</h3><ol>
<li><strong>阿里源安装</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> step 1，安装必要的一些系统工具</span></span><br><span class="line">apt-get update</span><br><span class="line">apt-get install apt-transport-https ca-certificates curl software-properties-common</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step 2，安装 GPG 证书</span></span><br><span class="line">curl -fsSL https://mirrors.aliyun.com/docker-ce/linux/ubuntu/gpg | apt-key add -</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Step 3，添加阿里云 docker-ce repo</span></span><br><span class="line">add-apt-repository &quot;deb [arch=amd64] https://mirrors.aliyun.com/docker-ce/linux/ubuntu $(lsb_release -cs) stable&quot;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> step 3.1 ubuntu24.04 需要额外添加秘钥</span></span><br><span class="line">cp /etc/apt/trusted.gpg /etc/apt/trusted.gpg.d</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Step 4，更新并安装 docker-ce</span></span><br><span class="line">apt-get update</span><br><span class="line">apt-get install docker-ce docker-ce-cli containerd.io docker-buildx-plugin docker-compose-plugin</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-二进制安装"><a href="#知识点：docker-二进制安装" class="headerlink" title="知识点：docker 二进制安装"></a>知识点：docker 二进制安装</h3><ol>
<li><strong>安装 docker</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载 docker 安装包</span></span><br><span class="line">wget https://download.docker.com/linux/static/stable/x86_64/docker-27.2.1.tgz</span><br><span class="line">wget https://download.docker.com/linux/static/stable/aarch64/docker-27.2.1.tgz</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解压安装包</span></span><br><span class="line">tar xf docker-27.2.1.tgz</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将程序拷贝到 /usr/bin 下</span></span><br><span class="line">chown -R root:root docker</span><br><span class="line">cp -a docker/* /usr/bin/</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>配置 docker service</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> vim /usr/lib/systemd/system/docker.service</span></span><br><span class="line">[Unit]</span><br><span class="line">Description=Docker Application Container Engine</span><br><span class="line">Documentation=https://docs.docker.com</span><br><span class="line">After=network-online.target firewalld.service</span><br><span class="line">Wants=network-online.target</span><br><span class="line"></span><br><span class="line">[Service]</span><br><span class="line">Type=notify</span><br><span class="line">ExecStart=/usr/bin/dockerd</span><br><span class="line">ExecReload=/bin/kill -s HUP $MAINPID</span><br><span class="line">LimitNOFILE=infinity</span><br><span class="line">LimitNPROC=infinity</span><br><span class="line">TimeoutStartSec=0</span><br><span class="line">Delegate=yes</span><br><span class="line">KillMode=process</span><br><span class="line">Restart=on-failure</span><br><span class="line">StartLimitBurst=3</span><br><span class="line">StartLimitInterval=60s</span><br><span class="line"></span><br><span class="line">[Install]</span><br><span class="line">WantedBy=multi-user.target</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>启动 docker</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动 docker service</span></span><br><span class="line">systemctl daemon-reload</span><br><span class="line">systemctl start docker</span><br><span class="line">systemctl enable docker</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 检查 docker</span></span><br><span class="line">docker info</span><br><span class="line">docker run hello-world</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-卸载"><a href="#知识点：docker-卸载" class="headerlink" title="知识点：docker 卸载"></a>知识点：docker 卸载</h3><ol>
<li><strong>yum 卸载 docker</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">systemctl stop docker</span><br><span class="line">yum remove docker-ce docker-ce-cli containerd.io</span><br><span class="line">rm -rf /var/lib/docker /var/lib/containerd</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="1-3-Docker-服务端"><a href="#1-3-Docker-服务端" class="headerlink" title="1.3 Docker 服务端"></a>1.3 Docker 服务端</h2><hr>
<h3 id="知识点：dockerd-介绍"><a href="#知识点：dockerd-介绍" class="headerlink" title="知识点：dockerd 介绍"></a>知识点：dockerd 介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - dockerd 是 docker 的服务端进程</span><br><span class="line">  - 用来接受客户端的指令，管理和监控容器</span><br><span class="line">  - 正常情况下，dockerd 停止时，会停止所有 running 的容器</span><br><span class="line">  - dockerd 启动时，会自动配置 iptables；dockerd 停止时，不会从 iptables 里删除规则</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>基础选项</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* --help</span><br><span class="line">* -v, --version</span><br><span class="line">  - 查看帮助信息、版本信息</span><br><span class="line"></span><br><span class="line">* --validate</span><br><span class="line">  - 仅检查 daemod.json 文件的语法，不启动 dockerd</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>未整理选项</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line">    --add-runtime runtime                   Register an additional OCI compatible runtime (default [])</span><br><span class="line">    --allow-nondistributable-artifacts list Allow push of nondistributable artifacts to registry</span><br><span class="line">    --api-cors-header string                Set CORS headers in the Engine API</span><br><span class="line">    --authorization-plugin list             Authorization plugins to load</span><br><span class="line">    --bip string                            Specify network bridge IP</span><br><span class="line">-b, --bridge string                         Attach containers to a network bridge</span><br><span class="line">    --cdi-spec-dir list                     CDI specification directories to use</span><br><span class="line">    --cgroup-parent string                  Set parent cgroup for all containers</span><br><span class="line">    --config-file string                    Daemon configuration file (default &quot;/etc/docker/daemon.json&quot;)</span><br><span class="line">    --containerd string                     containerd grpc address</span><br><span class="line">    --containerd-namespace string           Containerd namespace to use (default &quot;moby&quot;)</span><br><span class="line">    --containerd-plugins-namespace string   Containerd namespace to use for plugins (default &quot;plugins.moby&quot;)</span><br><span class="line">    --cpu-rt-period int                     Limit the CPU real-time period in microseconds for the parent cgroup for all containers (not supported with cgroups v2)</span><br><span class="line">    --cpu-rt-runtime int                    Limit the CPU real-time runtime in microseconds for the parent cgroup for all containers (not supported with cgroups v2)</span><br><span class="line">    --cri-containerd                        start containerd with cri</span><br><span class="line">-D, --debug                                 Enable debug mode</span><br><span class="line">    --default-address-pool pool-options     Default address pools for node specific local networks</span><br><span class="line">    --default-cgroupns-mode string          Default mode for containers cgroup namespace (&quot;host&quot; | &quot;private&quot;) (default &quot;private&quot;)</span><br><span class="line">    --default-gateway ip                    Container default gateway IPv4 address</span><br><span class="line">    --default-gateway-v6 ip                 Container default gateway IPv6 address</span><br><span class="line">    --default-ipc-mode string               Default mode for containers ipc (&quot;shareable&quot; | &quot;private&quot;) (default &quot;private&quot;)</span><br><span class="line">    --default-network-opt mapmap            Default network options (default map[])</span><br><span class="line">    --default-runtime string                Default OCI runtime for containers (default &quot;runc&quot;)</span><br><span class="line">    --default-shm-size bytes                Default shm size for containers (default 64MiB)</span><br><span class="line">    --default-ulimit ulimit                 Default ulimits for containers (default [])</span><br><span class="line">    --dns list                              DNS server to use</span><br><span class="line">    --dns-opt list                          DNS options to use</span><br><span class="line">    --dns-search list                       DNS search domains to use</span><br><span class="line">    --exec-opt list                         Runtime execution options</span><br><span class="line">    --exec-root string                      Root directory for execution state files (default &quot;/var/run/docker&quot;)</span><br><span class="line">    --experimental                          Enable experimental features</span><br><span class="line">    --feature map                           Enable feature in the daemon</span><br><span class="line">    --fixed-cidr string                     IPv4 subnet for fixed IPs</span><br><span class="line">    --fixed-cidr-v6 string                  IPv6 subnet for fixed IPs</span><br><span class="line">-G, --group string                          Group for the unix socket (default &quot;docker&quot;)</span><br><span class="line">    --host-gateway-ip ip                    IP address that the special &#x27;host-gateway&#x27; string in --add-host resolves to. Defaults to the IP address of the default bridge</span><br><span class="line">    --icc                                   Enable inter-container communication (default true)</span><br><span class="line">    --init                                  Run an init in the container to forward signals and reap processes</span><br><span class="line">    --init-path string                      Path to the docker-init binary</span><br><span class="line">    --insecure-registry list                Enable insecure registry communication</span><br><span class="line">    --ip ip                                 Default IP when binding container ports (default 0.0.0.0)</span><br><span class="line">    --ip-forward                            Enable net.ipv4.ip_forward (default true)</span><br><span class="line">    --ip-masq                               Enable IP masquerading (default true)</span><br><span class="line">    --ip6tables                             Enable addition of ip6tables rules (experimental)</span><br><span class="line">    --iptables                              Enable addition of iptables rules (default true)</span><br><span class="line">    --ipv6                                  Enable IPv6 networking</span><br><span class="line">    --label list                            Set key=value labels to the daemon</span><br><span class="line">    --live-restore                          Enable live restore of docker when containers are still running</span><br><span class="line">    --log-driver string                     Default driver for container logs (default &quot;json-file&quot;)</span><br><span class="line">    --log-format string                     Set the logging format (&quot;text&quot;|&quot;json&quot;) (default &quot;text&quot;)</span><br><span class="line">-l, --log-level string                      Set the logging level (&quot;debug&quot;|&quot;info&quot;|&quot;warn&quot;|&quot;error&quot;|&quot;fatal&quot;) (default &quot;info&quot;)</span><br><span class="line">    --log-opt map                           Default log driver options for containers (default map[])</span><br><span class="line">    --max-concurrent-downloads int          Set the max concurrent downloads (default 3)</span><br><span class="line">    --max-concurrent-uploads int            Set the max concurrent uploads (default 5)</span><br><span class="line">    --max-download-attempts int             Set the max download attempts for each pull (default 5)</span><br><span class="line">    --metrics-addr string                   Set default address and port to serve the metrics api on</span><br><span class="line">    --mtu int                               Set the containers network MTU (default 1500)</span><br><span class="line">    --network-control-plane-mtu int         Network Control plane MTU (default 1500)</span><br><span class="line">    --no-new-privileges                     Set no-new-privileges by default for new containers</span><br><span class="line">    --node-generic-resource list            Advertise user-defined resource</span><br><span class="line">    --oom-score-adjust int                  Set the oom_score_adj for the daemon</span><br><span class="line">-p, --pidfile string                        Path to use for daemon PID file (default &quot;/var/run/docker.pid&quot;)</span><br><span class="line">    --raw-logs                              Full timestamps without ANSI coloring</span><br><span class="line">    --registry-mirror list                  Preferred registry mirror</span><br><span class="line">    --rootless                              Enable rootless mode; typically used with RootlessKit</span><br><span class="line">    --seccomp-profile string                Path to seccomp profile. Use &quot;unconfined&quot; to disable the default seccomp profile (default &quot;builtin&quot;)</span><br><span class="line">    --selinux-enabled                       Enable selinux support</span><br><span class="line">    --shutdown-timeout int                  Set the default shutdown timeout (default 15)</span><br><span class="line">-s, --storage-driver string                 Storage driver to use</span><br><span class="line">    --storage-opt list                      Storage driver options</span><br><span class="line">    --swarm-default-advertise-addr string   Set default address or interface for swarm advertised address</span><br><span class="line">    --tls                                   Use TLS; implied by --tlsverify</span><br><span class="line">    --tlscacert string                      Trust certs signed only by this CA (default &quot;~/.docker/ca.pem&quot;)</span><br><span class="line">    --tlscert string                        Path to TLS certificate file (default &quot;~/.docker/cert.pem&quot;)</span><br><span class="line">    --tlskey string                         Path to TLS key file (default &quot;~/.docker/key.pem&quot;)</span><br><span class="line">    --tlsverify                             Use TLS and verify the remote</span><br><span class="line">    --userland-proxy                        Use userland proxy for loopback traffic (default true)</span><br><span class="line">    --userland-proxy-path string            Path to the userland proxy binary</span><br><span class="line">    --userns-remap string                   User/Group setting for user namespaces</span><br><span class="line">    --validate                              Validate daemon configuration and exit</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>环境变量</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">DOCKER_CERT_PATH    Location of your authentication keys. This variable is used both by the docker CLI and the dockerd daemon.</span><br><span class="line">DOCKER_DRIVER       The storage driver to use.</span><br><span class="line">DOCKER_RAMDISK      If set this disables pivot_root.</span><br><span class="line">DOCKER_TLS_VERIFY   When set Docker uses TLS and verifies the remote. This variable is used both by the docker CLI and the dockerd daemon.</span><br><span class="line">DOCKER_TMPDIR       Location for temporary files created by the daemon.</span><br><span class="line">HTTP_PROXY          Proxy URL for HTTP requests unless overridden by NoProxy. See the Go specification for details.</span><br><span class="line">HTTPS_PROXY         Proxy URL for HTTPS requests unless overridden by NoProxy. See the Go specification for details.</span><br><span class="line">MOBY_DISABLE_PIGZ   Disables the use of unpigz to decompress layers in parallel when pulling images, even if it is installed.</span><br><span class="line">NO_PROXY            Comma-separated values specifying hosts that should be excluded from proxying. See the Go specification for details.</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：dockerd-配置文件"><a href="#知识点：dockerd-配置文件" class="headerlink" title="知识点：dockerd 配置文件"></a>知识点：dockerd 配置文件</h3><ol>
<li><strong>介绍介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">* dockerd 的配置</span><br><span class="line">  - dockerd 有两种配置方式</span><br><span class="line">  - 一种是在启动 dockerd 时直接指定 dockerd 的选项</span><br><span class="line">  - 一种是在 dockerd 的配置文中指定</span><br><span class="line">  - 如果两种方式发生冲突，则 dockerd 无法启动</span><br><span class="line"></span><br><span class="line">* /etc/docker/daemon.json</span><br><span class="line">  - dockerd 的配置文件</span><br><span class="line">  - 配置项本身也就是 dockerd 程序的选项，可以通过 dockerd --help 进行查看</span><br><span class="line">  - 修改 daemon.json 后，需要重启 dockerd 才能生效</span><br><span class="line"></span><br><span class="line">* 配置格式</span><br><span class="line">  - 对于 &quot;--OPTION VALUE&quot; 格式的 dockerd 选项，在配置文件中的配置格式为 &quot;OPTION: VALUE&quot;</span><br><span class="line">  - 对于 &quot;--OPTION&quot; 格式的 dockerd 选项，在配置文件中的配置格式为 &quot;OPTION: true&quot; 或 &quot;OPTION: false&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>官方配置范例</strong><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;allow-nondistributable-artifacts&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;api-cors-header&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;authorization-plugins&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;bip&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;bridge&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;builder&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;gc&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;enabled&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">      <span class="attr">&quot;defaultKeepStorage&quot;</span>: <span class="string">&quot;10GB&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;policy&quot;</span>: [</span><br><span class="line">        &#123; <span class="attr">&quot;keepStorage&quot;</span>: <span class="string">&quot;10GB&quot;</span>, <span class="attr">&quot;filter&quot;</span>: [<span class="string">&quot;unused-for=2200h&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;keepStorage&quot;</span>: <span class="string">&quot;50GB&quot;</span>, <span class="attr">&quot;filter&quot;</span>: [<span class="string">&quot;unused-for=3300h&quot;</span>] &#125;,</span><br><span class="line">        &#123; <span class="attr">&quot;keepStorage&quot;</span>: <span class="string">&quot;100GB&quot;</span>, <span class="attr">&quot;all&quot;</span>: <span class="literal">true</span> &#125;</span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;cgroup-parent&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;containerd&quot;</span>: <span class="string">&quot;/run/containerd/containerd.sock&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;containerd-namespace&quot;</span>: <span class="string">&quot;docker&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;containerd-plugins-namespace&quot;</span>: <span class="string">&quot;docker-plugins&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;data-root&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;debug&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;default-address-pools&quot;</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;base&quot;</span>: <span class="string">&quot;172.30.0.0/16&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;size&quot;</span>: <span class="number">24</span></span><br><span class="line">    &#125;,</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="attr">&quot;base&quot;</span>: <span class="string">&quot;172.31.0.0/16&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;size&quot;</span>: <span class="number">24</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;default-cgroupns-mode&quot;</span>: <span class="string">&quot;private&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;default-gateway&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;default-gateway-v6&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;default-network-opts&quot;</span>: &#123;&#125;,</span><br><span class="line">  <span class="attr">&quot;default-runtime&quot;</span>: <span class="string">&quot;runc&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;default-shm-size&quot;</span>: <span class="string">&quot;64M&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;default-ulimits&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;nofile&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;Hard&quot;</span>: <span class="number">64000</span>,</span><br><span class="line">      <span class="attr">&quot;Name&quot;</span>: <span class="string">&quot;nofile&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;Soft&quot;</span>: <span class="number">64000</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;dns&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;dns-opts&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;dns-search&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;exec-opts&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;exec-root&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;experimental&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;features&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;cdi&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">    <span class="attr">&quot;containerd-snapshotter&quot;</span>: <span class="literal">true</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;fixed-cidr&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;fixed-cidr-v6&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;group&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;host-gateway-ip&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;hosts&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;proxies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;http-proxy&quot;</span>: <span class="string">&quot;http://proxy.example.com:80&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;https-proxy&quot;</span>: <span class="string">&quot;https://proxy.example.com:443&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;no-proxy&quot;</span>: <span class="string">&quot;*.test.example.com,.example.org&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;icc&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;init&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;init-path&quot;</span>: <span class="string">&quot;/usr/libexec/docker-init&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;insecure-registries&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;ip&quot;</span>: <span class="string">&quot;0.0.0.0&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;ip-forward&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;ip-masq&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;iptables&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;ip6tables&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;ipv6&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;labels&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;live-restore&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;log-driver&quot;</span>: <span class="string">&quot;json-file&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;log-format&quot;</span>: <span class="string">&quot;text&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;log-level&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;log-opts&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;cache-disabled&quot;</span>: <span class="string">&quot;false&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;cache-max-file&quot;</span>: <span class="string">&quot;5&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;cache-max-size&quot;</span>: <span class="string">&quot;20m&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;cache-compress&quot;</span>: <span class="string">&quot;true&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;env&quot;</span>: <span class="string">&quot;os,customer&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;labels&quot;</span>: <span class="string">&quot;somelabel&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;max-file&quot;</span>: <span class="string">&quot;5&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;max-size&quot;</span>: <span class="string">&quot;10m&quot;</span></span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;max-concurrent-downloads&quot;</span>: <span class="number">3</span>,</span><br><span class="line">  <span class="attr">&quot;max-concurrent-uploads&quot;</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="attr">&quot;max-download-attempts&quot;</span>: <span class="number">5</span>,</span><br><span class="line">  <span class="attr">&quot;mtu&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;no-new-privileges&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;node-generic-resources&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;NVIDIA-GPU=UUID1&quot;</span>,</span><br><span class="line">    <span class="string">&quot;NVIDIA-GPU=UUID2&quot;</span></span><br><span class="line">  ],</span><br><span class="line">  <span class="attr">&quot;oom-score-adjust&quot;</span>: <span class="number">0</span>,</span><br><span class="line">  <span class="attr">&quot;pidfile&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;raw-logs&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;registry-mirrors&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;runtimes&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;cc-runtime&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/usr/bin/cc-runtime&quot;</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="attr">&quot;custom&quot;</span>: &#123;</span><br><span class="line">      <span class="attr">&quot;path&quot;</span>: <span class="string">&quot;/usr/local/bin/my-runc-replacement&quot;</span>,</span><br><span class="line">      <span class="attr">&quot;runtimeArgs&quot;</span>: [</span><br><span class="line">        <span class="string">&quot;--debug&quot;</span></span><br><span class="line">      ]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;,</span><br><span class="line">  <span class="attr">&quot;seccomp-profile&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;selinux-enabled&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;shutdown-timeout&quot;</span>: <span class="number">15</span>,</span><br><span class="line">  <span class="attr">&quot;storage-driver&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;storage-opts&quot;</span>: [],</span><br><span class="line">  <span class="attr">&quot;swarm-default-advertise-addr&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;tls&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;tlscacert&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;tlscert&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;tlskey&quot;</span>: <span class="string">&quot;&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;tlsverify&quot;</span>: <span class="literal">true</span>,</span><br><span class="line">  <span class="attr">&quot;userland-proxy&quot;</span>: <span class="literal">false</span>,</span><br><span class="line">  <span class="attr">&quot;userland-proxy-path&quot;</span>: <span class="string">&quot;/usr/libexec/docker-proxy&quot;</span>,</span><br><span class="line">  <span class="attr">&quot;userns-remap&quot;</span>: <span class="string">&quot;&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：data-root-配置"><a href="#知识点：data-root-配置" class="headerlink" title="知识点：data-root 配置"></a>知识点：data-root 配置</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 配置 dockerd 的数据存储的目录</span><br><span class="line">  - 数据包括 containers、images、volumes、service definition、secrets</span><br><span class="line">  - 默认值为 /var/lib/docker</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  &quot;data-root&quot;: &quot;PATH&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;data-root&quot;</span>: <span class="string">&quot;/data1/docker&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：registry-mirrors-配置"><a href="#知识点：registry-mirrors-配置" class="headerlink" title="知识点：registry-mirrors 配置"></a>知识点：registry-mirrors 配置</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 指定 docker hub 的镜像站地址</span><br><span class="line">  </span><br></pre></td></tr></table></figure></li>
<li><strong>阿里云源</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 阿里云会给每一个账号分配一个唯一的 docker 镜像加速地址</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 阿里云 --&gt; 控制台 --&gt; 容器镜像服务 --&gt; 镜像加速器</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> https://&lt;你的ID&gt;.mirror.aliyuncs.com</span></span><br><span class="line"></span><br><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line"></span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;XXXX&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line">sudo systemctl restart docker</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>其他源</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 科大：https://docker.mirrors.ustc.edu.cn</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 网易：https://hub-mirror.c.163.com</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 七牛：https://reg-mirror.qiniu.com</span></span><br><span class="line"></span><br><span class="line">vim /etc/docker/daemon.json</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [</span><br><span class="line">    &quot;https://docker.mirrors.ustc.edu.cn&quot;,</span><br><span class="line">    &quot;https://hub-mirror.c.163.com&quot;,</span><br><span class="line">    &quot;https://reg-mirror.qiniu.com&quot;</span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：insecure-registry-配置"><a href="#知识点：insecure-registry-配置" class="headerlink" title="知识点：insecure-registry 配置"></a>知识点：insecure-registry 配置</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* secure registry 和 insecure registry</span><br><span class="line">  - secure registry，就是指采用了 tls 加密，并且其 CA certificate 放在了 /etc/docker/certs.d/&lt;REGISTRY&gt;/ca.crt 的仓库</span><br><span class="line">  - 其他的情况，都是 insecure registry</span><br><span class="line"></span><br><span class="line">* insecure-registry 配置介绍</span><br><span class="line">  - 默认情况下，docker 禁止对 insecure registry 的访问，因为 docker 默认所有的仓库都是 insecure registry</span><br><span class="line">  - 只有在 insecure-registry 配置中添加了相关的仓库，docker 才会允许对此 insecure registry 的访问</span><br><span class="line">  - 配置方式有两种</span><br><span class="line">    - myregistry:5000，指定仓库的地址，则此仓库会被 docker 识别为 insecure registry</span><br><span class="line">    - 10.1.0.0/16，指定一个 CIDR 网段，则此网段的仓库都会被识别为 insecure registry</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;insecure-registry&quot;</span>: [</span><br><span class="line">    <span class="string">&quot;myregistry:5000&quot;</span>,</span><br><span class="line">    <span class="string">&quot;10.1.0.0/16&quot;</span></span><br><span class="line">    ]</span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：http-proxy、https-proxy、no-proxy-配置"><a href="#知识点：http-proxy、https-proxy、no-proxy-配置" class="headerlink" title="知识点：http-proxy、https-proxy、no-proxy 配置"></a>知识点：http-proxy、https-proxy、no-proxy 配置</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 配置 dockerd 的代理，如拉取镜像等</span><br><span class="line">  - 不涉及容器使用的代理</span><br><span class="line">  - 需要放在 proxies 关键字下</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  &quot;http-proxy&quot;: &quot;URL&quot;</span><br><span class="line">  &quot;https-proxy&quot;: &quot;URL&quot;</span><br><span class="line">  &quot;no-proxy&quot;: &quot;URL&quot;</span><br><span class="line"></span><br><span class="line">* http-proxy</span><br><span class="line">* https-proxy</span><br><span class="line">  - 配置 dockerd 使用的 http、https 代理</span><br><span class="line"></span><br><span class="line">* no-proxy</span><br><span class="line">  - 配置不走代理的 URL</span><br><span class="line">  - 多个 URL 则使用逗号间隔，不能有空格</span><br><span class="line">  - 支持使用 ip 地址、ip 网段、域名、*.example.com 格式域名、.example.org 格式域名、带端口</span><br><span class="line"></span><br><span class="line">* 环境变量</span><br><span class="line">  - dockerd 也读取环境中相关环境变量的配置，HTTP_PROXY、http_proxy、HTTPS_PROXY、https_proxy、NO_PROXY、no_proxy</span><br><span class="line">  - 环境变量的优先级低于 daemon.json 里的配置</span><br><span class="line">  - 可以在 docker 的 service 文件中添加相关的环境变量</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>配置范例</strong><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;proxies&quot;</span>: &#123;</span><br><span class="line">    <span class="attr">&quot;http-proxy&quot;</span>: <span class="string">&quot;http://proxy.example.com:3128&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;https-proxy&quot;</span>: <span class="string">&quot;https://proxy.example.com:3129&quot;</span>,</span><br><span class="line">    <span class="attr">&quot;no-proxy&quot;</span>: <span class="string">&quot;*.test.example.com,.example.org,127.0.0.0/8&quot;</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li><strong>service 环境变量范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> vim /usr/lib/systemd/system/docker.service.d/proxy.conf</span></span><br><span class="line">[service]</span><br><span class="line">Environment=HTTP_PROXY=http://192.168.174.1:4780</span><br><span class="line">Environment=HTTPS_PROXY=http://192.168.174.1:4780</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：metrics-addr-配置"><a href="#知识点：metrics-addr-配置" class="headerlink" title="知识点：metrics-addr 配置"></a>知识点：metrics-addr 配置</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 配置 dockerd 生产 prometheus 指标，并映射出相应的采集地址</span><br><span class="line">  - 对应了 dockerd 的 &quot;--metrics-addr&quot; 选项</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  &quot;metrics-addr&quot;: &quot;IP:PORT&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;metrics-addr&quot;</span>: <span class="string">&quot;0.0.0.0:9323&quot;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：hosts-配置"><a href="#知识点：hosts-配置" class="headerlink" title="知识点：hosts 配置"></a>知识点：hosts 配置</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - dockerd 可以接受三种 socket 发来的客户端指令：unix、tcp、fd</span><br><span class="line">  - 默认情况下，dockerd 只接受通过 sock 文件发来的客户端指令，unix:///var/run/docker.sock</span><br><span class="line">  - 使用 hosts 配置，可以配置 dockerd 接受从网络发来的指令</span><br><span class="line">  - 对应了 dockerd 的 &quot;-H&quot;、&quot;--host&quot; 选项</span><br><span class="line">  - 比较危险，须谨慎使用</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">&quot;hosts&quot;</span>: [<span class="string">&quot;unix:///var/run/docker.sock&quot;</span>, <span class="string">&quot;tcp://0.0.0.0:2375&quot;</span>]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="1-4-Docker-客户端"><a href="#1-4-Docker-客户端" class="headerlink" title="1.4 Docker 客户端"></a>1.4 Docker 客户端</h2><hr>
<h3 id="知识点：docker-客户端"><a href="#知识点：docker-客户端" class="headerlink" title="知识点：docker 客户端"></a>知识点：docker 客户端</h3><ol>
<li><strong>配置文件</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - ~/.docker/config.json 是 docker 命令行的默认配置文件</span><br><span class="line">  </span><br></pre></td></tr></table></figure></li>
<li><strong>环境变量</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">DOCKER_API_VERSION            Override the negotiated API version to use for debugging (e.g. 1.19)</span><br><span class="line">DOCKER_CERT_PATH              Location of your authentication keys. This variable is used both by the docker CLI and the dockerd daemon</span><br><span class="line">DOCKER_CONFIG                 The location of your client configuration files.</span><br><span class="line">DOCKER_CONTENT_TRUST_SERVER   The URL of the Notary server to use. Defaults to the same URL as the registry.</span><br><span class="line">DOCKER_CONTENT_TRUST          When set Docker uses notary to sign and verify images. Equates to --disable-content-trust=false for build, create, pull, push, run.</span><br><span class="line">DOCKER_CONTEXT                Name of the docker context to use (overrides DOCKER_HOST env var and default context set with docker context use)</span><br><span class="line">DOCKER_CUSTOM_HEADERS         (Experimental) Configure custom HTTP headers to be sent by the client. Headers must be provided as a comma-separated list of name=value pairs. This is the equivalent to the HttpHeaders field in the configuration file.</span><br><span class="line">DOCKER_DEFAULT_PLATFORM       Default platform for commands that take the --platform flag.</span><br><span class="line">DOCKER_HIDE_LEGACY_COMMANDS   When set, Docker hides &quot;legacy&quot; top-level commands (such as docker rm, and docker pull) in docker help output, and only Management commands per object-type (e.g., docker container) are printed. This may become the default in a future release.</span><br><span class="line">DOCKER_HOST                   Daemon socket to connect to.</span><br><span class="line">DOCKER_TLS                    Enable TLS for connections made by the docker CLI (equivalent of the --tls command-line option). Set to a non-empty value to enable TLS. Note that TLS is enabled automatically if any of the other TLS options are set.</span><br><span class="line">DOCKER_TLS_VERIFY             When set Docker uses TLS and verifies the remote. This variable is used both by the docker CLI and the dockerd daemon</span><br><span class="line">BUILDKIT_PROGRESS             Set type of progress output (auto, plain, tty, rawjson) when building with BuildKit backend. Use plain to show container output (default auto).</span><br><span class="line"></span><br><span class="line">HTTP_PROXY      Proxy URL for HTTP requests unless overridden by NoProxy.</span><br><span class="line">HTTPS_PROXY     Proxy URL for HTTPS requests unless overridden by NoProxy.</span><br><span class="line">NO_PROXY        Comma-separated values specifying hosts that should be excluded from proxying.</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>命令补全</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> Bash On Linux:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> apt install bash-completion</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum install bash-completion</span></span><br><span class="line">cat &lt;&lt;EOT &gt;&gt; ~/.bashrc</span><br><span class="line">if [ -f /etc/bash_completion ]; then</span><br><span class="line">    . /etc/bash_completion</span><br><span class="line">fi</span><br><span class="line">EOT</span><br><span class="line"></span><br><span class="line">mkdir -p ~/.local/share/bash-completion/completions</span><br><span class="line">docker completion bash &gt; ~/.local/share/bash-completion/completions/docker</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–filter-选项"><a href="#知识点：–filter-选项" class="headerlink" title="知识点：–filter 选项"></a>知识点：–filter 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 部分 docker 命令行指令支持使用 &quot;--filter&quot; 选项对结果进行筛选</span><br><span class="line">  - &quot;--filter&quot; 选项的格式采用 kv 对的方式</span><br><span class="line">  - 多个 &quot;--filter&quot; 选项为 OR 逻辑，多个 &quot;!=&quot; 条件则为 AND 逻辑</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  --filter key</span><br><span class="line">  --filter key=value</span><br><span class="line">  --filter key!=value</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–format-选项和-GoTemplate"><a href="#知识点：–format-选项和-GoTemplate" class="headerlink" title="知识点：–format 选项和 GoTemplate"></a>知识点：–format 选项和 GoTemplate</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 部分 docker 命令行指令支持在 &quot;--format&quot; 选项中使用 GoTemplate 对输出进行格式化</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">* join</span><br><span class="line">  - 使用分隔符将多个字符串连接为单个字符串</span><br><span class="line">  - 范例：--format &#x27;&#123;&#123;join .Args &quot; , &quot;&#125;&#125;&#x27;</span><br><span class="line"></span><br><span class="line">* table</span><br><span class="line">  - 以表格的形式打印每一列</span><br><span class="line">  - 范例：--format &quot;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Repository&#125;&#125;\t&#123;&#123;.Tag&#125;&#125;\t&#123;&#123;.Size&#125;&#125;&quot;</span><br><span class="line"></span><br><span class="line">* json</span><br><span class="line">  - 将一个元素编码为 json 字符串</span><br><span class="line">  - 范例：--format &#x27;&#123;&#123;json .Mounts&#125;&#125;&#x27;</span><br><span class="line"></span><br><span class="line">* lower</span><br><span class="line">* upper</span><br><span class="line">  - 将一个字符串全部改成小写/大写</span><br><span class="line">  - 范例：--format &quot;&#123;&#123;lower .Name&#125;&#125;&quot;</span><br><span class="line"></span><br><span class="line">* title</span><br><span class="line">  - 将每个字符串都改成 title 格式</span><br><span class="line">  - 范例：--format &quot;&#123;&#123;title .Name&#125;&#125;&quot;</span><br><span class="line"></span><br><span class="line">* split</span><br><span class="line">  - 将一个字符串，按照指定的分隔符，切分为多个字符串，最终组成一个列表</span><br><span class="line">  - 范例：--format &#x27;&#123;&#123;split .Image &quot;:&quot;&#125;&#125;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–since、–until-选项"><a href="#知识点：–since、–until-选项" class="headerlink" title="知识点：–since、–until 选项"></a>知识点：–since、–until 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 部分 docker 指令，支持使用 --since、--until 来对输出进行基于时间的筛选</span><br><span class="line">  - --since、--until 支持三种方式的时间语法</span><br><span class="line"></span><br><span class="line">* Unix timestamps</span><br><span class="line">  - 基于 1970-01-01 的描述</span><br><span class="line"></span><br><span class="line">* date formatted timestamps</span><br><span class="line">  - RFC3339Nano、RFC3339 时间格式</span><br><span class="line">  - 2006-01-02</span><br><span class="line">  - 2006-01-02T07:00</span><br><span class="line">  - 2006-01-02T15:04:05</span><br><span class="line">  - 2006-01-02T15:04:05.999999999</span><br><span class="line"></span><br><span class="line">* Go duration strings</span><br><span class="line">  - 10m</span><br><span class="line">  - 1h30m)</span><br><span class="line"></span><br><span class="line">* 时区</span><br><span class="line">  - 只有 date formatted timestamps 需要指定时区</span><br><span class="line">  - 默认采用 local 时区</span><br><span class="line">  - 通过在末尾添加 Z 或 +-00:00 timezone offset 来指定时区</span><br><span class="line">  </span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="1-5-Docker-系统级指令"><a href="#1-5-Docker-系统级指令" class="headerlink" title="1.5 Docker 系统级指令"></a>1.5 Docker 系统级指令</h2><hr>
<h3 id="知识点：docker-help"><a href="#知识点：docker-help" class="headerlink" title="知识点：docker help"></a>知识点：docker help</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 查看 docker cli 指令的帮助</span><br><span class="line">  - 查看 docker cli 子命令的帮助</span><br><span class="line">  - 与所有子命令的 &quot;--help&quot; 选项的功能相同</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker help</span><br><span class="line">  docker help SUBCMD</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 docker run 指令的帮助</span></span><br><span class="line">docker help run</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 docker network create 指令的帮助</span></span><br><span class="line">docker help network create</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-version"><a href="#知识点：docker-version" class="headerlink" title="知识点：docker version"></a>知识点：docker version</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 打印所有 docker 组件的版本信息</span><br><span class="line">  - 输出信息会分为两大块，Server 和 Client</span><br><span class="line">  - Client 部分会包含 docker cli 以及相关组件的版本信息</span><br><span class="line">  - Server 部分会包含 docker 服务端以及相关组件的版本信息，包括 docker engine、containerd、runc 等</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker version [OPTIONS]</span><br><span class="line"></span><br><span class="line">* -f, --format json</span><br><span class="line">  - 指定输出格式为 json</span><br><span class="line"></span><br><span class="line">* -f, --format GoTemplate</span><br><span class="line">  - 按照 GoTemplate 对输出信息进行过滤</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 docker 所有组件的版本信息</span></span><br><span class="line">docker version --format json | jq</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取 docker server 的版本信息</span></span><br><span class="line">docker version --format &#x27;&#123;&#123;.Server.Version&#125;&#125;&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取 docker client 的版本信息</span></span><br><span class="line">docker version --format &#x27;&#123;&#123;.Client.Version&#125;&#125;&#x27;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取 docker server 所有组件的版本信息</span></span><br><span class="line">docker version --format &#x27;&#123;&#123;json .Server.Components&#125;&#125;&#x27; | jq</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-info"><a href="#知识点：docker-info" class="headerlink" title="知识点：docker info"></a>知识点：docker info</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 查看 docker 的全局信息</span><br><span class="line">  - 包括核心版本、容器数量、镜像数量等</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker info [OPTIONS]</span><br><span class="line">  docker system info [OPTIONS]</span><br><span class="line"></span><br><span class="line">* -f, --format json</span><br><span class="line">  - 指定输出格式为 json</span><br><span class="line"></span><br><span class="line">* -f, --format GoTemplate</span><br><span class="line">  - 按照 GoTemplate 对输出信息进行过滤</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看当前配置的仓库地址</span></span><br><span class="line">docker info -f &#x27;&#123;&#123;json .RegistryConfig.Mirrors&#125;&#125;&#x27; | jq --indent 4</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-inspect"><a href="#知识点：docker-inspect" class="headerlink" title="知识点：docker inspect"></a>知识点：docker inspect</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 查看 docker 中一个对象的详细信息</span><br><span class="line">  - 对于不同的对象类型，支持不同的子命令</span><br><span class="line">    - docker container inspect</span><br><span class="line">    - docker image inspect</span><br><span class="line">    - docker network inspect</span><br><span class="line">    - docker volume inspect</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker inspect [OPTIONS] NAME|ID [NAME|ID...]</span><br><span class="line"></span><br><span class="line">* NAME|ID</span><br><span class="line">  - 指定需要查看的对象</span><br><span class="line">  - 对于容器，可以是 ContainerID、ContainerName</span><br><span class="line">  - 对于镜像，可以是 ImageId、ImageName</span><br><span class="line"></span><br><span class="line">* -f, --format json</span><br><span class="line">  - 采取 json 格式输出</span><br><span class="line"></span><br><span class="line">* -f, --format GoTemplate</span><br><span class="line">  - 按照 GoTemplate 对输出信息进行过滤</span><br><span class="line"></span><br><span class="line">* --type container|image|node|network|secret|service|volume|task|plugin</span><br><span class="line">  - 用来指定对象的类型，对于多个不同类型的对象具有同样的 name 时</span><br><span class="line"></span><br><span class="line">* -s, --size</span><br><span class="line">  - 只针对 container 类型的对象生效，在 inspect 原有的内容的基础上，额外输出两个信息</span><br><span class="line">  - SizeRootFs  容器的总的磁盘空间占用，包括只读层与可写层</span><br><span class="line">  - SizeRw      容器的可写层的磁盘空间占用</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看容器的全部信息</span></span><br><span class="line">docker inspect -f json mysql01 | jq --indent 4</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看某个网络的全部信息</span></span><br><span class="line">docker network inspect -f json mynet01 | jq --indent 4</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器的 ID</span></span><br><span class="line">docker inspect -f &#x27;&#123;&#123;.Id&#125;&#125;&#x27; mysql01</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器的端口绑定情况</span></span><br><span class="line">docker inspect -f &#x27;&#123;&#123;json .NetworkSettings.Ports&#125;&#125;&#x27; mysql01 | jq --indent 4</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器的可写层的磁盘使用情况</span></span><br><span class="line">docker inspect -s -f &#x27;&#123;&#123;json .SizeRootFs&#125;&#125;&#x27; mysql01 | jq --indent 4</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取容器的 ip 地址</span></span><br><span class="line">docker inspect -f &#x27;&#123;&#123;range .NetworkSettings.Networks&#125;&#125;&#123;&#123;.IPAddress&#125;&#125;&#123;&#123;end&#125;&#125;&#x27; mysql01</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-events"><a href="#知识点：docker-events" class="headerlink" title="知识点：docker events"></a>知识点：docker events</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 查看 docker events</span><br><span class="line">  - docker events 是 dockerd 的系统日志，里面记录了诸如 CONTAINER UP、CONTAINER CREATE 等的操作</span><br><span class="line">  - docker events 似乎每次 dockerd 重启都会被清空</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker events [OPTIONS]</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker system events</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">* --format json</span><br><span class="line">* --format GoTemplate</span><br><span class="line">  - 指定输出课时</span><br><span class="line"></span><br><span class="line">* --since string</span><br><span class="line">* --until string</span><br><span class="line">  - 默认情况下，docker events 只会查看 real-time 的记录</span><br><span class="line">  - 通过指定 &quot;--since&quot; 或 &quot;--until&quot;，可以查看历史 docker events</span><br><span class="line"></span><br><span class="line">* -f, --filter key=value</span><br><span class="line">  - 对 docker events 进行筛选</span><br><span class="line">  - 指定多个 key 相同的 filter，相当于 OR</span><br><span class="line">  - 指定多个 key 不同的 filter，相当于 AND</span><br><span class="line">  - 支持的 key 见 https://docs.docker.com/reference/cli/docker/system/events/#filter</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 20240101 以来的 docker events</span></span><br><span class="line">docker events --since 20240101</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-system-df"><a href="#知识点：docker-system-df" class="headerlink" title="知识点：docker system df"></a>知识点：docker system df</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 查看 docker 的磁盘占用情况</span><br><span class="line">  - 包括镜像的磁盘占用情况、容器的磁盘占用情况、卷的磁盘占用情况，等</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker system df [OPTIONS]</span><br><span class="line"></span><br><span class="line">* -v, --verbose</span><br><span class="line">  - 指定输出更详细的信息</span><br><span class="line"></span><br><span class="line">* --format table</span><br><span class="line">* --format json</span><br><span class="line">  - 指定输出格式</span><br><span class="line"></span><br><span class="line">* --format GoTemplate</span><br><span class="line">* --format table GoTemplate</span><br><span class="line">  - 指定输出格式，同时使用 GoTemplate 来过滤信息</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 docker 的磁盘占用情况</span></span><br><span class="line">docker system df -v</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看镜像的磁盘占用情况</span></span><br><span class="line">docker system df -v --format &#x27;&#123;&#123;json .Images&#125;&#125;&#x27; | jq --indent 4</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-system-prune"><a href="#知识点：docker-system-prune" class="headerlink" title="知识点：docker system prune"></a>知识点：docker system prune</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 删除 unused 容器、网络、虚悬镜像</span><br><span class="line">  - 在添加、卷</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker system prune [OPTIONS]</span><br><span class="line"></span><br><span class="line">* -f, --force</span><br><span class="line">  - 默认情况下，docker system prune 指令会要求用户进行确认</span><br><span class="line">  - 添加 &quot;-f&quot; 选项，则不需要用户进行确认，直接删除</span><br><span class="line"></span><br><span class="line">* -a, --all</span><br><span class="line">  - 默认情况下，只删除虚悬镜像，不会删除 unused 镜像</span><br><span class="line">  - 添加 &quot;-a&quot; 选项，unused 镜像也会被删除</span><br><span class="line"></span><br><span class="line">* --volumes</span><br><span class="line">  - 默认情况下，不会删除卷</span><br><span class="line">  - 指定 &quot;--volumes&quot; 选项，可以删除 unused 匿名卷</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 删除 unused 容器、网络和虚悬镜像</span></span><br><span class="line">docker system prune</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="Chapter02-Docker-容器"><a href="#Chapter02-Docker-容器" class="headerlink" title="Chapter02 Docker 容器"></a>Chapter02 Docker 容器</h1><hr>
<h2 id="2-1-Docker-容器介绍"><a href="#2-1-Docker-容器介绍" class="headerlink" title="2.1 Docker 容器介绍"></a>2.1 Docker 容器介绍</h2><hr>
<h3 id="知识点：容器介绍"><a href="#知识点：容器介绍" class="headerlink" title="知识点：容器介绍"></a>知识点：容器介绍</h3><ol start="2">
<li><strong>容器的标识符</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - docker 支持三种方式，来标志容器：</span><br><span class="line">    - 容器名</span><br><span class="line">    - UUID long identifier</span><br><span class="line">    - UUID short identifier，即 UUID long identifier 的前 12 个字符</span><br><span class="line"></span><br><span class="line">* UUID long identifier</span><br><span class="line">  - dockerd 分配给容器的随机 ID</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>容器的主进程</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 容器的本质，就是一个运行在宿主机上的进程，此进程为容器的主进程 main process</span><br><span class="line">  - 容器的其他所有进程，都是主进程的子进程</span><br><span class="line">  - 主进程的 pid 为 1</span><br><span class="line">  - 当主进程停止，也就意味着容器停止</span><br><span class="line"></span><br><span class="line">* 主进程在镜像中指定</span><br><span class="line">  - CMD</span><br><span class="line">  - ENTRYPOINT</span><br><span class="line"></span><br><span class="line">* 主进程的前台与后台</span><br><span class="line">  - 默认情况下，主进程都会占据当前终端的前台</span><br><span class="line">  - 通过指定 &quot;-d&quot; 选项，可以让主进程在后台运行</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：常见容器范例"><a href="#知识点：常见容器范例" class="headerlink" title="知识点：常见容器范例"></a>知识点：常见容器范例</h3><ol>
<li><strong>启动 ubuntu 容器</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">docker run -it -d --name=u01 ubuntu:latest</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>启动 mysql 容器</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 准备数据目录、日志目录</span></span><br><span class="line">mkdir -p /data/mysql01/&#123;data,logs&#125;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 准备配置文件</span></span><br><span class="line">vim /data/mysql01/my.cnf</span><br><span class="line">[client]</span><br><span class="line">default_character_set=utf8</span><br><span class="line">[mysqld]</span><br><span class="line">collation_server=utf8_general_ci</span><br><span class="line">character_set_server=utf8</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动容器</span></span><br><span class="line">docker run -d \</span><br><span class="line">  --name=mysql01 \</span><br><span class="line">  -p 3306:3306 \</span><br><span class="line">  -e MYSQL_ROOT_PASSWORD=12345678 \</span><br><span class="line">  --privileged=true \</span><br><span class="line">  -v /data/mysql01/my.cnf:/etc/my.cnf \</span><br><span class="line">  -v /data/mysql01/data:/var/lib/mysql \</span><br><span class="line">  -v /data/mysql01/logs:/var/log/mysql \</span><br><span class="line">  mysql:5.7</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 登录到数据库</span></span><br><span class="line">docker exec -it mysql01 mysql -uroot -p12345678</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>启动 redis 容器</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 准备 redis 配置文件</span></span><br><span class="line">mkdir -p /data/redis01/conf</span><br><span class="line">vim /data/redis01/conf/redis.conf</span><br><span class="line">database N</span><br><span class="line">requirepass 12345678</span><br><span class="line">bind 0.0.0.0</span><br><span class="line">daemonize no      # 设置禁止后台启动，因为会和 docker -d 参数冲突，导致容器一直启动失败</span><br><span class="line">append only</span><br><span class="line">protected yes</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动 redis 容器</span></span><br><span class="line">docker run -d \</span><br><span class="line">  --name redis01 \</span><br><span class="line">  -p 6379:6379 \</span><br><span class="line">  --privileged=ture \</span><br><span class="line">  -v /data/redis01/conf:/etc/redis \</span><br><span class="line">  -v /data/redis01/data:/data \</span><br><span class="line">  redis:6.0.8 redis-server /etc/redis/redis.conf</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入 redis 容器</span></span><br><span class="line">docker exec -it redis01 redis-cli -a 12345678</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>启动 tomcat 容器</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动 tomcat 容器</span></span><br><span class="line">docker run -it -d --name=tomcat01 -p 8080:8080 tomcat</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 如果使用 docker.hub 上最新版本的 tomcat 镜像，则会出现访问 404 的情况</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 原因，新版本 tmocat 对 webapps 目录中的内容做了修改，无法直接访问</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 处理方式一，修改容器的 webapps 目录</span></span><br><span class="line">docker exec -it -d tomcat01 /bin/bash</span><br><span class="line">rm -r /usr/local/tomcat/webapps</span><br><span class="line">cp -r /usr/local/tomcat/webapps.dist /usr/local/tomcat/webapps</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 处理方式二，使用旧版本 tomcat 镜像</span></span><br><span class="line">docker run -it -d --name=tomcat01 -p 8080:8080 billygoo/tomcat8_jdk8</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>启动 prometheus 容器</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 准备 prometheus 配置文件</span></span><br><span class="line">mkdir -p /data/prometheus/data</span><br><span class="line">vim /data/prometheus/prometheus.yml</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动 prometheus 容器</span></span><br><span class="line">docker run</span><br><span class="line">  --name my-prometheus \</span><br><span class="line">  --mount type=bind,source=/data/prometheus/prometheus.yml,destination=/etc/prometheus/prometheus.yml \</span><br><span class="line">  -p 9090:9090 \</span><br><span class="line">  --add-host host.docker.internal=host-gateway \</span><br><span class="line">  prom/prometheus</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>启动 alpine 容器</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动 alpine 容器</span></span><br><span class="line">docker run -itd --name a01 alpine</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在 alpine 容器中安装工具</span></span><br><span class="line">docker exec -it a01 apk add git</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="2-2-容器创建指令"><a href="#2-2-容器创建指令" class="headerlink" title="2.2 容器创建指令"></a>2.2 容器创建指令</h2><hr>
<h3 id="知识点：docker-run-x2F-create"><a href="#知识点：docker-run-x2F-create" class="headerlink" title="知识点：docker run&#x2F;create"></a>知识点：docker run&#x2F;create</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - docker create，创建一个新容器</span><br><span class="line">  - docker run，创建一个新容器并运行</span><br><span class="line">  - 如果镜像在本机不存在，则 docker 会自动到仓库中搜索下载相关的镜像</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker container run</span><br><span class="line"></span><br><span class="line">* COMMAND ARGs</span><br><span class="line">  - 额外指定容器的 main process</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>常用选项</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">* -i, --interactive</span><br><span class="line">  - Keep STDIN open even if not attached</span><br><span class="line">  - 以交互式运行容器</span><br><span class="line"></span><br><span class="line">* -t, --tty</span><br><span class="line">  - Allocate a pseudo-TTY</span><br><span class="line">  - 为容器分配一个伪终端 tty</span><br><span class="line"></span><br><span class="line">* -d, --detach</span><br><span class="line">  - Run container in background and print container ID</span><br><span class="line">  - 容器后台运行</span><br><span class="line"></span><br><span class="line">* --name NAME</span><br><span class="line">  - Assign a name to the container</span><br><span class="line">  - 手动指定容器名</span><br><span class="line">  - 如果没有手动指定容器名，则 docker 会为容器随机分配一个看似有语义实则没语义的容器名</span><br><span class="line">  - 容器名的最大优点，在 user-defined bridge network 中，容器相互之间可以直接使用容器名进行网络通信</span><br><span class="line"></span><br><span class="line">* --rm</span><br><span class="line">  - 设置如果容器停止，则自动删除容器和容器的匿名卷</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 运行一个 ubnutu 容器</span></span><br><span class="line">docker run -itd --name u01 ubuntu</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>未整理选项</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 存储选项</span></span><br><span class="line">--tmpfs           Mount a tmpfs directory</span><br><span class="line">--volumes-from    Mount volumes from the specified container(s)</span><br><span class="line">--volume-driver   Optional volume driver for the container</span><br><span class="line">--storage-opt     Storage driver options for the container</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 网络选项</span></span><br><span class="line">--link            Add link to another container</span><br><span class="line">--link-local-ip   Container IPv4/IPv6 link-local addresses</span><br><span class="line">--network-alias   Add network-scoped alias for the container</span><br><span class="line">--mac-address     Container MAC address (e.g., 92:d0:c6:0a:29:33)</span><br><span class="line">-P, --publish-all Publish all exposed ports to random ports</span><br><span class="line">--expose          Expose a port or a range of ports</span><br><span class="line">--dns-option    Set DNS options</span><br><span class="line">--dns-search    Set custom DNS search domains</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 内存资源限制选项</span></span><br><span class="line">--memory-reservation    Memory soft limit</span><br><span class="line">--memory-swap           Swap limit equal to memory plus swap: &#x27;-1&#x27; to enable unlimited swap</span><br><span class="line">--memory-swappiness     Tune container memory swappiness (0 to 100)</span><br><span class="line">--oom-kill-disable  Disable OOM Killer</span><br><span class="line">--oom-score-adj     Tune host&#x27;s OOM preferences (-1000 to 1000)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> CPU 资源限制选项</span></span><br><span class="line">--cpu-count         CPU count (Windows only)</span><br><span class="line">--cpu-percent       CPU percent (Windows only)</span><br><span class="line">--cpu-rt-period     Limit CPU real-time period in microseconds</span><br><span class="line">--cpu-rt-runtime    Limit CPU real-time runtime in microseconds</span><br><span class="line">--cpuset-cpus    CPUs in which to allow execution (0-3, 0,1)</span><br><span class="line">--cpuset-mems    MEMs in which to allow execution (0-3, 0,1)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> IO 资源限制选项</span></span><br><span class="line">--blkio-weight    Block IO (relative weight), between 10 and 1000, or 0 to disable (default 0)</span><br><span class="line">--blkio-weight-device    Block IO weight (relative device weight)</span><br><span class="line">--device-read-bps       Limit read rate (bytes per second) from a device</span><br><span class="line">--device-read-iops      Limit read rate (IO per second) from a device</span><br><span class="line">--device-write-bps      Limit write rate (bytes per second) to a device</span><br><span class="line">--device-write-iops     Limit write rate (IO per second) to a device</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 命名空间选项</span></span><br><span class="line">--pid       PID namespace to use</span><br><span class="line">--userns    User namespace to use</span><br><span class="line">--uts       UTS namespace to use</span><br><span class="line">--ipc       IPC mode to use</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 日志</span></span><br><span class="line">--log-driver    Logging driver for the container</span><br><span class="line">--log-opt    Log driver options</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 健康检查</span></span><br><span class="line">--health-cmd    Command to run to check health</span><br><span class="line">--health-interval    Time between running the check (ms|s|m|h) (default 0s)</span><br><span class="line">--health-retries    Consecutive failures needed to report unhealthy</span><br><span class="line">--health-start-interval    API 1.44+ Time between running the check during the start period (ms|s|m|h) (default 0s)</span><br><span class="line">--health-start-period    API 1.29+ Start period for the container to initialize before starting health-retries countdown (ms|s|m|h) (default 0s)</span><br><span class="line">--health-timeout    Maximum time to allow one check to run (ms|s|m|h) (default 0s)</span><br><span class="line">--no-healthcheck    Disable any container-specified HEALTHCHECK</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> Runtime Privilege and Linux Capabilities</span></span><br><span class="line">--cap-add     Add Linux capabilities</span><br><span class="line">--cap-drop    Drop Linux capabilities</span><br><span class="line">--device                Add a host device to the container</span><br><span class="line">--device-cgroup-rule    Add a rule to the cgroup allowed devices list</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cgroup</span></span><br><span class="line">--cgroup-parent    Optional parent cgroup for the container</span><br><span class="line">--cgroupns         Cgroup namespace to use (host|private). &#x27;host&#x27;: Run the container in the Docker host&#x27;s cgroup namespace. &#x27;private&#x27;: Run the container in its own private cgroup namespace. &#x27;&#x27;: Use the cgroup namespace as configured by the default-cgroupns-mode option on the daemon (default)</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 其他选项</span></span><br><span class="line">-a, --attach    Attach to STDIN, STDOUT or STDERR</span><br><span class="line">--entrypoint    Overwrite the default ENTRYPOINT of the image</span><br><span class="line">--group-add     Add additional groups to join</span><br><span class="line">-q, --quiet    Suppress the pull output</span><br><span class="line">-u, --user    Username or UID (format: &lt;name|uid&gt;[:&lt;group|gid&gt;])</span><br><span class="line">-w, --workdir    Working directory inside the container</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 其他其他选项</span></span><br><span class="line">--annotation      Add an annotation to the container (passed through to the OCI runtime)</span><br><span class="line">--cidfile         Write the container ID to the file</span><br><span class="line">--detach-keys     Override the key sequence for detaching a container</span><br><span class="line">--disable-content-trust  Skip image verification</span><br><span class="line">--domainname      Container NIS domain name</span><br><span class="line">--isolation       Container isolation technology</span><br><span class="line">--pids-limit      Tune container pids limit (set -1 for unlimited)</span><br><span class="line">--platform        Set platform if server is multi-platform capable</span><br><span class="line">--read-only       Mount the container&#x27;s root filesystem as read only</span><br><span class="line">--runtime         Runtime to use for this container</span><br><span class="line">--security-opt    Security Options</span><br><span class="line">--shm-size        Size of /dev/shm</span><br><span class="line">--sig-proxy       Proxy received signals to the process</span><br><span class="line">--stop-signal     Signal to stop the container</span><br><span class="line">--stop-timeout    Timeout (in seconds) to stop a container</span><br><span class="line">--sysctl          Sysctl options</span><br><span class="line">--ulimit          Ulimit options</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-update"><a href="#知识点：docker-update" class="headerlink" title="知识点：docker update"></a>知识点：docker update</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 更新 running 容器的配置</span><br><span class="line">  - 主要是资源限制有关</span><br><span class="line">  - 选项的语法与 docker run 相同</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker update [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker container update</span><br><span class="line"></span><br><span class="line">* 支持的选项</span><br><span class="line">  --blkio-weight</span><br><span class="line">  -c, --cpu-shares</span><br><span class="line">  --cpu-period</span><br><span class="line">  --cpu-quota</span><br><span class="line">  --cpu-rt-period</span><br><span class="line">  --cpu-rt-runtime</span><br><span class="line">  --cpus</span><br><span class="line">  --cpuset-cpus</span><br><span class="line">  --cpuset-mems</span><br><span class="line">  -m, --memory</span><br><span class="line">  --memory-reservation</span><br><span class="line">  --memory-swap</span><br><span class="line">  --pids-limit</span><br><span class="line">  --restart</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–restart-选项"><a href="#知识点：–restart-选项" class="headerlink" title="知识点：–restart 选项"></a>知识点：–restart 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 配置容器的自动重启</span><br><span class="line">  - 自动重启包含两种概念</span><br><span class="line">    - dockerd 没有重启，容器异常停止</span><br><span class="line">    - dockerd 重启</span><br><span class="line"></span><br><span class="line">* 生效范围</span><br><span class="line">  - 仅在容器启动成功，并且正常运行 10s 后、dockerd 开始监控容器后，才会生效</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  --restart RestartPolicy</span><br><span class="line"></span><br><span class="line">* no</span><br><span class="line">  - 默认策略，容器不会自动重启</span><br><span class="line"></span><br><span class="line">* always</span><br><span class="line">  - 总是自动重启</span><br><span class="line">  - 当手动正常停止容器时不会自动重启</span><br><span class="line">  - 当手动正常停止容器后再重启 dockerd 容器也会自动重启</span><br><span class="line"></span><br><span class="line">* unless-stopped</span><br><span class="line">  - 与 always 类似</span><br><span class="line">  - 只有一个区别，当 dockerd 重启后容器不会自动重启</span><br><span class="line"></span><br><span class="line">* on-failure[:max-retries]</span><br><span class="line">  - 仅在容器异常退出时会自动重启</span><br><span class="line">  - 当 dockerd 重启时容器不会自动重启</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–pull-选项"><a href="#知识点：–pull-选项" class="headerlink" title="知识点：–pull 选项"></a>知识点：–pull 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 指定容器的镜像拉取策略</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  --pull missing|always|never</span><br><span class="line"></span><br><span class="line">* missing</span><br><span class="line">  - 默认策略，仅宿主机上没有此镜像时，才拉取镜像</span><br><span class="line"></span><br><span class="line">* always</span><br><span class="line">  - 总是拉取镜像，不管宿主机上是不是已经有此镜像了</span><br><span class="line"></span><br><span class="line">* never</span><br><span class="line">  - 从不拉取镜像，只使用宿主机的镜像</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–init-选项"><a href="#知识点：–init-选项" class="headerlink" title="知识点：–init 选项"></a>知识点：–init 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 默认情况下，容器的 main process 是 Dockerfile 末尾的 ENTRYPOINT 或 CMD 指定的程序</span><br><span class="line">  - 容器的主进程需要负责管理容器的所有其他进程，当容器退出时需要收割容器中所有的进程</span><br><span class="line">  - 有些情况下，例如 main process 存在设计缺陷，无法做到当容器退出时收割容器中所有的进程</span><br><span class="line">  - 此情况下，可以添加 &quot;--init&quot; 选项，为容器指定另一个 init process 作为容器的 main process，来负责管理容器中的进程</span><br><span class="line">  - 理所当然，init process 的 pid 为 1，容器中其他的进程都是 init process 的子进程</span><br><span class="line">  - 默认情况下，&quot;--init&quot; 指定的进程是 docker-init</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  --init</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"># 启动一个 redis 进程，并且添加 init 进程</span><br><span class="line">docker run -itd --init --name r01 redis</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–env、–env-file-选项"><a href="#知识点：–env、–env-file-选项" class="headerlink" title="知识点：–env、–env-file 选项"></a>知识点：–env、–env-file 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 容器的环境变量介绍</span><br><span class="line">  - 在 docker run 时，docker 会自动为容器配置一部分环境变量，如 HOME、HOSTNAME、PATH 等</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>–env 选项</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - &quot;-e&quot; 或 &quot;--env&quot;</span><br><span class="line">  - 为容器添加环境变量</span><br><span class="line">  - 一个 &quot;--env&quot; 选项只能配置一个环境变量，如果想要配置多个环境变量，则多次指定 &quot;--env&quot; 选项</span><br><span class="line">  - 如果 value 为空，则表示将宿主机当前环境的同名的环境变量的值填充到容器的环境变量上</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  --env key=value</span><br><span class="line">  --env key=</span><br><span class="line">  --env key</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>–env-file 选项</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 指导容器从变量文件中读取环境变量</span><br><span class="line">  - 变量文件的内容的格式应当为 key=value，一行一个</span><br><span class="line">  - &quot;#&quot; 开头表示注释，&quot;#&quot; 不在开头不表示注释</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  --env-file FILE</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–label、–label-file-选项"><a href="#知识点：–label、–label-file-选项" class="headerlink" title="知识点：–label、–label-file 选项"></a>知识点：–label、–label-file 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 为容器添加标签</span><br><span class="line">  - 标签被记录在容器的 metadata 中</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>–label 选项</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - &quot;-l&quot; 或 &quot;--label&quot;</span><br><span class="line">  - 为容器添加标签，key=value 格式</span><br><span class="line">  - 如果 value 为空，则标签的值为 &quot;&quot;</span><br><span class="line">  - 一个 &quot;--label&quot; 选项只能指定一个标签，如果想要配置多个标签，则多次指定 &quot;--label&quot; 选项</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  --label key=value</span><br><span class="line">  --label key=</span><br><span class="line">  --label key</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>–label-file 选项</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 指导容器从文件中读取标签配置</span><br><span class="line">  - 标签文件的内容的格式应当为 key=value，一行一个</span><br><span class="line">  - &quot;#&quot; 开头表示注释，&quot;#&quot; 不在开头不表示注释</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  --label-file FILE</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="2-3-容器管理指令"><a href="#2-3-容器管理指令" class="headerlink" title="2.3 容器管理指令"></a>2.3 容器管理指令</h2><hr>
<h3 id="知识点：docker-ps"><a href="#知识点：docker-ps" class="headerlink" title="知识点：docker ps"></a>知识点：docker ps</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 列出所有的容器</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker ps [OPTIONS]</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker container ls</span><br><span class="line">  docker container ps</span><br><span class="line">  docker container list</span><br><span class="line"></span><br><span class="line">* -a, --all</span><br><span class="line">  - 默认 docker ps 只列出 running 的容器</span><br><span class="line">  - 添加 &quot;-a&quot; 选项则列出所有的容器，包括 running 的和 stopped 的</span><br><span class="line"></span><br><span class="line">* -q, --quiet</span><br><span class="line">  - 只打印容器 ID</span><br><span class="line">  - 通常用来生产某个具有某些特性的容器的列表，传给其他的指令，如 stopped 容器的列表传给 docker rm</span><br><span class="line"></span><br><span class="line">* -f, --filter K=V</span><br><span class="line">  - 添加过滤条件</span><br><span class="line">  - 部分支持的过滤条件</span><br><span class="line">    - id=ContainerID</span><br><span class="line">    - name=ContainerName</span><br><span class="line">    - label=key</span><br><span class="line">    - label=key=value</span><br><span class="line">    - status=created, restarting, running, removing, paused, exited, dead</span><br><span class="line">    - ancestor=image, image:tag, image:tag@digest, LayerShortID, LayerFullID</span><br><span class="line">    - before=Container</span><br><span class="line">    - since=Container</span><br><span class="line">    - volume=VolumeName, BindMountPath</span><br><span class="line">    - network=Network</span><br><span class="line">    - expose=Port, StartPort-EndPort/[Proto]</span><br><span class="line">    - publish=Port, StartPort-EndPort/[Proto]</span><br><span class="line">    - health=starting, healthy, unhealthy or none.</span><br><span class="line"></span><br><span class="line">* --format table</span><br><span class="line">* --format json</span><br><span class="line">* --format GoTemplate</span><br><span class="line">  - 指定输出格式</span><br><span class="line"></span><br><span class="line">* -s, --size</span><br><span class="line">  - 同时打印容器的磁盘占用情况</span><br><span class="line">  - 会额外添加两列输出，size 和 virtual size</span><br><span class="line">    - size 列，显示容器的可写层所占用的磁盘空间</span><br><span class="line">    - virtual size 列，显示容器的只读层加可写层所占用的磁盘空间</span><br><span class="line"></span><br><span class="line">* -n, --last N</span><br><span class="line">  - 只列出最近创建的 N 个容器</span><br><span class="line"></span><br><span class="line">* --no-trunc</span><br><span class="line">  - 不要截断输出</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 列出所有的容器</span><br><span class="line">docker ps -a</span><br><span class="line"></span><br><span class="line"># 以 json 格式列出所有的容器</span><br><span class="line">docker ps -a --format json | jq --indent 4</span><br><span class="line"></span><br><span class="line"># 仅列出容器的 ID、Name、镜像</span><br><span class="line">docker ps --format &#x27;table &#123;&#123;.ID&#125;&#125;\t&#123;&#123;.Names&#125;&#125;\t&#123;&#123;.Image&#125;&#125;&#x27;</span><br><span class="line"></span><br><span class="line"># 列出所有基于 mysql:latest 镜像所创建的容器</span><br><span class="line">docker ps -f ancestor=mysql</span><br><span class="line"></span><br><span class="line"># 列出所有在 mysql01 之前所创建的容器</span><br><span class="line">docker ps -f before=mysql01</span><br><span class="line"></span><br><span class="line"># 列出所有暴露了 8000-8888 之间的端口的容器</span><br><span class="line">docker ps -f expose=8000-8888/tcp</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-exec"><a href="#知识点：docker-exec" class="headerlink" title="知识点：docker exec"></a>知识点：docker exec</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 切换到容器环境中执行一个指令</span><br><span class="line">  - 新进程的 cwd，就是容器的 default working directory </span><br><span class="line">  - 常用来进入容器环境，通过一个新启动的进程进入容器，exit 不会导致容器退出</span><br><span class="line"></span><br><span class="line">* 如何理解 Execute a command in a running container</span><br><span class="line">  - 本质上，一个容器就相当于一组 namespace + cgroup 的集合</span><br><span class="line">  - 所以，所谓的 &quot;在容器中执行一个指令&quot;，就是指新启动一个进程，并且进程的 namespace 和 cgroup 与容器中的一样</span><br><span class="line">  - 这样的进程，可以直接与容器中的进程进行通信，所看到的文件系统直接就是容器的文件系统</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker exec [OPTIONS] CONTAINER COMMAND [ARG...]</span><br><span class="line"></span><br><span class="line">* COMMAND</span><br><span class="line">  - 指定进入容器环境所执行的指令</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>选项</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* -i, --interactive</span><br><span class="line">  - 交互模式</span><br><span class="line"></span><br><span class="line">* -t, --tty</span><br><span class="line">  - 分配一个伪终端</span><br><span class="line"></span><br><span class="line">* -e, --env key=value</span><br><span class="line">* --env-file FILE</span><br><span class="line">  - 同时设置环境变量</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 进入到 u01 容器中</span></span><br><span class="line">docker exec -it u01 /bin/bash</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-rm"><a href="#知识点：docker-rm" class="headerlink" title="知识点：docker rm"></a>知识点：docker rm</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 删除容器</span><br><span class="line">  - 默认只能删除 stopped 容器，不能删除 running 容器</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker rm [OPTIONS] CONTAINER [CONTAINER...]</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker container rm</span><br><span class="line">  docker container remove</span><br><span class="line"></span><br><span class="line">* -f, --force</span><br><span class="line">  - 强制删除容器，连同 running 容器一起删除</span><br><span class="line"></span><br><span class="line">* -v, --volumes</span><br><span class="line">  - Remove anonymous volumes associated with the container</span><br><span class="line">  - 将容器绑定的匿名卷一起删除</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 删除一个容器</span></span><br><span class="line">docker rm mysql01</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除所有 exited 的容器</span></span><br><span class="line">docker rm $(docker ps --filter status=exited -q)</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-cp"><a href="#知识点：docker-cp" class="headerlink" title="知识点：docker cp"></a>知识点：docker cp</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 在容器和宿主机之间复制数据</span><br><span class="line">  - 可以是文件、目录</span><br><span class="line">  - 容器可以是 running 的，也可以是 stopped 的</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker cp [OPTIONS] CONTAINER:SRC_PATH DEST_PATH</span><br><span class="line">  docker cp [OPTIONS] SRC_PATH CONTAINER:DEST_PATH</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker container cp</span><br><span class="line"></span><br><span class="line">* CONTAINER:SRC_PATH</span><br><span class="line">* CONTAINER:DEST_PATH</span><br><span class="line">  - 指定容器内的路径，通过 &quot;:&quot; 指定</span><br><span class="line">  - 推荐使用绝对路径</span><br><span class="line">  - 如果使用的是相对路径，则相对路径的起始位置为 &quot;/&quot;</span><br><span class="line"></span><br><span class="line">* SRC_PATH</span><br><span class="line">* DEST_PATH</span><br><span class="line">  - 指定宿主机的路径</span><br><span class="line">  - 如果使用的是相对路径，则相对路径的起始位置我 current working directory</span><br><span class="line"></span><br><span class="line">* -a, --archive</span><br><span class="line">  - Archive mode (copy all uid/gid information)</span><br><span class="line"></span><br><span class="line">* -L, --follow-link</span><br><span class="line">  - Always follow symbol link in SRC_PATH</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将宿主机上的 /etc/hosts 复制到 u01 容器的 /home 下</span></span><br><span class="line">docker cp /etc/hosts u01:/home</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-start-x2F-stop-x2F-restart-x2F-kill"><a href="#知识点：docker-start-x2F-stop-x2F-restart-x2F-kill" class="headerlink" title="知识点：docker start&#x2F;stop&#x2F;restart&#x2F;kill"></a>知识点：docker start&#x2F;stop&#x2F;restart&#x2F;kill</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - start，启动一个容器</span><br><span class="line">  - stop，停止一个容器</span><br><span class="line">  - restart，重启一个容器</span><br><span class="line">  - kill，向容器的主进程发送一个 SIG 信号，默认为 SIGKILL 强制停止</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker container start [OPTIONS] CONTAINE</span><br><span class="line">  docker container stop [OPTIONS] CONTAINER</span><br><span class="line">  docker container restart [OPTIONS] CONTAINER</span><br><span class="line">  docker container kill [OPTIONS] CONTAINER</span><br><span class="line"></span><br><span class="line">* --signal=N</span><br><span class="line">* --signal=SIGname</span><br><span class="line">  - 对于 stop、restart、kill 有效</span><br><span class="line">  - 指定向容器的主进程发送的信号</span><br><span class="line"></span><br><span class="line">* -t, --time N</span><br><span class="line">  - 对于 stop、restart 有效</span><br><span class="line">  - 指定在进行操作前的等待的秒数</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-pause-x2F-unpause"><a href="#知识点：docker-pause-x2F-unpause" class="headerlink" title="知识点：docker pause&#x2F;unpause"></a>知识点：docker pause&#x2F;unpause</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 将容器挂起/解除挂起</span><br><span class="line">  - 所谓容器挂起，就是将容器的所有进程挂起</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker pause CONTAINER</span><br><span class="line">  docker unpause CONTAINER</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker container pause</span><br><span class="line">  docker container unpause</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 挂起容器</span></span><br><span class="line">docker pause u01</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 解除挂起容器</span></span><br><span class="line">docker unpause u01</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-rename"><a href="#知识点：docker-rename" class="headerlink" title="知识点：docker rename"></a>知识点：docker rename</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 对容器重命名</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker rename CONTAINER NEW_NAME</span><br><span class="line">  </span><br><span class="line">* 别名</span><br><span class="line">  docker container rename</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将 u01 容器重命名为 u02</span></span><br><span class="line">docker rename u01 u02</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-logs"><a href="#知识点：docker-logs" class="headerlink" title="知识点：docker logs"></a>知识点：docker logs</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 查看容器日志</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker container logs [OPTIONS] CONTAINER</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker container logs</span><br><span class="line"></span><br><span class="line">* -f, --follow</span><br><span class="line">  - 持续输出</span><br><span class="line"></span><br><span class="line">* -n, --tail N</span><br><span class="line">  - 仅打印最后 N 条</span><br><span class="line">  - 默认打印全部的日志，相当于 &quot;-n all&quot;</span><br><span class="line"></span><br><span class="line">* -t, --timestamps</span><br><span class="line">  - 在每条日志前加上时间戳</span><br><span class="line"></span><br><span class="line">* --since timestame</span><br><span class="line">  - 仅打印某个时间之后的日志</span><br><span class="line"></span><br><span class="line">* --until timestame</span><br><span class="line">  - 仅打印某个时间之前的日志</span><br><span class="line"></span><br><span class="line">* --details</span><br><span class="line">  - 在打印日志时，添加额外的属性，例如在创建容器时提供给 --log-opt 选项的环境变量和标签</span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看容器的全部的日志</span></span><br><span class="line">docker logs n01</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 持续查看容器的日志</span></span><br><span class="line">docker logs -f n01</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器最近 200 条日志</span></span><br><span class="line">docker logs -n 200 n01</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器最近 2 小时的日志，并带上时间戳</span></span><br><span class="line">docker logs -t --since 2h n01</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-top"><a href="#知识点：docker-top" class="headerlink" title="知识点：docker top"></a>知识点：docker top</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 查看容器中的 running 进程</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker top CONTAINER</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-stats"><a href="#知识点：docker-stats" class="headerlink" title="知识点：docker stats"></a>知识点：docker stats</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 动态的展示容器的资源使用情况、容器的 pid</span><br><span class="line">  - 对于 stopped 容器，不会输出任何信息</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker stats [OPTIONS]</span><br><span class="line">  docker stats [OPTIONS] CONTAINERs</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker container stats</span><br><span class="line"></span><br><span class="line">* CONTAINERs</span><br><span class="line">  - 省略容器名的话，则是查看所有容器的资源使用情况</span><br><span class="line"></span><br><span class="line">* -a, --all</span><br><span class="line">  - 默认只展示 running 的容器</span><br><span class="line">  - 指定 &quot;-a&quot; 选项，可以显示所有容器，不过 stopped 容器不会输出任何信息</span><br><span class="line"></span><br><span class="line">* --format table</span><br><span class="line">* --format json</span><br><span class="line">* --format GoTemplate</span><br><span class="line">  - 指定输出格式</span><br><span class="line"></span><br><span class="line">* --no-stream</span><br><span class="line">  - 不再动态展示，而是只输出第一次刷新的结果</span><br><span class="line"></span><br><span class="line">* --no-trunc</span><br><span class="line">  - 不要对输出进行截断</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看所有容器的资源使用情况</span></span><br><span class="line">docker stats</span><br><span class="line"></span><br><span class="line">CONTAINER ID   NAME      CPU %     MEM USAGE / LIMIT    MEM %     NET I/O       BLOCK I/O         PIDS</span><br><span class="line">0e274d11e5de   m01       0.12%     204.3MiB / 7.71GiB   2.59%     23.7kB / 0B   39.5MB / 13.2MB   27</span><br><span class="line">03ad9cab1983   r02       0.25%     15.25MiB / 7.71GiB   0.19%     8.11kB / 0B   13.2MB / 0B       6</span><br><span class="line">4945c4e591ba   r01       0.26%     4.633MiB / 7.71GiB   0.06%     8.11kB / 0B   1.27MB / 0B       6</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-port"><a href="#知识点：docker-port" class="headerlink" title="知识点：docker port"></a>知识点：docker port</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 查看某个容器的端口映射情况</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker port CONTAINER </span><br><span class="line">  docker port CONTAINER [PRIVATE_PORT[/PROTO]]</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker container port</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看容器所有的端口映射</span></span><br><span class="line">docker port u01</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器特定端口的映射</span></span><br><span class="line">docker port u01 7890</span><br><span class="line">docker port u01 7890/tcp</span><br><span class="line">docker port u01 7890/udp</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-attach"><a href="#知识点：docker-attach" class="headerlink" title="知识点：docker attach"></a>知识点：docker attach</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - Attach local standard input, output, and error streams to a running container</span><br><span class="line">  - 将当前终端的 STDIN、STDOUT、STDERR，连接到容器的主进程上</span><br><span class="line">  - 不会启动新的进程，而是直接切换到容器的进程上，因此 exit 会导致容器停止</span><br><span class="line">  - 在容器中的所有操作，在容器的所有终端上同步显示</span><br><span class="line"></span><br><span class="line">* 退出</span><br><span class="line">  - Ctrl+P+Q 退出容器，容器不会停止运行</span><br><span class="line">  - Ctrl+C，相当于停止容器的主进程，容器也会被停止</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker attach [OPTIONS] CONTAINER</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-wait"><a href="#知识点：docker-wait" class="headerlink" title="知识点：docker wait"></a>知识点：docker wait</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 阻塞当前终端，直到相应的容器停止，然后打印容器的退出代码</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker wait CONTAINER [CONTAINER...]</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker container wait</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-diff"><a href="#知识点：docker-diff" class="headerlink" title="知识点：docker diff"></a>知识点：docker diff</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 列出容器的文件系统中，自从创建之后，相比于镜像，发生了变化的文件</span><br><span class="line">  - 某种意义上，就是看容器的可写层有哪些文件</span><br><span class="line"></span><br><span class="line">* 标识符</span><br><span class="line">  - A ==&gt; A file or directory was added</span><br><span class="line">  - D ==&gt; A file or directory was deleted</span><br><span class="line">  - C ==&gt; A file or directory was changed</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker diff CONTAINER</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker container diff</span><br><span class="line">  </span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 列出 nginx 容器中自从容器创建后发生变化的文件</span></span><br><span class="line">docker diff n01</span><br><span class="line"></span><br><span class="line">C /etc</span><br><span class="line">C /etc/nginx</span><br><span class="line">C /etc/nginx/conf.d</span><br><span class="line">C /etc/nginx/conf.d/default.conf</span><br><span class="line">C /var</span><br><span class="line">C /var/cache</span><br><span class="line">C /var/cache/nginx</span><br><span class="line">A /var/cache/nginx/client_temp</span><br><span class="line">A /var/cache/nginx/fastcgi_temp</span><br><span class="line">A /var/cache/nginx/proxy_temp</span><br><span class="line">A /var/cache/nginx/scgi_temp</span><br><span class="line">A /var/cache/nginx/uwsgi_temp</span><br><span class="line">C /run</span><br><span class="line">A /run/nginx.pid</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-container-prune"><a href="#知识点：docker-container-prune" class="headerlink" title="知识点：docker container prune"></a>知识点：docker container prune</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 删除所有的 stopped 容器</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker container prune [OPTIONS]</span><br><span class="line"></span><br><span class="line">* --filter label=key</span><br><span class="line">* --filter label!=key</span><br><span class="line">* --filter label=key=value</span><br><span class="line">* --filter label!=key=value</span><br><span class="line">* --filter until=timestamp</span><br><span class="line">  - 按照指定的条件对容器进行筛选</span><br><span class="line"></span><br><span class="line">* -f, --force</span><br><span class="line">  - 不需要提示确认</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="2-4-容器资源限制"><a href="#2-4-容器资源限制" class="headerlink" title="2.4 容器资源限制"></a>2.4 容器资源限制</h2><hr>
<h3 id="知识点：容器的资源限制介绍"><a href="#知识点：容器的资源限制介绍" class="headerlink" title="知识点：容器的资源限制介绍"></a>知识点：容器的资源限制介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 默认情况下，容器并没有资源限制，一个容器理论上可以使用宿主机的全部资源</span><br><span class="line"></span><br><span class="line">* 硬限制和软限制</span><br><span class="line">  - 硬限制，指无论在任何情况下，此限制都处于被激活的状态</span><br><span class="line">  - 软限制，指仅在满足了某些条件时才会被激活，例如系统检测到内存不足</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–memory-选项"><a href="#知识点：–memory-选项" class="headerlink" title="知识点：–memory 选项"></a>知识点：–memory 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - &quot;-m&quot; 或 &quot;--memory&quot;</span><br><span class="line">  - 硬限制，指定容器能使用的内存的最大上限</span><br><span class="line">  - 可以接受的最小值为 6m</span><br><span class="line">  - 支持各种容量单位，k、m、g 等</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  --memory LIMIT</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–kernel-memory-选项"><a href="#知识点：–kernel-memory-选项" class="headerlink" title="知识点：–kernel-memory 选项"></a>知识点：–kernel-memory 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 硬限制，容器可以使用的最大内核内存</span><br><span class="line">  - 可以接受的最小值为 6m</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  --kernel-memory LIMIT</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–cpus-选项"><a href="#知识点：–cpus-选项" class="headerlink" title="知识点：–cpus 选项"></a>知识点：–cpus 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 配置容器能使用的 cpu 的最大个数</span><br><span class="line">  - 可以是小数</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  --cpus N</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–cpu-period、–cpu-quota-选项"><a href="#知识点：–cpu-period、–cpu-quota-选项" class="headerlink" title="知识点：–cpu-period、–cpu-quota 选项"></a>知识点：–cpu-period、–cpu-quota 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 使用配额/总量的方式，限制容器的最大 cpu 资源</span><br><span class="line">  - 通常不会与 --cpus 一起使用</span><br><span class="line">  - 容器能使用的 CPU 资源为 cpu-quota/cpu-period</span><br><span class="line">  - 选项基于 Linux kernel 的 CFS CPU scheduler</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* --cpu-period N</span><br><span class="line">  - 指定计算配额时作为分母的 CPU CFS scheduler 周期，单位为微秒</span><br><span class="line">  - 默认为 100000 microseconds，即 100 milliseconds</span><br><span class="line"></span><br><span class="line">* --cpu-quota N</span><br><span class="line">  - 指定容器的 CPU CFS quota，单位为微秒</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–cpu-shares-选项"><a href="#知识点：–cpu-shares-选项" class="headerlink" title="知识点：–cpu-shares 选项"></a>知识点：–cpu-shares 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 提高或降低容器能被分配到 cpu 的优先级</span><br><span class="line">  - 计算方式为，cpu-share/所有容器的 cpu-share 之和</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* --cpu-shares N</span><br><span class="line">  - N 默认为 1024</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–gpus-选项"><a href="#知识点：–gpus-选项" class="headerlink" title="知识点：–gpus 选项"></a>知识点：–gpus 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 将 gpu 挂载到容器中</span><br><span class="line">  - 要求宿主机需要提前安装好 nvidia-container-runtime https://nvidia.github.io/nvidia-container-runtime/</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* --gpus N</span><br><span class="line">* --gpus &#x27;&quot;device=0,2&quot;&#x27;</span><br><span class="line">  - 通过 GPU 的编号将 gpu 挂载到容器中</span><br><span class="line"></span><br><span class="line">* --gpus device=GPU-3a23c669-1f69-c64e-cf85-44e9b07e7a2</span><br><span class="line">  - 通过 GPU 的 uuid 将 gpu 挂载到容器中</span><br><span class="line"></span><br><span class="line">* --gpus all</span><br><span class="line">  - 将宿主机的全部 GPU 挂载到容器中</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="Chapter03-DockerImage"><a href="#Chapter03-DockerImage" class="headerlink" title="Chapter03 DockerImage"></a>Chapter03 DockerImage</h1><hr>
<h2 id="3-1-DockerImage-介绍"><a href="#3-1-DockerImage-介绍" class="headerlink" title="3.1 DockerImage 介绍"></a>3.1 DockerImage 介绍</h2><hr>
<h3 id="知识点：镜像"><a href="#知识点：镜像" class="headerlink" title="知识点：镜像"></a>知识点：镜像</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - Image</span><br><span class="line">  - 启动容器的模板</span><br><span class="line">  - 提供启动容器的文件系统，含有程序运行所需的各种配置和依赖</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>镜像命名</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  DomainName:port/namespace/repository:tag</span><br><span class="line"></span><br><span class="line">* DomainName:port</span><br><span class="line">  - 域名，用来标识仓库服务器</span><br><span class="line">  - 可以是 IP 地址</span><br><span class="line">  - 省略 DomainName:port，则表示 docker 的公共仓库 registry-1.docker.io</span><br><span class="line">  - 省略 port，则默认 80</span><br><span class="line"></span><br><span class="line">* namespace</span><br><span class="line">  - 命名空间，默认为 library</span><br><span class="line"></span><br><span class="line">* repository</span><br><span class="line">  - 镜像名</span><br><span class="line"></span><br><span class="line">* tag</span><br><span class="line">  - 镜像的版本</span><br><span class="line">  - 省略则表示 latest</span><br><span class="line">  - 官方镜像通常采用软件版本号为 tag，如 mysql:5.7、nginx:1.16.1</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>虚悬镜像</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  -  dangling image</span><br><span class="line">  - 仓库名、标签名都是 none 的镜像</span><br><span class="line">  - 没有什么用，建议删除</span><br><span class="line">  - 通常由于构建异常而产生</span><br><span class="line">    - docker build 时未指定 -t，就会产生虚悬镜像</span><br><span class="line">    - docker build 过程中出错导致退出，也过程镜像会成为虚悬镜像，并且此时相应的容器也并没有被删除</span><br><span class="line">    - 创建镜像时，如果 tag 与旧的某个镜像重复，则旧的镜像就成为虚悬镜像</span><br><span class="line"></span><br><span class="line">* 查看当前主机是否有虚悬镜像</span><br><span class="line">  docker image -f dangling=true</span><br><span class="line"></span><br><span class="line">* 删除虚悬镜像</span><br><span class="line">  docker image prune</span><br><span class="line">  -f    &lt;== 直接删除，不用进行确认</span><br><span class="line">  -a    &lt;== 删除虚悬镜像和 unused 镜像，危险</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>digest</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 使用 v2 或更高版本 image format 的镜像，具一个基于内容的可寻址标识符，称为摘要 digest</span><br><span class="line">  - digest 是通过对镜像的数据进行 sha 计算后得到的结果，只要镜像的数据不变 digest 就不变</span><br><span class="line">  - 在使用镜像时，可以通过 digest 来进行镜像的拉取、管理等</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：镜像分层"><a href="#知识点：镜像分层" class="headerlink" title="知识点：镜像分层"></a>知识点：镜像分层</h3><hr>
<h2 id="3-2-DockerImage-指令"><a href="#3-2-DockerImage-指令" class="headerlink" title="3.2 DockerImage 指令"></a>3.2 DockerImage 指令</h2><hr>
<h3 id="知识点：docker-images"><a href="#知识点：docker-images" class="headerlink" title="知识点：docker images"></a>知识点：docker images</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 列出本地主机上的镜像</span><br><span class="line">  - 如果一个镜像有多个 repository name 或 tag，则会被多次列出</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker images [OPTIONS] [REPOSITORY[:TAG]]</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker image ls</span><br><span class="line">  docker image list</span><br><span class="line"></span><br><span class="line">* -a, --all</span><br><span class="line">  - 列出本地所有镜像，包括中间层</span><br><span class="line"></span><br><span class="line">* -f, --filter key=value</span><br><span class="line">  - 根据条件进行过滤</span><br><span class="line">  - 当前支持的条件：dangling、label、before、since</span><br><span class="line"></span><br><span class="line">* --format table</span><br><span class="line">* --format json</span><br><span class="line">* --format GoTemplage</span><br><span class="line">  - 指定输出格式</span><br><span class="line"></span><br><span class="line">* --no-trunc</span><br><span class="line">  - 不对输出进行截断</span><br><span class="line"></span><br><span class="line">* -q, --quiet</span><br><span class="line">  - 只打印镜像 id</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 列出所有镜像</span></span><br><span class="line">docker images</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出所有 mysql 镜像</span></span><br><span class="line">docker images mysql</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-search"><a href="#知识点：docker-search" class="headerlink" title="知识点：docker search"></a>知识点：docker search</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 从 docker.hub 上搜索镜像</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker search OPTION IMAGE</span><br><span class="line"></span><br><span class="line">* --format table</span><br><span class="line">* --format json</span><br><span class="line">* --format GoTemplate</span><br><span class="line">  - 指定输出格式</span><br><span class="line"></span><br><span class="line">* --limit N</span><br><span class="line">  - 限定输出结果的数量，默认为 25 个</span><br><span class="line"></span><br><span class="line">* --no-trunc</span><br><span class="line">  - 不对输出进行截断</span><br><span class="line"></span><br><span class="line">* -f, --filter key=value</span><br><span class="line">  - 进行筛选</span><br><span class="line">  - 当前支持的条件：stars、is-automated、is-official</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 搜索官方 nginx 镜像</span></span><br><span class="line">docker search nginx --filter is-official=true</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-tag"><a href="#知识点：docker-tag" class="headerlink" title="知识点：docker tag"></a>知识点：docker tag</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 为镜像创建一个新的标签</span><br><span class="line">  - 标签相当于镜像名的一个软链或别名</span><br><span class="line">  - 一个镜像可以同时具有多个标签</span><br><span class="line">  - 标签在对本地镜像进行管理时十分重要，例如上传镜像</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker tag SOURCE_IMAGE[:TAG] TARGET_IMAGE[:TAG]</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker image tag</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 为 mysql 镜像添加本地仓库 tag</span></span><br><span class="line">docker tag mysql myregistry:5000/project1/mysql:test</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-history"><a href="#知识点：docker-history" class="headerlink" title="知识点：docker history"></a>知识点：docker history</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 查看一个镜像的构建历史</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker history [OPTIONS] IMAGE</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker image history</span><br><span class="line"></span><br><span class="line">* --format table</span><br><span class="line">* --format json</span><br><span class="line">* --format jsonGoTemplate</span><br><span class="line">  - 指定输出格式</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 msyql 镜像的构建历史</span></span><br><span class="line">docker history mysql</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-pull"><a href="#知识点：docker-pull" class="headerlink" title="知识点：docker pull"></a>知识点：docker pull</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 从仓库上拉取镜像到本地</span><br><span class="line">  - 不指定仓库则默认从 docker hub 上下载镜像</span><br><span class="line">  - 省略 TAG 则默认使用 latest</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker pull [OPTIONS] NAME[:TAG|@DIGEST]</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker image pull</span><br><span class="line"></span><br><span class="line">* --platform ARCH</span><br><span class="line">  - 指定镜像的架构</span><br><span class="line"></span><br><span class="line">* -a, --all-tags</span><br><span class="line">  - Download all tagged images in the repository</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载 mysql 镜像</span></span><br><span class="line">docker pull mysql:8.0.32</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载 mysql 镜像 arm 架构</span></span><br><span class="line">docker pull mysql:8.0.32 --platform arm64</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载指定仓库的镜像</span></span><br><span class="line">docker pull myregistry:5000/project1/mysql:8.0.32</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-push"><a href="#知识点：docker-push" class="headerlink" title="知识点：docker push"></a>知识点：docker push</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 将镜像推送到仓库上</span><br><span class="line">  - 在推送镜像之前，先添加 tag，标记镜像的仓库地址</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker push [OPTIONS] NAME[:TAG]</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker image push</span><br><span class="line"></span><br><span class="line">* -a, --all-tags</span><br><span class="line">  - Push all tags of an image to the repository</span><br><span class="line"></span><br><span class="line">* --platform ARCH</span><br><span class="line">  - 指定架构</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 将 mysql 8.0.32 镜像推送到本地仓库</span><br><span class="line">docker tag mysql:8.0.32 myregistry:5000/project1/mysql:8.0.32</span><br><span class="line">docker push myregistry:5000/project1/mysql:8.0.32</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-rmi"><a href="#知识点：docker-rmi" class="headerlink" title="知识点：docker rmi"></a>知识点：docker rmi</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 删除镜像</span><br><span class="line">  - untag 镜像</span><br><span class="line">  - 镜像有多个标签时，只删除镜像只会删除相对应的标签，不会删除镜像</span><br><span class="line">  - 镜像只剩一个标签时，删除镜像会实际删除镜像的文件</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker rmi [OPTIONS] IMAGE [IMAGE...]</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker image rm</span><br><span class="line">  docker image remove</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-image-prune"><a href="#知识点：docker-image-prune" class="headerlink" title="知识点：docker image prune"></a>知识点：docker image prune</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 删除未使用的镜像</span><br><span class="line">  - 删除虚悬镜像</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker image prune [OPTIONS]</span><br><span class="line"></span><br><span class="line">* -a, --all</span><br><span class="line">  - 默认仅删除虚悬镜像</span><br><span class="line">  - 添加 &quot;-a&quot; 选项，删除所有未使用的镜像</span><br><span class="line"></span><br><span class="line">* -f, --force</span><br><span class="line">  - 不要求用户进行确认</span><br><span class="line">  </span><br><span class="line">* --filter label=key</span><br><span class="line">* --filter label!=key</span><br><span class="line">* --filter label=key=value</span><br><span class="line">* --filter label!=key=value</span><br><span class="line">* --filter until=timestamp</span><br><span class="line">  - 添加筛选</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 删除虚悬镜像</span></span><br><span class="line">docker image prune</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除虚悬镜像和所有未使用的镜像</span></span><br><span class="line">docker image prune -a</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除所有的 debug 标签为 <span class="literal">true</span> 的未使用的镜像</span></span><br><span class="line">docker image prune -a --filter label=debug=true</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除所有的在 2024-10-10 以前创建的镜像</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 注意，是镜像创建的时间，而不是镜像构建的时间</span></span><br><span class="line">docker image prune -a --filter &quot;until=2024-10-10&quot;</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-save"><a href="#知识点：docker-save" class="headerlink" title="知识点：docker save"></a>知识点：docker save</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 将镜像保存为一个 tar 文件</span><br><span class="line">  - tar 文件中会保存镜像的所有历史层、镜像的 tag</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker save [OPTION] IMAGE</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker image save</span><br><span class="line"></span><br><span class="line">* -o, --output FILE</span><br><span class="line">  - 默认 docker save 指令会将输出发送到 STDOUT</span><br><span class="line">  - 指定 &quot;-o&quot; 选项，让 docker save 直接将输出保存到 tar 文件中</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将 nginx 镜像保存到 tar 文件中</span></span><br><span class="line">docker save -o nginx_image_1.24.0.tar nginx:1.24.0</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将 nginx 镜像保存到 tar.gz 文件中</span></span><br><span class="line">docker save nginx:1.24.0 | gzip &gt; nginx_image_1.24.0.tar.gz</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-load"><a href="#知识点：docker-load" class="headerlink" title="知识点：docker load"></a>知识点：docker load</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 从 tar、tar.gz 文件中导入镜像</span><br><span class="line">  - docker 会自动还原 tar 文件中保存的镜像的 tag</span><br><span class="line">  - docker 可以自动识别文件使用的压缩工具，自动进行解压缩</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker load [OPTIONS]</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker image load</span><br><span class="line"></span><br><span class="line">* -i, --input FILE  </span><br><span class="line">  - 默认情况下，docker load 会从 STDIN 中读取输入</span><br><span class="line">  - 指定 &quot;-i&quot; 选项，让 docker load 直接读取 tar 文件</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 从 tar 文件中导入 nginx 镜像</span></span><br><span class="line">docker load -i nginx_image_1.24.0.tar</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-commit"><a href="#知识点：docker-commit" class="headerlink" title="知识点：docker commit"></a>知识点：docker commit</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 将容器提交为一个镜像</span><br><span class="line">  - 默认在提交过程中会 pause 容器</span><br><span class="line"></span><br><span class="line">* 卷</span><br><span class="line">  - 只会包含容器中的数据，不会包含卷中的数据</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker commit [OPTIONS] CONTAINER [REPOSITORY[:TAG]]</span><br><span class="line">  docker commit OPTIONS COMTAINER REPOSITORY:TAG</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker container commit</span><br><span class="line"></span><br><span class="line">* -a, --author String</span><br><span class="line">  - 添加作者信息</span><br><span class="line">  - 如 -a &quot;John Hannibal Smith &lt;hannibal@a-team.com&gt;&quot;</span><br><span class="line"></span><br><span class="line">* -m, --message String</span><br><span class="line">  - 添加备注信息</span><br><span class="line"></span><br><span class="line">* -c, --change &quot;instruction&quot;</span><br><span class="line">  - 在将容器提交为镜像时，添加一些修改</span><br><span class="line">  - 修改采用 Dockerfile instruction</span><br><span class="line">  - 支持的 Dockerfile instruction：CMD、ENTRYPOINT、ENV、EXPOSE、LABEL、ONBUILD、USER、VOLUME、WORKDIR</span><br><span class="line"></span><br><span class="line">* -p, --pause false</span><br><span class="line">  - 默认在提交容器时，会将容器 pause</span><br><span class="line">  - 指定 -p false，指定在提交时不要 pause 容器</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将容器提交为一个镜像</span></span><br><span class="line">docker commit u01 test/testimage:v1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将容器提交为一个镜像，并且添加环境变量设置</span></span><br><span class="line">docker commit --change &quot;ENV DEBUG=true&quot; u01 test/testimage:v1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将容器提交为一个镜像，并且修改镜像的默认程序，并且添加暴露端口</span></span><br><span class="line">docker commit --change=&#x27;CMD [&quot;apachectl&quot;, &quot;-DFOREGROUND&quot;]&#x27; -c &quot;EXPOSE 80&quot; u01 test/testimage:v1</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-export"><a href="#知识点：docker-export" class="headerlink" title="知识点：docker export"></a>知识点：docker export</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 将容器的文件系统直接保存为一个 tar 文件</span><br><span class="line"></span><br><span class="line">* 卷</span><br><span class="line">  - 不会包含卷中的数据</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker export [OPTIONS] CONTAINER</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker container export</span><br><span class="line"></span><br><span class="line">* -o, --output FILE</span><br><span class="line">  - 默认 docker export 会将输入发送到 STDOUT</span><br><span class="line">  - 指定 &quot;-o&quot; 选项，让 docker save 直接将数据保存到 tar 文件中</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将容器保存为 tar 文件</span></span><br><span class="line">docker export -o ubuntu.tar u01</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-import"><a href="#知识点：docker-import" class="headerlink" title="知识点：docker import"></a>知识点：docker import</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 从 tar 文件中导入镜像</span><br><span class="line">  - 支持本地文件，也支持 URL，URL 需要也是指向一个 tar 文件</span><br><span class="line">  - 可以自动识别 tar 文件使用的压缩格式</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker import [OPTIONS] FILE|URL|- [REPOSITORY[:TAG]]</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker image import</span><br><span class="line"></span><br><span class="line">* REPOSITORY[:TAG]</span><br><span class="line">  - 覆盖 tar 文件中镜像原来的镜像名和 tag</span><br><span class="line"></span><br><span class="line">* -c, --change &quot;instruction&quot;</span><br><span class="line">  - 在导入时，添加对镜像的修改</span><br><span class="line">  - 使用 Dockerfile instruction，支持的指令：CMD、ENTRYPOINT、ENV、EXPOSE、ONBUILD、USER、VOLUME、WORKDIR</span><br><span class="line"></span><br><span class="line">* -m, --message String</span><br><span class="line">  - 添加注释信息</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 从文件中导入镜像</span></span><br><span class="line">docker import nginx.tar</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从文件中导入镜像，并指定镜像名</span></span><br><span class="line">docker import nginx.tar nginx:v1.1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从文件中导入镜像，并添加修改</span></span><br><span class="line">docker import --change &quot;ENV DEBUG=true&quot; nginx.tar</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 从 URL 导入镜像</span></span><br><span class="line">docker import https://example.com/exampleimage.tgz</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="Chapter04-DockerBuild"><a href="#Chapter04-DockerBuild" class="headerlink" title="Chapter04 DockerBuild"></a>Chapter04 DockerBuild</h1><hr>
<h2 id="4-1-DockerBuild-介绍"><a href="#4-1-DockerBuild-介绍" class="headerlink" title="4.1 DockerBuild 介绍"></a>4.1 DockerBuild 介绍</h2><hr>
<h3 id="知识点：DockerBuild-介绍"><a href="#知识点：DockerBuild-介绍" class="headerlink" title="知识点：DockerBuild 介绍"></a>知识点：DockerBuild 介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* 介绍 </span><br><span class="line">  - DockerBuild 是 Docker 的核心能力之一</span><br><span class="line">  - 它允许用户根据 Dockerfile 创建自定义的 Docker 镜像</span><br><span class="line">  - 镜像是容器运行的基础，而 DockerBuild 的作用就是将应用程序代码、依赖项和系统配置打包成一个可移植、可复现的镜像</span><br><span class="line"></span><br><span class="line">* 构建镜像的核心思想</span><br><span class="line">  - 容器应当是临时的、无状态的 Create ephemeral containers</span><br><span class="line">  - 容器应当尽量精简 Don&#x27;t install unnecessary packages</span><br><span class="line">  - 容器的功能、目标应当尽量解耦 Decouple applications</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>核心概念</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line">* docker build</span><br><span class="line">  - Docker 提供的用来进行 Build 的指令</span><br><span class="line"></span><br><span class="line">* Dockerfile</span><br><span class="line">  - 用来定义如何 Build 镜像的一个文本文件</span><br><span class="line">  - 内容为一系列的指令，如 FROM、RUN、COPY、CMD 等</span><br><span class="line"></span><br><span class="line">* build context</span><br><span class="line">  - 执行 docker build 时，Docker 会将当前目录（或指定路径）的所有文件发送给 Docker 守护进程（daemon）</span><br><span class="line">  - 这个目录称为构建上下文 build context</span><br><span class="line"></span><br><span class="line">* 构建容器</span><br><span class="line">  - docker 在构建镜像时，会按照 Dockerfile 的指令启动一个容器，然后在这个容器内执行各种 Dockerfile 指令，最终将这个容器提交为一个镜像</span><br><span class="line">  - 这个容器就称为构建容器</span><br><span class="line"></span><br><span class="line">* 镜像分层</span><br><span class="line">  - Docker 镜像由多个只读层 Layers 组成</span><br><span class="line">  - 每个 Dockerfile 指令都会生成一个新层，Docker 镜像的每一层也都对应了一个 Dockerfile 指令</span><br><span class="line">  - 仅修改镜像元数据的指令不会创建新层</span><br><span class="line"></span><br><span class="line">* 构建流程</span><br><span class="line">  - 根据基础镜像启动一个构建容器</span><br><span class="line">  - 根据指令，对构建容器进行修改</span><br><span class="line">  - 将修改后的内容提交为一个新的镜像</span><br><span class="line">  - 根据新的镜像再次创建一个容器</span><br><span class="line">  - 读取下一条指令</span><br><span class="line"></span><br><span class="line">* BuildKit</span><br><span class="line">  - Docker BuildKit 是 Docker 最新一代镜像构建引擎，旨在提供更快的构建速度、更高效的缓存机制、更安全的构建过程，并支持并行构建、多阶段优化等高级功能</span><br><span class="line">  - BuildKit 从 Docker 18.09 版本开始引入，从 Docker 23.0+ 成为默认的构建后端</span><br><span class="line"></span><br><span class="line">* 构建缓存 build cache</span><br><span class="line">  - docker 在构建镜像时，会将镜像层进行缓存</span><br><span class="line">  - 当重复构建时，docker 会优先使用缓存，以加快构建速率</span><br><span class="line">  - 除非条件不允许才会真实执行构建操作，此情况称为缓存失效 build cache invalidation</span><br><span class="line">  - 使用 docker build 的 &quot;--no-cache&quot; 选项可以强制不使用缓存</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>DockerBuild 高级功能</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">* 多阶段构建 Multi-stage Builds</span><br><span class="line">  - 在单个 Dockerfile 中定义多个构建阶段，最终仅保留运行时所需的文件和依赖，从而显著减小镜像体积并提升安全性</span><br><span class="line">  - 在 Dockerfile 中指定多个 FROM 指令，每个 FROM 指令即对应了一个 stage</span><br><span class="line">  - 构建过程中，中间 stage 可以使用之前 stage 中的文件，如通过 COPY --from</span><br><span class="line">  - 生成的最终镜像只是最后一个 stage 的内容</span><br><span class="line">  - 一个使用场景：在之前 stage 中安装编译环境并进行编译，在最终 stage 中只保留编译后的二进制程序</span><br><span class="line"></span><br><span class="line">* 多平台构建 Multi-Platform Builds</span><br><span class="line"></span><br><span class="line">* scratch 镜像</span><br><span class="line">  - Docker 的 scratch 镜像是一个特殊的空镜像，它不包含任何文件、依赖或操作系统层，仅作为构建其他镜像的空白起点</span><br><span class="line">  - 优点：</span><br><span class="line">    - 零基础：scratch 是虚拟概念，无实际文件（无法通过 docker pull 获取），代表绝对最小化的构建起点</span><br><span class="line">    - 极简主义：镜像仅包含用户显式添加的文件（如二进制程序），无 Shell、包管理器或系统库</span><br><span class="line">    - 多阶段构建：在最终阶段使用 scratch 剥离构建工具，大幅减小镜像体积</span><br><span class="line">  - 缺点：</span><br><span class="line">    - 无 Shell 环境：无法运行 sh 或 bash，所有操作需通过绝对路径执行</span><br><span class="line">    - 动态链接限制：若程序依赖动态库（如标准 C 库），需静态编译或手动复制所有依赖到镜像。</span><br><span class="line">    - 调试困难：缺少基础工具（如 ls、cat），需通过外部工具或日志排查问题。</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：构建上下文"><a href="#知识点：构建上下文" class="headerlink" title="知识点：构建上下文"></a>知识点：构建上下文</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 构建上下文 build context，是指在执行 docker build 命令时，Docker 引擎用于构建镜像的所有文件和目录的集合</span><br><span class="line">  - docker 在构建镜像时，会将 build context 中所有的内容都发送给 builder</span><br><span class="line">  - docker 在构建镜像时，只能将 build context 中的文件加载到镜像中</span><br><span class="line">  - 使用 ADD、COPY 指令来将文件加载到镜像中</span><br><span class="line">  - build context 可以是本地目录，也可以是一个 git 仓库，如果是 git 仓库，docker 会在后台将仓库克隆下来</span><br><span class="line"></span><br><span class="line">* git 仓库</span><br><span class="line">  - 使用 git 仓库作为 build context 时，可以额外指定所使用的分支、子目录，格式为 #ref:dir</span><br><span class="line">  - ref 指定 branch、tag、commit hash，可以为空，如果是使用 commit hash，则必须是 40 字符的完整 SHA1 hash</span><br><span class="line">  - dir 指定子目录</span><br><span class="line">  - docker build https://github.com/user/myrepo.git#container:docker，使用 container 分支，使用 docker 子目录</span><br><span class="line"></span><br><span class="line">* 指定 build context</span><br><span class="line">  - docker build 指令的最后一个参数 PATH，即指定的是 build context</span><br><span class="line">  - docker build 的 --build-context 选项可以额外指定 build context</span><br><span class="line"></span><br><span class="line">* build context 的范围</span><br><span class="line">  - 对于本地目录，其下的所有文件和子目录都属于 build context 中</span><br><span class="line">  - 对于 git 仓库，仓库下以及所有子模块都数据 build context 中</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>.dockerignore 文件</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - ignore 文件，用来指定哪些文件或目录不应包含在构建上下文中，其作用类似于 Git 的 .gitignore</span><br><span class="line">  - 通过使用 .dockerignore，可以避免将非必需文件如日志、临时文件、开发依赖等加入上下文</span><br><span class="line">  - 优点：</span><br><span class="line">    - 提高构建速度：减少上下文传输量，尤其是 build context 是一个远程来源时</span><br><span class="line">    - 保护敏感数据：防止密钥（如 .env）、版本控制文件（如 .git）等敏感信息被意外打包到镜像中</span><br><span class="line"></span><br><span class="line">* 文件名和位置</span><br><span class="line">  - .dockerignore 文件的存放位置就在 build context 的顶级目录中，文件名就是 .dockerignore</span><br><span class="line"></span><br><span class="line">* 语法</span><br><span class="line">  - .dockerignore 基于 pattern 进行匹配，pattern 采用 unix shell globs 语法，使用 Golang 的 filepath.Match 函数进行计算</span><br><span class="line">  - .dockerignore 文件不解析开头或者结尾的 &#x27;/&#x27; 字符，里面的内容都是以 build context 为根的相对路径</span><br><span class="line">    - 以下四个功能相同：/foo/bar/、/foo/bar、foo/bar/、foo/bar</span><br><span class="line">  - &#x27;#&#x27; 井号表示注释</span><br><span class="line">  - 支持 &#x27;*&#x27; 通配符</span><br><span class="line">  - 支持 &#x27;?&#x27; 通配符</span><br><span class="line">  - 支持 &#x27;**&#x27; 通配符，匹配任意级别目录</span><br><span class="line">  - 支持 &#x27;!&#x27; 表示反向否定</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>build context 范例</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"># 本地目录结构</span><br><span class="line">.</span><br><span class="line">|--index.ts</span><br><span class="line">|--Dockerfile</span><br><span class="line">|--package.json</span><br><span class="line">|--package-lock.json</span><br><span class="line"></span><br><span class="line"># docker file 内容</span><br><span class="line"># syntax=docker/dockerfile:1</span><br><span class="line">FROM node:latest</span><br><span class="line">WORKDIR /src</span><br><span class="line">COPY package.json package-lock.json .</span><br><span class="line">RUN npm ci</span><br><span class="line">COPY index.ts src .</span><br><span class="line"></span><br><span class="line"># docker build 指令</span><br><span class="line">docker build .</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>.dockerignore 范例</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"># 从 build context 的一级目录中中排除所有的 md 文件</span><br><span class="line">*.md</span><br><span class="line"># 从 build context 中排除所有的 .cpp 文件，不管是在哪一级目录里</span><br><span class="line">**.cpp</span><br><span class="line"># 保留 build context 的一级目录中的 README.md 文件</span><br><span class="line">!README.md</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：构建变量和环境变量"><a href="#知识点：构建变量和环境变量" class="headerlink" title="知识点：构建变量和环境变量"></a>知识点：构建变量和环境变量</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">* 构建变量 build arguments</span><br><span class="line">  - 仅在镜像构建阶段有效，不会保留到最终镜像或容器运行时，不过会作为一个元数据保留在镜像的构建历史中</span><br><span class="line">  - 通常用来向 dockerfile 指令传递参数，如 FROM 指令指定基础镜像的版本</span><br><span class="line">  - 使用 ARG 指令定义构建变量</span><br><span class="line">  - docker build 的 --build-arg 参数可以指定/覆盖构建变量，优先级高于 ARG 指令</span><br><span class="line"></span><br><span class="line">* 环境变量 environment variable</span><br><span class="line">  - 在构建阶段、最终镜像、容器运行时均有效</span><br><span class="line">  - 可以包含任何信息，如用作最终容器运行时的执行环境</span><br><span class="line">  - 使用 ENV 指令定义环境变量</span><br><span class="line">  - 对于 multi-stage 构建，每一个 stage 可以集成其父 stage 或祖先 stage 设置的环境变量，不能继承其他 stage 的环境变量</span><br><span class="line">  - docker build 并不支持通过参数 build 阶段修改环境变量的值，因此如果在 build 阶段需要修改环境变量的值需要使用到构建变量</span><br><span class="line">  - docker run 的 --env 参数可以向容器传递/覆盖环境变量</span><br><span class="line">  - 对于以下命令，环境变量的替换由 docker builder 完成：ADD、COPY、ENV、EXPOSE、FROM、LABEL、STOPSIGNAL、USER、VOLUME、WORKDIR、ONBUILD</span><br><span class="line">  - 对于以下命令，环境变量的替换由容器运行时 shell 完成：RUN、CMD、ENTRYPOINT</span><br><span class="line"></span><br><span class="line">* RUN 指令</span><br><span class="line">  - 对于 RUN 指令，构建变量和环境变量都会成为 RUN 指令执行的命令的环境变量</span><br><span class="line">  - 环境变量的优先级高于构建变量</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>构建变量的作用域</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 构建变量有两级作用域，global 和 stage</span><br><span class="line">  - global 级，是定义在第一个 FROM 指令之前的构建变量，只能在每一个 FROM 指令上生效，不能在 stage 中生效</span><br><span class="line">  - stage 级，是定义在某一个 stage 中的构建变量，只会在当前 stage 中生效，不会在其他 stage 生效，但可以在 child stage 中生效</span><br><span class="line">  - stage 级的构建变量不会继承 global 级的构建变量，如果想在 stage 中使用 global 级，需要在 stage 中显式的进行空声明，如 ARG NODE_ENV</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>环境变量的扩展格式</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">* 引用</span><br><span class="line">  $VariableName</span><br><span class="line">  $&#123;VariableName&#125;</span><br><span class="line"></span><br><span class="line">* standard bash modifiers</span><br><span class="line">  - $&#123;VariableName:-Word&#125;，如果变量已设置则结果为该变量的值，如果未设置则结果为 Word</span><br><span class="line">  - $&#123;VariableName:+Word&#125;，如果变量已设置则结果为 Word，如果未设置则结果为空字符串</span><br><span class="line">  - $&#123;variable#pattern&#125;，str=foobarbaz echo $&#123;str#f*b&#125; ==&gt; arbaz，removes the shortest match of pattern from variable, seeking from the start of the string</span><br><span class="line">  - $&#123;variable##pattern&#125;，str=foobarbaz echo $&#123;str##f*b&#125; ==&gt; az，removes the longest match of pattern from variable, seeking from the start of the string</span><br><span class="line">  - $&#123;variable%pattern&#125;，string=foobarbaz echo $&#123;string%b*&#125; ==&gt; foobar，removes the shortest match of pattern from variable, seeking backwards from the end of the string</span><br><span class="line">  - $&#123;variable%%pattern&#125;，string=foobarbaz echo $&#123;string%%b*&#125; ==&gt; foo，removes the longest match of pattern from variable, seeking backwards from the end of the string</span><br><span class="line">  - $&#123;variable/pattern/replacement&#125;，string=foobarbaz echo $&#123;string/ba/fo&#125; ==&gt; fooforbaz，replace the first occurrence of pattern in variable with replacement</span><br><span class="line">  - $&#123;variable//pattern/replacement&#125;，string=foobarbaz echo $&#123;string//ba/fo&#125; ==&gt; fooforfoz，replaces all occurrences of pattern in variable with replacement</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>预定义的构建变量</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">* BUILDPLATFORM</span><br><span class="line">* BUILDOS</span><br><span class="line">* BUILDARCH</span><br><span class="line">* BUILDVARIANT</span><br><span class="line">  - 记录了 builder 所运行的机器的架构信息，global 域</span><br><span class="line"></span><br><span class="line">* TARGETPLATFORM</span><br><span class="line">* TARGETOS</span><br><span class="line">* TARGETARCH</span><br><span class="line">* TARGETVARIANT</span><br><span class="line">  - 记录了目标镜像的架构信息，global 域</span><br><span class="line"></span><br><span class="line">* HTTP_PROXY、http_proxy</span><br><span class="line">* HTTPS_PROXY、https_proxy</span><br><span class="line">* FTP_PROXY、ftp_proxy</span><br><span class="line">* NO_PROXY、no_proxy</span><br><span class="line">* ALL_PROXY、all_proxy</span><br><span class="line">  - 配置和记录 build 阶段使用的代理信息</span><br><span class="line">  - 通过 --build-arg 参数，可以修改这些构建变量的值，继而为构建过程指定使用的网络代理</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：build-secret"><a href="#知识点：build-secret" class="headerlink" title="知识点：build secret"></a>知识点：build secret</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - secret 用来临时将敏感信息存放到构建容器中进行使用，如密码、api token 等</span><br><span class="line">  - 在最终构建完成的镜像中，不会保存 secret</span><br><span class="line"></span><br><span class="line">* 使用</span><br><span class="line">  - 在 docker build 指令上配置 secret</span><br><span class="line">  - 在 RUN 指令使用 --mount=secret 挂载 secret，secret 只针对当前 RUN 指令生效</span><br><span class="line"></span><br><span class="line">* bind secret</span><br><span class="line">  - 以文件挂载的形式，向构建容器传递 secret</span><br><span class="line">  - Sources：secret 的来源可以是一个文件，或者环境变量</span><br><span class="line">  - Target：secret 可以被挂载为一个文件，或者环境变量，默认为以文件的形式挂载到 /run/secrets/&lt;id&gt; 文件上</span><br><span class="line"></span><br><span class="line">* ssh secret</span><br><span class="line">  - 将 ssh 秘钥挂载进构建容器中</span><br><span class="line">  </span><br></pre></td></tr></table></figure></li>
<li><strong>bind secret 范例</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># 在 docker build 指令上配置 secret</span><br><span class="line">docker build --secret id=aws,src=$HOME/.aws/credentials .</span><br><span class="line"></span><br><span class="line"># 在 dockerfile 中使用 secret</span><br><span class="line">RUN --mount=type=secret,id=aws AWS_SHARED_CREDENTIALS_FILE=/run/secrets/aws aws s3 cp ...</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-build"><a href="#知识点：docker-build" class="headerlink" title="知识点：docker build"></a>知识点：docker build</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 使用 Dockerfile 创建镜像</span><br><span class="line">  - 推荐将使用的命令放在 Dockerfile 同级的 sh 脚本中，命名为 build-command.sh</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker build [OPTIONS] &#123;PATH | URL&#125;</span><br><span class="line"></span><br><span class="line">* 别名</span><br><span class="line">  docker buildx build</span><br><span class="line">  docker builder build</span><br><span class="line">  docker image build</span><br><span class="line">  docker buildx b</span><br><span class="line"></span><br><span class="line">* PATH</span><br><span class="line">  - 指定 build context，应当是一个目录</span><br><span class="line">  - 如果无特殊指定，则 Dockerfile 默认采用 build context 下的文件名为 Dockerfile 的文件</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>常用选项</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">* -t IMAGE:TAG</span><br><span class="line">  - 为镜像指定标签</span><br><span class="line">  - 可以同时指定多个 -t 选项，为镜像添加多个标签</span><br><span class="line">  - 省略 TAG，则表示 TAG 为 latest</span><br><span class="line"></span><br><span class="line">* -f, --file FILE</span><br><span class="line">  - 指定所使用的 Dockerfile</span><br><span class="line"></span><br><span class="line">* --build-arg NAME=VALUE</span><br><span class="line">  - 指定构建变量</span><br><span class="line">  - 范例：docker build --build-arg HTTP_PROXY=http://10.20.30.2:1234 .</span><br><span class="line"></span><br><span class="line">* --build-context NAME=VALUE</span><br><span class="line">  - 指定额外的 build context</span><br><span class="line">  - VALUE 可以指定本地目录、git 仓库</span><br><span class="line">  - 在 Dockerfile 使用时，通过 COPY 的 --from 选项来从额外的 build context 中添加内容</span><br><span class="line">  - 范例：docker build --build-context app=/src/app .</span><br><span class="line"></span><br><span class="line">* --secret [type=file,]id=ID[,src=&lt;FILEPATH&gt;]</span><br><span class="line">* --secret [type=env,]id=ID[,env=VARIABLE]</span><br><span class="line">  - 在构建过程中指定 secret</span><br><span class="line">  - secret 在构建过程中可以在 RUN --mount=type=secret 中使用</span><br><span class="line">  - type=file，从文件中获取内容作为 secret，文件的内容为 secret 的值</span><br><span class="line">  - type=env，从环境变量中获取内容作为 secret，环境变量的值为 secret 的值</span><br><span class="line">  - 如果省略了 type，则 docker build 会自动确定 secret 的类型</span><br><span class="line">    - 如果本地环境中有一个与 id 同名的环境变量，则 docker build 自动识别 secret 为 env 类型并将此环境变量的值作为 secret 的值</span><br><span class="line">    - 范例：SECRET_TOKEN=token docker build --secret id=SECRET_TOKEN .</span><br><span class="line">    - 否则，docker build 识别 type 为 file</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>其他选项</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">* --add-host NAME=VALUE</span><br><span class="line">  - 在容器的 /etc/hosts 中添加条目，支持特殊值 host-gateway</span><br><span class="line">  - 范例：docker build --add-host host1=8.8.8.8 --add-host host1_v6=2001:4860:4860::8888 .</span><br><span class="line"></span><br><span class="line">* --no-cache</span><br><span class="line">  - 构建镜像时不使用缓存</span><br><span class="line">  - 镜像的每一层都是完全重新构建，而不是利用已有的分层数据</span><br><span class="line"></span><br><span class="line">* --platform=value[,value]</span><br><span class="line">  - 指定目标镜像的架构</span><br><span class="line"></span><br><span class="line">* --push</span><br><span class="line">  - 在构建镜像时直接将镜像推送到 register 上</span><br><span class="line">  - 此时 -t 选项应当使用 &lt;registry&gt;/&lt;image&gt; 的格式</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 绝对路径方式</span></span><br><span class="line">docker build -t IMAGE:TAG /projects/project01</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 相对路径方式</span></span><br><span class="line">cd /projects/project01</span><br><span class="line">docker build -t IMAGE:TAG</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-buildx"><a href="#知识点：docker-buildx" class="headerlink" title="知识点：docker buildx"></a>知识点：docker buildx</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - docker buildx 是 docker 提供的新版本的 build 指令，原来的 build 指令改称为 docker build (legacy builder)</span><br><span class="line">  - 本质上，执行 docker build 实际上是在执行 docker buildx build</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>相关指令</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">* docker buildx ls</span><br><span class="line">  - List builder instances</span><br><span class="line"></span><br><span class="line">* docker buildx du</span><br><span class="line">  - shows the disk usage for the currently selected builder</span><br><span class="line"></span><br><span class="line">* docker buildx prune</span><br><span class="line">  - Remove build cache</span><br><span class="line"></span><br><span class="line">* docker buildx history ls</span><br><span class="line">  - List completed builds recorded by the active builder</span><br><span class="line"></span><br><span class="line">* docker buildx history logs</span><br><span class="line">  - Print the logs for a completed build</span><br><span class="line"></span><br><span class="line">* docker buildx inspect</span><br><span class="line">  - Inspect current builder instance</span><br><span class="line"></span><br><span class="line">* docker buildx create</span><br><span class="line">  - Create a new builder instance</span><br><span class="line"></span><br><span class="line">* docker buildx rm</span><br><span class="line">  - Remove one or more builder instances</span><br><span class="line"></span><br><span class="line">* docker buildx stop</span><br><span class="line">  - Stop builder instance</span><br><span class="line"></span><br><span class="line">* docker buildx use</span><br><span class="line">  - Switches the current builder instance</span><br><span class="line"></span><br><span class="line">* docker buildx version</span><br><span class="line">  - Show buildx version information</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="4-2-DockerFile"><a href="#4-2-DockerFile" class="headerlink" title="4.2 DockerFile"></a>4.2 DockerFile</h2><hr>
<h3 id="知识点：Dockerfile-介绍"><a href="#知识点：Dockerfile-介绍" class="headerlink" title="知识点：Dockerfile 介绍"></a>知识点：Dockerfile 介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">* Dockerfile</span><br><span class="line">  - 用来构建镜像的文本文件脚本</span><br><span class="line"></span><br><span class="line">* Dockerfile 的文件名</span><br><span class="line">  - Dockerfile 的默认文件名就是 Dockerfile，通过 dir 来区分项目</span><br><span class="line">  - docker build 的 --file 选项可以手动指定使用的 Dockerfile</span><br><span class="line"></span><br><span class="line">* 官方镜像的 Dockerfile</span><br><span class="line">  - https://github.com/docker-library</span><br><span class="line"></span><br><span class="line">* Dockerfile 内容的编排</span><br><span class="line">  - 不容易变动的部分放在 Dockerfile 的前部，如基础镜像、基础依赖软件、基础环境设置等</span><br><span class="line">  - 经常变动的部分放在 Dockerfile 的后部，如程序功能代码、相关变量等</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：Dockerfile-语法"><a href="#知识点：Dockerfile-语法" class="headerlink" title="知识点：Dockerfile 语法"></a>知识点：Dockerfile 语法</h3><ol>
<li><strong>基础</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 指令不区分大小写，推荐大写</span><br><span class="line"></span><br><span class="line">* &#x27;#&#x27; 表示注释</span><br><span class="line"></span><br><span class="line">* &#x27;\&#x27; 可以续行</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>解析器指令 Parser directives</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 解析器指令，是一种特殊的注释行，用来在构建镜像时影响 Docker 对 Dockerfile 的解析行为</span><br><span class="line">  - 解析器指令只在构建阶段生效，不会保留在最终的构建结果中</span><br><span class="line">  - 解析器指令，类似于 shebang，必须放在 dockerfile 的最开头，要在所有的注释、所有的空行、所有的 dockerfile 指令之前</span><br><span class="line">  - directives 不区分大小写，推荐小写</span><br><span class="line">  - value 区分大小写</span><br><span class="line">  - 解析器指令有三个，syntax、escape、check</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  # DIRECTIVE=VALUE</span><br><span class="line"></span><br><span class="line">* syntax</span><br><span class="line">  - 指定 dockerfile 的语法版本</span><br><span class="line">  - 推荐值：# syntax=docker/dockerfile:1</span><br><span class="line"></span><br><span class="line">* excape</span><br><span class="line">  - 指定使用的跳脱字符</span><br><span class="line">  - windows 推荐值：# escape=`，因为在 windows 中 \ 被用作路径分隔符</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：Dockerfile-的-shell-格式和-exec-格式"><a href="#知识点：Dockerfile-的-shell-格式和-exec-格式" class="headerlink" title="知识点：Dockerfile 的 shell 格式和 exec 格式"></a>知识点：Dockerfile 的 shell 格式和 exec 格式</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - Dockerfile 中的 RUN、CMD、ENTRYPOINT 指令支持两种格式，shell 格式和 exec 格式</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>exec 格式</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">* 单行格式</span><br><span class="line">  INSTRUCTION [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot; ...]</span><br><span class="line"></span><br><span class="line">* 多行格式</span><br><span class="line">  INSTRUCTION </span><br><span class="line">  - &quot;executable&quot;</span><br><span class="line">  - &quot;param1&quot;</span><br><span class="line">  - &quot;param2&quot;</span><br><span class="line">  ...</span><br><span class="line"></span><br><span class="line">* 说明</span><br><span class="line">  - exec 格式会被解析为 JSON array，因此必须使用双引号，不能使用单引号</span><br><span class="line">  - 列表中第一个元素必须代表要运行的程序</span><br><span class="line">  - 列表中其他的元素代表命令的参数</span><br><span class="line">  - ENTRYPOINT 指令推荐使用 exec 格式</span><br><span class="line"></span><br><span class="line">* &quot;/bin/bash&quot; &quot;-c&quot; 方式</span><br><span class="line">  - exec 格式并不会通过 shell 来调用程序，而是直接调用指定要运行的程序</span><br><span class="line">  - 对于一些 shell 的常用功能，如变量替换、bash-builtin，exec 格式可能无法完成</span><br><span class="line">  - 因此，exec 格式常用的方式为通过 &quot;/bin/bash&quot; &quot;-c&quot; 方式来启动</span><br><span class="line">  - 范例：ENTRYPOINT [&quot;/bin/bash&quot;, &quot;-c&quot;, &quot;echo&quot;, &quot;$HOME&quot;]</span><br><span class="line">  </span><br></pre></td></tr></table></figure></li>
<li><strong>shell 格式</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  INSTRUCTION command param1 param2</span><br><span class="line"></span><br><span class="line">* 说明</span><br><span class="line">  - shell 格式必定会调用一个 shell 来执行命令</span><br><span class="line">  - 整个命令行的参数会被组成一个长字符串，发送给 shell 进行执行</span><br><span class="line">  - 因此，shell 格式支持使用 &quot;\&quot; 进行断行、支持 heredocs</span><br><span class="line">  - 较长的 shell 指令推荐使用 &quot;\&quot; 进行断行，每行一个参数，这样便于维护</span><br><span class="line">  - RUN 指令推荐使用 shell 格式</span><br><span class="line"></span><br><span class="line">* SHELL 指令</span><br><span class="line">  - Dockerfile 的 SHELL 指令，可以调整 shell 格式调用的 shell</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：Dockerfile-范例"><a href="#知识点：Dockerfile-范例" class="headerlink" title="知识点：Dockerfile 范例"></a>知识点：Dockerfile 范例</h3><ol>
<li><strong>范例一，构建具有 vim 的镜像</strong><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install vim</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> tail -f /etc/passwd &gt; /dev.null</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例二，构建具有 jdk1.8 的镜像</strong><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装基础软件包</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum -y install glibc.i686</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># java 安装到 /uar/local/java</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir /usr/<span class="built_in">local</span>/java</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> jdk-8u311.xxxx.tar.gz /uar/<span class="built_in">local</span>/java</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 配置环境变量</span></span><br><span class="line"><span class="keyword">ENV</span> JAVA_HOME /usr/local/java/jdk1.<span class="number">8.0</span>xxxx</span><br><span class="line"><span class="keyword">ENV</span> JRE_HOME $JAVA_HOME/jre</span><br><span class="line"><span class="keyword">ENV</span> CLASSPATH $JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar:$JRE_HOME/lib:$CLASSPATH</span><br><span class="line"><span class="keyword">ENV</span> PATH $JAVA_HOME/bin:$PATH</span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> tail -f /etc/passwd &gt; /dev.null</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例三，构建编译安装 nginx 的镜像</strong><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">FROM</span> centos:<span class="number">7</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 安装一些依赖软件</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install -y vim iotop bc gcc gcc-c++ glibc glibc-devel tree telnet lsof wget tcpdump bash-completion traceroute</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install -y pcre pcre-devel openssl openssl-devel</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> yum install -y zip unzip zlib-devel net-tools lrzsz ntpdate libevent libevent-devel systemd-devel</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝源码文件</span></span><br><span class="line"><span class="comment"># 保存在 /usr/local/</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> nginx-1.18.0.tar.gz /usr/<span class="built_in">local</span>/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 编译安装</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /usr/<span class="built_in">local</span>/src/nginx-1.18.0</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> ./configure --prefix=/usr/<span class="built_in">local</span>/nginx &amp;&amp; make &amp;&amp; make install</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝配置文件</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> nginx.conf /usr/<span class="built_in">local</span>/nginx/conf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 拷贝 web 代码</span></span><br><span class="line"><span class="keyword">ADD</span><span class="bash"> code.tar.gz /usr/<span class="built_in">local</span>/nginx/html/</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 创建用户</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> useradd nginx -s /sbin/nologin</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 修改 nginx 相关文件的用户和组</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> chown nginx.nginx /usr/<span class="built_in">local</span>/nginx/nginx</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span> <span class="number">443</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">ENTRYPOINT</span><span class="bash"> [<span class="string">&quot;/usr/local/nginx/sbin/nginx&quot;</span>,<span class="string">&quot;-g&quot;</span>,<span class="string">&quot;daemon off;&quot;</span>]</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：FROM-指令"><a href="#知识点：FROM-指令" class="headerlink" title="知识点：FROM 指令"></a>知识点：FROM 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - FROM 指令，用来创建一个新的构建阶段，并为后续指令设置基础映像</span><br><span class="line">  - 因此，一个有效的 Dockerfile 的第一条指令必须是 FROM 指令</span><br><span class="line"></span><br><span class="line">* 关于 ARG 指令</span><br><span class="line">  - 只有在一种特殊情况下，FROM 可以不是 Dockerfile的第一条指令，就是在 FROM 指令前使用一个或多个 ARG 指令来声明变量</span><br><span class="line">  - 此种 ARG 指令声明的变量不在构建阶段之内，仅能用于 FROM 指令，无法用于 FROM 之后的其他所有指令</span><br><span class="line">  - 如果想要使用在 FROM 之前的 ARG 声明的默认值，需要再在 FROM 指令之后，使用不带值的 ARG 指令再次进行声明</span><br><span class="line"></span><br><span class="line">* 镜像来源</span><br><span class="line">  - Docker Official Images</span><br><span class="line">  - Verified Publisher</span><br><span class="line">  - Docker-Sponsored Open Source</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>语法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  FROM [--platform=&lt;platform&gt;] IMAGE[:TAG] [AS &lt;name&gt;]</span><br><span class="line">  FROM [--platform=&lt;platform&gt;] IMAGE[@DIGEST] [AS &lt;name&gt;]</span><br><span class="line"></span><br><span class="line">* --platform=&lt;platform&gt;</span><br><span class="line">  - 如果 FROM 指定的镜像是一个多平台镜像 multi-platform image，可以使用 --platform 选项指定具体的架构</span><br><span class="line">  - 可选值包括 linux/amd64、linux/arm64、windows/amd64 等</span><br><span class="line">  - 如果不指定 --platform，则默认才有与构建平台相同架构的镜像</span><br><span class="line"></span><br><span class="line">* AS &lt;name&gt;</span><br><span class="line">  - 在一个 Dockerfile 中，可以出现多个 FROM 指令，每个指令用于指定一个构建阶段，此即为多阶段构建 Multi-stage Builds</span><br><span class="line">  - 使用 AS &lt;anme&gt; 来对某一个阶段进行命名</span><br><span class="line">  - 后续的构建阶段可以使用之前的构建阶段之中的文件，如 COPY --from=&lt;name&gt; 或 RUN --mount=type=bind,from=&lt;name&gt;</span><br><span class="line"></span><br><span class="line">* IMAGE@DIGEST</span><br><span class="line">  - 通常在 FROM 指令上指定镜像都是采用 IMAGE:TAG 的方式，但如果 TAG 有小版本的升级，则可能导致重复构建时使用的镜像不同，造成 cache miss</span><br><span class="line">  - 使用 IMAGE@DIGEST 可以定死所使用的的基础镜像</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 范例一，基础用法</span></span><br><span class="line"><span class="keyword">FROM</span> ubuntu:latest</span><br><span class="line"></span><br><span class="line"><span class="comment"># 范例二，在 FROM 指令之前使用 ARG 声明</span></span><br><span class="line"><span class="keyword">ARG</span>  CODE_VERSION=latest</span><br><span class="line"><span class="keyword">FROM</span> base:$&#123;CODE_VERSION&#125;</span><br><span class="line"><span class="keyword">CMD</span><span class="bash">  /code/run-app</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">FROM</span> extras:$&#123;CODE_VERSION&#125;</span><br><span class="line"><span class="keyword">CMD</span><span class="bash">  /code/run-extras</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 范例三，在 FROM 指令之前使用 ARG 声明，并在 FROM 指令之后再次声明</span></span><br><span class="line"><span class="keyword">ARG</span> VERSION=latest</span><br><span class="line"><span class="keyword">FROM</span> busybox:$VERSION</span><br><span class="line"><span class="keyword">ARG</span> VERSION</span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> <span class="variable">$VERSION</span> &gt; image_version</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：LABEL-指令"><a href="#知识点：LABEL-指令" class="headerlink" title="知识点：LABEL 指令"></a>知识点：LABEL 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 为镜像添加各种元数据信息，如维护者、版本等</span><br><span class="line">  - 标签只是更改镜像的元数据，不会使镜像产生额外的分层</span><br><span class="line">  - LABEL 指令添加的信息可以被 inspect 命令查看到</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  LABEL KEY=VALUE [KEY=VALUE ...]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">LABEL</span><span class="bash"> version=<span class="string">&quot;1.0&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> maintainer=<span class="string">&quot;xxx XXX@126.com&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> description=<span class="string">&quot;This text xxxx.&quot;</span></span></span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> org.opencontainers.image.authors=<span class="string">&quot;SvenDowideit@home.org.au&quot;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 查看镜像的标签</span></span><br><span class="line">docker image inspect --format=<span class="string">&#x27;&#123;&#123;json .Config.Labels&#125;&#125;&#x27;</span> MY_image</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：MAINTAINER-指令"><a href="#知识点：MAINTAINER-指令" class="headerlink" title="知识点：MAINTAINER 指令"></a>知识点：MAINTAINER 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 指定镜像的作者</span><br><span class="line">  - 指令已不推荐，改用 LABEL</span><br><span class="line"></span><br><span class="line">* 范例</span><br><span class="line">  MAINTAINER jay&lt;XXX@126.com&gt;</span><br><span class="line">  MAINTAINER &quot;jay XXX@126.com&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：ARG-指令"><a href="#知识点：ARG-指令" class="headerlink" title="知识点：ARG 指令"></a>知识点：ARG 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 设置构建变量</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  ARG &lt;name&gt;[=&lt;value&gt;] [&lt;name&gt;[=&lt;value&gt;]...]</span><br><span class="line">  </span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：ENV-指令"><a href="#知识点：ENV-指令" class="headerlink" title="知识点：ENV 指令"></a>知识点：ENV 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 设置环境变量</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  ENV &lt;name&gt;=&lt;value&gt; [&lt;name&gt;=&lt;value&gt;...]</span><br><span class="line">  ENV &lt;name&gt; &lt;value&gt;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：RUN-指令"><a href="#知识点：RUN-指令" class="headerlink" title="知识点：RUN 指令"></a>知识点：RUN 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 运行相应的指令，可以是 shell，所有的命令都应保证是非交互的</span><br><span class="line"></span><br><span class="line">* Shell 格式</span><br><span class="line">  RUN [OPTIONS] &lt;command&gt; ...</span><br><span class="line">* Exec 格式</span><br><span class="line">  RUN [OPTIONS] [ &quot;&lt;command&gt;&quot;, ... ]</span><br><span class="line"></span><br><span class="line">* apt-get</span><br><span class="line">  - 默认情况下，RUN 指令会自动使用构建缓存</span><br><span class="line">  - 对于 RUN apt-get -y install 方式的指令，如果已经存在缓存，则可能使用缓存而不是实际执行 RUN 指令，这可能导致镜像中的依赖不是最新版</span><br><span class="line">  - 可以使用 docker build 的 --no-cache 选项强制跳过缓存</span><br><span class="line">  - 也可以采用 RUN apt-get -y update &amp;&amp; apt-get -y install 的方式，这种方法称为缓存破坏 cache busting</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>–mount 选项</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 在 RUN 指令运行期间添加一个外部的挂载，仅在当前 RUN 指令执行期间生效</span><br><span class="line">  - 挂载的文件不会保存在镜像中</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  RUN --mount=[type=&lt;TYPE&gt;][,option=&lt;value&gt;[,option=&lt;value&gt;]...]</span><br><span class="line"></span><br><span class="line">* RUN --mount=type=bind</span><br><span class="line">  - 临时将外部文件挂载到构建容器内</span><br><span class="line">  - 范例：RUN --mount=type=bind,source=requirements.txt,target=/tmp/requirements.txt pip install --requirement /tmp/requirements.txt</span><br><span class="line"></span><br><span class="line">* RUN --mount=type=secret</span><br><span class="line">  - 临时将 secret 挂载到构建容器内</span><br><span class="line">  - 范例，将 secret 挂载为文件：RUN --mount=type=secret,id=aws,target=/root/.aws/credentials aws s3 cp s3://...</span><br><span class="line">  - 范例，将 secret 挂载为环境变量：RUN --mount=type=secret,id=API_KEY,env=API_KEY some-command --token-from-env $API_KEY</span><br><span class="line"></span><br><span class="line">* RUN --mount=type=ssh</span><br><span class="line">  - ​​将 SSH 密钥​​挂载到构建容器中</span><br><span class="line"></span><br><span class="line">* RUN --network</span><br><span class="line">  - 控制当前 RUN 执行时的网络环境</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：CMD-指令"><a href="#知识点：CMD-指令" class="headerlink" title="知识点：CMD 指令"></a>知识点：CMD 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 指定容器启动后执行的指令</span><br><span class="line">  - 如果有多个 CMD 设置，则只有最后一个 CMD 设置有效，其他的 CMD 设置会被覆盖</span><br><span class="line"></span><br><span class="line">* CMD 指令的用处</span><br><span class="line">  - 指定容器启动后运行的进程</span><br><span class="line">    - CMD 指令需采用 shell 格式或 exec 可执行程序格式</span><br><span class="line">    - Dockerfile 中应当没有 ENTRYPOINT 指令</span><br><span class="line">    - 如果 docker run 指定了执行命令，则 CMD 会被覆盖</span><br><span class="line">  - 向 ENTRYPOINT 指令传递默认参数</span><br><span class="line">    - CMD 指令需采用 exec 参数格式</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>格式</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* shell 格式</span><br><span class="line">  CMD command param1 param2</span><br><span class="line"></span><br><span class="line">* exec 可执行程序格式</span><br><span class="line">  CMD [&quot;executable&quot;,&quot;param1&quot;,&quot;param2&quot;]</span><br><span class="line"></span><br><span class="line">* exec 参数格式</span><br><span class="line">  CMD [&quot;param1&quot;,&quot;param2&quot;]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：ENTRYPOINT-指令"><a href="#知识点：ENTRYPOINT-指令" class="headerlink" title="知识点：ENTRYPOINT 指令"></a>知识点：ENTRYPOINT 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 指定容器启动后执行的指令</span><br><span class="line">  - 如果有多个 ENTRYPOINT 设置，则只有最后一个 ENTRYPOINT 设置会生效</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>ENTRYPOINT 指令、CMD 指令、docker run command 的关系</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">* 没有 ENTRYPOINT 指令有 CMD 指令</span><br><span class="line">  - 由 CMD 指令指定容器启动后执行的程序</span><br><span class="line">  - CMD 指令需使用 shell 格式或 exec 可执行程序格式</span><br><span class="line">  - 如果 docker run 指定了可执行程序，则 docker run 的配置会覆盖 CMD 指令</span><br><span class="line"></span><br><span class="line">* 有 ENTRYPOINT 指令且为 exec 格式</span><br><span class="line">  - 由 ENTRYPOINT 指令指定容器启动后执行的程序</span><br><span class="line">  - CMD 指令的内容会追加到 ENTRYPOINT 指令的末尾作为参数</span><br><span class="line">  - 如果 docker run 指定了内容，则 docker run 的配置会覆盖 CMD 指令</span><br><span class="line">  - CMD 指令应当使用 exec 格式（如果 CMD 指令是 shell 格式见 DockerDoc 没看明白）</span><br><span class="line"></span><br><span class="line">* 有 ENTRYPOINT 指令且为 shell 格式</span><br><span class="line">  - 由 ENTRYPOINT 指令指定容器启动后执行的程序</span><br><span class="line">  - CMD 指令的内容无效</span><br><span class="line">  - docker run 指定的内容无效</span><br><span class="line"></span><br><span class="line">* 没有 ENTRYPOINT 指令也没有 CMD 命令</span><br><span class="line">  - 报错，Dockerfile 应当至少指定 CMD、ENTRYPOINT 之一</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>格式</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* shell 格式</span><br><span class="line">  ENTRYPOINT command param1 param2</span><br><span class="line"></span><br><span class="line">* exec 格式</span><br><span class="line">  ENTRYPOINT [&quot;executable&quot;, &quot;param1&quot;, &quot;param2&quot;]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：ADD-指令"><a href="#知识点：ADD-指令" class="headerlink" title="知识点：ADD 指令"></a>知识点：ADD 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 将文件或目录复制到镜像中</span><br><span class="line">  - 来源可以是 build context、remote URL、Git repository</span><br><span class="line">  - 对于 tar 包，如果来自本地文件，则 ADD 会自动进行解压</span><br><span class="line">  - 对于远程文件，如果带认证，则 ADD 指令无法完成，需要用 RUN wget 或 RUN curl 来实现</span><br><span class="line">  - 对于远程文件，推荐使用 ADD 指令而不是 COPY 指令</span><br><span class="line"></span><br><span class="line">* 注意</span><br><span class="line">  - ADD 无法自动解压 zip 文件</span><br><span class="line">  - ADD 解压 tar 包要注意 tar 包文件的覆盖问题，尤其是 tar 包内文件是以 &#x27;/&#x27; 开头的情况</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  ADD [OPTIONS] SRC ... DEST</span><br><span class="line">  ADD [OPTIONS] [&quot;SRC&quot;,... &quot;DEST&quot;]</span><br><span class="line"></span><br><span class="line">* SRC</span><br><span class="line">  - 可以包含多个</span><br><span class="line">  - 支持本地文件、远程文件、git 仓库</span><br><span class="line">  - 可以包含支持 go filepath 的 wildcard</span><br><span class="line">  - 如果来源是 build context，则所有的路径都是以 build context 为起点，例如 file1.txt、/file1.txt、../file1.txt 指的都是 build context 下的 file1.txt</span><br><span class="line"></span><br><span class="line">* DEST</span><br><span class="line">  - 只能包含一个</span><br><span class="line">  - 目录如果不存在则会自动创建</span><br><span class="line"></span><br><span class="line">* 选项</span><br><span class="line">  --chown</span><br><span class="line">  --chmod</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：COPY-指令"><a href="#知识点：COPY-指令" class="headerlink" title="知识点：COPY 指令"></a>知识点：COPY 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 将 build context 的文件复制到镜像中</span><br><span class="line">  - 来源可以是 build context、remote URL、Git repository、build stage、named context、image</span><br><span class="line">  - COPY 不会进行自动解压 tar 包</span><br><span class="line">  </span><br><span class="line">* 格式</span><br><span class="line">  COPY [OPTIONS] SRC ... DEST</span><br><span class="line">  COPY [OPTIONS] [&quot;SRC&quot;,... &quot;DEST&quot;]</span><br><span class="line"></span><br><span class="line">* SRC</span><br><span class="line">  - 可以包含多个</span><br><span class="line">  - 可以包含支持 go filepath 的 wildcard</span><br><span class="line">  - 如果来源是 build context，则所有的路径都是以 build context 为起点，例如 file1.txt、/file1.txt、../file1.txt 指的都是 build context 下的 file1.txt</span><br><span class="line"></span><br><span class="line">* DEST</span><br><span class="line">  - 只能包含一个</span><br><span class="line">  - 目录可以自动创建</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>选项</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* --chown=USER:GROUP</span><br><span class="line">  - 修改文件的 onwer 和 group</span><br><span class="line"></span><br><span class="line">* --chmod=PERMS</span><br><span class="line">  - 修改文件的权限</span><br><span class="line"></span><br><span class="line">* --from=&lt;image|stage|context&gt;</span><br><span class="line">  - 默认情况下，COPY 指令从 build context 中拷贝文件</span><br><span class="line">  - 使用 --from 选项，可以让 COPY 指令从 build stage、named context、image 中拷贝文件</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：EXPOSE-指令"><a href="#知识点：EXPOSE-指令" class="headerlink" title="知识点：EXPOSE 指令"></a>知识点：EXPOSE 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 声明容器需要对外暴露的端口</span><br><span class="line">  - EXPOSE 只是声明端口，实际暴露端口仍需要在运行容器时通过 -p 或 -P 选项实现</span><br><span class="line">  - 默认协议为 tcp</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  EXPOSE &lt;port&gt; [&lt;port&gt;[/&lt;protocol&gt;] ...]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">80</span>/tcp <span class="number">80</span>/udp</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：SHELL-指令"><a href="#知识点：SHELL-指令" class="headerlink" title="知识点：SHELL 指令"></a>知识点：SHELL 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 对于 RUN、CMD、ENTRYPOINT 指令，当使用 shell 格式的命令时，修改默认的 shell 程序</span><br><span class="line">  - SHELL 指令可以在 dockerfile 中出现多次，每个 SHELL 指令都会覆盖所有先前的 SHELL 指令，并影响所有后续的指令</span><br><span class="line">  - Linux 的默认 shell 是 [&quot;/bin/sh&quot;, &quot;-c&quot;]</span><br><span class="line">  - Windows 的 默认 shell 是 [&quot;cmd&quot;, &quot;/S&quot;, &quot;/C&quot;]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  SHELL [&quot;executable&quot;, &quot;parameters&quot;]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight dockerfile"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 在 linux 中指定默认 shell 为 bash</span></span><br><span class="line"><span class="comment"># /bin/bash 相比于 /bin/sh 支持很多额外的特性，例如数组、条件判断等</span></span><br><span class="line"><span class="keyword">SHELL</span><span class="bash"> [<span class="string">&quot;/bin/bash&quot;</span>, <span class="string">&quot;-c&quot;</span>]</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 windows 中指定默认 shell 为 powershell</span></span><br><span class="line"><span class="keyword">SHELL</span><span class="bash"> [<span class="string">&quot;powershell&quot;</span>, <span class="string">&quot;-command&quot;</span>]</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> Write-Host hello</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 在 windows 中指定默认 shell 为 cmd</span></span><br><span class="line"><span class="keyword">SHELL</span><span class="bash"> [<span class="string">&quot;cmd&quot;</span>, <span class="string">&quot;/S&quot;</span>, <span class="string">&quot;/C&quot;</span>]</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> <span class="built_in">echo</span> hello</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：WORKDIR-指令"><a href="#知识点：WORKDIR-指令" class="headerlink" title="知识点：WORKDIR 指令"></a>知识点：WORKDIR 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 在 dockerfile 中，对于 WORKDIR 指令之后的 RUN、CMD、ENTRYPOINT、COPY、ADD，切换工作目录</span><br><span class="line">  - 如果目录不存在，则 WORKDIR 指令会自动创建此目录</span><br><span class="line">  - 默认的 working directory 为 /</span><br><span class="line"></span><br><span class="line">* 变量</span><br><span class="line">  - WORKDIR 只支持在 dockerfile 中显式定义的 ENV 环境变量，不支持其他类型的变量</span><br><span class="line"></span><br><span class="line">* 绝对路径和相对路径</span><br><span class="line">  - 如果 WORKDIR 指令的参数是一个相对路径，则按照当前的 working directory 为基础切换路径</span><br><span class="line">  - 推荐使用绝对路径</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  WORKDIR /path/to/workdir</span><br><span class="line">  WORKDIR relative_path</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：USER-指令"><a href="#知识点：USER-指令" class="headerlink" title="知识点：USER 指令"></a>知识点：USER 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - 对后续的指令，设置操作的用户</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  USER &lt;user&gt;[:&lt;group&gt;]</span><br><span class="line">  USER &lt;UID&gt;[:&lt;GID&gt;]</span><br><span class="line"></span><br><span class="line">* group</span><br><span class="line">  - 如果指定了组，则后续的指令中用户将仅具有指定的组身份，其他配置的组身份都将被忽略</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="Chapter05-DockerRegistry"><a href="#Chapter05-DockerRegistry" class="headerlink" title="Chapter05 DockerRegistry"></a>Chapter05 DockerRegistry</h1><hr>
<h2 id="5-1-DockerRegistry-介绍"><a href="#5-1-DockerRegistry-介绍" class="headerlink" title="5.1 DockerRegistry 介绍"></a>5.1 DockerRegistry 介绍</h2><hr>
<h3 id="知识点：Docker-仓库"><a href="#知识点：Docker-仓库" class="headerlink" title="知识点：Docker 仓库"></a>知识点：Docker 仓库</h3><hr>
<h3 id="知识点：Docker-Hub"><a href="#知识点：Docker-Hub" class="headerlink" title="知识点：Docker Hub"></a>知识点：Docker Hub</h3><hr>
<h3 id="知识点：docker-login"><a href="#知识点：docker-login" class="headerlink" title="知识点：docker login"></a>知识点：docker login</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 登录到某个仓库</span><br><span class="line">  - 对于有验证的仓库，只有登录后才能 push 和 pull</span><br><span class="line">  - 可以同时多个仓库</span><br><span class="line">  - push 或 pull 时，如果 IMAGE 没有指定 registry，则都是访问 docker.hub</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker login [OPTIONS] [SERVER]</span><br><span class="line"></span><br><span class="line">* SERVER</span><br><span class="line">  - 指定要登录的仓库，格式为 ip:port</span><br><span class="line">  - 省略则登录 ~/.docker/config.json 记录的仓库</span><br><span class="line">  - port 默认为 80</span><br><span class="line"></span><br><span class="line">* OPTIONS</span><br><span class="line">  -u, --username string</span><br><span class="line">  -p, --password string</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-logout"><a href="#知识点：docker-logout" class="headerlink" title="知识点：docker logout"></a>知识点：docker logout</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 退出当前登录的仓库</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker logout [SERVER]</span><br><span class="line">  </span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：Docker-Registry-介绍"><a href="#知识点：Docker-Registry-介绍" class="headerlink" title="知识点：Docker Registry 介绍"></a>知识点：Docker Registry 介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 由 docker 提供的单机镜像仓库</span><br><span class="line">  - docker.hub、阿里云 docker 镜像站等，都是采用 registry 来建立</span><br><span class="line"></span><br><span class="line">* 发展历史</span><br><span class="line">  - 第一代 registry 使用 python 开发，由于存在各种问题，已被废弃</span><br><span class="line">  - registry 2.0 使用 go 开发，项目名称为 distribution，</span><br><span class="line">  - registry 2.0 与第一代 registry 不兼容</span><br><span class="line">  - 2021 年移交给 CNCF 维护，源码 git/distribution/distribution</span><br><span class="line">  - docker 1.6 开始支持 registry 2.0，docker 1.5 之前的版本无法访问 registry 2.0</span><br><span class="line">  - registry 2.4 开始支持回收站机制，即可以删除镜像</span><br><span class="line">  - registry 2.7 开始从原始镜像中移除了 htpasswd 程序，需要额外指定</span><br><span class="line"></span><br><span class="line">* 应用场景</span><br><span class="line">  - 适合小规模的镜像管理</span><br><span class="line">  - registry 没有 web 管理界面，不适用于大型场景，更多采用 harbor</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：Docker-Registry-配置文件"><a href="#知识点：Docker-Registry-配置文件" class="headerlink" title="知识点：Docker Registry 配置文件"></a>知识点：Docker Registry 配置文件</h3><hr>
<h3 id="知识点：启动无需验证的-docker-registry-范例"><a href="#知识点：启动无需验证的-docker-registry-范例" class="headerlink" title="知识点：启动无需验证的 docker registry 范例"></a>知识点：启动无需验证的 docker registry 范例</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> registry 默认暴露 5000 端口</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 默认情况下，仓库数据存放在容器的 /var/lib/registry 目录下</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 假设本机 IP 为 192.168.31.101</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动 registry 容器</span></span><br><span class="line">docker run -d --restart always -p 5000:5000 registry ;</span><br><span class="line">docker run -d --restart always -p 5000:5000 --name registry registry:2</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加 insecure-registries</span></span><br><span class="line">vim /etc/docker/daemon.json</span><br><span class="line">  &quot;insecure-registries&quot;: [&quot;localhost:5000&quot;]</span><br><span class="line">systemctl restart docker</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 上传镜像 tag</span></span><br><span class="line">docker image tag ubuntu localhost:5000/myfirstimage:v1</span><br><span class="line">docker push localhost:5000/myfirstimage:v1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 拉取镜像</span></span><br><span class="line">docker pull localhost:5000/myfirstimage:v1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 获取仓库的镜像列表</span></span><br><span class="line">curl -XGET http://192.168.174.12:5000/v2/_catalog</span><br><span class="line">curl -XGET http://192.168.174.12:5000/v2/myfirstimage/tags/list</span><br><span class="line"></span><br></pre></td></tr></table></figure>
<hr>
<h3 id="知识点：启动需要验证的-docker-registry"><a href="#知识点：启动需要验证的-docker-registry" class="headerlink" title="知识点：启动需要验证的 docker registry"></a>知识点：启动需要验证的 docker registry</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> registry 的验证，是通过检验 htpasswd 生成的用户-密码对认证文件来实现</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> registry 最新版镜像并不包括 htpasswd 程序，想要生成认证文件，需要想办法搞到 htpasswd 程序</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 假设本机 IP 为 192.168.31.101</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装 htpasswd 程序</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> yum -y install httpd-tools</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> apt-get -y install apache2-utils</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在宿主机创建认证文件</span></span><br><span class="line">mkdir auth</span><br><span class="line">htpasswd -Bbn USERNAME PASSWORD &gt;&gt; auth/htpasswd</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建 registry 容器</span></span><br><span class="line">docker run \</span><br><span class="line">  -d \</span><br><span class="line">  -p 5000:5000 \</span><br><span class="line">  -v auth:/auth \           # 通过存储卷将认证文件传递到容器中</span><br><span class="line">  --name registry \</span><br><span class="line">  --restart=always \</span><br><span class="line">  -e &quot;REGISTRY_AUTH=htpasswd&quot; \</span><br><span class="line">  -e &quot;REGISTRY_AUTH_HTPASSWD_REALM=Registry Realm&quot; \</span><br><span class="line">  -e REGISTRY_AUTH_HTPASSWD_PATH=/auth/htpasswd \</span><br><span class="line">  registry ;</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 添加不安全仓库</span></span><br><span class="line">vim /etc/docker/daemon.json</span><br><span class="line">  &quot;insecure-registries&quot;: [&quot;192.168.31.133:5000&quot;]</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启 docker</span></span><br><span class="line">systemctl daemon-reload &amp;&amp; systemctl restart docker</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 登录到 registry</span></span><br><span class="line">docker login -u USERNAME -p PASSWD 192.168.31.101:5000</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="知识点：云仓库范例"><a href="#知识点：云仓库范例" class="headerlink" title="知识点：云仓库范例"></a>知识点：云仓库范例</h3><ol>
<li><strong>范例一，镜像发布到阿里云个人仓库</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 开通阿里云个人镜像服务，务必保留好密码</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 容器镜像服务--&gt;个人实例</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建 registry，对应 IMAGE 命名中的仓库服务器</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建 namespace，对应 IMAGE 命名中的 registry，标识仓库名</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建 repository</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 登录到阿里云个人镜像仓库</span></span><br><span class="line">docker login -u=aliyunXXXX registry.cn-XXXX.aliyuncs.com</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 推送镜像</span></span><br><span class="line">docker tag IMAGE REGISTRY/namespace/repository:TAG</span><br><span class="line">docker push REGISTRY/namespace/repository:TAG</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> web 访问 repository 页面，可以查看镜像的各个版本</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="5-3-Harbor"><a href="#5-3-Harbor" class="headerlink" title="5.3 Harbor"></a>5.3 Harbor</h2><hr>
<h1 id="Chapter06-DockerVolume-卷"><a href="#Chapter06-DockerVolume-卷" class="headerlink" title="Chapter06 DockerVolume 卷"></a>Chapter06 DockerVolume 卷</h1><hr>
<h2 id="6-1-DockerVolume-介绍"><a href="#6-1-DockerVolume-介绍" class="headerlink" title="6.1 DockerVolume 介绍"></a>6.1 DockerVolume 介绍</h2><hr>
<h3 id="知识点：存储卷介绍"><a href="#知识点：存储卷介绍" class="headerlink" title="知识点：存储卷介绍"></a>知识点：存储卷介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 存储卷用来将容器的数据持久化到主机的存储上，而不再是保存到容器的可写层当中</span><br><span class="line">  - Docker 提供了两种方式，卷 volumes 和绑定挂载 bind mounts</span><br><span class="line">  - 卷和绑定挂载的生命周期与容器无关，即使容器停止或删除，数据依然持久化在主机的存储中</span><br><span class="line">  - 卷和绑定挂载并不属于联合文件系统，在将容器提交为镜像时，卷和绑定挂载中的数据不会被包含到镜像中</span><br><span class="line">  - 通过绑定挂载和卷，可以轻松的实现容器和主机之间的数据交互</span><br><span class="line">  - 无论选择哪一种类型，数据在容器中看起来都是一样的</span><br><span class="line">    - 卷只能在容器的文件系统中被公开为一个目录</span><br><span class="line">    - 绑定挂载可以被公开为一个目录，也可被公开为一个文件</span><br><span class="line"></span><br><span class="line">* 挂载选项</span><br><span class="line">  - docker 命令行提供了两个选项来将卷挂载到容器中，&quot;-v&quot; 和 &quot;--mount&quot;</span><br><span class="line">  - 两个选项功能基本相同，区别在于 &quot;-v&quot; 选项比较简单，&quot;--mount&quot; 选项更复杂，但可以指定更多的细节</span><br><span class="line">  - docker 官方更推荐 &quot;--mount&quot; 选项，但实际中 &quot;-v&quot; 用的更多</span><br><span class="line">  - 如果需要指定 volume driver options，则必须使用 &quot;--mount&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：卷-volume"><a href="#知识点：卷-volume" class="headerlink" title="知识点：卷 volume"></a>知识点：卷 volume</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 卷 volume，docker 提供的两种容器数据持久化方式之一</span><br><span class="line">  - docker 官方更推荐使用卷来进行数据的管理</span><br><span class="line">  - 卷里的数据与容器的生命周期无关，停止容器、删除容器不会影响到卷里的数据，只有手动显式的删除卷才会摧毁卷中的数据</span><br><span class="line">  - 一个卷可以挂载到多个容器中，因此多个容器可以通过一个卷实现数据的交互</span><br><span class="line"></span><br><span class="line">* volume 的命名</span><br><span class="line">  - 以小写字母或数字开头，支持小写字母、数字、下划线、句点、连字符</span><br><span class="line"></span><br><span class="line">* volume 的管理</span><br><span class="line">  - 卷由 dockerd 创建和管理</span><br><span class="line">  - 可以通过 docker 命令行或者 API 对卷进行操作</span><br><span class="line"></span><br><span class="line">* volume 的存储</span><br><span class="line">  - 卷的数据只能放在 docker 的存储根目录 storage.root 下的 volumes 子目录中，默认为 /var/lib/docker/volumes</span><br><span class="line">  - 当新建一个卷时，docker 会在 volumes 目录下创建一个 VOLUME_NAME 命名的目录</span><br><span class="line">  - 将卷挂载到容器，本质上也是一个目录的映射，即将此目录映射到容器中的某个目录</span><br><span class="line">  - 容器对卷的写操作会被转化为对 storage.root/VOLUME_NAME 目录的写操作</span><br><span class="line"></span><br><span class="line">* 卷的常用应用场景</span><br><span class="line">  - 通过将一个卷挂载到多个容器中，可以实现容器间的数据共享</span><br><span class="line"></span><br><span class="line">* 数据的自动复制和遮蔽</span><br><span class="line">  - 如果将一个空的卷，挂载到容器中某个已经有数据的目录，则 docker 会先将数据复制到卷中，再将卷挂载到容器上</span><br><span class="line">  - 如果将一个非空的卷，挂载到容器中某个已经有数据的目录，则容器中原有的数据会被遮蔽</span><br><span class="line"></span><br><span class="line">* 挂载卷的子目录</span><br><span class="line">  - 卷支持只将卷内的某个子目录而不是整个卷挂载到容器中</span><br><span class="line">  - 要求卷中子目录必须已经存在</span><br><span class="line">  - 挂载卷的子目录，只能使用 &quot;--mount&quot; 选项</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>创建和删除卷</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 创建卷</span><br><span class="line">  - 创建卷有两种方式，使用 docker volume create 显式创建，使用 docker run 启动容器时隐式创建</span><br><span class="line">  - 使用 docker volume create 方式的话，需要先创建卷，再讲卷挂载到容器上</span><br><span class="line">  - 使用 docker run 方式的话，无需提前创建卷，docker 会自动在启动容器前创建卷</span><br><span class="line"></span><br><span class="line">* 删除卷</span><br><span class="line">  - 删除卷时，只能删除 unused 的卷，无法删除正在被容器使用的卷，不论是命名卷还是匿名卷</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>命名卷和匿名卷</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 命名卷 named volume</span><br><span class="line">  - 在创建卷时显式的指定 VULUME_NAME，则称为为命名卷</span><br><span class="line"></span><br><span class="line">* 匿名卷 anonymous volume</span><br><span class="line">  - 在创建卷时没有显式的指定 VULUME_NAME，则称为为匿名卷</span><br><span class="line">  - docker 会为匿名卷自动分配一个复杂字符串 random volume ID 作为卷的目录名</span><br><span class="line">  - 与命名卷一样，匿名卷的生命周期独立于容器的生命周期，删除容器不会关联删除匿名卷</span><br><span class="line">    - 只有一种例外情况，使用 docker run 隐式创建匿名卷，并且指定了 &quot;--rm&quot; 选项，并且没有指定 &quot;-d&quot; 选项，此时，停止、推出容器，会关联删除匿名卷</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>相关命令</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看容器的数据卷情况</span></span><br><span class="line">docker inspect -f &#x27;&#123;&#123;.Mounts&#125;&#125;&#x27; CONTAINER</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：绑定挂载-bind-mount"><a href="#知识点：绑定挂载-bind-mount" class="headerlink" title="知识点：绑定挂载 bind mount"></a>知识点：绑定挂载 bind mount</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 绑定挂载 bind mount，docker 提供的两种容器数据持久化方式之一，是早期 docker 唯一的持久化数据的方式</span><br><span class="line">  - 绑定挂载用来将主机上的一个文件或目录，挂载到容器中</span><br><span class="line">  - 绑定挂载的本质实际是一个映射，将主机上的某一个目录或文件，映射到容器中，此时无论是容器还是主机上的其他进程均能对此文件或目录进行修改</span><br><span class="line">  - 绑定挂载可以指向主机的任意位置，甚至是 nfs 存储</span><br><span class="line"></span><br><span class="line">* 绑定挂载的使用注意</span><br><span class="line">  - 在指定绑定挂载时，必须使用绝对路径</span><br><span class="line">  - 如果主机上文件或目录不存在，docker 可以自动创建</span><br><span class="line">  - 绑定挂载并不受 docker 管理，无法使用 docker 命令对绑定挂载进行操作</span><br><span class="line">  - 绑定挂载的生命周期持续到没有容器使用它为止</span><br><span class="line">  - 如果主机上的路径不存在，docker 是否会自动创建它，取决于使用的是 &quot;-v&quot; 选项还是 &quot;--mount&quot; 选项</span><br><span class="line"></span><br><span class="line">* 绑定挂载的应用场景</span><br><span class="line">  - 绑定挂载的一个常见的应用场景，就是将主机的配置文件挂载到容器中，如 /etc/hosts、/etc/resolve.conf</span><br><span class="line"></span><br><span class="line">* 绑定挂载的遮蔽</span><br><span class="line">  - 如果将一个非空的目录，挂载到容器中已经有数据的目录，则容器中的原有数据会被遮蔽</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>相关命令</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看容器的绑定挂载的情况</span></span><br><span class="line">docker inspect -f &#x27;&#123;&#123;.Mounts&#125;&#125;&#x27; CONTAINER</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：tmpfs"><a href="#知识点：tmpfs" class="headerlink" title="知识点：tmpfs"></a>知识点：tmpfs</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - tmpfs 也是 docker 提供的一种存储形式</span><br><span class="line">  - tmpfs 并不是持久化存储，数据只会放在内存中，不会放到硬盘或主机或容器中</span><br><span class="line">  - 暂不研究</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="6-2-DockerVolume-指令"><a href="#6-2-DockerVolume-指令" class="headerlink" title="6.2 DockerVolume 指令"></a>6.2 DockerVolume 指令</h2><hr>
<h3 id="知识点：docker-volume-ls"><a href="#知识点：docker-volume-ls" class="headerlink" title="知识点：docker volume ls"></a>知识点：docker volume ls</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 列出当前主机所有的卷，包括命名卷和匿名卷</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker volume ls [OPTIONS]</span><br><span class="line"></span><br><span class="line">* -f, --filter &quot;foo=bar&quot;</span><br><span class="line">  - 指定过滤条件，如 &quot;dangling=true&quot;</span><br><span class="line">  - 当前支持的过滤条件</span><br><span class="line">    - dangling    true or false，0 or 1，相当于 unused</span><br><span class="line">    - driver</span><br><span class="line">    - label       label=&lt;key&gt; 或 label=&lt;key&gt;=&lt;value&gt;</span><br><span class="line">    - name        volume&#x27;s name</span><br><span class="line"></span><br><span class="line">* --format table</span><br><span class="line">* --format json</span><br><span class="line">* --format GoTemplate</span><br><span class="line">  - 指定输出格式</span><br><span class="line"></span><br><span class="line">* -q, --quiet</span><br><span class="line">  - 仅打印 volume name</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 列出当前所有的卷</span></span><br><span class="line">docker volume ls</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出当前所有 unused 卷</span></span><br><span class="line">docker volume ls -f dangliag=1</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 列出所有的卷的存储引擎</span></span><br><span class="line">docker volume ls --format &quot;&#123;&#123;.Name&#125;&#125;: &#123;&#123;.Driver&#125;&#125;&quot;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-volume-create"><a href="#知识点：docker-volume-create" class="headerlink" title="知识点：docker volume create"></a>知识点：docker volume create</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 创建一个卷</span><br><span class="line">  - 省略 VOLUME_NAME 则会创建一个匿名卷</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker volume create [OPTIONS] [VOLUME_NAME]</span><br><span class="line"></span><br><span class="line">* -d, --driver</span><br><span class="line">  - 指定 volume 使用的存储引擎</span><br><span class="line">  - 默认使用 local</span><br><span class="line"></span><br><span class="line">* -l, --label name=value</span><br><span class="line">  - 为 volume 添加标签</span><br><span class="line">  - 每个 --label 选项可以指定一个键值对，通过多次指定 --label 选项来添加多个标签</span><br><span class="line"></span><br><span class="line">* -o, --opt K=V</span><br><span class="line">  - 基于存储引擎，为 volume 添加选项</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建一个卷</span></span><br><span class="line">docker volume create my_vol_1</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-volume-rm"><a href="#知识点：docker-volume-rm" class="headerlink" title="知识点：docker volume rm"></a>知识点：docker volume rm</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 删除 unused 卷</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker volume rm [OPTIONS] VOLUME_NAME</span><br><span class="line"></span><br><span class="line">* -f, --force</span><br><span class="line">  - 强制删除卷</span><br><span class="line">  - 会先停止删除所有使用这个卷的容器，然后再删除卷</span><br><span class="line">  - 非常危险的操作，绝对不要使用</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-volume-prune"><a href="#知识点：docker-volume-prune" class="headerlink" title="知识点：docker volume prune"></a>知识点：docker volume prune</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 删除所有 unused anonymous 卷</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker volume prune [OPTIONS]</span><br><span class="line"></span><br><span class="line">* -a, --all</span><br><span class="line">  - 删除所有的 unused 卷，包括 named volume 和 anonymous volume</span><br><span class="line"></span><br><span class="line">* --filter K=V</span><br><span class="line">  - 指定筛选条件</span><br><span class="line">  - 通常使用 label 进行筛选</span><br><span class="line">    --filter label=project1         根据 label_name 进行筛选</span><br><span class="line">    --filter label=project1=value   根据 label_name 和 label_value 进行筛选</span><br><span class="line">    --filter label!=project1</span><br><span class="line">    --filter label!=project1=value</span><br><span class="line"></span><br><span class="line">* -f, --force</span><br><span class="line">  - 不会 prompt 确认信息，直接删除</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="6-3-容器的存储卷配置"><a href="#6-3-容器的存储卷配置" class="headerlink" title="6.3 容器的存储卷配置"></a>6.3 容器的存储卷配置</h2><hr>
<h3 id="知识点：–volume-选项"><a href="#知识点：–volume-选项" class="headerlink" title="知识点：–volume 选项"></a>知识点：–volume 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - &quot;-v&quot; 或 &quot;--volume&quot;</span><br><span class="line">  - 参数分为三个字段，每个字段之间使用 &quot;:&quot; 间隔</span><br><span class="line"></span><br><span class="line">* 自动创建</span><br><span class="line">  - 在挂载命名卷时，如果命名卷不存在，则 &quot;-v&quot; 选项可以自动创建</span><br><span class="line">  - 在挂载匿名卷时，&quot;-v&quot; 选项会自动创建匿名卷</span><br><span class="line">  - 在挂载绑定挂载时，如果 host 上目标路径不存在，则 &quot;-v&quot; 选项可以自动创建，但只会创建为一个目录</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">* 挂载命名卷</span><br><span class="line">  -v VolumeName:ContainerPath[:OpList]</span><br><span class="line"></span><br><span class="line">* 挂载匿名卷</span><br><span class="line">  -v ContainerPath[:OpList]</span><br><span class="line"></span><br><span class="line">* 挂载绑定挂载</span><br><span class="line">  -v HostPath:ContainPath[:OpList]</span><br><span class="line"></span><br><span class="line">* OpList</span><br><span class="line">  comma-separated list of options</span><br><span class="line">  rw  以读写模式挂载，默认策略</span><br><span class="line">  ro  以只读模式挂载</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将命名卷 u01-vol 挂载到 ubuntu 容器中</span></span><br><span class="line">docker run -d --name=u01 -v u01-vol:/data ubuntu</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将匿名卷挂载到 ubuntu 容器中</span></span><br><span class="line">docker run -d --name=u01 -v /data ubuntu</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将绑定挂载挂载到 ubuntu 容器中</span></span><br><span class="line">docker run -d --name=u01 -v /data1/docker/u01/data:/data ubuntu</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–mount-选项"><a href="#知识点：–mount-选项" class="headerlink" title="知识点：–mount 选项"></a>知识点：–mount 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - &quot;--mount&quot; 选项相比 &quot;-v&quot; 选项，可以实现更细粒度的挂载</span><br><span class="line">  - &quot;--mount&quot; 选项通过指定一系列的 key=value 对来实现对挂载的指定</span><br><span class="line">  - 在某些情况下只能使用 &quot;--mount&quot; 选项，例如需要指定存储引擎的类型</span><br><span class="line"></span><br><span class="line">* 自动创建</span><br><span class="line">  - 对于命名卷，如果卷不存在，&quot;--mount&quot; 选项会进行自动创建</span><br><span class="line">  - 对于匿名卷，&quot;--mount&quot; 选项会进行自动创建</span><br><span class="line">  - 对于挂载绑定，如果 host 上目标路径不存在，则 &quot;--mount&quot; 选项不会自动创建</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  --mount &quot;key=value[,key=value]&quot;</span><br><span class="line"></span><br><span class="line">* 挂载命名卷</span><br><span class="line">  docker run --mount type=volume,src=VOLUME_NAME,dst=CONTAINER_PATH --name CONTAINER_NAME IMAGE</span><br><span class="line"></span><br><span class="line">* 挂载匿名卷</span><br><span class="line">  docker run --mount type=volume,dst=CONTAINER_PATH --name CONTAINER_NAME IMAGE</span><br><span class="line"></span><br><span class="line">* 挂载绑定挂载</span><br><span class="line">  docker run --mount type=bind,src=HOST_PATH,dst=CONTAINER_PATH --name CONTAINER_NAME IMAGE</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>kv 对</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line">* kv 对的格式</span><br><span class="line">  - kv 对的顺序不重要</span><br><span class="line">  - kv 对使用逗号间隔，但不能有空格，整个 kv 对列表应当可以在命令行上只被解析为一个 token</span><br><span class="line">  - 除了 dst 选项，其他的 key 都在某些情况下可以省略</span><br><span class="line"></span><br><span class="line">* type</span><br><span class="line">  - 指定挂载的存储的类型</span><br><span class="line">  - volume 表示卷</span><br><span class="line">  - bind 表示绑定挂载</span><br><span class="line">  - tmpfs 表示 tmpfs</span><br><span class="line">  - 默认为 volume</span><br><span class="line"></span><br><span class="line">* src、source</span><br><span class="line">  - 对于命名卷，此处指定 VolumeName</span><br><span class="line">  - 对于匿名卷，此 key 省略</span><br><span class="line">  - 对于绑定挂载，此处指定 host 文件或目录的绝对路径</span><br><span class="line"></span><br><span class="line">* dst、destination、target</span><br><span class="line">  - 指定存储挂载到容器中的路径，必须使用绝对路径</span><br><span class="line"></span><br><span class="line">* volume-subpath</span><br><span class="line">  - 用来将卷的子目录挂载到容器中，指定卷的子目录的路径</span><br><span class="line">  - 子目录必须提前已经存在</span><br><span class="line"></span><br><span class="line">* readonly</span><br><span class="line">  - 单独一个 key，无需指定 value</span><br><span class="line">  - 指定以只读的方式将卷挂载到容器中</span><br><span class="line"></span><br><span class="line">* volume-driver</span><br><span class="line">  - 指定存储引擎</span><br><span class="line"></span><br><span class="line">* volume-opt</span><br><span class="line">  - 可以出现多次，值为 key=value 的 kv 对</span><br><span class="line">  - 用于指定 volume 的选项</span><br><span class="line">  - 如果 kv 对中的 value 中需要包含 &quot;,&quot;，则需要对整个 volume-opt 进行跳脱，通常采用双引号</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将命名卷 u01-vol 挂载到 ubuntu 容器中</span></span><br><span class="line">docker run -d --name=u01 --mount src=u01-vol,dst=/data ubuntu</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将匿名卷挂载到 ubuntu 容器中</span></span><br><span class="line">docker run -d --name=u01 --mount dst=/data ubuntu</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将绑定挂载挂载到 ubuntu 容器中</span></span><br><span class="line">docker run -d --name=u01 --mount src=/data,dst=/data ubuntu</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 挂载卷的子路径</span></span><br><span class="line">docker run -d --name=app2 --mount src=logs,dst=/var/log,volume-subpath=app2 app2:latest</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–volumes-from-选项"><a href="#知识点：–volumes-from-选项" class="headerlink" title="知识点：–volumes-from 选项"></a>知识点：–volumes-from 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 指定容器从另一个容器处继承对存储卷的挂载，包括挂载的存储卷、在容器中的挂载点</span><br><span class="line">  - 本质上只是一个省略写法，主容器若被删除，不影响从容器的数据卷情况</span><br><span class="line">  - 一个常用的应用场景，从一个容器继承其挂载的匿名卷或绑定挂载，来实现多个容器以及宿主机之间的数据互通</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  --volumes-from CONTAINER</span><br><span class="line">  --volumes-from CONTAINER:ro</span><br><span class="line">  --volumes-from CONTAINER:rw</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="Chapter07-DockerNetwork"><a href="#Chapter07-DockerNetwork" class="headerlink" title="Chapter07 DockerNetwork"></a>Chapter07 DockerNetwork</h1><hr>
<h2 id="7-1-DockerNetwork-介绍"><a href="#7-1-DockerNetwork-介绍" class="headerlink" title="7.1 DockerNetwork 介绍"></a>7.1 DockerNetwork 介绍</h2><hr>
<h3 id="知识点：docker-网络介绍"><a href="#知识点：docker-网络介绍" class="headerlink" title="知识点：docker 网络介绍"></a>知识点：docker 网络介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - docker 网络主要提供两个功能，容器与容器之间通信，容器与非容器之间通信</span><br><span class="line">  - 本质上是通过 iptables 设置各种规则来实现，需要 kernel 支持 net.ipv4.ip_forward 功能</span><br><span class="line">  - 在 K8S 阶段有更好的解决方案</span><br><span class="line">    - k8s 早期使用 iptables，但 iptables 性能较差，后期改用 ipvs</span><br><span class="line">    - 生产环境，iptables 可能有上万条规则，每一个报文，都要经过这上万条规则的匹配后，才能发送</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>docker 网络驱动</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - docker 对网络的实现是以可拔插插件的方式实现的，插件即网络驱动 network driver</span><br><span class="line">  - docker 支持以下几种网络驱动</span><br><span class="line">    - bridge    The default network driver.</span><br><span class="line">    - host      Remove network isolation between the container and the Docker host.</span><br><span class="line">    - none      Completely isolate a container from the host and other containers.</span><br><span class="line">    - overlay   Overlay networks connect multiple Docker daemons together.</span><br><span class="line">    - ipvlan    IPvlan networks provide full control over both IPv4 and IPv6 addressing.</span><br><span class="line">    - macvlan   Assign a MAC address to a container.</span><br><span class="line"></span><br><span class="line">* host 网络驱动</span><br><span class="line">  - 容器直接使用宿主机 IP，不再使用 NAT 转换，此时容器网络与宿主机网络不再存在网络隔离</span><br><span class="line">  - 容器将不会虚拟出自己的网卡</span><br><span class="line">  - 容器可以直接使用宿主机的 hosts 文件</span><br><span class="line">  - 容器将不会获得一个独立的 network namesapce，而是和宿主机共用一个 network namespace</span><br><span class="line">  - host 模式下，设置端口映射将无意义，容器将自动使用宿主机端口，若重复则自动递增</span><br><span class="line">  - docker 只允许同时存在一个 host 网络，因此一般只有 docker 的默认网络 host 存在</span><br><span class="line"></span><br><span class="line">* none 网络驱动</span><br><span class="line">  - 容器有独立的 netwok namespace，但没有做任何配置，需要手动配置</span><br><span class="line">  - 容器初始不具有网络功能，只有 lo</span><br><span class="line">  - 在 none 模式下，容器没有网卡、路由、IP 等信息，只有一个 lo</span><br><span class="line">  - 需要后期手动为容器添加网卡、配置 IP 等</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>默认网络和用户自定义网络</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">* 默认网络</span><br><span class="line">  - 默认情况下，docker 会自动建立三个默认网络：bridge、host、none</span><br><span class="line">  - bridge 网络</span><br><span class="line">    - docker 全局的默认网络，采用 bridge 网络驱动，没有指定网络的容器，都会被放在此网络中</span><br><span class="line">    - docker 会自定建立一个默认网桥 docker0，作为 bridge 网络的网桥</span><br><span class="line">  - host 网络</span><br><span class="line">    - 使用 host 网络驱动的默认网络</span><br><span class="line">  - none 网络</span><br><span class="line">    - 使用 none 网络驱动的默认网络</span><br><span class="line"></span><br><span class="line">* 用户自定义网络 User-defined networks</span><br><span class="line">  - 由用户手动创建，非 docker 默认网络的网络，就是用户自定义网络</span><br><span class="line">  - 通过容器名称通信</span><br><span class="line">    - 用户自定义网络的最大的优点，就是使用 bridge 网络驱动的网络，在其同一个网络下的容器，都可以使用容器名称来进行相互通信</span><br><span class="line">    - docker 会自动在网络中维护容器名称到容器 ip 的解析，无需手动配置 dns</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>容器连接到网络</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line">* 容器连接到网络</span><br><span class="line">  - 一个容器可以同时连接到多个网络中</span><br><span class="line">  - 每当连接到一个网络，docker 就会自动为容器添加一个虚拟网卡</span><br><span class="line">  - 可以使用 &quot;--network&quot; 选项，在创建容器时指定需要连接的网络</span><br><span class="line">  - 也可以通过 docker network connect 指令将 running 容器连接到网络中</span><br><span class="line"></span><br><span class="line">* 容器的 ip</span><br><span class="line">  - 容器是否会被分配 ip，取决于使用的网络驱动</span><br><span class="line">  - bridge 网络会为容器分配 ip</span><br><span class="line">  - host 网络不会为容器分配 ip</span><br><span class="line"></span><br><span class="line">* 容器的 hostname</span><br><span class="line">  - 容器默认采用容器 ID 的前 12 位作为容器的 hostname</span><br><span class="line">  - 可以通过 &quot;--hostname&quot; 选项，在创建容器时，手动指定容器的 hostname</span><br><span class="line">  - 容器名 &quot;--name&quot; 与容器的主机名 &quot;--hostname&quot; 无关</span><br><span class="line"></span><br><span class="line">* 容器的 hosts</span><br><span class="line">  - 容器具有独立的 hosts 文件，与宿主机的 hosts 文件无关</span><br><span class="line">  - 默认情况下，只会包含 localhost 和 ContainerHostname 等少量的条目</span><br><span class="line">  - 可以通过 &quot;--add-host&quot; 选项，在创建容器时，为容器的 hosts 文件添加条目</span><br><span class="line"></span><br><span class="line">* 容器的 dns</span><br><span class="line">  - 默认情况下，容器继承主机的 /etc/resolv.conf 配置文件中定义的 DNS 设置</span><br><span class="line">    - 连接到默认网络 bridge 的容器会获得一个此文件的副本</span><br><span class="line">    - 连接到自定义网络的容器则会使用 docker 的嵌入式 DNS 服务器，嵌入式 DNS 服务器会 DNS 查找请求转发到主机上配置的 DNS 服务器</span><br><span class="line">  - 也可以使用 &quot;--dns&quot; 选项，手动为容器配置 DNS 服务器</span><br><span class="line"></span><br><span class="line">* 端口映射 port mapping</span><br><span class="line">  - 在使用 bridge 网络时，容器只能被宿主机和其他的容器访问到，外部的应用无法访问到容器</span><br><span class="line">  - 可以通过 &quot;-p&quot; 选项，将容器的端口映射到主机的端口，从而让外部应用可以访问到容器</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：bridge-网络驱动"><a href="#知识点：bridge-网络驱动" class="headerlink" title="知识点：bridge 网络驱动"></a>知识点：bridge 网络驱动</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 虚拟网桥模式</span><br><span class="line">  - docker 中最常用、最通用的网络驱动，也是 docker 网络的默认网络驱动</span><br><span class="line">  - 即提供了网络隔离，又保证了同一个网络下的通信</span><br><span class="line">    - 同一个网络下的容器可以通信，甚至可以直接使用 ContainerName 通信</span><br><span class="line">    - 不同的网络下的容器相互之间无法通信</span><br><span class="line">  - docker 官方建议，由于 linux 内核的限制，一个 bridge 网络下最好不要超过 1000 个容器，否则 bridge 网络会变的不稳定</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>bridge 网络的实现</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">* 网桥</span><br><span class="line">  - docker 会通过 iptables 创建一个虚拟网桥，相当于交换机</span><br><span class="line">  - 虚拟网桥有自己的子网、地址段、网关</span><br><span class="line">  - 在宿主机上执行 brctl show 可以查看网桥</span><br><span class="line"></span><br><span class="line">* 容器 IP</span><br><span class="line">  - 当容器连接到 bridge 网络时，docker 会自动为容器添加一个虚拟网卡，并为其分配一个 IP</span><br><span class="line">  - 虚拟网桥在内核层连通了宿主机的网卡，会对容器进行 NAT IP 转换，使容器可以通过网桥来与其他设备通信</span><br><span class="line">  - 网桥的接口称为 veth，与容器的 eth 相对应和连接，这样一对接口称为 veth pair</span><br><span class="line">  - 宿主机 ifconfig 可以看到 veth</span><br><span class="line">  - 宿主机 ip addr show 可以看到 veth 和在虚拟网桥上的接口位置，格式 vethxxxx@ifxx</span><br><span class="line">  - 一个容器可以同时连接到多个网络中</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>bridge 网络驱动的自定义网络相比默认网络的区别</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 自定义网络会自动维护对容器名的 dns 解析</span><br><span class="line">  - 默认网络 bridge 中的主机，相互之间只能通过 ContainerIP 进行通信</span><br><span class="line">  - 自定义网络中，docker 自动维护了 ContainerName 的 dns 解析，容器可以直接通过 ContainerName 进行网络通信</span><br><span class="line"></span><br><span class="line">* 自定义网络提供了更好的网络隔离</span><br><span class="line">  - 默认网络做，会包含所有未指定网络的容器</span><br><span class="line">  - 自定义网络中，只会包含手动添加的容器</span><br><span class="line"></span><br><span class="line">* 容器可以随时加入或离开自定义网络</span><br><span class="line">  - 使用 docker network connect/disconnect 指令，可以随时让容器加入或离开自定义网络</span><br><span class="line">  - 连接到默认网络 bridge 的容器，无法离开默认网络，只能删掉重建</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-和-iptables"><a href="#知识点：docker-和-iptables" class="headerlink" title="知识点：docker 和 iptables"></a>知识点：docker 和 iptables</h3><ol>
<li><strong>docker 在 iptables 中的实现</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - docker 的网络，本质上是通过在 iptables 中添加 chain 和 rule 实现的</span><br><span class="line"></span><br><span class="line">* docker 在 iptable 中的实现</span><br><span class="line">  - 在 nat 表中，docker 创建 DOCKER 链，并添加规则，来实现伪装和端口映射</span><br><span class="line">  - 数据包首先到达 nat 表，在经过了 DNAT 转换后，前往 filter 表的 FORWARD 链</span><br><span class="line">  - docker 会在 FORWARD 链中添加各种 chain，来最终处理数据包，并将 FORWARD 的默认策略改为 DROP，以阻断未经端口绑定的网络访问</span><br><span class="line">  - 数据包进入 FORWARD 链后，经过各种规则后，被最终确认是允许进入容器还是被丢弃掉</span><br><span class="line"></span><br><span class="line">* DOCKER 链</span><br><span class="line"></span><br><span class="line">* DOCKER-USER 链</span><br><span class="line">  - docker 在 FORWARD 链中建立的，提供给用户的，用来添加自定义过滤规则的地方</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>添加自定义的网络限制</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - docker 建议，所有自定义的网络过滤规则，都应当放到 DOCKER-USER 链中</span><br><span class="line">  - 放在 FORWARD 链中的其他位置，可能不会生效</span><br><span class="line"></span><br><span class="line">* conntrack 扩展</span><br><span class="line">  - 当数据包到达 DOCKER-USER 链时，它们已经被进行过 dnat，此时的 dest ip 和 dest port 是经过了转换后的，指向的是容器的 ip 和端口而不是主机的 ip 和端口</span><br><span class="line">  - 可以通过 conntrack 扩展，来得到数据包中原始的请求 dest ip 和 dest port</span><br><span class="line">  - 范例：</span><br><span class="line">    iptables -I DOCKER-USER -p tcp -m conntrack --ctstate ESTABLISHED,RELATED -j ACCEPT</span><br><span class="line">    iptables -I DOCKER-USER -p tcp -m conntrack --ctorigdst 198.51.100.2 --ctorigdstport 80 -j ACCEPT</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="7-2-DockerNetwork-指令"><a href="#7-2-DockerNetwork-指令" class="headerlink" title="7.2 DockerNetwork 指令"></a>7.2 DockerNetwork 指令</h2><hr>
<h3 id="知识点：docker-network-ls"><a href="#知识点：docker-network-ls" class="headerlink" title="知识点：docker network ls"></a>知识点：docker network ls</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 列出当前的 docker 网络</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker network ls [OPTIONS]</span><br><span class="line">  docker network list [OPTIONS]</span><br><span class="line"></span><br><span class="line">* --format table</span><br><span class="line">* --format json</span><br><span class="line">* --format GoTemplate</span><br><span class="line">  - 指定输出格式</span><br><span class="line"></span><br><span class="line">* -q, --quiet</span><br><span class="line">  - 只打印 network ID</span><br><span class="line"></span><br><span class="line">* --no-trunc</span><br><span class="line">  - 对于 network ID 不要进行截断</span><br><span class="line"></span><br><span class="line">* -f, --filter &quot;foo=bar&quot;</span><br><span class="line">  - 指定条件过滤</span><br><span class="line">  - 指定多个过滤条件，则为 OR 逻辑</span><br><span class="line">  - 支持的过滤条件</span><br><span class="line">    - driver</span><br><span class="line">    - id</span><br><span class="line">    - label=key or label=key=value</span><br><span class="line">    - name</span><br><span class="line">    - scope</span><br><span class="line">    - type=custom or type=builtin</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 列出当前的 docker 网络</span></span><br><span class="line">docker network ls</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-network-create"><a href="#知识点：docker-network-create" class="headerlink" title="知识点：docker network create"></a>知识点：docker network create</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 创建一个 docker 网络</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker network create [OPTIONS] NetworkName</span><br><span class="line"></span><br><span class="line">* -d, --driver Driver</span><br><span class="line">  - 指定网络的驱动类型，bridge、host、none 等</span><br><span class="line">  - 默认为 bridge</span><br><span class="line"></span><br><span class="line">* --subnet</span><br><span class="line">  - 为 Network 分配子网</span><br><span class="line"></span><br><span class="line">* --ip-range</span><br><span class="line">  - 指定 Network 的 ip 地址范围</span><br><span class="line"></span><br><span class="line">* --gateway</span><br><span class="line">  - 指定 Network 的网关</span><br><span class="line"></span><br><span class="line">* --label K=V</span><br><span class="line">  - 为 Network 配置标签</span><br><span class="line"></span><br><span class="line">* -o, --opt K=V</span><br><span class="line">  - 指定高级选项</span><br><span class="line">    com.docker.network.bridge.name      指定网桥的名字</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 创建一个网络</span></span><br><span class="line">docker network create -d bridge mynet</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 创建一个网络并且同时指定网络的子网和地址范围</span></span><br><span class="line">docker network create --driver=bridge --subnet=172.28.0.0/16 --ip-range=172.28.1.0/24 --gateway=172.28.1.254 mynet1</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-network-inspect"><a href="#知识点：docker-network-inspect" class="headerlink" title="知识点：docker network inspect"></a>知识点：docker network inspect</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 查看某个 docker 网络的具体信息</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker network inspect [OPTIONS] Network</span><br><span class="line"></span><br><span class="line">* -f, --format json</span><br><span class="line">* -f, --format GoTemplate</span><br><span class="line">  - 指定输出格式</span><br><span class="line"></span><br><span class="line">* -v, --verbose</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看 mynet 网络的信息</span></span><br><span class="line">docker network inspect mynet</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 mynet 连接了哪些容器</span></span><br><span class="line">docker network inspect -f &quot;&#123;&#123;.Containers&#125;&#125;&quot; -f json mynet | jq</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-network-connect-x2F-disconnect"><a href="#知识点：docker-network-connect-x2F-disconnect" class="headerlink" title="知识点：docker network connect&#x2F;disconnect"></a>知识点：docker network connect&#x2F;disconnect</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - connect，将一个容器连接到到某个网络中</span><br><span class="line">  - disconnect，将一个容器从某个网络断开</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker network connect [OPTIONS] Network Container</span><br><span class="line">  docker network disconnect [OPTIONS] Network Container</span><br><span class="line"></span><br><span class="line">* --ip IP</span><br><span class="line">  - 指定容器的 ip 地址</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将 mysql01 容器连接到 mynet 网络中</span></span><br><span class="line">docker network connect mynet mysql01</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将 mysql01 容器与 mynet 网络断开</span></span><br><span class="line">docker network disconnect mynet mysql01</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-network-rm"><a href="#知识点：docker-network-rm" class="headerlink" title="知识点：docker network rm"></a>知识点：docker network rm</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 删除一个 Network</span><br><span class="line">  - 要删除网络，必须先断开与之连接的所有容器</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker network rm Network</span><br><span class="line"></span><br><span class="line">* -f, --force</span><br><span class="line">  - 默认情况下，如果 Network 不存在，则 docker network rm 指令会返回错误</span><br><span class="line">  - 添加 &quot;-f&quot; 选项则不会返回错误</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 删除 mynet 网络</span></span><br><span class="line">docker network rm mynet</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-network-prune"><a href="#知识点：docker-network-prune" class="headerlink" title="知识点：docker network prune"></a>知识点：docker network prune</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 删除所有的 unused Network</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  docker network prune [OPTIONS]</span><br><span class="line"></span><br><span class="line">* --filter K=V</span><br><span class="line">  - 添加过滤条件</span><br><span class="line">  - 支持的条件</span><br><span class="line">    until=TimeStamp</span><br><span class="line">    label=Key</span><br><span class="line">    label=Key=Value</span><br><span class="line">    label!=Key</span><br><span class="line">    label!=Key=Value</span><br><span class="line"></span><br><span class="line">* -f, --force</span><br><span class="line">  不提示确认</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 删除所有的 unused Network</span></span><br><span class="line">docker network prune</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除所有超过 3 小时前创建的 unused Network</span></span><br><span class="line">docker network prune --force --filter until=3h</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="7-3-容器的网络配置"><a href="#7-3-容器的网络配置" class="headerlink" title="7.3 容器的网络配置"></a>7.3 容器的网络配置</h2><hr>
<h3 id="知识点：–network-选项"><a href="#知识点：–network-选项" class="headerlink" title="知识点：–network 选项"></a>知识点：–network 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 指定容器使用的网络</span><br><span class="line">  - 省略的话，使用默认的 bridge 网络</span><br><span class="line">  - 可以通过指定多个 &quot;--network&quot; 选项，来将容器连接到多个网络上</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* --network NETWORK</span><br><span class="line">  - 指定容器使用用户定义网络</span><br><span class="line">  - 自定义网络会对其内的所有容器自动维护 ContainerName 和 IP 的对应关系，使同一网络内的容器，可以直接通过 ContainerName 而不是 IP 来相互访问，而默认网络 docker0 则不行</span><br><span class="line">  - 可以不再通过写死 IP 来访问容器，容器的 ip 是很容易变化的，写死 IP 的方式很容易出问题</span><br><span class="line"></span><br><span class="line">* --network bridge</span><br><span class="line">* --netwrok host</span><br><span class="line">* --network none</span><br><span class="line">  - 指定容器使用默认网络</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–publish-选项"><a href="#知识点：–publish-选项" class="headerlink" title="知识点：–publish 选项"></a>知识点：–publish 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">* 作用</span><br><span class="line">  - &quot;-p&quot; 或 &quot;--publish&quot;，用来配置容器的端口发布 published ports</span><br><span class="line">  - 将容器的端口，与主机上的某个端口一一绑定，这样通过访问主机上相应的端口，就能访问容器的对应端口</span><br><span class="line">  - 一个 &quot;-p&quot; 选项只能做一次端口绑定，如果需要绑定多个端口，可以多次指定 &quot;-p&quot;</span><br><span class="line"></span><br><span class="line">* 网络驱动模式</span><br><span class="line">  - 端口发布仅在使用 bridge 网络时有意义</span><br><span class="line">  - 在使用 host 网络时，端口发布没有意义，因为容器本身就使用了主机的网络命名空间</span><br><span class="line"></span><br><span class="line">* 容器通信</span><br><span class="line">  - 端口发布，仅用于外部应用访问容器</span><br><span class="line">  - 主机访问容器、同一网络的不同容器之间互信访问，不需要进行端口发布</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  -p [HostIP:]HostPort:ContainerPort[/Protocol]</span><br><span class="line"></span><br><span class="line">* HostIP</span><br><span class="line">  - 指定在绑定端口时，在主机上监听的 ip 地址</span><br><span class="line">  - 默认为 0.0.0.0 和 [::]</span><br><span class="line"></span><br><span class="line">* Protocol</span><br><span class="line">  - 指定进行端口绑定的协议，默认为 tcp</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 将容器的 80 端口，绑定在主机的 8080 端口</span></span><br><span class="line">-p 8080:80</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将容器的 80 端口，绑定在主机的 192.168.1.100:8080 上</span></span><br><span class="line">-p 192.168.1.100:8080:80</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 将容器的 80 udp 端口，绑定在主机的 192.168.1.100:8080 udp 上</span></span><br><span class="line">-p 192.168.1.100:8080:80/udp</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–ip-选项"><a href="#知识点：–ip-选项" class="headerlink" title="知识点：–ip 选项"></a>知识点：–ip 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - &quot;--ip&quot;、&quot;--ip6&quot;</span><br><span class="line">  - 在创建容器时，指定容器的 ip</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  --ip IP</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在创建容器时指定容器的 ip</span></span><br><span class="line">docker network create --driver=bridge --subnet=172.28.0.0/16 --ip-range=172.28.1.0/24 --gateway=172.28.1.254 mynet1</span><br><span class="line">docker run -itd --name u01 --network mynet1 --ip 172.28.1.100 ubuntu:latest</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–hostname-选项"><a href="#知识点：–hostname-选项" class="headerlink" title="知识点：–hostname 选项"></a>知识点：–hostname 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - &quot;-h&quot; 或 &quot;--hostname&quot;</span><br><span class="line">  - 在创建容器时，为容器指定 hostname</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  -h HostName</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在创建容器时指定容器的 ip 和 hostname</span></span><br><span class="line">docker network create --driver=bridge --subnet=172.28.0.0/16 --ip-range=172.28.1.0/24 --gateway=172.28.1.254 mynet1</span><br><span class="line">docker run -itd --name u01 --network mynet1 --hostname ubuntu01 --ip 172.28.1.100 ubuntu:latest</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–dns-选项"><a href="#知识点：–dns-选项" class="headerlink" title="知识点：–dns 选项"></a>知识点：–dns 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 为容器添加配置 DNS 服务器</span><br><span class="line">  - 一个 &quot;--dns&quot; 选项只能添加一个 DNS 服务器，如果想要配置多个，则多次添加 &quot;--dns&quot; 选项</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  --dns DNS_IP</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在创建容器时指定容器的 ip，并且添加 DNS 配置</span></span><br><span class="line">docker network create --driver=bridge --subnet=172.28.0.0/16 --ip-range=172.28.1.0/24 --gateway=172.28.1.254 mynet1</span><br><span class="line">docker run -itd --name u01 --network mynet1 --dns 114.114.114.114 --ip 172.28.1.100 ubuntu:latest</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：–add-host-选项"><a href="#知识点：–add-host-选项" class="headerlink" title="知识点：–add-host 选项"></a>知识点：–add-host 选项</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 在启动容器时，为容器的 hosts 文件添加条目</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>用法</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 格式</span><br><span class="line">  --add-host HOSTNAME=IP</span><br><span class="line">  --add-host=HOSTNAME=IP</span><br><span class="line"></span><br><span class="line">* host-gateway</span><br><span class="line">  - docker 支持的特殊值</span><br><span class="line">  - 用来代表宿主机的 internal IP address，即宿主机在 docker 网络中使用的地址</span><br><span class="line"></span><br><span class="line">* host.docker.internal</span><br><span class="line">  - docker 的一个使用习惯，指向宿主机的 internal IP address</span><br><span class="line">  - 常用方式为 &quot;--add-host host.docker.internal=host-gateway&quot;，在 hosts 里添加对宿主机的解析，这样容器内的服务可以通过 &quot;host.docker.internal&quot; 这个域名访问宿主机的服务</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 常用</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在创建容器时向 hosts 添加对宿主机的解析</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker 会自动在容器的 /etc/hosts 里添加 <span class="string">&quot;宿主机内部IP  host.docker.internal&quot;</span> 的条目</span></span><br><span class="line">docker run -itd --name u01 --add-host host.docker.internal=host-gateway ubuntu:latest</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 在创建容器时向 hosts 添加 <span class="string">&quot;172.31.30.121 centos121&quot;</span> 的条目</span></span><br><span class="line">docker run -itd --name u01 --add-host centos121=172.31.30.121 ubuntu:latest</span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h1 id="Chapter08-DockerCompose"><a href="#Chapter08-DockerCompose" class="headerlink" title="Chapter08 DockerCompose"></a>Chapter08 DockerCompose</h1><hr>
<h2 id="8-1-DockerCompose-介绍"><a href="#8-1-DockerCompose-介绍" class="headerlink" title="8.1 DockerCompose 介绍"></a>8.1 DockerCompose 介绍</h2><hr>
<h3 id="知识点：docker-compose-介绍"><a href="#知识点：docker-compose-介绍" class="headerlink" title="知识点：docker compose 介绍"></a>知识点：docker compose 介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - docker 提供的基础的单机容器编排工具</span><br><span class="line">  - 使用 Compose file 来定义资源</span><br><span class="line">  - 使用 docker compose 指令来管理资源</span><br><span class="line">  - 使用 docker compose，可以一次性向启动应用所需的所有资源，包括容器、网络、卷，全部定义好，统一管理</span><br><span class="line"></span><br><span class="line">* 历史</span><br><span class="line">  - 2014 年推出第一版，采用 python 编写</span><br><span class="line">  - 2020 年推出第二版并沿用至今，采用 go 编写</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>docker compose 概念</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">* Compose file</span><br><span class="line">  - docker compose 的配置文件，yaml 格式</span><br><span class="line">  - 用来定义一组容器之间的调用关系，尤其是不同容器之间启动的先后顺序</span><br><span class="line">  - 文件名必须是 docker-compose.yml</span><br><span class="line">  - 执行 docker compose 命令时，必须与 compose file 位于相同目录</span><br><span class="line">  - compose file format 有版本的区别，需要相应的 docker engine 的支持，官方推荐使用 v3 以上的格式</span><br><span class="line"></span><br><span class="line">* project 工程</span><br><span class="line">  - 概念上，表示一个具备完整业务单元的应用程序部署实例，相当于 K8S 中的 pod</span><br><span class="line">  - 形式上，一个 docker-compose.yml 即定义一个工程</span><br><span class="line"></span><br><span class="line">* project name 工程名</span><br><span class="line">  - 一个工程的唯一标识符，由 docker compose 的顶级元素 name 所决定</span><br><span class="line">  - 在 docker compose 中通过 project name 来对资源进行分组、隔离</span><br><span class="line">  - 工程名只能包含小写字母、数字、横线 dash、下划线 underscores</span><br><span class="line">  - docker compose 对工程名的决定优先级</span><br><span class="line">    - docker compose 指令的 -p 选项</span><br><span class="line">    - COMPOSE_PROJECT_NAME 环境变量</span><br><span class="line">    - compose file 的 name 配置</span><br><span class="line">    - compose file 所在的目录的目录名</span><br><span class="line"></span><br><span class="line">* project dir 工程目录</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>docker compose 资源</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">* service 服务</span><br><span class="line">  - 对计算资源的抽象，也就是容器</span><br><span class="line">  - 一个 service 旧对应一个容器</span><br><span class="line">  - 在 compose 中，通过 service 来定位容器，而不是容器名或容器 ID</span><br><span class="line">  - 在 compose 中，容器可以通过 service_name 来与其他容器进行通信</span><br><span class="line"></span><br><span class="line">* network 网络</span><br><span class="line">  - 与 docker network 概念类似，专用于 docker compose service 之间的通信</span><br><span class="line"></span><br><span class="line">* volumes 卷</span><br><span class="line">  - 与 docker volume 概念类似，专用于提供给 docker compose service 进行持久化存储</span><br><span class="line"></span><br><span class="line">* config</span><br><span class="line">  - 与 k8s 的 configmap 类似，专用于提供给 docker compose service 用于保存配置</span><br><span class="line"></span><br><span class="line">* secret</span><br><span class="line">  - 与 k8s 的 secret 类似，专用于给提供给 docker compose service 保存敏感信息</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-compose-安装"><a href="#知识点：docker-compose-安装" class="headerlink" title="知识点：docker compose 安装"></a>知识点：docker compose 安装</h3><ol>
<li><strong>compose plugin</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> repo 方式安装</span></span><br><span class="line">yum -y install docker-compose-plugin</span><br><span class="line">apt-get -y install docker-compose-plugin</span><br><span class="line">docker compose version</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> manual 方式安装</span></span><br><span class="line">DOCKER_CONFIG=$&#123;DOCKER_CONFIG:-$HOME/.docker&#125;</span><br><span class="line">mkdir -p $DOCKER_CONFIG/cli-plugins</span><br><span class="line">curl -SL https://github.com/docker/compose/releases/download/v2.30.3/docker-compose-linux-x86_64 -o $DOCKER_CONFIG/cli-plugins/docker-compose</span><br><span class="line">chmod +x $DOCKER_CONFIG/cli-plugins/docker-compose</span><br><span class="line">chmod +x /usr/local/lib/docker/cli-plugins/docker-compose</span><br><span class="line">docker compose version</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看 docker compose 程序文件</span></span><br><span class="line">docker info --format &#x27;&#123;&#123;range .ClientInfo.Plugins&#125;&#125;&#123;&#123;if eq .Name &quot;compose&quot;&#125;&#125;&#123;&#123;.Path&#125;&#125;&#123;&#123;end&#125;&#125;&#123;&#123;end&#125;&#125;&#x27;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>standalone</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装</span></span><br><span class="line">curl -SL https://github.com/docker/compose/releases/download/v2.30.3/docker-compose-linux-x86_64 -o /usr/local/bin/docker-compose</span><br><span class="line">chmod u+x /usr/local/bin/docker-compose</span><br><span class="line">docker-compose version</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-compose-环境变量"><a href="#知识点：docker-compose-环境变量" class="headerlink" title="知识点：docker compose 环境变量"></a>知识点：docker compose 环境变量</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-compose-官方示例"><a href="#知识点：docker-compose-官方示例" class="headerlink" title="知识点：docker compose 官方示例"></a>知识点：docker compose 官方示例</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 启动一个 redis 容器，在内部维持一个计数器</span><br><span class="line">  - 启动一个 flask 容器，对外提供一个 web 门户</span><br><span class="line">  - 每次访问 web 门户，计数器计数加一</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>准备工作</strong></li>
</ol>
<ul>
<li>创建项目目录<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">mkdir composetest</span><br><span class="line">cd composetest</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>创建 flask 容器的运行脚本<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; app.py &lt;&lt; EOF</span><br><span class="line">import time</span><br><span class="line"></span><br><span class="line">import redis</span><br><span class="line">from flask import Flask</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line">cache = redis.Redis(host=&#x27;redis&#x27;, port=6379)</span><br><span class="line"></span><br><span class="line">def get_hit_count():</span><br><span class="line">    retries = 5</span><br><span class="line">    while True:</span><br><span class="line">        try:</span><br><span class="line">            return cache.incr(&#x27;hits&#x27;)</span><br><span class="line">        except redis.exceptions.ConnectionError as exc:</span><br><span class="line">            if retries == 0:</span><br><span class="line">                raise exc</span><br><span class="line">            retries -= 1</span><br><span class="line">            time.sleep(0.5)</span><br><span class="line"></span><br><span class="line">@app.route(&#x27;/&#x27;)</span><br><span class="line">def hello():</span><br><span class="line">    count = get_hit_count()</span><br><span class="line">    return f&#x27;Hello World! I have been seen &#123;count&#125; times.\n&#x27;</span><br><span class="line">EOF</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>创建 flask 容器的依赖列表<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; requirements.txt &lt;&lt; EOF</span><br><span class="line">flask</span><br><span class="line">redis</span><br><span class="line">EOF</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>创建 flask 容器的 Dockerfile<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; Dockerfile &lt;&lt; EOF</span><br><span class="line"><span class="meta">#</span><span class="bash"> syntax=docker/dockerfile:1</span></span><br><span class="line">FROM python:3.10-alpine</span><br><span class="line">WORKDIR /code</span><br><span class="line">ENV FLASK_APP=app.py</span><br><span class="line">ENV FLASK_RUN_HOST=0.0.0.0</span><br><span class="line">RUN sed -i &#x27;s/dl-cdn.alpinelinux.org/mirrors.tuna.tsinghua.edu.cn/g&#x27; /etc/apk/repositories &amp;&amp; apk add --no-cache gcc musl-dev linux-headers</span><br><span class="line">COPY requirements.txt requirements.txt</span><br><span class="line">RUN pip install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple</span><br><span class="line">EXPOSE 5000</span><br><span class="line">COPY . .</span><br><span class="line">CMD [&quot;flask&quot;, &quot;run&quot;, &quot;--debug&quot;]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>创建 web.yaml<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; web.yaml &lt;&lt; EOF</span><br><span class="line">services:</span><br><span class="line">  web:</span><br><span class="line">    build: .</span><br><span class="line">    ports:</span><br><span class="line">    - &quot;8000:5000&quot;</span><br><span class="line">EOF</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>创建 redis.yaml<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; redis.yaml &lt;&lt; EOF</span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: &quot;redis:alpine&quot;</span><br><span class="line">EOF</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li>创建 compose.yaml<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">cat &gt; compose.yaml &lt;&lt; EOF</span><br><span class="line">include:</span><br><span class="line">- web.yaml</span><br><span class="line">- redis.yaml</span><br><span class="line">EOF</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ul>
<ol start="3">
<li><strong>启动和测试</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动 docker compose</span></span><br><span class="line">docker compose up -d</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看项目</span></span><br><span class="line">docker compose ls</span><br><span class="line">NAME                STATUS              CONFIG FILES</span><br><span class="line">composetest         running(2)          /root/composetest/compose.yaml</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看容器</span></span><br><span class="line">docker compose ps</span><br><span class="line">NAME                  IMAGE             COMMAND                  SERVICE   CREATED       STATUS          PORTS</span><br><span class="line">composetest-redis-1   redis:alpine      &quot;docker-entrypoint.s…&quot;   redis     2 hours ago   Up 45 seconds   6379/tcp</span><br><span class="line">composetest-web-1     composetest-web   &quot;flask run --debug&quot;      web       2 hours ago   Up 45 seconds   0.0.0.0:8000-&gt;5000/tcp, :::8000-&gt;5000/tcp</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 测试</span></span><br><span class="line">curl http://127.0.0.1:8000</span><br><span class="line">Hello World! I have been seen 1 times.</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="8-2-DockerCompose-指令"><a href="#8-2-DockerCompose-指令" class="headerlink" title="8.2 DockerCompose 指令"></a>8.2 DockerCompose 指令</h2><hr>
<h3 id="知识点：docker-compose-指令"><a href="#知识点：docker-compose-指令" class="headerlink" title="知识点：docker compose 指令"></a>知识点：docker compose 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - docker compose 的执行指令</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker compose [COMPOSE-OPTIONS] SUB-COMMAND [SUB-COMMAND-ARGS]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>compose 选项</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 只能放在 docker compose 和 sub-command 之间的选项</span><br><span class="line">  - 适用于 docker compose 的全部子命令</span><br><span class="line"></span><br><span class="line">* -f, --file</span><br><span class="line">  - 指定使用的 compose，而不是默认的 compose.yml</span><br><span class="line">  - 可以使用多个 -f 选项来指定多个 compose file</span><br><span class="line">    - 当使用多个 compose file 时，docker compose 会将所有的 compose 合并为一个文件，然后再执行</span><br><span class="line">    - docker compose 会按照提供的文件的顺序来进行构建，后面的文件将追加、覆盖到其先前的文件</span><br><span class="line">    - When you use multiple Compose files, all paths in the files are relative to the first configuration file specified with -f. You can use the --project-directory option to override this base path.</span><br><span class="line"></span><br><span class="line">* -p, --project-name</span><br><span class="line">  - 指定的工程名</span><br><span class="line"></span><br><span class="line">* --env-file</span><br><span class="line">  - Specify an alternate environment file</span><br><span class="line"></span><br><span class="line">* --dry-run</span><br><span class="line">  - 干跑，仅测试</span><br><span class="line">  - 干跑会显示 docker compose 真正执行时会进行的所有步骤</span><br><span class="line"></span><br><span class="line">* --parallel</span><br><span class="line">  - 指定并发度，默认 -1 表示 unlimited</span><br><span class="line"></span><br><span class="line">* --profile</span><br><span class="line">  - Specify a profile to enable</span><br><span class="line"></span><br><span class="line">* --progress</span><br><span class="line">  - 设置输出信息的格式</span><br><span class="line">  - 可选值包括 auto、tty、plain、json、quiet</span><br><span class="line"></span><br><span class="line">* --project-directory</span><br><span class="line">  - Specify an alternate working directory</span><br><span class="line">  - default: the path of the, first specified, Compose file</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 使用 -f 指定 compose file</span></span><br><span class="line">docker compose -f 1.yaml up</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 使用 -f 指定多个 compose file</span></span><br><span class="line">docker compose -f 1.yaml -f 2.yaml up</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-compose-ls-指令"><a href="#知识点：docker-compose-ls-指令" class="headerlink" title="知识点：docker compose ls 指令"></a>知识点：docker compose ls 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 列出 running 的 compose projects</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker compose ls [OPTIONS]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>选项</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* -a, --all</span><br><span class="line">  - 列出所有的 compose projects，包括 stopped 的</span><br><span class="line"></span><br><span class="line">* --filter</span><br><span class="line">  - Filter output based on conditions provided</span><br><span class="line"></span><br><span class="line">* --format [table | json]</span><br><span class="line">  - 指定输出格式</span><br><span class="line"></span><br><span class="line">* -q, --quiet</span><br><span class="line">  - Only display project names</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-compose-up-x2F-down-指令"><a href="#知识点：docker-compose-up-x2F-down-指令" class="headerlink" title="知识点：docker compose up&#x2F;down 指令"></a>知识点：docker compose up&#x2F;down 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">* docker compose up</span><br><span class="line">  - 启动 docker compose 项目</span><br><span class="line"></span><br><span class="line">* docker compose down</span><br><span class="line">  - 下线 docker compose 项目并删除相关资源</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker compose up [OPTIONS] [SERVICE...]</span><br><span class="line">  docker compose down [OPTIONS] [SERVICES]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-compose-config-指令"><a href="#知识点：docker-compose-config-指令" class="headerlink" title="知识点：docker compose config 指令"></a>知识点：docker compose config 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 解析、检查 compose file</span><br><span class="line">  - 会将所有的 compose file 子文件全部整合在一起，会对环境变量进行替换</span><br><span class="line">  - 如果 compose file 语法没有问题，则把最终解析的结果打印出来</span><br><span class="line">  - 如果 compose file 语法有问题，则会报错</span><br><span class="line"></span><br><span class="line">* 格式</span><br><span class="line">  docker compose comfig [OPTIOMS]</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>选项</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">* --format yaml|json</span><br><span class="line">  - 指定输出格式</span><br><span class="line"></span><br><span class="line">* --images</span><br><span class="line">  - 仅输出使用的镜像</span><br><span class="line"></span><br><span class="line">* --services</span><br><span class="line">  - 仅输出 service 名字</span><br><span class="line"></span><br><span class="line">* --profiles</span><br><span class="line">  - 仅输出 profile 名字</span><br><span class="line"></span><br><span class="line">* --volumes</span><br><span class="line">  - 仅输出 volume</span><br><span class="line"></span><br><span class="line">* --no-interpolate</span><br><span class="line">  - 不对环境变量进行替换</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例</strong><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> ll</span></span><br><span class="line">total 24</span><br><span class="line">-rw-r--r-- 1 root root 506 Jun  3 15:15 app.py</span><br><span class="line">-rw-r--r-- 1 root root  33 Jun  3 16:39 compose.yaml</span><br><span class="line">-rw-r--r-- 1 root root 427 Jun  3 14:16 Dockerfile</span><br><span class="line">-rw-r--r-- 1 root root  45 Jun  3 16:39 redis.yaml</span><br><span class="line">-rw-r--r-- 1 root root  12 Jun  3 13:53 requirements.txt</span><br><span class="line">-rw-r--r-- 1 root root  69 Jun 17 10:46 web.yaml</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> cat compose.yaml</span> </span><br><span class="line">include:</span><br><span class="line">- web.yaml</span><br><span class="line">- redis.yaml</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> docker compose config</span></span><br><span class="line">name: composetest</span><br><span class="line">services:</span><br><span class="line">  redis:</span><br><span class="line">    image: redis:alpine</span><br><span class="line">    networks:</span><br><span class="line">      default: null</span><br><span class="line">  web:</span><br><span class="line">    build:</span><br><span class="line">      context: /root/composetest</span><br><span class="line">      dockerfile: Dockerfile</span><br><span class="line">    networks:</span><br><span class="line">      default: null</span><br><span class="line">    ports:</span><br><span class="line">      - mode: ingress</span><br><span class="line">        target: 5000</span><br><span class="line">        published: &quot;8001&quot;</span><br><span class="line">        protocol: tcp</span><br><span class="line">networks:</span><br><span class="line">  default:</span><br><span class="line">    name: composetest_default</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：docker-compose-ps-指令"><a href="#知识点：docker-compose-ps-指令" class="headerlink" title="知识点：docker compose ps 指令"></a>知识点：docker compose ps 指令</h3><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">* docker compose ps [-a]</span><br><span class="line">  - 显示所有容器</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<hr>
<h3 id="知识点：docker-compose-top-指令"><a href="#知识点：docker-compose-top-指令" class="headerlink" title="知识点：docker compose top 指令"></a>知识点：docker compose top 指令</h3><hr>
<h3 id="知识点：docker-compose-logs-指令"><a href="#知识点：docker-compose-logs-指令" class="headerlink" title="知识点：docker compose logs 指令"></a>知识点：docker compose logs 指令</h3><hr>
<h3 id="知识点：docker-compose-exec-指令"><a href="#知识点：docker-compose-exec-指令" class="headerlink" title="知识点：docker compose exec 指令"></a>知识点：docker compose exec 指令</h3><hr>
<h3 id="知识点：docker-compose-images-x2F-push-x2F-pull-指令"><a href="#知识点：docker-compose-images-x2F-push-x2F-pull-指令" class="headerlink" title="知识点：docker compose images&#x2F;push&#x2F;pull 指令"></a>知识点：docker compose images&#x2F;push&#x2F;pull 指令</h3><hr>
<h3 id="知识点：docker-compose-version-指令"><a href="#知识点：docker-compose-version-指令" class="headerlink" title="知识点：docker compose version 指令"></a>知识点：docker compose version 指令</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - 显示 docker compose 的版本信息</span><br><span class="line"></span><br><span class="line">格式</span><br><span class="line">  docker compose version</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="8-3-Compose-File"><a href="#8-3-Compose-File" class="headerlink" title="8.3 Compose File"></a>8.3 Compose File</h2><hr>
<h3 id="知识点：Compose-file-介绍"><a href="#知识点：Compose-file-介绍" class="headerlink" title="知识点：Compose file 介绍"></a>知识点：Compose file 介绍</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">* 介绍</span><br><span class="line">  - docker compose 中的资源定义文件，与 k8s 中的资源定义文件概念相同</span><br><span class="line">  - docker compose 的一切操作均围绕 Compose file 进行</span><br><span class="line"></span><br><span class="line">* top-level elements</span><br><span class="line">  - name</span><br><span class="line">  - service</span><br><span class="line">  - network</span><br><span class="line">  - volume</span><br><span class="line">  - config</span><br><span class="line">  - secret</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>Compose file 的版本</strong></li>
<li><strong>Compose file 的名称</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">* 名称和路径</span><br><span class="line">  - 在没有特殊指定的情况下，Compose file 默认放在 working directory 下，命名为 compose.yaml 或 compose.yml</span><br><span class="line">  - 也可以命名为 docker-compose.yaml 或 docker-compose.yml 但不推荐，优先级较低</span><br><span class="line">  - docker compose 的 -f 选项可以指定使用的 compose file</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>Compose file 多文件组合</strong></li>
</ol>
<hr>
<h3 id="知识点：Compose-file-fragments"><a href="#知识点：Compose-file-fragments" class="headerlink" title="知识点：Compose file fragments"></a>知识点：Compose file fragments</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：Compose-file-extensions"><a href="#知识点：Compose-file-extensions" class="headerlink" title="知识点：Compose file extensions"></a>知识点：Compose file extensions</h3><ol>
<li><strong>介绍</strong><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h3 id="知识点：Compose-file-范例"><a href="#知识点：Compose-file-范例" class="headerlink" title="知识点：Compose file 范例"></a>知识点：Compose file 范例</h3><ol>
<li><strong>范例一，docker 官方范例，启动一个 webapp + database 的工程工程</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="attr">frontend:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">example/webapp</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;443:8043&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">front-tier</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">back-tier</span></span><br><span class="line">    <span class="attr">configs:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">httpd-config</span></span><br><span class="line">    <span class="attr">secrets:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">server-certificate</span></span><br><span class="line"></span><br><span class="line">  <span class="attr">backend:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">example/database</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">db-data:/etc/data</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">back-tier</span></span><br><span class="line"></span><br><span class="line"><span class="attr">volumes:</span></span><br><span class="line">  <span class="attr">db-data:</span></span><br><span class="line">    <span class="attr">driver:</span> <span class="string">flocker</span></span><br><span class="line">    <span class="attr">driver_opts:</span></span><br><span class="line">      <span class="attr">size:</span> <span class="string">&quot;10GiB&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="attr">configs:</span></span><br><span class="line">  <span class="attr">httpd-config:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">secrets:</span></span><br><span class="line">  <span class="attr">server-certificate:</span></span><br><span class="line">    <span class="attr">external:</span> <span class="literal">true</span></span><br><span class="line"></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="comment"># The presence of these objects is sufficient to define them</span></span><br><span class="line">  <span class="attr">front-tier:</span> &#123;&#125;</span><br><span class="line">  <span class="attr">back-tier:</span> &#123;&#125;</span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
<li><strong>范例二，启动一个 mysql+redis 工程</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">test_project_1</span></span><br><span class="line"><span class="comment"># 容器配置</span></span><br><span class="line"><span class="attr">services:</span></span><br><span class="line">  <span class="comment"># mysql 容器配置</span></span><br><span class="line">  <span class="attr">mysql01:</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">m01</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">mysql:5.7</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;3306:3306&quot;</span></span><br><span class="line">    <span class="attr">volumes:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/data/ContainerData/m01/log:/var/log/mysql</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/data/ContainerData/m01/data:/var/lib/mysql</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">/data/ContainerData/m01/conf:/etc/mysql/conf</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">network01</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">network02</span></span><br><span class="line">    <span class="attr">environment:</span></span><br><span class="line">      <span class="attr">MYSQL_ROOT_PASSWORD:</span> <span class="string">&#x27;12345678&#x27;</span></span><br><span class="line">      <span class="attr">MYSQL_DATABASE:</span> <span class="string">&#x27;DB01&#x27;</span></span><br><span class="line">      <span class="attr">MYSQL_USER:</span> <span class="string">&#x27;xyz&#x27;</span></span><br><span class="line">      <span class="attr">MYSQL_PASSWD:</span> <span class="string">&#x27;123456&#x27;</span></span><br><span class="line">    <span class="attr">depends_on:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">redis01</span></span><br><span class="line">  <span class="comment"># redis 容器配置</span></span><br><span class="line">  <span class="attr">redis01:</span></span><br><span class="line">    <span class="attr">image:</span> <span class="string">redis</span></span><br><span class="line">    <span class="attr">container_name:</span> <span class="string">r01</span></span><br><span class="line">    <span class="attr">ports:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&quot;6381:6379&quot;</span></span><br><span class="line">    <span class="attr">networks:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">network02</span></span><br><span class="line"><span class="comment"># 网络配置</span></span><br><span class="line"><span class="attr">networks:</span></span><br><span class="line">  <span class="attr">network01:</span></span><br><span class="line">  <span class="attr">network02:</span></span><br><span class="line"></span><br></pre></td></tr></table></figure></li>
</ol>
<hr>
<h2 id="8-4-Service-语法"><a href="#8-4-Service-语法" class="headerlink" title="8.4 Service 语法"></a>8.4 Service 语法</h2><hr>
<h3 id="知识点：compose-service-介绍"><a href="#知识点：compose-service-介绍" class="headerlink" title="知识点：compose service 介绍"></a>知识点：compose service 介绍</h3><hr>
<h3 id="知识点：service-SERVICE-NAME-configs"><a href="#知识点：service-SERVICE-NAME-configs" class="headerlink" title="知识点：service.SERVICE_NAME.configs"></a>知识点：service.SERVICE_NAME.configs</h3><hr>
<h3 id="知识点：service-SERVICE-NAME-cap-X"><a href="#知识点：service-SERVICE-NAME-cap-X" class="headerlink" title="知识点：service.SERVICE_NAME.cap_X"></a>知识点：service.SERVICE_NAME.cap_X</h3><hr>
<h3 id="知识点：service-SERVICE-NAME-cgroup-X"><a href="#知识点：service-SERVICE-NAME-cgroup-X" class="headerlink" title="知识点：service.SERVICE_NAME.cgroup_X"></a>知识点：service.SERVICE_NAME.cgroup_X</h3><hr>
<h3 id="知识点：service-SERVICE-NAME-cpu-X"><a href="#知识点：service-SERVICE-NAME-cpu-X" class="headerlink" title="知识点：service.SERVICE_NAME.cpu_X"></a>知识点：service.SERVICE_NAME.cpu_X</h3><hr>
<h3 id="知识点：service-SERVICE-NAME-dns-X"><a href="#知识点：service-SERVICE-NAME-dns-X" class="headerlink" title="知识点：service.SERVICE_NAME.dns_X"></a>知识点：service.SERVICE_NAME.dns_X</h3><hr>
<h3 id="知识点：service-SERVICE-NAME-entrypoint"><a href="#知识点：service-SERVICE-NAME-entrypoint" class="headerlink" title="知识点：service.SERVICE_NAME.entrypoint"></a>知识点：service.SERVICE_NAME.entrypoint</h3><hr>
<h3 id="知识点：service-SERVICE-NAME-env-file"><a href="#知识点：service-SERVICE-NAME-env-file" class="headerlink" title="知识点：service.SERVICE_NAME.env_file"></a>知识点：service.SERVICE_NAME.env_file</h3><hr>
<h3 id="知识点：service-SERVICE-NAME-environment"><a href="#知识点：service-SERVICE-NAME-environment" class="headerlink" title="知识点：service.SERVICE_NAME.environment"></a>知识点：service.SERVICE_NAME.environment</h3><hr>
<h3 id="知识点：service-SERVICE-NAME-expose"><a href="#知识点：service-SERVICE-NAME-expose" class="headerlink" title="知识点：service.SERVICE_NAME.expose"></a>知识点：service.SERVICE_NAME.expose</h3><hr>
<h3 id="知识点：service-SERVICE-NAME-extra-hosts"><a href="#知识点：service-SERVICE-NAME-extra-hosts" class="headerlink" title="知识点：service.SERVICE_NAME.extra_hosts"></a>知识点：service.SERVICE_NAME.extra_hosts</h3><hr>
<h3 id="知识点：service-SERVICE-NAME-labels"><a href="#知识点：service-SERVICE-NAME-labels" class="headerlink" title="知识点：service.SERVICE_NAME.labels"></a>知识点：service.SERVICE_NAME.labels</h3><hr>
<h3 id="知识点：service-其他语法"><a href="#知识点：service-其他语法" class="headerlink" title="知识点：service 其他语法"></a>知识点：service 其他语法</h3><hr>
<h2 id="8-5-Volume-语法"><a href="#8-5-Volume-语法" class="headerlink" title="8.5 Volume 语法"></a>8.5 Volume 语法</h2><hr>
<h3 id="知识点：compose-volume-介绍"><a href="#知识点：compose-volume-介绍" class="headerlink" title="知识点：compose volume 介绍"></a>知识点：compose volume 介绍</h3><hr>
<h2 id="8-6-Network-语法"><a href="#8-6-Network-语法" class="headerlink" title="8.6 Network 语法"></a>8.6 Network 语法</h2><hr>
<h3 id="知识点：compose-network-介绍"><a href="#知识点：compose-network-介绍" class="headerlink" title="知识点：compose network 介绍"></a>知识点：compose network 介绍</h3><hr>
<h2 id="8-7-Build-语法"><a href="#8-7-Build-语法" class="headerlink" title="8.7 Build 语法"></a>8.7 Build 语法</h2><hr>
<h2 id="8-8-其他语法"><a href="#8-8-其他语法" class="headerlink" title="8.8 其他语法"></a>8.8 其他语法</h2>
    </div>

    
    
    

    <footer class="post-footer">

        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/2000/01/01/Blog21-hadoop/" rel="prev" title="Blog21-hadoop">
                  <i class="fa fa-chevron-left"></i> Blog21-hadoop
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/2000/01/01/Blog32-containerd/" rel="next" title="Blog32-containerd">
                  Blog32-containerd <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 2000 – 
  <span itemprop="copyrightYear">2025</span>
  <span class="with-love">
    <i class="fa fa-heart"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">John Doe</span>
</div>
  <div class="powered-by">Powered by <a href="https://hexo.io/" rel="noopener" target="_blank">Hexo</a> & <a href="https://theme-next.js.org/muse/" rel="noopener" target="_blank">NexT.Muse</a>
  </div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/motion.js"></script><script src="/js/schemes/muse.js"></script><script src="/js/next-boot.js"></script>

  





  




  

  <script class="next-config" data-name="enableMath" type="application/json">false</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"per_page":true,"tags":"none","cdn":"//cdn.bootcss.com/mathjax/2.7.1/latest.js?config=TeX-AMS-MML_HTMLorMML","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>



</body>
</html>
